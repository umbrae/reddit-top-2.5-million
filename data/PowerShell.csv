created_utc,score,domain,id,title,ups,downs,num_comments,permalink,selftext,link_flair_text,over_18,thumbnail,subreddit_id,edited,link_flair_css_class,author_flair_css_class,is_self,name,url,distinguished
1375180123.0,48,self.PowerShell,1jc9v3,"Advanced Tools and Scripting with PowerShell 3 from Jeffrey Snover - free full day course from MS, and other videos (xpost from /r/sysadmin)",52,4,7,http://www.reddit.com/r/PowerShell/comments/1jc9v3/advanced_tools_and_scripting_with_powershell_3/,"Hi all,

Just a reminder and a few new links!

* The final full day session, [Advanced Tools and Scripting with PowerShell 3.0, is available here.](http://channel9.msdn.com/series/advpowershell3).  Thanks for the update Alektorophobia!
* The first full day sesion, [Getting Started with PowerShell 3, is available here](http://channel9.msdn.com/Series/GetStartedPowerShell3).  Thanks for the update CravesPowder!
* Jeffery Snover is one of the creators of PowerShell, and I've heard he's a good public speaker, so these sessions should be worth your while if you have any responsibilities on the Microsoft side of the house.
* Shameless plug - I keep a [list of PowerShell resources](http://ramblingcookiemonster.wordpress.com/powershell-resources/) I've found helpful in learning and using PowerShell, covering cheat sheets, blogs, videos, books, etc.  Will be weeding through these videos and adding the MVA session as appropriate.
* [PowerShell Summit 2013 videos](http://www.powershellmagazine.com/2013/05/08/powershell-summit-2013-session-recordings/) from Aaron Hoover (may be difficult to hear)
* [DevOps, Desired State, and Microsoft Windows presentation](https://www.usenix.org/conference/ucms13/devops-desired-state-and-microsoft-windows) from Bruce Payette @ USENIX

Hemant Mahawar from The PowerShell team also posted the [sessions and materials from TechEd](http://blogs.msdn.com/b/powershell/archive/2013/07/29/powershell-sessions-slides-and-demos-from-teched-2013.aspx):

**[Desired State Configuration](http://technet.microsoft.com/en-us/library/dn249912.aspx) in Windows PowerShell**

* [TechEd-NA Session Video](http://channel9.msdn.com/Events/TechEd/NorthAmerica/2013/MDC-B302)
* [TechEd-NA Slides](http://video.ch9.ms/sessions/teched/na/2013/MDC-B302.pptx)
* [TechEd-Europe Session Video](http://channel9.msdn.com/Events/TechEd/Europe/2013/MDC-B302)
* [TechEd-Europe Slides](http://video.ch9.ms/sessions/teched/eu/2013/MDC-B302.pptx)
* Demos:
* .....[DSC-Windows Server 2012 R2-Preview Demos](http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-63-74-metablogapi/3124.Demo_5F00_WindowServer2012R2_2D00_Preview_5F00_4677B514.zip)
* .....[DSC-WMF 4.0-Preview Demos](http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-63-74-metablogapi/3051.Demo_5F00_WMF4.0_2D00_Preview_5F00_5E9B1F6F.zip)

**Advance Automation using Windows PowerShell**

* [TechEd-NA Session Video](http://channel9.msdn.com/Events/TechEd/NorthAmerica/2013/MDC-B400)
* [TechEd-NA Slides](http://video.ch9.ms/sessions/teched/na/2013/MDC-B400.pptx)
* [TechEd-Europe Session Video](http://channel9.msdn.com/Events/TechEd/Europe/2013/MDC-B400)
* [TechEd-Europe Slides](http://video.ch9.ms/sessions/teched/eu/2013/MDC-B400.pptx)

**Windows PowerShell Unplugged**

* [TechEd-NA Session Video](http://channel9.msdn.com/Events/TechEd/NorthAmerica/2013/MDC-B340)
* [TechEd-NA Slides](http://video.ch9.ms/sessions/teched/na/2013/MDC-B340.pptx)
* [TechEd-Europe Session Video](http://channel9.msdn.com/Events/TechEd/Europe/2013/MDC-B340)
* [TechEd-Europe Slides](http://video.ch9.ms/sessions/teched/eu/2013/MDC-B340.pptx)

**Additional sessions, hands-on-labs and instructor-led-labs** showcasing various technology/product administration using of PowerShell automation:

* [TechEd-NA](http://channel9.msdn.com/Events/TechEd/NorthAmerica/2013?term=powershell)
* [TechEd-Europe](http://channel9.msdn.com/Events/TechEd/Europe/2013?term=powershell)

I think that's everything I've seen recently, hope you find it helpful.

Cheers!",,False,,t5_2qo1o,1376321165.0,,,True,t3_1jc9v3,http://www.reddit.com/r/PowerShell/comments/1jc9v3/advanced_tools_and_scripting_with_powershell_3/,
1340650746.0,49,self.PowerShell,vl31u,Windows 2012 Core Powershell Cheat sheet,50,1,8,http://www.reddit.com/r/PowerShell/comments/vl31u/windows_2012_core_powershell_cheat_sheet/,"Below is a list of commands that I've been compiling as a sort of internal cheat sheet.  I need to have something ready for the rest of my team, as when 2012 launches we're going to make a serious push to move things over to core.  Everything below is what I needed to be able to manage a core server, with the intent of a main 2012 server with a GUI being the managment host.  I'm still missing a simple Powershell v3 command to be able to modify the local admins group easily.  If anyone knows one please enlighten me.  I'll also update with the additional commands I used to open the firewall for remoting.  I'm wondering if enable-psremoting would be sufficient.      
  

**Update:**  Have a much simpler way to add to local admins group now.  
**Update 2:**  Learned about SCONFIG utility.  This is a configuration utility that comes with core OS installs.  It will allow you to configure many of the things listed below.  Very useful for manually configuring Networking, Domain Membership, and Remote Management.

 ==========================================================  
 
**To List Network Adapters**

    Get-NetAdapter

**To Set an IP**

    new-netIPaddress -interfaceindex 12 -IPaddress 10.110.3.206 -DefaultGateway 10.110.3.254 -AddressFamily IPv4 -prefixlength 24

**To Set DNS Servers**

    set-DNSclientserveraddress -interfaceindex 12 -serveraddresses 1.2.25.X,1.2.25.X

**To get the latest Help/Man files**

    Update-help

**To rename the computer**

    Rename-Computer hostname

**To restart the computer**

    Restart-Computer

**To show firewall rules**

    get-netfirewallrule -name *name  &lt;----  Partial names will work here, hence the use of *.  

**To bind to AD**
    
    Add-Computer -DomainName ad.example.edu -Restart

**To add AD group to Local Admin Group (20 char max name)**

    Net localgroup administrators domain\user /add

**To add AD user to Local Group (Support for &gt; 20 char name)**

    $objUser = [ADSI](""WinNT://domain/user"")
    $objGroup = [ADSI](""WinNT://computername/localgroupname"")
    $objGroup.PSBase.Invoke(""Add"",$objUser.PSBase.Path)

**To check local admin group membership**

    Net localgroup administrators  ",,False,,t5_2qo1o,1345050766.0,,,True,t3_vl31u,http://www.reddit.com/r/PowerShell/comments/vl31u/windows_2012_core_powershell_cheat_sheet/,
1359045521.0,47,self.PowerShell,1772si,Ever have trouble getting people to return their laptops? NOT ANY MORE!,60,13,16,http://www.reddit.com/r/PowerShell/comments/1772si/ever_have_trouble_getting_people_to_return_their/,"I'm sure I'm not the only sysadmin who finds it difficult to reclaim laptops from users when it's time to upgrade the OS / fire the user/ give their nice laptop to the hot new girl. No matter how much you pester them, they refuse to bring the sodding things in to my cave. Now there is of course the option of deleting their computer's AD account, but that does give the awkward ""Your admin has deleted your computer account because he hates you"" error message. Much more subtle to just RANDOMLY CORRUPT A BUNCH OF DRIVERS. To wit;

    $target = Read-Host ""What is your target?""

    (gci (""\\""+$target+""\c$\windows\system32\drivers"") | Get-Random -count 10) | % {
    takeown /f $_.fullname /a
    ICACLS $_.fullname /GRANT Administrators:F
    ""foo""+(gc $_.fullname) &gt; $_.fullname}

    shutdown -s -t 0 -m $target

The results are intentionally a bit eratic, so your lusers don't catch on to what you're up to; it might cause a BSOD, it might trigger a (few) system repairs. Who knows. At any rate, you'll be seing that machine again soon.",,False,,t5_2qo1o,False,,,True,t3_1772si,http://www.reddit.com/r/PowerShell/comments/1772si/ever_have_trouble_getting_people_to_return_their/,
1376664039.0,36,self.PowerShell,1khn9o,A fun script for Friday - make your friend's computer start talking to him/her,38,2,8,http://www.reddit.com/r/PowerShell/comments/1khn9o/a_fun_script_for_friday_make_your_friends/,"A co-worker of mine stumbled upon [this nifty blog article](http://pmckibbins.wordpress.com/2013/01/21/powershell-text-to-speech/) on how to make a text-to-speech call using PowerShell.

The article gives two examples:

* Call the SAPI.SPVoice COM object

* Load the reference to System.Speech

Where can this come in fun? Well, if you throw PSRemoting in, of course! In my testing, if you use the second method (or the pared down script below) you can make your victim's computer start talking to him or her. Here's how you do it:

1. Provide a distraction so that your victim leaves their computer unlocked, and make yourself administrator on their workstation (only needed if you aren't already an admin!)

2. Enable PSRemoting on their workstation. A method for doing this would be using [PSExec](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx):

        psexec.exe /acceptEula \\(yourVictimsComputer) -d -h -s powershell.exe """"Enable-PSRemoting -Force""""""

3. Start a new PSSession connecting to their workstation:

        New-PSSession -ComputerName YourVictimsComputer

4. Load this function:

        function Say-Text {
            param ([Parameter(Mandatory=$true, ValueFromPipeline=$true)] [string] $Text)
            [Reflection.Assembly]::LoadWithPartialName('System.Speech') | Out-Null   
            $object = New-Object System.Speech.Synthesis.SpeechSynthesizer 
            $object.Speak($Text) 
        }

5. Ensure that their volume is on. (For example, say, ""Hey I just found this really funny video!"")

6. Start speaking to them by calling the function you just made:

        Say-Text ""I'm afraid I can't do that Dave""

Have fun, and don't scare anyone too much :)

EDIT: Formatting",,False,,t5_2qo1o,1376664296.0,,,True,t3_1khn9o,http://www.reddit.com/r/PowerShell/comments/1khn9o/a_fun_script_for_friday_make_your_friends/,
1372784297.0,38,jairampatel.com,1hi9bu,"Introducing Shellit, a simple, open source Reddit client for PowerShell. [x-post from /r/coding]",40,2,4,http://www.reddit.com/r/PowerShell/comments/1hi9bu/introducing_shellit_a_simple_open_source_reddit/,,,False,,t5_2qo1o,False,,,False,t3_1hi9bu,http://www.jairampatel.com/post-2-introducing-shellit-a-reddit-client-for-powershell/,
1351079254.0,40,self.PowerShell,1201qo,"Post your favorite PowerShell functions, snippets, scripts or one-liners",46,6,39,http://www.reddit.com/r/PowerShell/comments/1201qo/post_your_favorite_powershell_functions_snippets/,"Hi all,

I figure it might be helpful to try gathering up a list of our favorite PowerShell snapins, modules, functions, snippets, scripts, or one-liners.

To format as code on Reddit, just make sure to indent each line with four spaces (e.g. highlight code in PowerShell ISE script pane and press tab).

Post a brief description and note on how you use it (if the comment-based help doesn't provide this), the author or inspiration if appropriate, and the code.  If the code is too long, submit it to [poshcode.org](http://poshcode.org/), the [Script Center Repository](http://gallery.technet.microsoft.com/scriptcenter/), or a similar service and link it here.",,False,,t5_2qo1o,1351080624.0,,,True,t3_1201qo,http://www.reddit.com/r/PowerShell/comments/1201qo/post_your_favorite_powershell_functions_snippets/,
1340043772.0,33,channel9.msdn.com,v8gu2,"Windows Powershell Crash Course [Microsoft TechEd 2012] Don Jones, Jeffrey Snover 1hr14m",39,6,2,http://www.reddit.com/r/PowerShell/comments/v8gu2/windows_powershell_crash_course_microsoft_teched/,,,False,,t5_2qo1o,False,,,False,t3_v8gu2,http://channel9.msdn.com/Events/TechEd/NorthAmerica/2012/WSV321,
1306179622.0,33,self.PowerShell,hia16,This Subreddit Has Been Revived,35,2,15,http://www.reddit.com/r/PowerShell/comments/hia16/this_subreddit_has_been_revived/,This subreddit is back from the dead. We hope to make this a valuable source of information for powershell related discussions.,,False,,t5_2qo1o,False,,,True,t3_hia16,http://www.reddit.com/r/PowerShell/comments/hia16/this_subreddit_has_been_revived/,moderator
1349365489.0,36,self.PowerShell,10xuyb,"I have created a script that will scan users homedrive for media files and send them an email with an attachment that contains a list of the files if the files size are over 1000MB and kindly asking to remove the files. Hope can be used by someone else.
",37,1,20,http://www.reddit.com/r/PowerShell/comments/10xuyb/i_have_created_a_script_that_will_scan_users/,"Import-Module activedirectory
$CSVPath = ""C:\mp3log\""
$smtpserver = ""yoursmtpserver""
$from = ""noreply@yourcompany""

$userdetails =Get-ADUser -filter * -searchscope subtree -searchbase "" OU=Main,DC=Company,DC=com"" –Properties *  
$date = get-date
$newline = ""&lt;br&gt;""
$body =""""
$res=""""


foreach ($user in $userdetails) {
 
Get-ChildItem  -Path $user.homedirectory -Include *.mp3,*.wma,*.wmv,*.mov,*.mpg,*.avi,*.api -Recurse   | select name, fullname |  export-csv ""c:\mp3log\$($user.samaccountname).csv""  -noType

[int]$res=((Get-ChildItem -Path $user.homedirectory  -Include *.mp3,*.wma,*.wmv,*.mov,*.mpg,*.avi,*.api -Recurse | Measure-Object -Sum Length).Sum / 1MB)
 
 if ($res -gt 1000) {

                
                $to = $user.emailaddress
                $subject = ""Your media files are "" + $res + "" MB "" + ""big""
                $body += "" Dear "" + $($user.givenname) + "" "" + $($user.surname) + "" "" +  ""we have detected some media files on your My Documents Folder "" + $newline + $newline
		$body += "" This files may include *.mp3,*.wma,*.wmv,*.mov,*.mpg and *.avi "" + $newline + $newline
		$body += "" Please find an attachment with the location and name of the files"" + $newline + $newline
                $body += "" If these files are genuine and work related, you don't need to do anything."" + $newline + $newline
		$body += "" However if the files are not work related please consider deleting them as they are taking space on the company file servers."" + $newline + $newline
                $body += "" Thank you for playing fair"" + $newline + $newline 
                $body += "" Message generated by the helpdesk on "" + $date + "".""
				
				$outputencoding = [system.Text.Encoding]::UTF8
				
 Send-MailMessage -smtpServer $smtpserver -from $from -to $to -subject $subject -body $body -Attachments ""c:\mp3log\$($user.samaccountname).csv""-bodyashtml -encoding $outputencoding 
 $body=""""
 $subject=""""
 $res=""""
 }
 }
 else
 {}
",,False,,t5_2qo1o,False,,,True,t3_10xuyb,http://www.reddit.com/r/PowerShell/comments/10xuyb/i_have_created_a_script_that_will_scan_users/,
1373892626.0,32,self.PowerShell,1ic49m,How to (usefully) encrypt and store credentials.,34,2,9,http://www.reddit.com/r/PowerShell/comments/1ic49m/how_to_usefully_encrypt_and_store_credentials/,"I noted this in the other thread about credentials and figured more folks would see it here.  The problem, as pointed out, is that your computer is used to generate the encryption key when you encrypt a string with convertto-securestring.  That means if you try to run the script on another computer, the decryption will fail since you'll have the wrong key.  

The solution is to provide your own key.  You can store it somewhere secure, or stick it in a text file, or really whatever you like.  You can think of it as a two-part password:  You need the encrypted password data and you need the key.  

So, step one:  Make a key.  It's just an array of 24 numbers between 0 and 255.  You can do it manually or stick it in a text file (one number per line).  Numbers can be anything you like within those bounds.  

So, 
    
    $key = (1,2,3,4,5,......,23,24)

Then, you encrypt: 

    Read-Host -AsSecureString | ConvertFrom-SecureString -Key $key | Out-File .\adminpw.dat

And maybe put your key in a file too. 

    $key &gt; ./keyfile.dat

To use it, then: 

    $key = cat ./keyfile.dat
    $password = cat ./adminpw.dat | ConvertTo-SecureString -Key $key

Perfectly safe, right?  No one can even see the password since you were super savvy and encrypted a secure string in the first place. 

Except securestrings suck. 

    $decrypted = [System.Runtime.InteropServices.marshal]::PtrToStringAuto([System.Runtime.InteropServices.marshal]::SecureStringToBSTR($password))


That's right, you can reach into the memory and yank it out any time (and so can anyone else with half a mind to find out how).  

So, the moral of the story is to keep your scripts out of the wrong hands.  Short of requiring an interactive password dialogue (no good for automation), I haven't come up with a genuinely secure way to store credentials.  

Speaking of which, you might be curious as to why you'd store them anyway.  Why not just schedule the script to run as a task, using Windows to store the credentials for the AT job?  Well, I've got one application for this that really can't be duplicated.  

Suppose you wanted to run a script against a bunch of servers, some of which are in the domain and some of which are not.  As long as you've synced up an administrative local account, you should be able to talk to everything (except domain controllers).  The caveat is that the domain must be the local computer name...which changes for each machine!

So, using the above code, I store the synced password as $password.  Then, for each box, I create a new cred: 

    $username = $computername + '\adminaccount'
    $cred = $cred = New-Object -TypeName System.Management.Automation.PSCredential `
    -ArgumentList $username, $password 

Then call 

    invoke-command -credential $cred -computername $computername -scriptblock {get-process}

or whatever you want to run remotely, as a local administrator, on any list of boxes you like.  

Enjoy.",,False,,t5_2qo1o,False,,,True,t3_1ic49m,http://www.reddit.com/r/PowerShell/comments/1ic49m/how_to_usefully_encrypt_and_store_credentials/,
1372175829.0,28,technet.microsoft.com,1h1l1c,What's New in Windows PowerShell 4.0,28,0,3,http://www.reddit.com/r/PowerShell/comments/1h1l1c/whats_new_in_windows_powershell_40/,,,False,,t5_2qo1o,False,,,False,t3_1h1l1c,http://technet.microsoft.com/library/hh857339.aspx#BKMK_workflow,
1364870050.0,26,i.imgur.com,1bhljl,Brute-forcing today's XKCD with PowerShell...,30,4,15,http://www.reddit.com/r/PowerShell/comments/1bhljl/bruteforcing_todays_xkcd_with_powershell/,,,False,,t5_2qo1o,False,,,False,t3_1bhljl,http://i.imgur.com/SgpIZgd.png,
1337623564.0,27,nexus.realtimepublishers.com,txtog,PowerShell crash course for Administrators by Don Jones,30,3,14,http://www.reddit.com/r/PowerShell/comments/txtog/powershell_crash_course_for_administrators_by_don/,,,False,,t5_2qo1o,False,,,False,t3_txtog,http://nexus.realtimepublishers.com/accwp.php?,
1354821861.0,27,microsoft.com,14ecm6,Microsoft releases Microsoft Script Explorer: PowerShell script search,33,6,5,http://www.reddit.com/r/PowerShell/comments/14ecm6/microsoft_releases_microsoft_script_explorer/,,,False,,t5_2qo1o,False,,,False,t3_14ecm6,http://www.microsoft.com/en-us/download/details.aspx?id=29101,
1365263930.0,26,self.PowerShell,1bsteu,TIL you can add properties to an existing object by using Add-Member,26,0,12,http://www.reddit.com/r/PowerShell/comments/1bsteu/til_you_can_add_properties_to_an_existing_object/,"So I'm an Exchange admin and was recently asked by my boss to pull a  CSV list of all active mailboxes in our organization. The report was to include:
  
- Username
- Display Name
- When the mailbox was created
- The last time the mailbox was accessed
  
Obtaining the first three fields was easy as they are returned by the Get-Mailbox cmdlet. The last access time, however is returned by the Get-MailboxStatistics cmdlet. Normally I would just echo the output of both commands to a file and let Excel parse it out but I wanted to use the native Export-CSV command this time. So I used Add-Member:
  
    $mbx = Get-Mailbox -ResultSize Unlimited
    $mbx | foreach {Add-Member -InputObject $_ -Type noteproperty -Name LastLogonTime -Value (Get-MailboxStatistics $_.name).lastlogontime}
  
The second command loops through each mailbox and runs the command to retrieve the last time the mailbox was accessed. It then appends that information to the mailbox object as a property. Now that I have all my information in one object I can export the data easily:
  
    $mbx | select name,displayname,whencreated,lastlogontime | export-csv mailboxreport.csv
  
Cool trick I thought I'd share. ",,False,,t5_2qo1o,1365264133.0,,,True,t3_1bsteu,http://www.reddit.com/r/PowerShell/comments/1bsteu/til_you_can_add_properties_to_an_existing_object/,
1350497208.0,26,blogs.technet.com,11n3hm,Microsoft Script Explorer - Browse Powershell scripts from TN Script Center!,27,1,5,http://www.reddit.com/r/PowerShell/comments/11n3hm/microsoft_script_explorer_browse_powershell/,,,False,,t5_2qo1o,False,,,False,t3_11n3hm,http://blogs.technet.com/b/exchange/archive/2012/03/14/check-out-microsoft-script-explorer-for-windows-powershell-pre-release.aspx,
1366111555.0,23,nomanualrequired.blogspot.com,1cge7m,Using Powershell to automate Syinternals Process Monitor.,28,5,7,http://www.reddit.com/r/PowerShell/comments/1cge7m/using_powershell_to_automate_syinternals_process/,,,False,,t5_2qo1o,False,,,False,t3_1cge7m,http://nomanualrequired.blogspot.com,
1363049424.0,24,tech.collectedit.com,1a48yy,Using Powershell for ‘one click’ build and deploy,28,4,2,http://www.reddit.com/r/PowerShell/comments/1a48yy/using_powershell_for_one_click_build_and_deploy/,,,False,,t5_2qo1o,False,,,False,t3_1a48yy,http://tech.collectedit.com/post/2013/03/10/Using-Powershell-for-one-click-build-and-deploy.aspx,
1339561033.0,25,self.PowerShell,uz9pt,"Created a script to check Craigslist for new car postings, based on criteria; emails alert/details to you with new posts that match. Script inside...",25,0,9,http://www.reddit.com/r/PowerShell/comments/uz9pt/created_a_script_to_check_craigslist_for_new_car/,"So, been looking for a cheap car lately for a track slut, but tired of cruising craigslist manually for what I want. That, and I want results to come to me; I don't want to use an intermediate site to check posts, either.

Enter, this script: [http://pastebin.com/UYNRXMHL](http://pastebin.com/UYNRXMHL)

A few notes:

* All preferences can be configured with the variables at the beginning of the script
* `$Regions` and `$Searches` are arrays; you can define more than one
* All search strings can include [advanced craigslist search functions](http://www.craigslist.org/about/help/search)
* There are issues with results if you stray from the `cta` section (cars+trucks for sale), but it is easily adaptable to any section if you want to make it work elsewhere (housing, for example; mainly lines 107 through 125)
* ""cache"" is stored in flat text files, and checks dupes against the full URL; cache location can be set manually.
* there really isn't much error checking, and there are a lot of assumptions; if craigslist changes HTML structure, the script will likely break.
* I hit numerous bugs along the way with how craigslist lays out results depending on a lot of different factors. there are likely more bugs i have not hit yet, but the basic functionality works great!

I hope this is useful to someone other than myself and a few friends!",,False,,t5_2qo1o,False,,,True,t3_uz9pt,http://www.reddit.com/r/PowerShell/comments/uz9pt/created_a_script_to_check_craigslist_for_new_car/,
1335488547.0,25,self.PowerShell,suiy2,"This is what victory smells like.  First ""complex"" script - get all servers list of users is logged onto.",26,1,15,http://www.reddit.com/r/PowerShell/comments/suiy2/this_is_what_victory_smells_like_first_complex/,"I am REALLY proud of this, and don't really know anyone who can really appreciate the effort that went into writing it.  I wrote pretty much every character, modeling some of it after stuff I found online, but I had a hard time finding any examples of throttling jobs and getting the data back out of jobs.  Oh, and I've only really been playing with powershell for about 3 weeks.  It's insanely powerful.

It would be pretty easy to modify to get a list of users from a file or a list of servers from a file.  If you get the list of servers from a file you would need to change all of the $s.name instances to $s.

    $starttime = get-date
    
    # Gets all servers from the servers OU in fabrikam.com:
    write-host ""Getting server list.""
    $servers = get-adcomputer -Filter {name -like ""*""} -SearchBase ""ou=servers,dc=fabrikam,dc=com"" -SearchScope Subtree | sort-object name
    
    # Creates an array of obects called ""lanObj"" that has a custom Name and Servers property
    $lanIDs = ""Bill"",""Ted"",""Abe"",""Sam""
    $lanObj = @()
    $count = 0
    foreach ($objTech in $lanIDs){
        $objTech = New-Object System.Object
        $objTech | Add-Member -type NoteProperty -name Name -value $lanIDs[$count]
        $ObjTech | Add-Member -type NoteProperty -name Servers -value $null
        $lanObj += $objTech
        $count = $count + 1}
    
    # Starts a job for each server which pulls the owner of all explore.exe processes.
    write-host 'Querying' $servers.count 'servers.'
    $JobCount = 0
    $conjobs = 25 # Number of jobs to run concurrently.
    foreach ($s in $servers) {
        #write-host ""Jobcount is $jobcount at start of foreach.""
        start-job -name $s.name {Get-WMIObject Win32_Process -filter 'name=""explorer.exe""' -computername $using:s.name | ForEach-Object { $owner = $_.GetOwner(); $owner.User } | Get-Unique}
        start-sleep -m 100
        $RunningJobs = get-job -state running
        $JobCount = @($RunningJobs).count
        #write-host ""Jobcount is $jobcount before loop""
        if ($JobCount -ge $ConJobs){
            do {write-host ""Job limit of $conjobs hit.  Sleeping.""
                start-sleep 10
                $runningjobs = get-job -state running
                $JobCount = @($RunningJobs).count
                write-host ""Resuming.  Job count is $jobcount of $conjobs""}
            until ($jobCount -lt $ConJobs)
        }
    }
    write-host ""All jobs started.""
    
    # Checks to make sure all jobs are complete.
    $RunningJobs = get-job -state running
    $JobCount = @($RunningJobs).count
    if ($JobCount -ge 1){
        write-host ""Sleeping until all jobs complete.""
        do {start-sleep 5
            $runningjobs = get-job -state running
            $JobCount = @($RunningJobs).count
            write-host ""Running job count is $jobcount.""}
        until ($jobCount -lt 1)
    }
    
    
    # Gets the information from each job and puts it into the server property for any user who is logged in.
    $count = 0
    foreach ($s in $servers){
        $count += 1
        write-host 'Receiving and parsing job' $s.name
        $users = $null
        $users = receive-job $s.Name
        if ($users -ne $null){
            foreach ($u in $users){
                if ($lanIDs -contains $u){
                    foreach ($l in $lanObj){
                        if ($l.name -eq $u){
                            $l.servers += ($s.name | out-string)
                        }
                    }
                }
            }
        }
    }
    
    write-host ""`n""
    write-host ""Servers each user is logged onto:""
    write-host ""`n""
    
    # Spits out a nice list for each user and the servers they are logged onto.
    $count = 0
    foreach ($o in $lanobj){
        if ($lanobj
            write-host $lanobj
            write-host $lanobj
        }
        $count = $count + 1  
    }
    
    # Time keeping.
    $finishtime = get-date
    $totaltime = $finishtime - $starttime
    
    write-host ""Start time: "" $starttime
    write-host ""Finish time:"" $finishtime
    Write-Host ""Total time: "" $totaltime
    
    # Remove jobs.
    foreach ($s in $servers) {remove-job $s.name}
    write-host ""Jobs removed.""",,False,,t5_2qo1o,True,,,True,t3_suiy2,http://www.reddit.com/r/PowerShell/comments/suiy2/this_is_what_victory_smells_like_first_complex/,
1324352939.0,24,gallery.technet.microsoft.com,nje4k,Windows System Administration tool 2.0,27,3,4,http://www.reddit.com/r/PowerShell/comments/nje4k/windows_system_administration_tool_20/,,,False,,t5_2qo1o,False,,,False,t3_nje4k,http://gallery.technet.microsoft.com/Arposh-Windows-System-a1beb102,
1353335399.0,24,self.PowerShell,13g8zc,Powershell homework,30,6,12,http://www.reddit.com/r/PowerShell/comments/13g8zc/powershell_homework/,"Lets come up with a list of 30 or so tasks that increasingly get more difficult, so we can get some powershell practise in. If everyone adds one task, Ill compile the list and post a google document. Thoughts? ",,False,,t5_2qo1o,False,,,True,t3_13g8zc,http://www.reddit.com/r/PowerShell/comments/13g8zc/powershell_homework/,
1346804346.0,24,microsoft.com,zd5p3,Windows Management Framework 3.0 Released,28,4,3,http://www.reddit.com/r/PowerShell/comments/zd5p3/windows_management_framework_30_released/,,,False,,t5_2qo1o,False,,,False,t3_zd5p3,http://www.microsoft.com/en-us/download/details.aspx?id=34595,
1306182642.0,24,blogs.msdn.com,hibfh,"In honor of the revival, here's a PS cheat sheet I keep pinned to my cube wall.",25,1,4,http://www.reddit.com/r/PowerShell/comments/hibfh/in_honor_of_the_revival_heres_a_ps_cheat_sheet_i/,,,False,,t5_2qo1o,False,,,False,t3_hibfh,http://blogs.msdn.com/cfs-filesystemfile.ashx/__key/communityserver-components-postattachments/00-01-52-56-34/Cheat-Sheet-V1.00.pdf,
1375895831.0,24,self.PowerShell,1jw87d,"Just picking up PowerShell, can anyone explain this?",24,0,35,http://www.reddit.com/r/PowerShell/comments/1jw87d/just_picking_up_powershell_can_anyone_explain_this/,"I'm going through the very simple beginner tutorials and I run into what seems like an inconsistency.
 
Why does this work:

    Get-service -name &lt;name&gt;

But not this:

    Get-service -status &lt;status&gt;

I can get the results I'm looking for using 'where-object' but I am curious why using -status does not work.",[Core],False,,t5_2qo1o,False,,,True,t3_1jw87d,http://www.reddit.com/r/PowerShell/comments/1jw87d/just_picking_up_powershell_can_anyone_explain_this/,
1369263155.0,22,self.PowerShell,1ev6x7,I'm so spoiled by PowerShell,28,6,26,http://www.reddit.com/r/PowerShell/comments/1ev6x7/im_so_spoiled_by_powershell/,"I'm trying to learn Python for Mac OS X automation and it's making me realize how damn spoiled I am with PowerShell.. between get-member, get-command, and get-help pretty much anyone can stumble along in PowerShell.... Holy crap!",,False,,t5_2qo1o,False,,,True,t3_1ev6x7,http://www.reddit.com/r/PowerShell/comments/1ev6x7/im_so_spoiled_by_powershell/,
1363673479.0,23,code.msdn.microsoft.com,1akv23,PowerShell 3.0 SDK Sample Pack released with more than 50 sample projects,23,0,8,http://www.reddit.com/r/PowerShell/comments/1akv23/powershell_30_sdk_sample_pack_released_with_more/,,,False,,t5_2qo1o,False,,,False,t3_1akv23,http://code.msdn.microsoft.com/Windows-PowerShell-30-SDK-9a34641d,
1340815803.0,22,stackoverflow.com,voxl1,I love PowerShell. This just saved me many hours of work.,24,2,2,http://www.reddit.com/r/PowerShell/comments/voxl1/i_love_powershell_this_just_saved_me_many_hours/,,,False,,t5_2qo1o,False,,,False,t3_voxl1,http://stackoverflow.com/questions/4381943/how-to-export-csv-of-active-directory-objects,
1329969562.0,23,i.imgur.com,q2042,Maybe I should spend some time trying to optimize my scripts..,26,3,12,http://www.reddit.com/r/PowerShell/comments/q2042/maybe_i_should_spend_some_time_trying_to_optimize/,,,False,,t5_2qo1o,False,,,False,t3_q2042,http://i.imgur.com/yIBR5.png,
1308591234.0,22,microsoft.com,i4heo,PowerShell: Learn it now before it's an emergency! (Webcast series),23,1,2,http://www.reddit.com/r/PowerShell/comments/i4heo/powershell_learn_it_now_before_its_an_emergency/,,,False,,t5_2qo1o,False,,,False,t3_i4heo,http://www.microsoft.com/events/series/windowsserver2008.aspx?tab=Webcasts&amp;seriesid=101&amp;webcastid=17428,
1375862541.0,22,self.PowerShell,1jvdjf,Automatically re-size and import photos into Active Directory,23,1,8,http://www.reddit.com/r/PowerShell/comments/1jvdjf/automatically_resize_and_import_photos_into/,"I've just [put up a new script](http://www.theagreeablecow.com/2013/08/automatically-re-size-and-import-photos.html), which I hope you find useful.  

I love powershell because it helps me find ways to remove some of those annoying little administrative tasks that IT always seem to end up with. In this case it was managing AD photos for Outlook, Lync and SharePoint.

The script works best from a scheduled task and will automatically re-size and import new photos from a network share (based on a username.jpg match in AD). So now it's a piece of cake to just save the new photos there and someone else can take responsibility of the whole process.",[Active Directory],False,,t5_2qo1o,False,,,True,t3_1jvdjf,http://www.reddit.com/r/PowerShell/comments/1jvdjf/automatically_resize_and_import_photos_into/,
1372718744.0,20,powershellmagazine.com,1hghm4,Powershell 3 Quick Reference Sheets,25,5,1,http://www.reddit.com/r/PowerShell/comments/1hghm4/powershell_3_quick_reference_sheets/,,,False,,t5_2qo1o,False,,,False,t3_1hghm4,http://www.powershellmagazine.com/2012/06/09/windows-powershell-3-0-and-server-manager-quick-reference-guides/,
1370555532.0,22,imgur.com,1ftjuu,Desired State Configuration Cheat Sheet (Handout from Powershell booth @ TechEd),25,3,8,http://www.reddit.com/r/PowerShell/comments/1ftjuu/desired_state_configuration_cheat_sheet_handout/,,,False,,t5_2qo1o,False,,,False,t3_1ftjuu,http://imgur.com/a/yFlzD,
1366676063.0,22,powershell.org,1cwfrf,2013 PowerShell Scripting Games,28,6,11,http://www.reddit.com/r/PowerShell/comments/1cwfrf/2013_powershell_scripting_games/,,,False,,t5_2qo1o,False,,,False,t3_1cwfrf,http://powershell.org/wp/the-scripting-games/,
1347121476.0,22,ramblingcookiemonster.wordpress.com,zk63f,PowerShell Cheat Sheet and References,25,3,6,http://www.reddit.com/r/PowerShell/comments/zk63f/powershell_cheat_sheet_and_references/,,,False,,t5_2qo1o,False,,,False,t3_zk63f,http://ramblingcookiemonster.wordpress.com/2012/09/07/powershell-cheat-sheet/,
1339689960.0,19,i.imgur.com,v1tbl,I was really disappointed that this didn't work,32,13,2,http://www.reddit.com/r/PowerShell/comments/v1tbl/i_was_really_disappointed_that_this_didnt_work/,,,False,,t5_2qo1o,False,,,False,t3_v1tbl,http://i.imgur.com/Lk8eH.png,
1372386330.0,21,mattblogsit.com,1h80le,PowerShell v4 Ping and Telnet Replacement,24,3,12,http://www.reddit.com/r/PowerShell/comments/1h80le/powershell_v4_ping_and_telnet_replacement/,,,False,,t5_2qo1o,False,,,False,t3_1h80le,http://mattblogsit.com/windows/powershell-v4-ping-and-telnet-replacement,
1358354356.0,19,self.PowerShell,16owd8,A little code snippet I use on Exchange to check for spamming accounts.,22,3,5,http://www.reddit.com/r/PowerShell/comments/16owd8/a_little_code_snippet_i_use_on_exchange_to_check/,"Every org has users that respond to phishing attempts eventually. Spammers then use the credentials your users give them to spam from your external facing mail interfaces. I got tired of finding out about them too late, and now have this script run.

It will check each Hub server's logs for all messages sent in the last 12 hours. Then it groups them by (separately) subject and sender, and gives you the top 20 of each (minus any *.int domains, which are Exchange's internal messages.) If there's a spammer, they will show up in this list with *way* more messages than normal, and the subject line will show up similarly.

    $Servers = ""ExchHub1"", ""ExchHub2""
    Foreach ($Server in $Servers) {
    	$logs = get-messagetrackinglog -Server $Server -Start ((Get-Date).AddHours(-12)) -End (get-date) -ResultSize unlimited
    	Write-Host -ForegroundColor Green ""$Server top senders in last 12 hours""
    	$logs | ?{$_.Sender -notlike ""*.int""} | group Sender | sort Count -desc | select -First 20 | ft Count, Name -auto
    	Write-Host -ForegroundColor Green ""$Server top subject lines in last 12 hours""
    	$logs | ?{$_.Sender -notlike ""*.int""} | group MessageSubject | sort Count -desc | select -First 20 | ft Count, Name -auto
    	}

Just change the $Servers to match your own. Or put **Param( )** around the servers, and then you can pass a list to it.

This could also be set up to output to .CSV files, or to email someone if the number of messages in a grouping reaches some threshold that makes sense to your org.",,False,,t5_2qo1o,False,,,True,t3_16owd8,http://www.reddit.com/r/PowerShell/comments/16owd8/a_little_code_snippet_i_use_on_exchange_to_check/,
1317993275.0,20,self.PowerShell,l436m,Text to Speech Function,21,1,9,http://www.reddit.com/r/PowerShell/comments/l436m/text_to_speech_function/,"function Out-Text {
    param(
        [Parameter(Mandatory=$true)]
        $Text 
		)
      
    $object = New-Object -ComObject SAPI.SpVoice
    $object.Speak($text) | Out-Null
}
Out-Text ""thats pretty sweet"" 

# Pastebin link http://pastebin.com/NbL3Uzq8
",,False,,t5_2qo1o,False,,,True,t3_l436m,http://www.reddit.com/r/PowerShell/comments/l436m/text_to_speech_function/,
1349709221.0,18,self.PowerShell,115249,Update: PowerShell and GUI.  PICS inside.,19,1,14,http://www.reddit.com/r/PowerShell/comments/115249/update_powershell_and_gui_pics_inside/,"So I decided to stick with PowerShell an incorporate it in the GUI.  I stuck with PowerShell becuase I did not want to create an install file for folks and wanted to keep it fairly straight forward for other users to use.

I am fairly pleased with the outcome of it all and still looking to add to it.

[PowerShell and GUI](http://imgur.com/a/SEBYG)

**Edit**

I've went ahead and pasted my code for folks to use.  Some changes may need to be made though:

1. Line 285 Insert your update path or delete from 285 - 289 if you do not want an update check.

Good luck!

[PCRename v3.1](http://pastebin.com/UeFQTnqb)",,False,,t5_2qo1o,1349796422.0,,,True,t3_115249,http://www.reddit.com/r/PowerShell/comments/115249/update_powershell_and_gui_pics_inside/,
1372685033.0,19,masterrex.com,1hfabe,Easy OCR with Powershell,25,6,4,http://www.reddit.com/r/PowerShell/comments/1hfabe/easy_ocr_with_powershell/,,,False,,t5_2qo1o,False,,,False,t3_1hfabe,http://masterrex.com/?p=36,
1369470611.0,17,slideshare.net,1f0sb6,PowerShell for Penetration Testers,21,4,0,http://www.reddit.com/r/PowerShell/comments/1f0sb6/powershell_for_penetration_testers/,,,False,,t5_2qo1o,False,,,False,t3_1f0sb6,http://www.slideshare.net/nikhil_mittal/power-shell-forpenetrationtesters,
1366501027.0,16,learn-powershell.net,1crqf6,Sharing Variables and Live Objects Between PowerShell Runspaces,19,3,0,http://www.reddit.com/r/PowerShell/comments/1crqf6/sharing_variables_and_live_objects_between/,,,False,,t5_2qo1o,False,,,False,t3_1crqf6,http://learn-powershell.net/2013/04/19/sharing-variables-and-live-objects-between-powershell-runspaces/,
1307688213.0,20,self.PowerShell,hw72h,How To: Set RunOnce to run a PowerShell script on reboot (one time only).,20,0,3,http://www.reddit.com/r/PowerShell/comments/hw72h/how_to_set_runonce_to_run_a_powershell_script_on/,"So I needed to rename a computer and then join it to the domain. I have a VBScript function that let's me define things to run after a reboot using the RunOnce registry key, and I wanted to do the same in PowerShell (man is this WAY easier!). I just added this code to the end of the renameComputer.ps1 script I was using:

    Set-Location -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce'
    Set-ItemProperty -Path . -Name joinDomain -Value ""C:\scripts\joinDomain.ps1""
    Restart-Computer

This will create a subkey in the RunOnce registry key (assuming you are running Vista/7/2008) named ""joinDomain"" with the value of ""C:\scripts\joinDomain.ps1""

If that doesn't work for you, try changing the second line to this:

    Set-ItemProperty -Path . -Name joinDomain -Value 'C:\WINDOWS\system32\WindowsPowerShell\v1.0\powershell.exe ""C:\scripts\joinDomain.ps1""'

PowerShell is SO awesome!",,False,,t5_2qo1o,False,,,True,t3_hw72h,http://www.reddit.com/r/PowerShell/comments/hw72h/how_to_set_runonce_to_run_a_powershell_script_on/,
1375210988.0,16,self.PowerShell,1jd8aq,PoSH Cheat Sheet.,21,5,11,http://www.reddit.com/r/PowerShell/comments/1jd8aq/posh_cheat_sheet/,"Maybe a repost? I have not seen it. Has some common commands for those of use who are not experts and need a quick reference. 

http://www.microsoft.com/en-us/download/confirmation.aspx?id=7097
",,False,,t5_2qo1o,False,,,True,t3_1jd8aq,http://www.reddit.com/r/PowerShell/comments/1jd8aq/posh_cheat_sheet/,
1374238529.0,19,microsoftvirtualacademy.com,1immj3,"Getting Started with PowerShell 3.0 recording will be ""posted soon"", be sure to register for the August 1st event is you haven't already! It will be a blast!",24,5,8,http://www.reddit.com/r/PowerShell/comments/1immj3/getting_started_with_powershell_30_recording_will/,,,False,,t5_2qo1o,False,,,False,t3_1immj3,http://www.microsoftvirtualacademy.com/LiveEvents.aspx,
1373638852.0,17,interworks.com,1i5jp8,How to Encrypt and Store Credentials Securely for Use with Automation Scripts,19,2,10,http://www.reddit.com/r/PowerShell/comments/1i5jp8/how_to_encrypt_and_store_credentials_securely_for/,,,False,,t5_2qo1o,False,,,False,t3_1i5jp8,https://www.interworks.com/blogs/trhymer/2013/07/08/powershell-how-encrypt-and-store-credentials-securely-use-automation-script,
1371645581.0,17,channel9.msdn.com,1gngp2,Powershell Desired State Configuration presentation from TechEd 2013. Native CM for Windows in Powershell v4?,17,0,1,http://www.reddit.com/r/PowerShell/comments/1gngp2/powershell_desired_state_configuration/,,,False,,t5_2qo1o,False,,,False,t3_1gngp2,http://channel9.msdn.com/Events/TechEd/NorthAmerica/2013/MDC-B302#fbid=tNpj8p6aR8I,
1312142796.0,16,blog.richprescott.com,j51bq,Client Systems Administration toolkit (ACSA),18,2,10,http://www.reddit.com/r/PowerShell/comments/j51bq/client_systems_administration_toolkit_acsa/,,,False,,t5_2qo1o,False,,,False,t3_j51bq,http://blog.richprescott.com/2011/07/arposh-client-system-administration.html,
1376696360.0,16,microsoftvirtualacademy.com,1kiqvi,Getting Started With Powershell 3.0 Jumpstart,20,4,3,http://www.reddit.com/r/PowerShell/comments/1kiqvi/getting_started_with_powershell_30_jumpstart/,,,False,,t5_2qo1o,False,,,False,t3_1kiqvi,http://www.microsoftvirtualacademy.com/training-courses/getting-started-with-powershell-3-0-jump-start#fbid=ryyB8k2IzeY,
1372195337.0,15,self.PowerShell,1h2bsp,"Remove all versions of Java, and install the latest.",21,6,27,http://www.reddit.com/r/PowerShell/comments/1h2bsp/remove_all_versions_of_java_and_install_the_latest/,"This is a script I wrote to uninstall all version's of Java, then install Java from an msi file which is on a distribution computer at the remote location.  The script will check a log file for the computer hostname to see if it has ran before.  If it ran it will exit out.  It will set the distribution computer hostname by looking at the Default gateway.

I noticed on XP computers the java install would fail if jqs was a running process, so if that process is running it will stop it.

It will write a two text files.  One text file will tell me what java's are install before I remove them, and the other file will tell me whats installed after the removal / install.

-----------------------------------------------------------------------------------------------------------


#Checks log file to find out if this script has already ran.
$LogCheck = Get-Content \\domain.com\share\apps\DTUpdate\Software\logs\Java_7Update25.log | Where{$_ -like ""*$env:COMPUTERNAME""}

Switch ($LogCheck -eq $null)  
{
    $false {Exit}
}

#Sets Variables
$java = Get-WmiObject -Class win32_product | where { $_.Name -like ""*Java*""}
$javaPC = $Java.IdentifyingNumber
$JQS = get-process | Where {$_.ProcessName -eq ""jqs""}
$IPGateway = Get-WmiObject -Class Win32_NetworkAdapterConfiguration | where {$_.DNSDomain -eq ""domain.com""}
$JavaMSI = ""Software\Software\Java\7Update25\jre1.7.0_25.msi""
$Time = Get-Date

#Switch to find out if Java Quick Start is running (Windows XP) - If it is running, it will be stopped.
Switch ($JQS -eq $null) 
{
    $false {Stop-Process -Name ""jqs"" -Force}
}

#Searchs for Installed versions of Java and removes all installed Versions
$Java &gt;&gt; ""\\domain.com\share\apps\DTUpdate\SOFTWARE\LOGS\Java\Before\$env:COMPUTERNAME.log""

ForEach ($i in $JavaPC) 
{
    Start-Process -FilePath ""msiexec.exe"" -argumentList ""/X$i /q /norestart"" -wait 
}

#$java = Get-WmiObject -Class win32_product | where { $_.Name -like ""*Java*""}
#$Java &gt;&gt; ""\\domain.com\share\apps\DTUpdate\SOFTWARE\LOGS\Java\After\$env:COMPUTERNAME.log""

#Sets variable to distribution computer based on Default Gateway IP Address
Switch ($IPGateway.DefaultIPGateway) 
{
    #
    '192.168.7.1' {$FileLoc = ""KRKDIS01""}
    
    #
    '192.168.9.1' {$FileLoc = ""110DIS01""}
    
    #
    '192.168.18.1' {$FileLoc = ""SYRDIS01""}

    # 
    '192.168.20.1' {$FileLoc = ""CLFDIS01""}

    #
    '192.168.22.1' {$FileLoc = ""SEGODIS01""}

    # 
    '192.168.36.1' {$FileLoc = ""VISDIS01""}

    #
    '192.168.37.1' {$FileLoc = ""WLFDIS01""}

    # 
    '192.168.38.1' {$FileLoc = ""GLVDIS01""}

    # 
    '192.168.39.1' {$FileLoc = ""BUFDIS01""}

    # 
    '192.168.40.1' {$FileLoc = ""DEYDIS01""}

    # 
    '192.168.41.1' {$FileLoc = ""CRTDIS01""}

    # 
    '192.168.42.1' {$FileLoc = ""SPSDIS01""}

    # 
    '192.168.43.1' {$FileLoc = ""WLTDIS01""}

    # 
    '192.168.44.1' {$FileLoc = ""FRTDIS01""}
        
    # 
    '192.168.45.1' {$FileLoc = ""SKDDIS01""}
    
    # 
    '192.168.46.1' {$FileLoc = ""SLGDIS01""}
    
    # 
    '192.168.47.1' {$FileLoc = ""VESDIS01""}
    
    # 
    '192.168.48.1' {$FileLoc = ""RPIDIS01""}

    # 
    '192.168.50.1' {$FileLoc = ""ALBDIS01""}

    # 
    '192.168.51.1' {$FileLoc = ""LATDIS01""}

    # 
    '192.168.52.1' {$FileLoc = ""HOODIS01""}

    #
    '192.168.53.1' {$FileLoc = ""GLDDIS01""}

    # 
    '192.168.54.1' {$FileLoc = ""PATDIS01""}

    # 
    '192.168.55.1' {$FileLoc = ""ARBDIS01""}

    # 
    '192.168.56.1' {$FileLoc = ""GLNDIS01""}
    
    # 
    '192.168.58.1' {$FileLoc = ""ESPDIS01""}
    
    # 
    '192.168.59.1' {$FileLoc = ""COMDIS01""}
    
    # 
    '192.168.61.1' {$FileLoc = ""MIDDIS01""}
        
    # 
    '192.168.62.1' {$FileLoc = ""TRYDIS01""}

    # 
    '192.168.63.1' {$FileLoc = ""SDKDIS01""}

    #
    '192.168.64.1' {$FileLoc = ""AMSDIS01""}

    # 
    '192.168.65.1' {$FileLoc = ""AMHDIS01""}

    # 
    '192.168.66.1' {$FileLoc = ""CLRDIS01""}

    # 
    '192.168.67.1' {$FileLoc = ""ALTDIS01""}

    # 
    '192.168.68.1' {$FileLoc = ""NANDIS01""}

    # 
    '192.168.69.1' {$FileLoc = ""COBDIS01""}

    # 
    '192.168.70.1' {$FileLoc = ""COPDIS01""}

    # 
    '192.168.71.1' {$FileLoc = ""NSKDIS01""}

    # 
    '192.168.72.1' {$FileLoc = ""CICDIS01""}

    # 
    '192.168.73.1' {$FileLoc = ""APSDIS01""}

    # 
    '192.168.74.1' {$FileLoc = ""SQRDIS01""}

    #
    '192.168.75.1' {$FileLoc = ""SBFDIS01""}

    # 
    '192.168.76.1' {$FileLoc = ""MLTDIS01""}

    # 
    '172.29.11.1' {$FileLoc = ""SMSDIS01""}

    # 
    '172.29.12.1' {$FileLoc = ""SMSDIS02""}

    # 
    '172.30.11.1' {$FileLoc = ""COPDIS01""}
    
    # 
    '10.254.32.1' {$FileLoc = ""SMSDIS01""}

    # 
    '10.254.40.1' {$FileLoc = ""KRKDIS01""}

    # 
    '10.254.220.1' {$FileLoc = ""SMSDIS02""}

    # 
    '192.168.36.1' {$FileLoc = ""VISBRN01""}

    #Default - If Default Gateway not found in switch, Defaults to HQ FileShare
    Default {$Fileloc = ""domain.com\share\apps\DTUpdate""}
}

#Tests the Path to the Java MSI.  If path is not valid, defauls to HQ FileShare
Switch (Test-Path \\$FileLoc\$javaMSI)
{
    $True 
        {
            Start-Process -FilePath ""msiexec.exe"" -ArgumentList ""/I \\$FileLoc\$JavaMSI /q /norestart"" -wait
        }
    
    $False
        {
            $Fileloc = ""domain.com\sefshare\apps\DTUpdate""
            Start-Process -FilePath ""msiexec.exe"" -ArgumentList ""/I \\$FileLoc\$JavaMSI /q /norestart"" -wait
        }
}
""$Time, $env:COMPUTERNAME"" &gt;&gt; '\\domain.com\share\apps\DTUpdate\SOFTWARE\LOGS\Java_7Update25.log'
$java = Get-WmiObject -Class win32_product | where { $_.Name -like ""*Java*""}
$Java &gt;&gt; ""\\domain.com\share\apps\DTUpdate\SOFTWARE\LOGS\Java\After\$env:COMPUTERNAME.log""",,False,,t5_2qo1o,1372212953.0,,,True,t3_1h2bsp,http://www.reddit.com/r/PowerShell/comments/1h2bsp/remove_all_versions_of_java_and_install_the_latest/,
1366431987.0,16,powershelladmin.com,1cq32f,Are they ready and useful now? Get-WmiObject wrapper scripts - completely rewritten.,18,2,4,http://www.reddit.com/r/PowerShell/comments/1cq32f/are_they_ready_and_useful_now_getwmiobject/,,,False,,t5_2qo1o,False,,,False,t3_1cq32f,http://www.powershelladmin.com/wiki/Get-wmiobject_wrapper,
1358627146.0,17,self.PowerShell,16w44v,"If I'm reasonably competent w/cygwin bash, is there any reason to learn powershell?",19,2,38,http://www.reddit.com/r/PowerShell/comments/16w44v/if_im_reasonably_competent_wcygwin_bash_is_there/,"I'm a SAS &amp; ruby programmer who uses cygwin mostly to interact w/git &amp; to launch scripts for editing &amp; submission to the proper interpreters.  I've got a few really simple aliases set up (mostly just shortcuts to cd into particular project directories) but haven't ever really done any shell programming (that's what ruby is for).

I was just setting up a new win8 machine &amp; installed github for windows on it &amp; that seems to come with a powershell-based command prompt.  My initial thought was ""ugh--uninstall this thing &amp; get me msysgit like normal"" but then I started wondering--maybe powershell has nice features that you don't get with bash.

Are there?",,False,,t5_2qo1o,False,,,True,t3_16w44v,http://www.reddit.com/r/PowerShell/comments/16w44v/if_im_reasonably_competent_wcygwin_bash_is_there/,
1340181946.0,15,techrepublic.com,vbkba,"Recap: In case you missed it, Powershell 3 has some awesome new features",19,4,7,http://www.reddit.com/r/PowerShell/comments/vbkba/recap_in_case_you_missed_it_powershell_3_has_some/,,,False,,t5_2qo1o,False,,,False,t3_vbkba,http://www.techrepublic.com/blog/networking/powershell-3-takes-scripting-to-new-heights/5204/,
1333992242.0,16,self.PowerShell,s11ze,Processing IIS logs...,17,1,8,http://www.reddit.com/r/PowerShell/comments/s11ze/processing_iis_logs/,"In my Exchange 2010 life, I don't always land on machines with the analysis tools I'd prefer, but I need to search for information fairly quickly to explain an issue.

Since all Exchange servers have Powershell... here's how I go log diving

    $filename= ""u_ex120408.log""   #whatever file you need
    $line= get-content -totalCount 4 $filename | select -last 1
    $hdr= $line -replace ""#Fields: "","""" -split "" ""
    $data= import-csv $filename -Header $hdr -delimiter "" "" 

This ends up making it pretty easy to construct a picture of someone's activity, client profiles, etc...  Just sort as you'd like, ft the columns you want, group/etc...  and you're off to the races.

Figured I'd share.",,False,,t5_2qo1o,False,,,True,t3_s11ze,http://www.reddit.com/r/PowerShell/comments/s11ze/processing_iis_logs/,
1329107771.0,15,i.imgur.com,pn15c,Are you a wizard?,21,6,4,http://www.reddit.com/r/PowerShell/comments/pn15c/are_you_a_wizard/,,,False,,t5_2qo1o,False,,,False,t3_pn15c,http://i.imgur.com/8dmv6.png,
1315274909.0,16,gallery.technet.microsoft.com,k5yjd,Client System Administration tool,20,4,1,http://www.reddit.com/r/PowerShell/comments/k5yjd/client_system_administration_tool/,,,False,,t5_2qo1o,False,,,False,t3_k5yjd,http://gallery.technet.microsoft.com/scriptcenter/a5aff367-7b47-4b50-a2ef-20dcb4bb6d64,
1311718742.0,17,self.PowerShell,j0ktc,"Completely new to PowerShell, any book recommendations?",17,0,12,http://www.reddit.com/r/PowerShell/comments/j0ktc/completely_new_to_powershell_any_book/,"I am taking a script programming class this semester and we are working in PowerShell. Not only do I know nothing about PowerShell, but friends who have already taken the class have told me it is hard as hell. One friend told me I might as well sign up for a tutor on day one. The book our professor has chosen is Microsoft Windows PowerShell Programming Etc. Many classmates have also told me they felt as though the book was useless because it didn't really help them.

So I'm wondering if any of you can suggest any PowerShell books for beginners? Any other tools you would recommend or tips you can offer?",,False,,t5_2qo1o,False,,,True,t3_j0ktc,http://www.reddit.com/r/PowerShell/comments/j0ktc/completely_new_to_powershell_any_book/,
1375796878.0,15,self.PowerShell,1jt6vn,[Daily Thread] Tips Tuesday! What scripts or lines of code do you use on a daily basis?,16,1,38,http://www.reddit.com/r/PowerShell/comments/1jt6vn/daily_thread_tips_tuesday_what_scripts_or_lines/,"**Tips Tuesday**

Single line of code? Script you found that made your life easier? Share it with the world! 

----

**Monthly Publications**

[PowerTips Monthly Volume 3](http://powershell.com/cs/media/p/25742.aspx)

----

**Tips of the day**


[Hey Scripting Guy: Verify Secure Boot Policy](http://blogs.technet.com/b/heyscriptingguy/archive/2013/08/05/powertip-use-powershell-to-verify-secure-boot-policy.aspx)

[Powershell.com: Analyzing PowerShell Errors](http://powershell.com/cs/blogs/tips/archive/2013/08/06/analyzing-powershell-errors.aspx)

----

**Message(s) from the boys upstairs:**

The mods added something pretty awesome! Tag your posts with flare! Make sure the right people get to see your post by adding flare. For more information check out the post by /u/Davotronic5000 [here](http://www.reddit.com/r/PowerShell/comments/1jti9z/new_feature_link_flair/).

A bot is in the works. Hang tight. 

----

****This post will be removed in 48 Hours to remove clutter. Make sure you save it if you want to save the code. It will not be removed from your user saved directory!****",[Daily Post],False,,t5_2qo1o,1375884169.0,,,True,t3_1jt6vn,http://www.reddit.com/r/PowerShell/comments/1jt6vn/daily_thread_tips_tuesday_what_scripts_or_lines/,
1375305742.0,16,self.PowerShell,1jg60p,"[Requests] I love this community, and I think it would be cool if we did a daily thread to share information.",19,3,13,http://www.reddit.com/r/PowerShell/comments/1jg60p/requests_i_love_this_community_and_i_think_it/,"I think it would be really cool where we can share things we are working on, accomplishments, projects, ect, on a daily thread and have that thread that focuses on a certain thing. 



For instance on /r/homebrewing 



Monday:
What brewing related things did you do this week?

Tuesday:
Tuesday Recipe Critique and Formulation!

Wednesday:
Wednesday Q &amp;amp; A

Thursday:
Advanced Brewers Round Table

Friday:
Sitrep Friday!



For /r/powershell let's tweak it to help each other out, get knowledge out, and toot our own horns every once in a while. 



Monday:
What projects are you working on this week? 

Tuesday:
Tips and Tricks Tuesday. Share Snapins, tips, and code snippets you found useful [PasteBin]. 

Wednesday:
Wednesday Q &amp;amp; A

Thursday:
That's the last straw Thursday.  Advanced coding for people who are stuck. 

Friday:
Don't touch it Friday. Share your code,  open source project on GitHub, or just a story of how something awesome happened this week that made you feel like a bad ass. 



Also, adding tags, and supported support snapins to the sidebar would be awesome. If someone has a question about AD or PowerCLI we need to have tags to navigate the correct people who know more about that to that post. Sorting through ""new to powershell write my code"" posts gets old sometimes. 



So what do you guys think? Questions? Comments? More requests? Keep them coming! I'm not a mod, but if we like any recommendations for the sub  hopefully they will go for it. ",,False,,t5_2qo1o,False,,,True,t3_1jg60p,http://www.reddit.com/r/PowerShell/comments/1jg60p/requests_i_love_this_community_and_i_think_it/,
1374463595.0,14,self.PowerShell,1isfri,Are you using GitHub? Why Not?,19,5,24,http://www.reddit.com/r/PowerShell/comments/1isfri/are_you_using_github_why_not/,"Long-time lurker here. You guys have a lot of great ideas(that I make great use of!).  
I'm noticing one key difference between Powershell groups and the groups I use for other languages- *EVERYBODY* else is using GitHub.  

If you haven't tried it yet, it's free and pretty easy to use.  If you have never used a version control system, you owe it to yourself to learn one - it will really help you take your coding to the next level.  

So please, **consider this your dumb question thread-  ask anything you want to know about Git/GitHub, whatever is stopping you from adopting it, confusing you, etc.**  

GitHub is an ideal way for you to manage your projects, scale your projects, get collaboration, and to get credit for the work you contribute to the community of PowerShell Scripters! In a lot of fields/languages, your GitHub account serves as your ""Street cred"", and it's a great resume booster.  This is a great way to get involved in a large project and expand your knowledge of PowerShell as well.  So, what's holding you back?",,False,,t5_2qo1o,False,,,True,t3_1isfri,http://www.reddit.com/r/PowerShell/comments/1isfri/are_you_using_github_why_not/,
1373292643.0,16,csharpening.net,1hv49n,The Future of PowerGUI VSX,20,4,2,http://www.reddit.com/r/PowerShell/comments/1hv49n/the_future_of_powergui_vsx/,,,False,,t5_2qo1o,False,,,False,t3_1hv49n,http://csharpening.net/?p=1673,
1372339936.0,14,powershell.com,1h6dle,PowerTips now available as an in-depth monthly guide.,15,1,6,http://www.reddit.com/r/PowerShell/comments/1h6dle/powertips_now_available_as_an_indepth_monthly/,,,False,,t5_2qo1o,False,,,False,t3_1h6dle,http://powershell.com/cs/media/g/powertipsmonthly2013/default.aspx,
1367519612.0,17,self.PowerShell,1dkee3,"Has anyone had to present to their boss's how and why you want to upgrade from Powershell 2 to Powershell 3? If so, can I see your presentation?",19,2,31,http://www.reddit.com/r/PowerShell/comments/1dkee3/has_anyone_had_to_present_to_their_bosss_how_and/,"I will have to present to a technology committee the how's and why's about the upgrade. I am starting to work on it, and it would be helpful to see what others have talked about and what you've done.   

Thanks!",,False,,t5_2qo1o,False,,,True,t3_1dkee3,http://www.reddit.com/r/PowerShell/comments/1dkee3/has_anyone_had_to_present_to_their_bosss_how_and/,
1367318964.0,15,self.PowerShell,1dejba,Would PowerShell be useful for 1st Line support? Should I learn PowerShell or batch scripting?,17,2,24,http://www.reddit.com/r/PowerShell/comments/1dejba/would_powershell_be_useful_for_1st_line_support/,"I have been in 1st line support for almost a year.  I am studying Network+ in my spare time.  Should I also focus on scripting in PowerShell or batch?

To be honest I am not entirely sure what all is possible with scripting because the tutorials and such are very focused towards administrators.  And going forward, which I should I bother learning?

Edit: Thanks for all the replies guys.  I will start learning PWS to automate some of the things I do regularly like adding and removing users.  ",,False,,t5_2qo1o,1367325779.0,,,True,t3_1dejba,http://www.reddit.com/r/PowerShell/comments/1dejba/would_powershell_be_useful_for_1st_line_support/,
1366182069.0,15,github.com,1cipu4,Move Steam Games to Another Directory/Drive Using PowerShell,20,5,2,http://www.reddit.com/r/PowerShell/comments/1cipu4/move_steam_games_to_another_directorydrive_using/,,,False,,t5_2qo1o,False,,,False,t3_1cipu4,https://github.com/AndrewGaspar/Steam-Management-for-PowerShell,
1363910387.0,13,i.imgur.com,1arn59,Why can't I set the default gateway? ,18,5,7,http://www.reddit.com/r/PowerShell/comments/1arn59/why_cant_i_set_the_default_gateway/,,,False,,t5_2qo1o,False,,,False,t3_1arn59,http://i.imgur.com/31cwGkq.jpg,
1355933743.0,16,manning.com,1543tm,50% off PowerShell Deep Dives book | promo code dotd1220au,18,2,4,http://www.reddit.com/r/PowerShell/comments/1543tm/50_off_powershell_deep_dives_book_promo_code/,,,False,,t5_2qo1o,False,,,False,t3_1543tm,http://www.manning.com/hicks/,
1354632796.0,14,csharpening.net,149hqa,Hooking a Remote Process and Stealing a Password with PowerShell,17,3,0,http://www.reddit.com/r/PowerShell/comments/149hqa/hooking_a_remote_process_and_stealing_a_password/,,,False,,t5_2qo1o,False,,,False,t3_149hqa,http://csharpening.net/?p=1409,
1353932084.0,15,self.PowerShell,13t57l,Parallel PowerShell - Foreach-Parallel and Run-Parallel [xpost from /r/usefulscripts],18,3,9,http://www.reddit.com/r/PowerShell/comments/13t57l/parallel_powershell_foreachparallel_and/,"Foreach-Parallel and Run-Parallel are two similar functions that provide parallelization in PowerShell using runspacepools rather than Jobs or PSRemoting.

* I break down some of the code for Run-Parallel in [this post](http://ramblingcookiemonster.wordpress.com/2012/11/25/parallel-powershell-part-ii/)
* I list a number of references that discuss parallelization or performance in PowerShell [here](http://ramblingcookiemonster.wordpress.com/2012/10/19/parallel-powershell/)
* [Script Repository link for Run-Parallel](http://gallery.technet.microsoft.com/Run-Parallel-Parallel-377fd430)
* [Script Repository link for Foreach-Parallel](http://gallery.technet.microsoft.com/Foreach-Parallel-Parallel-a8f3d22b)

These can be a big help.  I went from a domain wide query taking on the order of two days, down to 5 hours with an acceptable increase in bandwidth usage.  Your processor will be a major factor.

There may be a better way to implement runtime tracking for timeouts.  Waiting to hear back from the pros : )

*Update*:

* For Invoke-Parallel (Run-Parallel):  Modified the way timeouts are tracked.  Instead of queueing up all runspaces in the pool immediately, we set a threshold ('maxQueue') for the maximum number of runspaces to allow in a pool.  If we are at this limit, we check for completed runspaces and sleep a short while before trying to add a new runspace.

* Boe [posted an idea](http://powershell.org/discuss/viewtopic.php?f=6&amp;t=801) on using nested runspaces (i.e. create intermediary runspaces to track timeouts for actual runspaces).  This works, but I found the performance hit completely negates the purpose of these scripts - performance : )
",,False,,t5_2qo1o,1354759286.0,,,True,t3_13t57l,http://www.reddit.com/r/PowerShell/comments/13t57l/parallel_powershell_foreachparallel_and/,
1351000851.0,14,idera.com,11y2a0,Idera Expands Commitment to PowerShell Community by Providing PowerShell Plus for Free,15,1,8,http://www.reddit.com/r/PowerShell/comments/11y2a0/idera_expands_commitment_to_powershell_community/,,,False,,t5_2qo1o,False,,,False,t3_11y2a0,http://www.idera.com/News/?NewsCategory=0&amp;ID=482,
1344574422.0,15,self.PowerShell,xzcq3,I discovered this today. Powershell Pack,18,3,2,http://www.reddit.com/r/PowerShell/comments/xzcq3/i_discovered_this_today_powershell_pack/,"""Windows PowerShell Pack contains 10 modules to help supercharge your Windows PowerShell scripting. The PowerShellPack lets you write user interfaces in PowerShell script, manage RSS feeds, schedule operating system tasks, and much more."" 

I specially like this module PSSystemTools
[Microsost Powershell Pack](http://archive.msdn.microsoft.com/PowerShellPack)





",,False,,t5_2qo1o,False,,,True,t3_xzcq3,http://www.reddit.com/r/PowerShell/comments/xzcq3/i_discovered_this_today_powershell_pack/,
1317725873.0,15,self.PowerShell,l0ecf,Get-Wadsworth,17,2,2,http://www.reddit.com/r/PowerShell/comments/l0ecf/getwadsworth/,"So I got a little bored..

Usage:
Get-Wadsworth ""PowerShell is a pretty damn cool language""

    
    function Get-Wadsworth { 
    
        Param([string]$InputString)
    
        $InputString.Remove(0,$InputString.Length - ($InputString.Length * .7)).Split() | Select -skip 1 | % { $a += ""$_ "" }
    
        $a
    
    }

",,False,,t5_2qo1o,False,,,True,t3_l0ecf,http://www.reddit.com/r/PowerShell/comments/l0ecf/getwadsworth/,
1310756564.0,15,self.PowerShell,iqntx,"Find, Disable, and Move Active Directory Objects That have been inactive for x weeks.(/r/sysadmin X-post)",15,0,8,http://www.reddit.com/r/PowerShell/comments/iqntx/find_disable_and_move_active_directory_objects/,"http://pastebin.com/53PV7Yck  

This is probably pretty elementary to this crowd- I'm new to powershell as a scripting language.  The other scripts I found for accomplishing this task were way too verbose IMHO.  

This script just takes the output of a DSQuery command and passes it to DSMOD and DSMOVE.  The items moved programmatically are labelled and time stamped.  A total of the newly disabled items and the duration of the task are calculated, then this info is emailed.  

Without these lines or comments, this script could be reduced by about 90% and still have the same effect.  

A very slight modification to this will do the same thing with user accounts.",,False,,t5_2qo1o,False,,,True,t3_iqntx,http://www.reddit.com/r/PowerShell/comments/iqntx/find_disable_and_move_active_directory_objects/,
1375653416.0,15,self.PowerShell,1jpaff,Using PowerShell to Monitor TCP/IP Socket Use.,17,2,11,http://www.reddit.com/r/PowerShell/comments/1jpaff/using_powershell_to_monitor_tcpip_socket_use/,"I was asked to monitor the number of sockets a CRM installation was creating on a Windows 2008 R2 box. There were some custom applications on the machine not properly closing sockets that had been created. It seems the CRM machine was calling a local webservice to help sanitize leads that were being injected into the system, and do other custom actions when users were executing various functions while in CRM.


The event log was reporting the TCP/IP subsystem had run out of available sockets periodically.  After doing some research, it seems Microsoft has increased the dynamic client port range for outgoing connections in Windows Vista and in Windows Server 2008 and later. The new default start port is 49152, and the default end port is 65535. This is a change from the configuration of earlier versions of Windows that used a default port range of 1025 through 5000.

I was interested in seeing exactly how many connections were being left open by this custom code. Using netsh gave me the answer; 


    PS C:\&gt; netsh int ipv4 show dynamicport tcp
    Protocol tcp Dynamic Port Range
    Start Port      : 49152
    Number of Ports : 16384

    
So it appears this code is exhausting over 16,000 ephemeral ports at certain times. Going through the event logs confirmed this behavior. It is possible to up the number of ports through the registry, or by using netsh to set the dynamic ports (editing the same registry key); 


    HKEY\LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters 


But that seems sloppy at best. If the code is using up this many sockets, it's obvious the code is the issue. To prove that, I needed to receive notifications whenever the socket pool was exhausted, and then could take that to the development team, to have their code sanitized further to make sure all the connections that were being opened, were subsequently closed when no longer needed. 


I came up with this simple powershell script to run through a scheduled task every 10 minutes to check netstat -aonp ""TIME_WAIT"", and ""CLOSE_WAIT""  connections. If it's over the threshold specified, it will dump a simple alert to the users specified.

        &lt;#Begin script#&gt;
        $ErrorActionPreference = ""Stop""
        $hostName = hostname
        $timeWait = netstat -aonp TCP | Select-String ""TIME_WAIT""
        $timeWaitCount = $timeWait.Count
        $closeWait = netstat -aonp TCP | Select-String ""CLOSE_WAIT""
        $closeWaitCount = $closeWait.Count
        &lt;#Create email function#&gt;
        function email([string]$subject,[string]$body)
        {
           $smtpServer = ""your.servername.here@domain.com""
           $smtp = New-Object Net.Mail.SmtpClient($smtpServer)
           $message = New-Object Net.Mail.MailMessage
           $message.From = ""donotreply@$hostName.domain.com""
           $message.To.Add(""user1@domain.com, user2@domain.com"")
           $message.Subject = ""$subject""
           $message.Body = ""$body""
           $smtp.Send($message)
        }
        try
        {
           &lt;#Set TIME_WAIT threshold #&gt;
           if ($timeWaitCount -gt 5000)
           {
              $subject = ""$hostName TIME_WAIT Over Threshold :: $timeWaitCount""
              $body = ""Please check $hostName""
              email $subject $body
           }
           &lt;#Set CLOSE_WAIT threshold #&gt;
           if ($closeWaitCount -gt 5000)   
           {
              $subject = ""$hostName CLOSE_WAIT Over Threshold :: $closeWaitCount""
              $body = ""Please check $hostName""
              email $subject $body
           }
        }
        catch
        {
           [system.exception] ""Exception: Unable to send email.""
           $Error | Format-List -Property * -Force
        }
    ",,False,,t5_2qo1o,1375653596.0,,,True,t3_1jpaff,http://www.reddit.com/r/PowerShell/comments/1jpaff/using_powershell_to_monitor_tcpip_socket_use/,
1373565626.0,13,microsoftvirtualacademy.com,1i3frc,"2 free PowerShell events, 2nd in comments.",16,3,5,http://www.reddit.com/r/PowerShell/comments/1i3frc/2_free_powershell_events_2nd_in_comments/,,,False,,t5_2qo1o,False,,,False,t3_1i3frc,http://www.microsoftvirtualacademy.com/liveevents/PowerShell-JumpStart?CR_CC=200211916,
1370613955.0,15,automatedops.com,1fv165,Get a credential stored in Windows Credential Manager.,18,3,0,http://www.reddit.com/r/PowerShell/comments/1fv165/get_a_credential_stored_in_windows_credential/,,,False,,t5_2qo1o,False,,,False,t3_1fv165,http://www.automatedops.com/blog/2013/06/07/get-storedcredentials-module/,
1368668262.0,16,csharpening.net,1ef9bw,Testing ASP.NET MVC4 Web API Endpoints with PowerShell,17,1,1,http://www.reddit.com/r/PowerShell/comments/1ef9bw/testing_aspnet_mvc4_web_api_endpoints_with/,,,False,,t5_2qo1o,False,,,False,t3_1ef9bw,http://csharpening.net/?p=1613,
1365557525.0,15,poshcode.org,1c16oh,"Guns N' Roses Sweet Child O' Mine script, inspired by Christophe Cremon",16,1,5,http://www.reddit.com/r/PowerShell/comments/1c16oh/guns_n_roses_sweet_child_o_mine_script_inspired/,,,False,,t5_2qo1o,False,,,False,t3_1c16oh,http://poshcode.org/4097,
1363814346.0,14,youtube.com,1aot7h,My colleague thought it was time for PowerShell to do the harlem shake...,33,19,4,http://www.reddit.com/r/PowerShell/comments/1aot7h/my_colleague_thought_it_was_time_for_powershell/,,,False,,t5_2qo1o,False,,,False,t3_1aot7h,http://www.youtube.com/watch?v=O2IQUD3nmMo,
1360504265.0,15,tomorrow.uspeoples.org,188v5s,Cleaning up Music File Names using PowerShell,15,0,2,http://www.reddit.com/r/PowerShell/comments/188v5s/cleaning_up_music_file_names_using_powershell/,,,False,,t5_2qo1o,False,,,False,t3_188v5s,http://tomorrow.uspeoples.org/2013/02/cleaning-up-music-file-names-using.html,
1359315216.0,15,learn-powershell.net,17dqzl,PowerShell Patch Utility PoshPAIG Updated to 2.1.5,16,1,1,http://www.reddit.com/r/PowerShell/comments/17dqzl/powershell_patch_utility_poshpaig_updated_to_215/,,,False,,t5_2qo1o,False,,,False,t3_17dqzl,http://learn-powershell.net/2013/01/25/powershell-patch-utility-poshpaig-updated-to-2-1-5/,
1358739332.0,15,self.PowerShell,16yv04,Looking for well-done scripts,18,3,6,http://www.reddit.com/r/PowerShell/comments/16yv04/looking_for_welldone_scripts/,"I'm new to the language, and the quickest way for me to learn things is by seeing things that were well-made by other people and picking up good habits. Can you guys show me some good examples of clean, professional looking scripts?",,False,,t5_2qo1o,False,,,True,t3_16yv04,http://www.reddit.com/r/PowerShell/comments/16yv04/looking_for_welldone_scripts/,
1356085906.0,14,self.PowerShell,157zrv,Powershell equivalent of psexec -i?,15,1,11,http://www.reddit.com/r/PowerShell/comments/157zrv/powershell_equivalent_of_psexec_i/,"**Psexec - i** allows you to run a program on a remote machine such that it appears in the console session on the remote machine, and the logged on user can interact with it. Is there a way of doing this with Invoke-Command or similar?",,False,,t5_2qo1o,False,,,True,t3_157zrv,http://www.reddit.com/r/PowerShell/comments/157zrv/powershell_equivalent_of_psexec_i/,
1340501472.0,12,zduck.com,vi8s1,"PowerShell, batch files, and exit codes. Recipes &amp; Secrets.",14,2,0,http://www.reddit.com/r/PowerShell/comments/vi8s1/powershell_batch_files_and_exit_codes_recipes/,,,False,,t5_2qo1o,False,,,False,t3_vi8s1,http://zduck.com/2012/powershell-batch-files-exit-codes/,
1338962867.0,14,self.PowerShell,unjqj,Favourite One liners?,17,3,14,http://www.reddit.com/r/PowerShell/comments/unjqj/favourite_one_liners/,"heres mine. 
This lists the most recent version of a file

    ls -r -fi *.lis | sort @{expression={$_.Name}}, @{expression={$_.LastWriteTime};Descending=$true} | select Directory, Name, lastwritetime | Group-Object Name | %{$_.Group | Select -first 1}
",,False,,t5_2qo1o,False,,,True,t3_unjqj,http://www.reddit.com/r/PowerShell/comments/unjqj/favourite_one_liners/,
1337276613.0,12,self.PowerShell,try2p,What Powershell code got you hooked? ,15,3,17,http://www.reddit.com/r/PowerShell/comments/try2p/what_powershell_code_got_you_hooked/,"Line, Script or concepts.",,False,,t5_2qo1o,False,,,True,t3_try2p,http://www.reddit.com/r/PowerShell/comments/try2p/what_powershell_code_got_you_hooked/,
1330436496.0,13,social.technet.microsoft.com,q9nt9,PowerShell V3 Guide (Wiki Based) on TechNet,16,3,0,http://www.reddit.com/r/PowerShell/comments/q9nt9/powershell_v3_guide_wiki_based_on_technet/,,,False,,t5_2qo1o,False,,,False,t3_q9nt9,http://social.technet.microsoft.com/wiki/contents/articles/4725.powershell-v3-guide-en-us.aspx,
1321853059.0,14,self.PowerShell,mjtzr,What will this command do?,16,2,6,http://www.reddit.com/r/PowerShell/comments/mjtzr/what_will_this_command_do/,    Get-Process | Stop-Process,,False,,t5_2qo1o,False,,,True,t3_mjtzr,http://www.reddit.com/r/PowerShell/comments/mjtzr/what_will_this_command_do/,
1308716089.0,14,self.PowerShell,i5woe,Best piece of PowerShell related advice you've ever heard?,16,2,10,http://www.reddit.com/r/PowerShell/comments/i5woe/best_piece_of_powershell_related_advice_youve/,"For me the best piece of advice I've ever heard was from Don Jones (at a PowerShell training event): Quit using Write-Host. Anywhere you'd use Write-Host, use Write-Verbose or Write-Warning instead.

At the time I was like ""whatever, personal preference"", but after trying it, man was he right. In virtually every instance where I'd use Write-Host it turns out that Write-Verbose or Write-Warning is a superior choice. I'm either writing modular code where for the most part anything I'd want written to the shell is only in the testing phase, or in a script I only need to see the results or errors, unless it's not working right.

So what is the best piece of PowerShell related advice you've heard?",,False,,t5_2qo1o,False,,,True,t3_i5woe,http://www.reddit.com/r/PowerShell/comments/i5woe/best_piece_of_powershell_related_advice_youve/,
1376049548.0,11,gallery.technet.microsoft.com,1k0r75,PowerShell - HTML Reports and Notifications,14,3,3,http://www.reddit.com/r/PowerShell/comments/1k0r75/powershell_html_reports_and_notifications/,,,False,,t5_2qo1o,False,,,False,t3_1k0r75,http://gallery.technet.microsoft.com/scriptcenter/PowerShell-HTML-Notificatio-e1c5759d,
1369837625.0,12,self.PowerShell,1f9pn0,Prompt for Credentials without a Dialog Box - Powershell.com tip,14,2,5,http://www.reddit.com/r/PowerShell/comments/1f9pn0/prompt_for_credentials_without_a_dialog_box/,"I got this e-mail today from Powershell.com newsletter and it looks like a handy tip. I didn't know it.


&gt;Whenever a PowerShell script asks for credentials, PowerShell pops up a dialog box. You can view this by running this command:
&gt;
    Get-Credential
&gt;
&gt;PowerShell is a console-based scripting language, and so it may be unwanted to open additional dialogs. That's why you can change the basic behavior and ask PowerShell to accept credential information right inside the console. This is a per-machine setting, so you need local Administrator privileges and must run these two lines from an elevated PowerShell console:
&gt;
    $key = ""HKLM:\SOFTWARE\Microsoft\PowerShell\1\ShellIds""
    Set-ItemProperty -Path $key -Name ConsolePrompting -Value $true

Hope you find it useful! I know I did!",,False,,t5_2qo1o,1369840437.0,,,True,t3_1f9pn0,http://www.reddit.com/r/PowerShell/comments/1f9pn0/prompt_for_credentials_without_a_dialog_box/,
1360135887.0,13,self.PowerShell,17zlzg,Add new PC to AD with alternate credentials,15,2,5,http://www.reddit.com/r/PowerShell/comments/17zlzg/add_new_pc_to_ad_with_alternate_credentials/,"This script is made for running after a sysprep.  The local administrator account doesn't have permissions to add the newly sysprepped computer to the domain so we use a delegated AD account who's only ability is to add computers to various domain OU's.  In this script, the computer gets renamed using the BIOS Asset tag, has its Active Directory object created in the OU based on the current IP subnet, and then is physically added to the domain.  One final step is to place a RunOnce registry entry which starts a forced GPUpdate to ensure GPOs are applied on the first domain login.  This script was created using various sites and script snippets plus lots of testing in my domain and environment.  I haven't created any safety features for various potential errors. Use with discretion and make recommendations.

# Setting up user/pass for Active Directory authentication
    $user = ""domain\username""
    $password = ""secret""
    $encpassword = convertto-securestring ""secret"" -asplaintext -force
    $cred = new-object     system.management.automation.pscredential($user,$encpassword)

# Our computer names are a combination of the inventory number prefixed by our domain name
#SMBIOSAssetTag is the BIOS location for the write-once Asset tag
    $name = (""MyDomain"" + (gwmi win32_systemenclosure).SMBIOSAssetTag)

# Compare the computers current name with the BIOS combo; if not the same then renames the computer
    if ((gwmi win32_computersystem).name -ne $name){(gwmi win32_computersystem).rename($name)}

# Since the final computer name is the BIOS combo one, it is used for adding the computer to the domain
    $ComputerName = (""MyDomain"" + (gwmi win32_systemenclosure).SMBIOSAssetTag)

# The following grabs all local IP's and picks only the ones used for various domain subnet assignments
    $IP = [system.net.dns]::GetHostAddresses($env:computername)|?{$_.IPAddresstostring -like '192.168.*'}

# Now read the 3rd octet and assign path variable with correct target computer Organization Unit
    if ($ip -like '192.168.0.*'){$Path = 'LDAP://mydomain.com/OU=HQ_Computers,OU=WORKSTATIONS,DC=mydomain,DC=com'}
    if ($ip -like '192.168.1.*'){$Path = 'LDAP://mydomain.com/OU=Site1_Computers,OU=WORKSTATIONS,DC=mydomain,DC=com'}
    if ($ip -like '192.168.2.*'){$Path = 'LDAP://mydomain.com/OU=Site2_Computers,OU=WORKSTATIONS,DC=mydomain,DC=com'}
    if ($ip -like '192.168.3.*'){$Path = 'LDAP://mydomain.com/OU=Site3_Computers,OU=WORKSTATIONS,DC=mydomain,DC=com'}

# Use ADSI to add the computer to the domain via credentials assigned above
# Note: this section will error if the computer is found in the domain
    $objDomain = New-Object System.DirectoryServices.DirectoryEntry($path,$user,$password)
    $objComputer = $objDomain.Create(""computer"", ""CN="" + $ComputerName)
    $objComputer.Put(""sAMAccountName"",$ComputerName + ""$"")
    $objComputer.Put(""Description"",""Computer Object created by script"")
    $objComputer.Put(""userAccountControl"", 4128)
    $objComputer.SetInfo()

# Now that the computer account has been added, add the physical computer to the domain
    add-computer -credential $cred -erroraction silentlycontinue -domainname MyDomain

# I input a forced GPUpdate with the boot option to the Registries ""RunOnce"" key to
# ensure all GPOs are applied on the first domain login
    reg.exe add HKLM\Software\Microsoft\Windows\CurrentVersion\Runonce /v GPUpdate /t REG_SZ /d ""gpupdate /force /boot"" /f",,False,,t5_2qo1o,False,,,True,t3_17zlzg,http://www.reddit.com/r/PowerShell/comments/17zlzg/add_new_pc_to_ad_with_alternate_credentials/,
1359403600.0,13,self.PowerShell,17g3xq,Looking to make a progress bar,14,1,10,http://www.reddit.com/r/PowerShell/comments/17g3xq/looking_to_make_a_progress_bar/,"I am writing a script to automate a few tasks (extracting mailboxes, hiding users from the GAL.. some other hopefully scriptable magic) and I was trying to find a way to create a progress bar for each step.  

I found this writeup (http://blogs.technet.com/b/heyscriptingguy/archive/2011/01/29/add-a-progress-bar-to-your-powershell-script.aspx) but I'm not sure how to apply it to what I'm trying to do.

For example, I'm using the Export-Mailbox cmdlet to create .pst files, how do I apply a progress bar to that task?

Thanks guys.",,False,,t5_2qo1o,False,,,True,t3_17g3xq,http://www.reddit.com/r/PowerShell/comments/17g3xq/looking_to_make_a_progress_bar/,
1355337180.0,13,self.PowerShell,14qjnk,Disk space usage  CSV report (with e-mail functions!),13,0,5,http://www.reddit.com/r/PowerShell/comments/14qjnk/disk_space_usage_csv_report_with_email_functions/,"This script generates a .csv file containing the computer name, drive letter, disk capacity and free disk space in gigabytes, sorted by free space. It then e-mails that .csv file to multiple recipients. I have it set to only poll C: drives. You can change this in the wmi query portion to poll all physical disks if you choose.

You'll need to have a list of computer names in your computers.txt file, and you'll need to substitute in your own SMTP server and from and to fields as well.

    gwmi -query ""SELECT  SystemName,DeviceID,Caption,VolumeName,Size,Freespace FROM win32_logicaldisk WHERE DeviceID='C:'"" -computer (gc ""c:\computers.txt"") | Select-Object SystemName,Caption,@{Name=""Size(GB)""; Expression={""{0:N2}"" -f ($_.Size/1GB)}},@{Name=""Freespace(GB)""; Expression={""{0:N2}"" -f ($_.Freespace/1GB)}} | sort-object {[decimal] $_.""Freespace(GB)""} | export-csv c:\DiskReport.csv -notypeinformation

    $date = get-date
    send-mailmessage -to ""User1 &lt;User1@Domain.com&gt;"", ""User2 &lt;User2@Doamin.com&gt;"" -subject ""Disk Space Report"" -from ""Name &lt;Name@Domain.com&gt;"" -body ""Disk Space Report $date"" -attachments ""C:\DiskReport.csv"" -smtpserver ""SMTPSERVERGOESHERE""",,False,,t5_2qo1o,False,,,True,t3_14qjnk,http://www.reddit.com/r/PowerShell/comments/14qjnk/disk_space_usage_csv_report_with_email_functions/,
1350408954.0,12,ramblingcookiemonster.wordpress.com,11kvrl,Get-NetworkStatistics:  Netstat -ano for remote systems,13,1,8,http://www.reddit.com/r/PowerShell/comments/11kvrl/getnetworkstatistics_netstat_ano_for_remote/,,,False,,t5_2qo1o,False,,,False,t3_11kvrl,http://ramblingcookiemonster.wordpress.com/2012/10/16/get-networkstatistics/,
1349384263.0,12,self.PowerShell,10yg0a,PowerShell and GUI,13,1,20,http://www.reddit.com/r/PowerShell/comments/10yg0a/powershell_and_gui/,"What started as script in PowerShell has turned into a small program because of all the user input involved.  I've also thrown in a few GUI such as Yes, No, Cancel prompts and some Out-GridView features.  It feels more like a program and so I've considered moving the application to a full GUI with PowerShell in the background driving it.  I don't know how difficult this would be or is it even common?

Should I just re-write it in Visual Studio or something similar?  Any thoughts or suggestions would be great.

**Edit** A few folks have asked me to post my code.  I think some of my error catching is off and I really need to clean it up, but other than that it's a working version.

    #powershell -file C:\myscript.ps1
    #update check for newer version
    $update=Test-Path ""\\Insert\path\here\scriptv1.X.zip""
    if($update -eq ""True"")
    {
    write-host ""&lt;&lt;New Version Available - 2.5  &gt;&gt;"" -background ""red""
    write-host ""&lt;&lt;\\put\path\here &gt;&gt;"" -background ""red""
    }
    
    Write-Host ""-----------------------------------------------------""
    Write-Host ""pcRenamifier v2.5""
    Write-Host ""Author: XXXXXX""
    Write-Host ""-----------------------------------------------------""
    Import-Module ActiveDirectory
    Write-Host ""--Please Login using a.account--""
    #login
    $credential = Get-Credential
    #Main
    do {
    	Write-Host ""--Remote Computer Rename v2.5--""
    	Write-Host ""1. Query AD (Outputs to a text file)""
    	Write-Host ""2. Quick Computer Rename""
    	Write-host ""3. Check Remote Computer Software Update""
    	Write-host ""4. Check Remote Computer Windows Hotfixes/Updates""
    	Write-host ""5. Check Current Computer""
    	Write-host ""6. Get Computer Information""
    	Write-host ""7. Quit""	
    	$choice=Read-Host ""Choose a number to continue""
    	#AD Query for computer
    	switch ($choice)
    		{
    			1 {
    				#output AD query to text file on desktop
    				Write-Host ""--Enter first five characters of computer name or full computer name i.e. USCLT--""
    				$cn=Read-Host 'Computer name'
    				$out=""$cn*""
    
    				if($cn.length -lt ""5"")
    				{
    				write-host ""&lt;&lt; Must be 5 or more characters to run query &gt;&gt;"" -background ""red""
    				break
    				}
    					else
    					{
    					Get-ADComputer -Filter 'SamAccountName -like $out' &gt; $env:userprofile\desktop\$cn-dsquery.txt
    					#Prompt that export to text file complete.
    					[System.Reflection.Assembly]::LoadWithPartialName(“System.Windows.Forms”)
    					[Windows.Forms.MessageBox]::Show(“Query complete.  See dsquery.txt saved to Desktop.”, “pcRenamifier V2.5”, [Windows.Forms.MessageBoxButtons]::OK, [Windows.Forms.MessageBoxIcon]::Information)
    					}
    			}
    			2 {
    				do #begin do rename loop statement
    				{
    				$old=Read-Host ""Enter current computer name""
    				#checking AD for current computer name
    					try
    					{
    					$findpc = Get-ADComputer $old -properties CN
    					} #end try
    					catch [system.Exception]
    					{
    					write-warning ""&lt;&lt; $old computer not found in AD. Please try again. &gt;&gt;""
    					break
    					} #end catch
    					#if computer not found
    						if($findpc -eq $null)
    						{
    						write-warning ""&lt;&lt; Computer not found in Active Directory.  Please try again. &gt;&gt;""
    						break
    						}
    							#if computer found in AD enter new computer name
    							else
    								{
    								do
    									{
    									write-host ""&lt;&lt; $old Computer found in Active Directory! &gt;&gt;"" #Old computer found in the directory
    									$new=Read-Host ""Enter new computer name"" #enter new computer name
    										if($new.length -gt ""15"")
    										{
    										write-warning ""&lt;&lt; Please check name!  $new can not be more than 15 characters in length. &gt;&gt;"" #if new computer name is over 15 characters
    										}
    									} until($new.length -le ""15"")
    
    								try
    								{
    									$findnpc = Get-ADComputer $new -properties CN #searching for duplicates
    									if($findpc -ne $null)
    										{
    										clear-host
    										write-warning ""&lt;&lt; $new - Duplicates not allowed in Active Directory. Please try again. &gt;&gt;"" 
    										}
    								} #end try
    								catch [system.Exception] #error catching
    								{
    									write-host ""&lt;&lt; $new is a valid name. &gt;&gt;""
    									#computer rename process &amp; prompt
    									[System.Reflection.Assembly]::LoadWithPartialName(""System.Windows.Forms"")
                                        $rename = [System.Windows.Forms.MessageBox]::Show(""$old will be renamed to $new.  Is this correct?"" , ""Status"", ""3"",  ""Information"")  
    
    								} #end catch
    								Finally
    								{
    									if ($rename -eq ""Yes"")
    									{
    										try
    										{
    											#Computer rename
                                                $remotemachine = Get-WmiObject Win32_ComputerSystem -ComputerName $old -Authentication 6 -credential $credential
    											$remotemachine.Rename($new,$credential.GetNetworkCredential().Password,$credential.Username)
    										}
    										catch [System.UnauthorizedAccessException]
    										{
    										write-host ""&lt;&lt; Invalid A.ACCOUNT login.  Please try again. &gt;&gt;"" -background ""red""
    										break
    										}
    											try
    											{
    											$errorActionPreference = 'Stop'
    											restart-computer $old -credential $credential
    											clear-host
    											write-host ""$old has been renamed to $new and is rebooting.  Have a nice day."" #Computer renamed and rebooted
    											}
    											catch [Exception]
    											{
    											write-host ""&lt;&lt; There is currently a user logged on this computer and the computer will not be rebooted.  Please reboot manually. &gt;&gt;"" -background ""red""
    											}
    									} #end if rename Yes
    									elseif ($rename -eq ""No"")
    									{
    									write-host ""&lt;&lt; $old computer not renamed. &gt;&gt;""
    									} #end if No
                                        elseif ($rename -eq ""Cancel"")
    									{
    									clear-host
    									write-host ""&lt;&lt; Computer renamed cancelled. &gt;&gt;""
    									break
    									} #end else if
                                        else
    									{
    									write-host ""&lt;&lt; Not a valid option... Starting over. &gt;&gt;""
    									break #break loop
    									} #end else
                                    } #end finally
    							} #end else
    					}while ($rename -eq ""No"") #end do rename loop statement
    			} #end choice 2
    			3 {
    				$current = read-host ""Enter computer name to check for Software"" #Enter computer name to check for software installed
    				#Begin window prompt yes,no,cancel
    				[System.Reflection.Assembly]::LoadWithPartialName(""System.Windows.Forms"")
    				$export = [System.Windows.Forms.MessageBox]::Show(""Export Software report to Excel"" , ""$current - Software"", ""3"",  ""Information"")
    				if ($export -eq ""Yes"") #if yes answer for export to excel
    				{
    					try
    					{
    					$Fdate=get-date -format M.d.yyyy #setdate 
    					Get-WmiObject -class win32_product -ComputerName $current -Authentication 6 -credential $credential | Select Name,Version,PackageName,Installdate,Vendor | Sort InstallDate -Descending| Export-Csv $env:userprofile\desktop\$current-$Fdate-Software.csv #export to csv file on desktop 
    					Get-WmiObject -class win32_product -ComputerName $current -Authentication 6 -credential $credential | Select Name,Version,PackageName,Installdate,Vendor | Sort InstallDate -Descending| ogv #out gridview of report
    					clear-host
    					[System.Reflection.Assembly]::LoadWithPartialName(“System.Windows.Forms”)
    					[Windows.Forms.MessageBox]::Show(“Software report exported to Excel on desktop.”, “pcRenamifier V2.5”, [Windows.Forms.MessageBoxButtons]::OK, [Windows.Forms.MessageBoxIcon]::Information)
    					}
    					catch [System.UnauthorizedAccessException]
    					{
    					 #Write-Host $_.Exception.gettype().fullName
    					 #Write-Host $_.Exception.message
    					write-host ""&lt;&lt; Invalid A.ACCOUNT login.  Please try again. &gt;&gt;"" -background ""red""
    					}
    					catch [Exception]
    					{
    					 write-warning ""&lt;&lt; $current may not be a valid computer name.  Please try again. &gt;&gt;""
    					}
    				}
    					elseif ($export -eq ""No"") # no answer for export to excel
    					{
    					Get-WmiObject -class win32_product -ComputerName $current -Authentication 6 -credential $credential | Select Name,Version,PackageName,Installdate,Vendor | Sort InstallDate -Descending| ogv #out gridview of report
    					} #end if No
                        elseif ($export -eq ""Cancel"")
    					{
    					clear-host
    					write-host ""&lt;&lt; Report cancelled. &gt;&gt;""
    					break
    					} #end else if
    			} #end choice 3	
    			4 {
    				$current = read-host ""Enter computer name to check for Hotfixes and Updates"" #Enter computer name to check for hotfixes and updates installed
    				[System.Reflection.Assembly]::LoadWithPartialName(""System.Windows.Forms"")
    				$export = [System.Windows.Forms.MessageBox]::Show(""Export Hotfixes and Updates report to Excel"" , ""$current - Hotfixes &amp; Updates"", ""3"",  ""Information"")
    				if ($export -eq ""Yes"") #if yes answer for export to excel
    				{
    					try
    					{
    					$Fdate=get-date -format M.d.yyyy #set date
    					Get-WmiObject -Class Win32_QuickFixEngineering -ComputerName $current -Authentication 6 -credential $credential | select description,hotfixid,installedon | Sort InstallDate -Descending| Export-Csv $env:userprofile\desktop\$current-Hotfixes.csv #export to excel to desktop
    					Get-WmiObject -Class Win32_QuickFixEngineering -ComputerName $current -Authentication 6 -credential $credential | select description,hotfixid,installedon | Sort InstallDate -Descending| ogv #report out grid view
    					clear-host
    					[System.Reflection.Assembly]::LoadWithPartialName(“System.Windows.Forms”)
    					[Windows.Forms.MessageBox]::Show(“Software report exported to Excel on desktop.”, “pcRenamifier V2.5”, [Windows.Forms.MessageBoxButtons]::OK, [Windows.Forms.MessageBoxIcon]::Information)
    					}
    					catch [System.UnauthorizedAccessException]
    					{
    					write-host ""&lt;&lt; Invalid A.ACCOUNT login.  Please try again. &gt;&gt;"" -background ""red""
    					}
    					catch [Exception]
    					{
    					 write-warning ""&lt;&lt; $current may not be a valid computer name.  Please try again. &gt;&gt;""
    					}
    				}
    					elseif ($export -eq ""No"") #If not answer for export to excel
    					{
    					Get-WmiObject -Class Win32_QuickFixEngineering -ComputerName $current -Authentication 6 -credential $credential | select description,hotfixid,installedon | Sort InstallDate -Descending| ogv
    					} #end if No
                        elseif ($export -eq ""Cancel"")
    					{
    					clear-host
    					write-host ""&lt;&lt; Report cancelled. &gt;&gt;""
    					break
    					} #end else if
    			} #end choice 4						
    			5 { #get current machine software and hotfixes to Out gridview
    				gp HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* |Select DisplayName, DisplayVersion, Publisher, InstallDate, HelpLink, UninstallString |ogv
    					
    			} #end choice 5				
    				6 { #begin remote computer info
    				$current = read-host ""Enter computer name to check for information""
    				#table formatting
    				$header1 = @{expression={$_.LocalPath};label=""Last Login""},
                    @{expression={$_.LastUseTime};label=""Last Use Time""}
                    #Obtain Computer info
    				$PCInfo = get-wmiobject win32_computersystem -ComputerName $current -Authentication 6 -credential $credential &gt;&gt;C:\temp\PCInfo.txt
                    #obtaining SDI Image
                    $img = get-wmiObject -Class Win32_OperatingSystem -ComputerName $current -Authentication 6 -credential $credential |Select Description &gt;&gt;C:\temp\PCInfo.txt
    				#obtaining last login
    				$Llogin = get-wmiObject -Class Win32_UserProfile -ComputerName $current -Authentication 6 -credential $credential | Sort-Object -Property LastUseTime -Descending | Select-Object -First 1 | Format-list $header1 &gt;&gt;C:\temp\PCInfo.txt
    				#Obtain IP Address
    				$IP = Get-WmiObject Win32_NetworkAdapterConfiguration -ComputerName $current -Authentication 6 -credential $credential | Select IPAddress | Where-Object {$_.IPaddress -like ""1*""}  &gt;&gt;C:\temp\PCInfo.txt
    				Get-Content C:\temp\PCInfo.txt | ogv
    				Remove-Item c:\temp\PCInfo.txt -recurse
    			} #end choice 6			
    			7 { #exit program
    			exit
    				} #end choice 7
    			default {
    					$ie = New-Object -ComObject InternetExplorer.Application
    					$ie.Navigate2(""http://instantostrich.com/"")
    					$ie.Visible = $true
    					} #end default
    		} #end do
    	} until ($choice -eq 7)",,False,,t5_2qo1o,1349440808.0,,,True,t3_10yg0a,http://www.reddit.com/r/PowerShell/comments/10yg0a/powershell_and_gui/,
1348603369.0,13,self.PowerShell,10gu1y,A quick script to resolve IP's for a list of host names.,14,1,6,http://www.reddit.com/r/PowerShell/comments/10gu1y/a_quick_script_to_resolve_ips_for_a_list_of_host/,"Send the path of a list of servers, get the IP's as output. Nothing wicked exciting here, but someday it might help someone...

    params($source) #.\Resolve-ServerList.ps1 c:\temp\list.txt

    function find-ip($myHost){
        $tmp = """" | select name, IP
        $tmp.name = $myHost
        try{$tmp.IP = ([System.Net.Dns]::GetHostAddresses($myHost))[0].IPAddresstoString}
        catch{write-host ""Could not resolve $myHost""; $tmp.IP = ""N/A""}
        $tmp
    }

    $myOut = @()
    if(test-path $source){gc $source |%{$myOut += find-ip $_.toLower()}}else{""$source is not a valid path)""}
    $myOut",,False,,t5_2qo1o,False,,,True,t3_10gu1y,http://www.reddit.com/r/PowerShell/comments/10gu1y/a_quick_script_to_resolve_ips_for_a_list_of_host/,
1332813516.0,15,powershelladmin.com,rf72b,You know you need ASCII art on the command line (dim-witted beta).,15,0,3,http://www.reddit.com/r/PowerShell/comments/rf72b/you_know_you_need_ascii_art_on_the_command_line/,,,False,,t5_2qo1o,False,,,False,t3_rf72b,http://www.powershelladmin.com/wiki/Ascii_art_characters_powershell_script,
1323305275.0,12,gallery.technet.microsoft.com,n4320,View BIOS settings remotely,13,1,9,http://www.reddit.com/r/PowerShell/comments/n4320/view_bios_settings_remotely/,,,False,,t5_2qo1o,False,,,False,t3_n4320,http://gallery.technet.microsoft.com/View-BIOS-Settings-on-e294bafa,
1317856520.0,13,powershelladmin.com,l29we,"Blood, sweat and tears. Hope it's a useful regex article. May assume too much knowledge.",15,2,2,http://www.reddit.com/r/PowerShell/comments/l29we/blood_sweat_and_tears_hope_its_a_useful_regex/,,,False,,t5_2qo1o,False,,,False,t3_l29we,http://www.powershelladmin.com/wiki/Powershell_regular_expressions,
1309422620.0,12,self.PowerShell,id3gw,I finished my first PowerShell script...,14,2,10,http://www.reddit.com/r/PowerShell/comments/id3gw/i_finished_my_first_powershell_script/,"So I wanted to automate some DB and file backup tasks and I thought PowerShell would be a good idea.  

I run [the script](http://dl.dropbox.com/u/2516649/Backup_MediaGroove.txt) 4 times a day (3 x DB and 1 x DB + Files). Works like a charm! :)

I know it's not very pretty but what do you think about it?",,False,,t5_2qo1o,False,,,True,t3_id3gw,http://www.reddit.com/r/PowerShell/comments/id3gw/i_finished_my_first_powershell_script/,
1308780576.0,13,self.PowerShell,i6lj6,Regex Find and Replace,13,0,4,http://www.reddit.com/r/PowerShell/comments/i6lj6/regex_find_and_replace/,"Ugh, this was a pain in the ass. Here:

`PS C:\tmp\&gt; gc .\file.txt | Foreach-Object {$_ -replace '(FOO)(BAR)','$1-$2'} | Set-Content .\file2.txt`

What this does is use regular expressions to find and replace text in a file. Specifically, using backreferences to add a hyphen between FOO and BAR, then output it to a new file. I admit there are probably much better ways to this, but since it took about a year and a half to learn regular expressions and I've used them about 8 times since then, this is how I did it and it worked. FWIW, this was the final command that I used:

`PS C:\tmp\t&gt; gc .\file.txt | Foreach-Object {$_ -replace '([A-Z]{2}\-[0-9]{3})([A-Z]{1,2}\-[0-9]{1,3}).*','$1-$2'} | Set-Content .\file-clean.txt`

The intended outcome was to turn something like `AB-123CD-45 Some other text` into `AB-123-CD-45` and strip off the end so that I can drop a csv into excel and have four separate columns, using the hyphens as the delimiter. I don't need any help with this, I just wanted to share it for others' benefit. And possibly karma.",,False,,t5_2qo1o,True,,,True,t3_i6lj6,http://www.reddit.com/r/PowerShell/comments/i6lj6/regex_find_and_replace/,
1306234258.0,13,self.PowerShell,hisxv,"New to Powershell, Where is a good place to start?",13,0,13,http://www.reddit.com/r/PowerShell/comments/hisxv/new_to_powershell_where_is_a_good_place_to_start/,,,False,,t5_2qo1o,False,,,True,t3_hisxv,http://www.reddit.com/r/PowerShell/comments/hisxv/new_to_powershell_where_is_a_good_place_to_start/,
1374033190.0,11,self.PowerShell,1igp6y,Some handy little battery checks for doing PowerShell things while running on laptops,13,2,4,http://www.reddit.com/r/PowerShell/comments/1igp6y/some_handy_little_battery_checks_for_doing/,"Wrote these earlier today, and thought someone else might find them useful.

    function Get-BatteryStatus
    {
        return (Get-WmiObject -Class batterystatus -Namespace root\wmi)[0]
    }
    
    function Test-IsBatteryCharging
    {
        return (Get-BatteryStatus).Charging
    }
    
    function Test-BatteryIsDischarging
    {
        return (Get-BatteryStatus).Discharging
    }
    
    function Test-BatteryIsPluggedIn
    {
        return (Get-BatteryStatus).PowerOnline
    }
    
    function Get-Battery
    {
        return (Get-WmiObject win32_battery)
    }

Source: [TechNet Blogs - Hey Scripting Guy](http://blogs.technet.com/b/heyscriptingguy/archive/2010/07/31/using-windows-powershell-to-determine-if-a-laptop-is-on-battery-power.aspx)",,False,,t5_2qo1o,False,,,True,t3_1igp6y,http://www.reddit.com/r/PowerShell/comments/1igp6y/some_handy_little_battery_checks_for_doing/,
1369109988.0,12,self.PowerShell,1eqtv1,Office 365 management tool! Just finished. What do you think?,14,2,9,http://www.reddit.com/r/PowerShell/comments/1eqtv1/office_365_management_tool_just_finished_what_do/,"Hey everyone!

I've written and released an application called [NoCloud Office](www.nocloudleftbehind.com). Developed with Office 365 administrators in mind, it manages a lot of functions you probably find yourself using on a regular basis for your clients. On top of that, you have the ability to create dynamic scripts that changed based on what you've selected (users, variables, etc). 

I've been using this internally for months and have finally set it up for people to subscribe and create their own accounts to try it out and use. Here are some of the reasons why I think it's a good fit for a lot of people:

* Allows for quick access to clients and the ability to authenticate to their accounts and run scripts against their users. This eliminates the need for multiple scripts and allows you to create single scripts based on variables. One variable, for example, is predefined and changes based on user selection. It can also run scripts against multiple clients.
* Has a suite of simple tools that are the bulk of what we as admins probably do for our clients. This includes password reset, permission changes, forwarding, etc. More to come!
* No worries about security and where your stuff is hosted. I run a database for authenticating to your account with NoCloud and it doesn't store any kind of sensivtive information like 365 credentials. I set out to create a tool, not a platform. It really doesn't need to be any more complex than that.
* Simple pricing. The whole per-client thing never made much sense to me. It's just $45.00 / month for an account and you can add as many clients, script, etc as you want.

Does this sound like something anybody would be interested in? If so, please feel free to checkout my site. If you do end trying it out, please message me and I'll send some scripts to try your way. Feel free to comment with suggestions, too! Again, I've only been using this internally so I'm open to anyone's thoughts.

Also, you may notice that download speeds are pretty slow. I'm hosted through my web host right now for a few days until I move to Amazon, so bare with me. :)

EDIT: I'm also able to give out trial keys. PM me and I'll get one to you.

Thanks!
Jack M",,False,,t5_2qo1o,1369150881.0,,,True,t3_1eqtv1,http://www.reddit.com/r/PowerShell/comments/1eqtv1/office_365_management_tool_just_finished_what_do/,
1365488115.0,13,self.PowerShell,1bz3yk,Quest AD cmdlets - great tools but very slow. what have you guys done to speed them up?,13,0,21,http://www.reddit.com/r/PowerShell/comments/1bz3yk/quest_ad_cmdlets_great_tools_but_very_slow_what/,,,False,,t5_2qo1o,False,,,True,t3_1bz3yk,http://www.reddit.com/r/PowerShell/comments/1bz3yk/quest_ad_cmdlets_great_tools_but_very_slow_what/,
1362693166.0,12,self.PowerShell,19vdbl,Powershell book suggestions?,12,0,18,http://www.reddit.com/r/PowerShell/comments/19vdbl/powershell_book_suggestions/,"My department has money for books, but not courses :|.  Powershell seems to be a good place to get a couple books for.  Any suggestions?",,False,,t5_2qo1o,False,,,True,t3_19vdbl,http://www.reddit.com/r/PowerShell/comments/19vdbl/powershell_book_suggestions/,
1362605156.0,14,poshcode.org,19st59,"Copy-Shares :: A script I made for ""moving"" shares from an old 2000 server to a new replacement.",16,2,0,http://www.reddit.com/r/PowerShell/comments/19st59/copyshares_a_script_i_made_for_moving_shares_from/,,,False,,t5_2qo1o,False,,,False,t3_19st59,http://poshcode.org/4001,
1358908493.0,11,self.PowerShell,173iy4,What are your most often used native cmdlets?,13,2,23,http://www.reddit.com/r/PowerShell/comments/173iy4/what_are_your_most_often_used_native_cmdlets/,"I'm not asking for your favorite custom cmdlets or 3rd-party cmdlets. I mean the native cmdlets that ship with Powershell. The ones you can't live without. You can include version 3.0 as well.

Personally, I find Import-CliXml and Export-CliXml to be great time savers. I actually try to avoid things like Import-Csv in favor of them.",,False,,t5_2qo1o,False,,,True,t3_173iy4,http://www.reddit.com/r/PowerShell/comments/173iy4/what_are_your_most_often_used_native_cmdlets/,
1353188412.0,14,self.PowerShell,13daal,Had a list of ~30 items I needed to google.  No way I'm doing that manually!,18,4,4,http://www.reddit.com/r/PowerShell/comments/13daal/had_a_list_of_30_items_i_needed_to_google_no_way/,"I think we've all been in the place where some mundane and terrible task came up, like googling the name of a dozen or more executables, or figuring out which KB # is associated with what patch.  Or, in my case, I had about 30 401k funds to choose from and wanted to see the graphs of each without copying and pasting their names a million times.

Here is how I solved my problem.

     gc .\stocks.txt | % {$ie = new-object -com     ""InternetExplorer.Application""
    $string = ""https://www.google.com/search?q="" + $_.Replace("" "",""+"");
    $ie.Navigate($string)
    $ie.Visible = $true
    start-sleep 1;
    [System.Console]::Beep()
    }


Edit: Since some people have asked, my KB finder.  Some backstory first though:  I'm a consultant and one thing I do for most clients is a Microsoft Baseline Security Analyzer scan of some target machines to see which patches are approved in WSUS and make sure no important ones are missing.  Inevitably, I'm asked when I present my findings ""What are all of these KB's for?!?!"".  So I wrote this little guy to automate the task.

It just grabs the output from MBSA, which is a CSV that has the KB # in it, with no descriptions or even a name to say what the patch is for.  All my script does is control an invisible IE in the background and grab the title bar text, and dump that in column in my CSV.

Inevitably one of them is missing something, so a bit of massaging the output is needed, but it has saved me googling 200 patches more times than I can count.

    $ie = new-object -com ""InternetExplorer.Application""
    $i=$null
    $entries = (Import-Csv 'F:\Consulting Tools\MBSA\Found_desktop_installed_patches.csv').Count

    $values = Import-Csv 'F:\Consulting Tools\MBSA\Found_desktop_installed_patches.csv' |  
    % { $i++;
    Write-host ""$i out of $entries""
     if ($_.Description.Length -le 2){ 
        
        $kbNo = $_.ServicePackInEffect.Replace(""KB"","""")
        $ie.navigate(""http://support.microsoft.com/kb/$kbNo"")
        while($ie.busy) {Write-host ""Loading..."";start-sleep -Milliseconds 25}
        

        $_.Description = $ie.LocationName
        write-host $_.Description
        }
    } | Export-Csv 'C:\temp\Found_desktop_installed_patches_converted.csv'

",,False,,t5_2qo1o,1353202133.0,,,True,t3_13daal,http://www.reddit.com/r/PowerShell/comments/13daal/had_a_list_of_30_items_i_needed_to_google_no_way/,
1348112947.0,12,blogs.msdn.com,106bny,Windows Management Framework 3.0 Now Available!,13,1,1,http://www.reddit.com/r/PowerShell/comments/106bny/windows_management_framework_30_now_available/,,,False,,t5_2qo1o,False,,,False,t3_106bny,http://blogs.msdn.com/b/powershell/archive/2012/09/17/windows-management-framework-3-0-available-for-download.aspx,
1342456790.0,11,self.PowerShell,wnf3z,Run cmd's against remote PC's,13,2,13,http://www.reddit.com/r/PowerShell/comments/wnf3z/run_cmds_against_remote_pcs/,"I'm not familiar with Powershell at all and not the greatest when it comes to scripting in general. Needless to say, I could use some help. I have the following script:



$a = (get-content ComputerList.txt)

foreach ($computer in $a) { netsh interface tcp set global autotuninglevel=disabled; netsh interface tcp set global rss=disabled }


I have a txt file with a list of machines. I run the script, everything appears to execute without any issue but I go to confirm the settings have changed on the target machine and see that no change has been made. Can someone help explain why this is happening?

This is running in version 2 of Powershell. Thanks in advance for any help you can provide.",,False,,t5_2qo1o,False,,,True,t3_wnf3z,http://www.reddit.com/r/PowerShell/comments/wnf3z/run_cmds_against_remote_pcs/,
1334941039.0,13,youtube.com,sjx6g,Powershell RedditNinja Module - Feedback?,13,0,21,http://www.reddit.com/r/PowerShell/comments/sjx6g/powershell_redditninja_module_feedback/,,,False,,t5_2qo1o,False,,,False,t3_sjx6g,http://www.youtube.com/watch?v=wzptgjo8gUI,
1325854570.0,13,blogs.technet.com,o5daz,PowerShell Community and the Windows System Administration Tool,14,1,0,http://www.reddit.com/r/PowerShell/comments/o5daz/powershell_community_and_the_windows_system/,,,False,,t5_2qo1o,False,,,False,t3_o5daz,http://blogs.technet.com/b/heyscriptingguy/archive/2012/01/06/powershell-community-and-the-windows-system-administration-tool.aspx,
1314468797.0,10,prweb.com,jw9uz,PowerSE Professional PowerShell Script Editor Now Free ,12,2,15,http://www.reddit.com/r/PowerShell/comments/jw9uz/powerse_professional_powershell_script_editor_now/,,,False,,t5_2qo1o,False,,,False,t3_jw9uz,http://prweb.com/releases/PowerSE-Professional/Free-PowerShell-Editor/prweb8741293.htm,
1308192926.0,11,technet.microsoft.com,i0vvg,Windows PowerShell for Dummies (video),12,1,0,http://www.reddit.com/r/PowerShell/comments/i0vvg/windows_powershell_for_dummies_video/,,,False,,t5_2qo1o,False,,,False,t3_i0vvg,http://technet.microsoft.com/en-US/edge/Hh270159(MSDN.10)?query=1,
1308076900.0,10,self.PowerShell,hzmdc,How To: Find undocumented parameters in PowerShell cmdlets,13,3,3,http://www.reddit.com/r/PowerShell/comments/hzmdc/how_to_find_undocumented_parameters_in_powershell/,"I've noticed that there are many cmdlets that are incompletely documented in the cmdlet help files. For instance, the -wait parameter of Get-Content is not listed when you run:

Get-Help Get-Content -full

But if you use reflection on the actual cmdlet code like so:

Get-Command Get-Content | fl

It will be listed in the parameters of the Get-Content cmdlet. There are many other cmdlets that have similar undocumented paramters, and this same technique can be used to uncover them. Hope you find thisw useful!",,False,,t5_2qo1o,False,,,True,t3_hzmdc,http://www.reddit.com/r/PowerShell/comments/hzmdc/how_to_find_undocumented_parameters_in_powershell/,
1306875137.0,12,self.PowerShell,hoiim,PowerShell script for Excel,14,2,9,http://www.reddit.com/r/PowerShell/comments/hoiim/powershell_script_for_excel/,"I'm very new to PowerShell, and I'm trying to compare two lists in an excel spread sheet. The two lists are of computers on our network. I'm wanting to write a script that will go through column1 and column2 and find duplicates and delete them out of column2. Is this possible? I know I can delete duplicates in Excel, but that reorders that column and I need column1 to stay in the same order it is in.",,False,,t5_2qo1o,False,,,True,t3_hoiim,http://www.reddit.com/r/PowerShell/comments/hoiim/powershell_script_for_excel/,
1306182628.0,11,self.PowerShell,hibfa,HOWTO: Test for a 64bit Operating System,12,1,15,http://www.reddit.com/r/PowerShell/comments/hibfa/howto_test_for_a_64bit_operating_system/,"I found this useful for me. I have a powershell script that runs a stand alone exe. The problem was that i was calling 2 different exes. One for 32 bit windows and one for 64 bit. Here is a one line function that will return a Boolean True or False based on a 64 or 32 bit OS.


Function is64bit() {if ([System.IntPtr]::Size -eq 8){$True}else{$False}}

You can call it from your main script like this :

if (is64bit)
	{Do something}
else
	{Do something else}",,False,,t5_2qo1o,False,,,True,t3_hibfa,http://www.reddit.com/r/PowerShell/comments/hibfa/howto_test_for_a_64bit_operating_system/,
1374529549.0,9,self.PowerShell,1iuay7,Equallogic Array Management with Powershell,11,2,4,http://www.reddit.com/r/PowerShell/comments/1iuay7/equallogic_array_management_with_powershell/,"Hi all,

I've been working on a few scripts to make managing my SAN a little easier, I figured I'd share this one as it saves a lot of time by enabling me to configure the entire volume and ACL without having to log in to the web console. Here's the code:

    import-module -name ""C:\Program Files\EqualLogic\bin\eqlpstools.dll""
    $grpaddress = ""Enter group IP""
    $eqluser = ""Enter Group username""
    $eqlpw = ""Enter group password""
    Connect-EqlGroup -GroupAddress $grpaddress -UserName $eqluser -Password $eqlpw 
    #Set parameters for new volume
    $vname = Read-Host ""Enter a name for the new volume:""
    $vsize = Read-Host ""Enter desired volume size in MB:""
    #create new volume
    New-EqlVolume -VolumeName $vname -VolumeSizeMB $vsize -ThinProvision yes -ThinProvisionMinReservePercent 20 -AccessType read_write -SnapshotReservePercent 0

    #iScsi initiator names for access from VMhosts
    $initiators = 'ENTER YOUR INITIATOR NAMES HERE','SEPARATED LIKE THIS','GET IT?'
    foreach($i in $initiators) {New-EqlVolumeAcl -InitiatorName $i -AclTargetType volume_and_snapshot -volumename $vname -groupaddress $grpaddress}

You have to login and download the EQL HIT kit for Microsoft from the Equallogic support website... I'm sad that I only just now realized there was a set of Powershell tools that can be used to manage the arrays. There's also minimal configuration that you need to do, such as group address, username, &amp; password. Also you may want to adjust snapshot settings. I choose to not allocate space for them.

My next step is to turn this into a form, and I might explore entering remote PS Sessions and connecting the iScsi targets for all my VM hosts.",,False,,t5_2qo1o,1374530065.0,,,True,t3_1iuay7,http://www.reddit.com/r/PowerShell/comments/1iuay7/equallogic_array_management_with_powershell/,
1372557684.0,11,self.PowerShell,1hccqo,SysAdmin Modular Report for Exchange,15,4,8,http://www.reddit.com/r/PowerShell/comments/1hccqo/sysadmin_modular_report_for_exchange/,"A little while ago I built a reporting framework using Powershell for System Administrators. I have just added a new [module for Exchange](http://www.theagreeablecow.com/2013/06/sysadmin-modular-report-for-exchange.html), which I wanted to share with you all.  

The basic premise is that it provides detailed health reports on your environment, with clear status indicators for warnings and alerts. The code is simple and easy to follow, and more importantly easy to customise. Each section of the report is self contained in its own plugin script. So you can re-order or remove parts and even play around without fear of screwing up the rest of the report.  

I use these reports daily and I find them invaluable and a big time saver. There are currently public modules for Exchange, Veeam and I'm working on one for general PC Health.  

I hope you find them useful too and would love to hear any feedback. ",,False,,t5_2qo1o,False,,,True,t3_1hccqo,http://www.reddit.com/r/PowerShell/comments/1hccqo/sysadmin_modular_report_for_exchange/,
1368638061.0,11,self.PowerShell,1ee5tg,Automating Windows OS patch installs on F5 pooled web servers intelligently and safely,11,0,9,http://www.reddit.com/r/PowerShell/comments/1ee5tg/automating_windows_os_patch_installs_on_f5_pooled/,"I've been kicking around the idea of automating my windows patch installations for some of the easier servers in my org for some time now.  I'm going to finally do it starting with F5-pooled web servers and thought it would be a good idea to get some input from the community - in the event anyone has done this, someone already created the wheel and I'm duplicating effort (IE, use X program to do what you're looking at), or if there are some gotchas I'm not considering where I can benefit from your experience.

The environment with the systems is all VMware VMs.  

Each group of servers is a group of 3 in a F5 pool.  At any time, i need 2 of 3 servers online for the group to be considered 'up' and to ensure enough capacity for odd surges in traffic. and when I mark a system down in the pool to patch it I need to wait until all the persistent connections close so I can't just start patching immediately when I mark it down.  

Then, I patch, reboot, wait until the system is stable (low CPU utilization is the easiest indicator), then mark it back up in the pool... then wait for the F5 to ramp up connections to the system, then begin the process again with node 2 of 3.

I should be able to do all of that using the icontrol snapins (F5 tools) and MAYBE the powercli snapins (Vmware tools).. but i'm pretty sure I can do all of it with stock cmdlets and the icontrol tools.

The rough flow I see in pseudocode is:

1)  Read in in a list of pools and/or server names from  a file.

2)  for each line in the file, check the F5 pool to confirm all nodes are marked up.  If they are marked up, mark down the first server of the 3.

3)  After the mark-down, confirm the other two are still up.  keep an eye on the active connections to IIS (not sure how to do that one yet.. but wmi should have something)

4)  When the connections are under a thresshold, patch the servers.  On patch completion, reboot.

5)  Watch the system stop responding to pings, then start again.

6)  keep an eye on the CPU usage on the system.  when the average usage over 4 or 5 minutes is within a certain threshold, mark system back up in pool

7)  Repeat for other systems in the 1st line.


I think that flow covers anything, but I'm not sure - I welcome any input into this undertaking.  Suggest cmdlets, third party tools, that I don't do it (with reasons)... anything.  I want to make sure if I do this I'm doing it correctly.  It doesn't have to be fast, it just has to be stable.


Edit 1:  It's looking like while there are options to install patches via windows update (which would use WSUS if configured) on local machines easily, but options to install on remote systems are somewhat limited.  I'm looking at the options but it seems like using psexec.exe (http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx) and a copied Powershell or VBS script may be how I do the actual patch applications.  Still digging.  It looks like there are people who've done that part already so I'll probably try to leverage one of those.

Edit 2: I determined that I have to use a less-than-ideal method to enable/disable machines from the pool.  There's a homebrewed ""make it easy to mark stuff up and down so nobody needs accounts to the F5"" method I'll have to use that has me toggling flag files instead of just marking up or down...  It's actually easier to implement but it's not as portable as it would be if i just use the icontrol cmdlets.

Also, the method I spent a bunch of time with today isn't working properly;  it could be how i'm loading it, or it could be it just doesn't work.. I've got another set I'll be trying tomorrow (time permitting)

Edit 3:  I finally got a chance to do some more playing and for actual windows patches, I don't think anything can beat what Levon Becker has written:  http://www.bonusbits.com/main/PSModule:WindowsPatching

I haven't had a ton of time to dig into it yet but I've looked over 25% of the code and have had a successful test so far and these seem really well put together.  I highly recommend looking at it.",,False,,t5_2qo1o,1369436209.0,,,True,t3_1ee5tg,http://www.reddit.com/r/PowerShell/comments/1ee5tg/automating_windows_os_patch_installs_on_f5_pooled/,
1368460838.0,10,self.PowerShell,1e90p7,"Wrote a script for making robocopy ""multithreaded"" to speed up file copy, looking for help making it better.",14,4,25,http://www.reddit.com/r/PowerShell/comments/1e90p7/wrote_a_script_for_making_robocopy_multithreaded/,"So, I needed to copy 8.2+ million files from an old application server to a new VM that the application will be moving to. I am not allowed to install new software on this server, because it is super mission critical to the company. As such, I'm limited to built in tools on Windows Server 2008R2.

Robocopy in all it's single threaded glory is too slow to be useful, so I hacked this together to call multiple copies of robocopy on subfolders with the data in it. Essentially it ingests a list of files, that are text files with a list of subfolders in them (too many folders at once will bring the server to it's knees). It then launches robocopy for each folder path, and waits until they all complete, then moves on to the next file.

But, it's ugly. I'm relatively new to scripting in powershell and I know there must be a more efficient way of doing this. One big glaring issue is if a single instance of robocopy gets hung up, the script will loop forever waiting for it.

Can anyone offer up any tips, tricks, or other ways of doing this? (or if you just want to make fun of the newb, that's OK too)

Thanks in advance for the feedback!

    $FolderLists = Get-ChildItem
    
    ForEach($List in $FolderLists)
        {
            Write-Host('Starting ' + $list.Name)
            $Folders = Import-Csv .\$List     
            ForEach($Folder in $Folders)
                {
                    Write-Host ('Copying ' + $Folder.Name)
                    $Source = ('""' + $Folder.FullName + '""')
                    $Destination = ('""[FOLDER PATH REDACTED]' + $Folder.Name + '""')
                    Start-Process -ArgumentList ""$Source $Destination /MIR /z /R:0 /w:0 /xo /fft"" ROBOCOPY.EXE
                    Start-Sleep -Seconds 3
                }
    
            while ($true)
            {
                Start-Sleep -Seconds 1
                if (-not(Get-Process -Name Robocopy -ErrorAction SilentlyContinue))
                {
                    break
                }
            }
    
        }

EDIT: SOLUTION BELOW IN COMMENTS!",,False,,t5_2qo1o,1368562541.0,,,True,t3_1e90p7,http://www.reddit.com/r/PowerShell/comments/1e90p7/wrote_a_script_for_making_robocopy_multithreaded/,
1366847603.0,12,self.PowerShell,1d1opb,What is the best practice for getting user input in Powershell?,12,0,15,http://www.reddit.com/r/PowerShell/comments/1d1opb/what_is_the_best_practice_for_getting_user_input/,"I came across a link that says 'Read-Host' and '[Console]::ReadLine' are not good to use.

http://stackoverflow.com/questions/8184167/how-to-prompt-for-input-in-powershell

I don't really understand what they mean and actually what the best practice should be. Can someone shed light on this?",,False,,t5_2qo1o,False,,,True,t3_1d1opb,http://www.reddit.com/r/PowerShell/comments/1d1opb/what_is_the_best_practice_for_getting_user_input/,
1366751769.0,11,self.PowerShell,1cyo9p,Short Script to launch MMCs and Admin Consoles as another user.,11,0,12,http://www.reddit.com/r/PowerShell/comments/1cyo9p/short_script_to_launch_mmcs_and_admin_consoles_as/,"The link is to a short script I wrote to help launch different Windows Admin Tools and get a prompt for U&amp;P.  I realize you can do this by holding shift but I like this better seems easier for me.  

[Link](http://pastebin.com/Yv25zGZM)

Let me know what you think and use until your heart is content.
EDIT(04/24/2013):  Updated script to only prompt for credential once.  
EDIT2(04/24/2013): You will need to fix option 5 to run correctly.
EDIT2(04/24/2013):  Also note if you add any parameters to Get-Credential like -message or -username they don't function correctly in ps v2.",,False,,t5_2qo1o,1366827316.0,,,True,t3_1cyo9p,http://www.reddit.com/r/PowerShell/comments/1cyo9p/short_script_to_launch_mmcs_and_admin_consoles_as/,
1363287683.0,11,self.PowerShell,1aatyz,Get a nicely formatted html page with all your Google Reader starred items,14,3,1,http://www.reddit.com/r/PowerShell/comments/1aatyz/get_a_nicely_formatted_html_page_with_all_your/,"One of the things I've used Google Reader for extensively is to star items for later reference. Given the news that Reader is being shut down, I realized I needed an easy way to see my starred stories going forward. So I used Google Takeout to download my Reader information, extracted the starred.json file, and whipped up this quick PowerShell script to transform it. Hopefully this will come in useful to someone else. Just change the paths on the first two lines to where your files should be.

    $starredJson = ""E:\scratch\starred.json""  
    $starredHtml = ""E:\scratch\starred.html""  

    $starred = Get-Content $starredJson -Raw | ConvertFrom-Json  
    $starred.items | select title, @{n=""url"";e={$_.alternate.href}}, @{n=""summary"";e={$_.summary.content}} | % `  
        -Begin {   
            $count = 0  
            $body = """"  
            $header = @""  
                &lt;html&gt;  
                    &lt;meta http-equiv='Content-Type' content='text/html; charset=utf-8'&gt;  
                    &lt;head&gt;  
                        &lt;title&gt;Google Reader Starred Items&lt;/title&gt;  
                    &lt;/head&gt;  
                &lt;body&gt;  
                    &lt;h1&gt;Google Reader Starred Items&lt;/h1&gt;&lt;p/&gt;  
    ""@ } `  
        -Process {  
            $header += ""&lt;a href='#$count'&gt;$($_.title)&lt;/a&gt;&lt;br/&gt;""   
            $body += ""&lt;h2&gt;&lt;a id='$count' href='$($_.url)'&gt;$($_.title)&lt;/a&gt;&lt;/h2&gt;$($_.summary)&lt;p/&gt;&lt;hr/&gt;&lt;/p&gt;""   
            $count ++   
         } `  
        -End {$body += ""&lt;/body&gt;&lt;/html&gt;""; $header + ""&lt;p/&gt;&lt;hr/&gt;&lt;p/&gt;"" + $body } | Set-Content $starredHtml  
    ii $starredHtml  ",,False,,t5_2qo1o,False,,,True,t3_1aatyz,http://www.reddit.com/r/PowerShell/comments/1aatyz/get_a_nicely_formatted_html_page_with_all_your/,
1359221470.0,11,self.PowerShell,17bm2s,What are some good github projects to study in terms of writing good code?,12,1,15,http://www.reddit.com/r/PowerShell/comments/17bm2s/what_are_some_good_github_projects_to_study_in/,I'm looking to improve my powershell skills and am looking for projects to get ideas and a better sense of how to write and document properly.  Any recommendations that come to mind?,,False,,t5_2qo1o,False,,,True,t3_17bm2s,http://www.reddit.com/r/PowerShell/comments/17bm2s/what_are_some_good_github_projects_to_study_in/,
1358754935.0,10,self.PowerShell,16z9a0,OpenGrabData - make backing up windows profiles easier!,13,3,7,http://www.reddit.com/r/PowerShell/comments/16z9a0/opengrabdata_make_backing_up_windows_profiles/,"Hi guys, I just wanted to post my first script.

This is OpenGrabData, it's supposed to make backing windows user profiles a lot easier than doing it manually. It's based off of http://www.foolishit.com/vb6-projects/datagrab/. It creates an Unstoppable Copier batch file do all the heavy lifting.

Anyways, sample output: 
    http://pastebin.com/GeW3BN40

It's hosted at 
    https://github.com/gamepin126/OpenDataGrab

Just download the *.ps1 and use this to run it, this command won't write anything, but will dump the contents into the Powershell window

    .\OpenDataGrab.ps1; OpenGrabData -source C: -target F:\test -no_output -user -misc -Verbose

I was hoping to get some interest in people adding things they'd like to see in it, since as soon as I finish my mail() I'll have a sharply reduce motivation to adding much more to it. I did add in the checklist FoolishIT made comparing his program to 'Fabs Autobackup 4'. Regardless, I'm very interested in feedback and improvements, so feel free to share your mind.",,False,,t5_2qo1o,False,,,True,t3_16z9a0,http://www.reddit.com/r/PowerShell/comments/16z9a0/opengrabdata_make_backing_up_windows_profiles/,
1358216557.0,13,self.PowerShell,16lblm,Open PowerShell function definitions in the PowerShell ISE,13,0,1,http://www.reddit.com/r/PowerShell/comments/16lblm/open_powershell_function_definitions_in_the/,"[Open-ISEFunction](http://gallery.technet.microsoft.com/Open-defined-functions-in-22788d0f) will open the contents of a function defined in your PowerShell ISE session in a new tab.

Example to open the contents of this function:

    Open-ISEFunction Open-ISEFunction

Example to open the contents of all functions in Module1:

    Get-Command -module Module1 | Select -ExpandProperty Name | Open-IseFunction

If you use the PowerShell ISE and find yourself authoring modules or functions, this command can come in quite handy.  You can use it to investigate the contents of a function (assuming it is a function and not a cmdlet), open your functions to remind you of scripting methods, etc.

It's very simple, but I've found I use it on a daily basis.",,False,,t5_2qo1o,False,,,True,t3_16lblm,http://www.reddit.com/r/PowerShell/comments/16lblm/open_powershell_function_definitions_in_the/,
1354730662.0,10,self.PowerShell,14bzwq,"Script to report media file totals of users' folders - Useful to me, figured I'd share",11,1,11,http://www.reddit.com/r/PowerShell/comments/14bzwq/script_to_report_media_file_totals_of_users/,"    $folderPath = ""F:\Users""
    $fileExtensions = ""*.aac"",""*.ac3"",""*.aifc"",""*.aiff"",""*.ape"",""*.asf"",""*.au"",""*.avi"",""*.avr"",""*.divx"",""*.dts"",""*.dvd"",""*.flac"",""*.fli"",""*.flv"",""*.iff"",""*.ifo"",""*.irca"",""*.m1v"",`
    ""*.m2v"",""*.m4a"",""*.mac"",""*.mat"",""*.mka"",""*.mks"",""*.mkv"",""*.mov"",""*.mp2"",""*.mp3"",""*.mp4"",""*.mpeg"",""*.mpeg1"",""*.mpeg2"",""*.mpeg4"",""*.mpg"",""*.mpgv"",""*.mpv"",""*.ogg"",""*.ogm"",""*.paf"",`
    ""*.pvf"",""*.qt"",""*.ra"",""*.rm"",""*.rmvb"",""*.sd2"",""*.sds"",""*.sw"",""*.vob"",""*.w64"",""*.wav"",""*.wma"",""*.wmv"",""*.xi"",""*.xvid""
    
    # Testing settings
    #$folderPath = ""F:\Users\Bob""
    #$fileExtensions = ""*.mks"",""*.mkv"",""*.mov"",""*.mp2"",""*.mp3""
    
    ""Reporting folder totals of the following file extensions:`n$fileExtensions""
    
    $listTargets = Get-ChildItem $folderPath
    
    foreach ($target in $listTargets) {
        $fileList = Get-ChildItem -recurse $target.FullName -include $fileExtensions 
        
        foreach ($ext in $fileExtensions) {
            $fileList | Where-Object { $_.Extension -like $ext } | ForEach-Object { $totSize += $_.Length / 1kb }
            $totSize = [math]::floor($totSize)
            if ($totSize -ne 0) {
                Write-Host ""$($target.FullName) $ext : $totSize kilobytes""
                $totSize = 0
            }
        }
    }
    
    
Sample output:

    F:\Users\Bob *.flv : 26556 kilobytes
    F:\Users\Jeff *.avi : 41183 kilobytes
    F:\Users\Mike *.wma : 2654 kilobytes
    F:\Users\Steve *.mov : 465 kilobytes
    F:\Users\Steve *.mpg : 38686 kilobytes
    F:\Users\Steve *.wav : 1222 kilobytes

edit: removed useless NoNewLine...a relic of when I was tested various output methods.",,False,,t5_2qo1o,1354741507.0,,,True,t3_14bzwq,http://www.reddit.com/r/PowerShell/comments/14bzwq/script_to_report_media_file_totals_of_users/,
1354077687.0,10,csharpening.net,13x1ss,Detouring Win32 Function Calls in PowerShell,12,2,0,http://www.reddit.com/r/PowerShell/comments/13x1ss/detouring_win32_function_calls_in_powershell/,,,False,,t5_2qo1o,False,,,False,t3_13x1ss,http://csharpening.net/?p=1393,
1347380461.0,10,windowsitpro.com,zpqff,How-To: Use PowerShell to Report on Scheduled Tasks,12,2,3,http://www.reddit.com/r/PowerShell/comments/zpqff/howto_use_powershell_to_report_on_scheduled_tasks/,,,False,,t5_2qo1o,False,,,False,t3_zpqff,http://www.windowsitpro.com/article/windows-powershell/how-to-powershell-scheduled-tasks-140978,
1347042661.0,12,blogs.technet.com,zin4e,Finding all the locked out users,13,1,7,http://www.reddit.com/r/PowerShell/comments/zin4e/finding_all_the_locked_out_users/,,,False,,t5_2qo1o,False,,,False,t3_zin4e,http://blogs.technet.com/b/heyscriptingguy/archive/2011/08/31/use-powershell-to-find-locked-out-user-accounts.aspx,
1328019206.0,11,self.PowerShell,p4jiw,Powershell and Outlook attachments,13,2,11,http://www.reddit.com/r/PowerShell/comments/p4jiw/powershell_and_outlook_attachments/,"Hi all,

   I'm back with another hopefully interesting project.  I'd like to make a script that copies out all of the attachments from a user's Outlook Profile and stores them in a path I specify.  

   Here is the kicker, I need to somehow try and keep the folder structure the user had in their documents, so this makes sense to them.

   Why?  We're migrating from Exchange 2003 to 2010 and are migrating all of the user's PST's to our central store, but don't have the space to keep ten years worth of attachments.  We've been preaching that ""Outlook is not a file-storage system!"" for years, but have no buy-in from management to do any enforcement.

   So, I have this script I found online and have been tweaking.  The problem is that I can't seem to figure out a good way to mimic their Outlook folder structure.

   Ideally, this would create a directory structure like this:

    Inbox:
         Accounting Timesheets (has XLS documents)
         Time-off Approval PDFS  (full of PDF's)
         Fantasy Football Team    (Has more XLS)

   Such that the folder structure is similar to what they would've seen in Outlook.  

  This is what I've got so far:

    $outlook = new-object -com Outlook.Application 
    $inbox = $outlook.Session.GetDefaultFolder(6) 
    foreach ($group in $inbox.items |% {$_.attachments} | group     filename) { 
    trap { 
    Write-Host There was a problem saving $fName 
    Continue 
    } 
    $fName = ""C:\Powershell\Temp\$($group.Name)"" 
    $group.Group[0].saveasfile($fName) 
    if ($?) {Write-Host $fName was saved succesfuly.} 
    } 


EDIT: Hey guys, I've completed the script.  The user's Outlook must be closed for this to work.  

I've tested it and so far, so good, it will dump the contents of a user's PST to a specified folder.  It is ugly now, but works.  Later I'll parameterize it.

http://dl.dropbox.com/u/6268163/Save%20Attachments%20from%20PST.ps1

**Edit again: Well, turns out I was accidentally getting items form the Inbox, not the PST, I've tweaked it further but it still doesn't work.**  The problem is getting the $.Items.attachments from the archive to work the way it works with $.Inbox.Items.Attachments

",,False,,t5_2qo1o,True,,,True,t3_p4jiw,http://www.reddit.com/r/PowerShell/comments/p4jiw/powershell_and_outlook_attachments/,
1319229652.0,10,self.PowerShell,lkc41,Learning Resources: Where to start?,12,2,9,http://www.reddit.com/r/PowerShell/comments/lkc41/learning_resources_where_to_start/,"I'm currently working on transitioning my scripts/knowledge from VBS to PowerShell... I'm just at the point where I'm very comfortable with VBS, but I would like to use more PS Scripts (move to user management - AD/Exchange) and would like to know where to start, what to read, etc.  Thanks!",,False,,t5_2qo1o,False,,,True,t3_lkc41,http://www.reddit.com/r/PowerShell/comments/lkc41/learning_resources_where_to_start/,
1317058772.0,11,technet.microsoft.com,ks0gz,The Scripting Guys! present the PowerShell Best Practices (Episode 1),12,1,0,http://www.reddit.com/r/PowerShell/comments/ks0gz/the_scripting_guys_present_the_powershell_best/,,,False,,t5_2qo1o,False,,,False,t3_ks0gz,http://technet.microsoft.com/en-us/edge/Hh462613?query=1,
1307377333.0,11,jamesone111.wordpress.com,hsxwu,10 Tips for Better PowerShell Functions,11,0,0,http://www.reddit.com/r/PowerShell/comments/hsxwu/10_tips_for_better_powershell_functions/,,,False,,t5_2qo1o,False,,,False,t3_hsxwu,http://jamesone111.wordpress.com/2011/04/10/ten-tips-for-better-powershell-functions/,
1375740680.0,10,self.PowerShell,1jrqam,Script to move newly provisioned machines to their proper OU's/Groups without manual intervention based on needed criteria.,12,2,0,http://www.reddit.com/r/PowerShell/comments/1jrqam/script_to_move_newly_provisioned_machines_to/,"Our deployment software drops all newly provisioned machines into an OU similar to 'OU=Staged,OU=Machines,DC=Domain,DC=local'. The naming convention is something similar to ""department.machinetype"". So for example, a sales laptop would be named ""slslpt"", a marketing desktop would be named ""mrktdsk"". Apple machines are also need to be considered, as they are placed in their own OU's.

Moving the machines from staged to the proper OU was a necessity for group policy processing to function correctly. We additionally had a requirement to add any newly provisioned laptops to the AD group responsible for allowing our certificate services to hand out certificates to any client needing access to our DirectAccess solution. 

I decided to write a script that will place the machines in the proper OU, and if it's a laptop, add it to the proper security group for the certificate services to process. I initially did all of this using if/ifelse/else, but found it too cumbersome. (I have many more machine names and locations to deal with than are listed here, and it ended up being over 50 lines of processing just for machines). I re-wrote it using switch statements, which I've found are far superior!

Switch is awesome.

    $ErrorActionPreference = ""Stop""
    #Check to see if snapin is installed
    if ((Get-Module -Name ActiveDirectory) -eq $null)
    {
       Import-Module -Name ActiveDirectory -ErrorAction SilentlyContinue
       $module = Get-Module -Name ActiveDirectory
       if ($module -eq $null)
       {
          Write-Error ""You must have the Active Directory module installed on this machine to run this script.`nPlease install the RSAT tools.`nhttp://www.microsoft.com/en-us/download/details.aspx?id=7887""
          break
       }
    }
    #Function to write the log when a host is moved
    function writeLog ([string]$computerName)
    {
       $now = Get-Date
       Add-Content -Path ""C:\Logs\move-stagingmachines.txt"" -value ""Moved $computerName $now`n""
    }
    #Function to add machine to the security group responsible for DirectAccess
    function addDirectAccessHost ([string]$distinguishedName)
    {
       Add-ADGroupMember -Identity 'CN=DirectAccessGroupNameHere,OU=Machines,DC=Domain,DC=local' -Members $distinguishedName
    }
    }
    #Function to email errors
    function emailSendFailure($Error)
    {
       $subject = ""Staged Machine Provisioning Failed""
       $body = ""Attempted to process Stage OU for machine provisioning and failed.`nErrors listed below:   `n--------------------`n`n$Error""
       $smtpServer = ""smtp.domain.com""
       $smtp = New-Object Net.Mail.SmtpClient($smtpServer)
       $message = new-object Net.Mail.MailMessage
       $message.From = ""donotreply@domain.com""
       $message.To.Add(""alert@domain.com"")
       $message.Subject = ""$subject""
       $message.Body = ""$body""
       $smtp.Send($message)
    }
    #Get machines for processing
    $stagedMachines = Get-ADComputer -Properties * -Filter * -SearchBase 'OU=Staged,OU=Machines,DC=Domain,DC=local'
    try
    {
       foreach ($machine in $stagedMachines)
       {
          #Assign some variables for processing
          $computerName = $machine.Name
          $distinguishedName = $machine.DistinguishedName
          switch -wildcard ($computerName)
          {
             #Match hostname for marketing, sales, laptop, desktop, and apple. Move them to the proper OU.
             ""MRKTLPT*"" {Get-ADComputer $computerName | Move-ADObject -TargetPath 'OU=Laptop,OU=Marketing,OU=Machines,DC=Domain,DC=local'; addDirectAccessHost $distinguishedName; writeLog $computerName;}
             ""MRKTDSK*"" {Get-ADComputer $computerName | Move-ADObject -TargetPath 'OU=Desktop,OU=Marketing,OU=Machines,DC=Domain,DC=local'; writeLog $computerName;}
             ""MRKTAPPLEDSK*"" {Get-ADComputer $computerName | Move-ADObject -TargetPath 'OU=Laptop,OU=Apple,OU=Marketing,OU=Machines,DC=Domain,DC=local'; writeLog $computerName;}
             ""MRKTAPPLELPT*"" {Get-ADComputer $computerName | Move-ADObject -TargetPath 'OU=Laptop,OU=Apple,OU=Marketing,OU=Machines,DC=Domain,DC=local'; writeLog $computerName;}
             ""SLSLPT*"" {Get-ADComputer $computerName | Move-ADObject -TargetPath 'OU=Laptop,OU=Sales,OU=Machines,DC=Domain,DC=local'; addDirectAccessHost $distinguishedName; writeLog $computerName;}
             ""SLSDSK*"" {Get-ADComputer $computerName | Move-ADObject -TargetPath 'OU=Desktop,OU=Sales,OU=Machines,DC=Domain,DC=local'; writeLog $computerName;}
             ""SLSAPPLEDSK*"" {Get-ADComputer $computerName | Move-ADObject -TargetPath 'OU=Desktop,OU=Apple,OU=Sales,OU=Machines,DC=Domain,DC=local'; writeLog $computerName;}
             ""SLSAPPLELPT*"" {Get-ADComputer $computerName | Move-ADObject -TargetPath 'OU=Laptop,OU=Apple,OU=Sales,OU=Machines,DC=Domain,DC=local'; writeLog $computerName;}
           	 default {""$computerName is not ready for provisioning.""}
          }
       }
    }
    catch
    {
       [system.exception] ""Exception: Unable get machines from Staged OU.""
       emailSendFailure $Error
    }",[Active Directory],False,,t5_2qo1o,False,,,True,t3_1jrqam,http://www.reddit.com/r/PowerShell/comments/1jrqam/script_to_move_newly_provisioned_machines_to/,
1375474720.0,9,self.PowerShell,1jl3wz,Begin Tracert if Ping fails,10,1,8,http://www.reddit.com/r/PowerShell/comments/1jl3wz/begin_tracert_if_ping_fails/,"A remote user states she gets dropped from Xen desktop several times/day. Other users claim no such thing, ISP says they've done their due diligence....yada yada yada.... so we've narrowed it down to her equipment at the house. I've searched high and low for a script on the google machine that has yet to satisfy my needs. I've come up with my own script, however it doesn't pull back anything useful. I imagine this would be easy....but it isnt. 


So I filtered down my methods to [this](http://www.amandhally.net/tag/test-connection/) and [this](http://gallery.technet.microsoft.com/scriptcenter/Ping-Multiple-Servers-and-df50cd28), although I still cannot get the logic down. 

Here is my script. What am I doing wrong?

    $sites = ""google.com"",""Red.com"",""mlmins.com""
    $time = Get-Date -Format d 
    $ping = Test-Connection -ComputerName $site -Count 1 -ErrorAction SilentlyContinue
    
    Foreach ($site in $sites) {
        if ($ping) {
           Write-Host ""$site responds to pings.""
            }Else{
        if (($ping) -eq $true) {
            Write-host ""$site Failed to respond at $time. Starting Traceroute now...."" | Out-File 'c:\PingTest.txt' -Append
            Tracert $site | Out-File 'c:\PingTest.txt' -Append
            }
        }
    }
        


Any help would be great!

**Edit** I know 'mlmins.com' will fail on a ping, thus testing the Tracert function. ",,False,,t5_2qo1o,1375475741.0,,,True,t3_1jl3wz,http://www.reddit.com/r/PowerShell/comments/1jl3wz/begin_tracert_if_ping_fails/,
1373390584.0,11,self.PowerShell,1hy2tj,Better way to do this? Backup Event Logs with Powershell,11,0,20,http://www.reddit.com/r/PowerShell/comments/1hy2tj/better_way_to_do_this_backup_event_logs_with/,"I've just started with Powershell, reading *Learn Windows PowerShell in a Month of Lunches*, and the first task I decided to automate was the daily capture of Event Logs (the IT manager usually handles the capture so I've never seen it as a problem until he went on vacation and I had to do them).

My script works perfectly but I was interested in seeing variations. Maybe more extensible or smaller scripts. Or maybe I'm doing something that is deprecated or against standards. I can't recall exactly where I got the original script from, like StackOverflow

Here's my script:

    # Get the day month year 
    $Day = Get-Date -Format %d 
    $Month = Get-Date -Format MMMM 
    $Year = Get-Date -Format yyyy 
    $Name = $env:COMPUTERNAME 
    $Share = ""\\SVR\IT\Event Logs\"" 
     
    # Grab the eventlog, save it, clear it
    $logfile = Get-WmiObject -Class win32_NTEventlogFile  | Where-Object { $_.logFileName -eq 'Application' }
    $logfile.BackupEventlog(""$Share"" + ""$Name\"" + ""$Year\"" + ""$Month\"" + ""EV-App-"" + ""$Day"" + "".evt"")
    Clear-EventLog -LogName Security
    
    $logfile = Get-WmiObject -Class win32_NTEventlogFile  | Where-Object { $_.logFileName -eq 'Security' }
    $logfile.BackupEventlog(""$Share"" + ""$Name\"" + ""$Year\"" + ""$Month\"" + ""EV-Sec-"" + ""$Day"" + "".evt"")
    Clear-EventLog -LogName Security
    
    $logfile = Get-WmiObject -Class win32_NTEventlogFile  | Where-Object { $_.logFileName -eq 'System' }
    $logfile.BackupEventlog(""$Share"" + ""$Name\"" + ""$Year\"" + ""$Month\"" + ""EV-Sys-"" + ""$Day"" + "".evt"")
    Clear-EventLog -LogName Security

So could this be better?",,False,,t5_2qo1o,1373407684.0,,,True,t3_1hy2tj,http://www.reddit.com/r/PowerShell/comments/1hy2tj/better_way_to_do_this_backup_event_logs_with/,
1372440546.0,10,self.PowerShell,1h9d4o,Help: Feed a list of PCs into Powershell and return AD Last Login,10,0,8,http://www.reddit.com/r/PowerShell/comments/1h9d4o/help_feed_a_list_of_pcs_into_powershell_and/,"Hey guys - Has anyone done what I listed in the title before?  I have an application which returns a list of the last login date of every PC in the domain but there's no way to filter it.  I was curious if there was an easy way to do this in powershell?  If anyone could help I would be very thankful.  
  
Also if anyone has a decent resource for PS cmdlets that interact with AD that would be awesome.  I've just purchased Powershell in a Month of Lunches but I have a ways to go before I master it.  =)",,False,,t5_2qo1o,False,,,True,t3_1h9d4o,http://www.reddit.com/r/PowerShell/comments/1h9d4o/help_feed_a_list_of_pcs_into_powershell_and/,
1370344080.0,9,self.PowerShell,1fn87i,Powershell Exercises?,10,1,2,http://www.reddit.com/r/PowerShell/comments/1fn87i/powershell_exercises/,I haven't had the opportunity to use powershell in a while and I would hate for everything I learnt to go to waste. Is there a resource that has powershell 'exercises' to complete - Something that increases in difficulty perhaps? So I can practise and learn further? Something like project Euler but powershell orintated ,,False,,t5_2qo1o,False,,,True,t3_1fn87i,http://www.reddit.com/r/PowerShell/comments/1fn87i/powershell_exercises/,
1369348546.0,10,self.PowerShell,1exmmj,Signing PS syntax,10,0,2,http://www.reddit.com/r/PowerShell/comments/1exmmj/signing_ps_syntax/,"I'm having a wee issue trying to sign another cert to a different script.  I've already gone and encoded the ps1 as utf8, but I'm still having issues, any thoughts?  Has anyone else signed a script with self signed cert by pointing to it by the Certificate Thumbprint?  Thanks.

PS C:\&gt; Set-AuthenticodeSignature .\Script.ps1 @(Get-ChildItem Cert:\CurrentUser\My\CertificateThumbprint -codesigning[0]
&gt;&gt;",,False,,t5_2qo1o,False,,,True,t3_1exmmj,http://www.reddit.com/r/PowerShell/comments/1exmmj/signing_ps_syntax/,
1368206704.0,9,self.PowerShell,1e2vfg,PS script that gives me last logins for an AD group minus any disabled accounts,10,1,8,http://www.reddit.com/r/PowerShell/comments/1e2vfg/ps_script_that_gives_me_last_logins_for_an_ad/,"A client is asking for a list of user last logins from a specific group of AD users, but a lot of the users are disabled. I am very new to powershell (like basic understanding and the ability to use other people's scripts), so I was hoping someone could point me in the right direction or maybe you have something like this already? I was hoping to have it export to a .csv with name, username and correct, accurate last login. Any help is appreciated!

UPDATE: I'll give these a try and let you know how it goes, thanks so much!!",,False,,t5_2qo1o,1368230950.0,,,True,t3_1e2vfg,http://www.reddit.com/r/PowerShell/comments/1e2vfg/ps_script_that_gives_me_last_logins_for_an_ad/,
1367200025.0,9,self.PowerShell,1db59b,Powershell bulk user create with template,12,3,10,http://www.reddit.com/r/PowerShell/comments/1db59b/powershell_bulk_user_create_with_template/,"EDIT - I think I may have it sorted now... i'll post the script when I get to work --

Hi All,
Just got a job to create a whole bunch of users in AD, but we need to user a template user - so group membership, home drive location, and logon script are copied.  Unfortunatly i'm having an issue with this.

I've created a script using the -Instance switch which should copy a template, but it doesn't seem to be working.

Anyone able to help?

So far, this is what I have:

    Import-Module ActiveDirectory -ErrorAction SilentlyContinue

    $dnsroot = '@' + (Get-ADDomain).dnsroot
    $users = Import-Csv .\list.csv

    foreach ($user in $users) {
    $userInstance = Get-ADUser -Identity $user.SameAs
    $defpassword = (ConvertTo-SecureString $user.Password -AsPlainText -force)

	try {
		New-ADUser -SamAccountName $user.SamAccountName -Instance $userInstance -Name ($user.FirstName + "" "" + $user.LastName) `
        -DisplayName ($user.FirstName + "" "" + $user.LastName) -GivenName $user.FirstName -Surname $user.LastName `
        -UserPrincipalName ($user.SamAccountName + $dnsroot) -Path $user.Path `
        -Enabled $true -ChangePasswordAtLogon $true -PasswordNeverExpires  $false `
        -AccountPassword $defpassword -PassThru `
        }
        catch [System.Object]
        {
			Write-Output ""Could not create user $($user.SamAccountName), $_""
        }
    }",,False,,t5_2qo1o,1367245349.0,,,True,t3_1db59b,http://www.reddit.com/r/PowerShell/comments/1db59b/powershell_bulk_user_create_with_template/,
1360075693.0,11,self.PowerShell,17xmm8,Get the Online Help URL from the Get-Help cmdlet and send it to the clipboard,12,1,3,http://www.reddit.com/r/PowerShell/comments/17xmm8/get_the_online_help_url_from_the_gethelp_cmdlet/,"I find myself using Powershell while connected to a server via remote desktop.  I don't want to run the 'Get-Help cmdletname -online' because it would open up a web browser on the server.  Instead I made a new function named Get-HelpURL.

I'm sure there is a better way to code this, please provide comments and suggestions so I can learn something new.

    Function Get-HelpURL {
    	&lt;#
    		.Synopsis
    			Gets the Online Help URL for the cmdlet and places it in the clipboard.
    		.Description
    			Gets the URL for the cmdlet and places it in the clipboard.
    			
    			If the function can't find a valid URL, it will display the local help contents.
    		.Example
    			Get-HelpURL Get-Service
    	#&gt;
    	[cmdletbinding()]
    	Param(
    		[Parameter(Mandatory=$true)]$Name,
    		[Switch] $Full = $False
    	)
    	Write-Debug ""Loading the System.Windows.Forms Assembly.""
    	[Reflection.Assembly]::LoadWithPartialName(""System.Windows.Forms"") | Out-Null
    	Write-Verbose ""Attempting to get the URL for the $Name cmdlet.""
    	$url = (Get-Help -Name $Name | Where-Object { $_.relatedLinks -ne $null } | Select-Object -ExpandProperty relatedLinks).NavigationLink.uri | Select-Object -First 1
    	
    	Write-Verbose ""Validating the URL starts with http://""
    	if ($url -eq $null) {
    		Write-Warning ""Unable to locate a URL in the help documentation. Displaying the local help contents.""
    		Get-Help -Name $Name -Full:$Full
    		Return
    	}
    	if ($url.startswith(""http://"")) {
    		Write-Verbose ""Placing the URL into the clipboard.""
    		[Windows.Forms.Clipboard]::SetText($url)
    		Write-Output ""$url - is now in the clipboard.""
    	}
    }",,False,,t5_2qo1o,False,,,True,t3_17xmm8,http://www.reddit.com/r/PowerShell/comments/17xmm8/get_the_online_help_url_from_the_gethelp_cmdlet/,
1359695581.0,10,self.PowerShell,17ogg7,What are some things PowerShell can't do? (Saw a post with this title but couldn't reply because it was too old),11,1,13,http://www.reddit.com/r/PowerShell/comments/17ogg7/what_are_some_things_powershell_cant_do_saw_a/,"http://www.reddit.com/r/PowerShell/comments/hwvwx/what_are_some_things_powershell_cant_do/


There's the link to the thread.  I'm a complete noob to powershell, so please be prepared for some stupidity.  I have been trying to get a better grasp of networking as I build my web dev skills, and this has caused me to venture into the realm where linux and windows meet in what appears to be some strange middle ground where they both appear to speak almost the same language, but definitely not even close.


Here is where I am confused. I can open up a cmd and ssh into a linux server without a problem (using PuTTY, plink, etc.), but when I try to do the same thing with powershell, failure ensues.  I know there's a difference between the two, where one is a scripting language and the other is....   just a console? 


I can run cmd from within a powershell instance and I can run powershell from within the prompt, but I cannot run certain cmd commands from powershell without invoking a cmd instance, and this is causing me some confusion as well.



I'm trying to make it so that I have just one interface where I can run all of my commands, whether they be from the command prompt, powershell, or any unix shell like bash or what have you. 

Then there's Powershell ISE which I thought was perfect. Especially in Windows 8, where dummies like me can see all of the commandlets right there without having to consult Microsoft's online reference, and auto completion, just like my favorite text editors.


But this thing still won't ssh me to my Unix server, which I can currently invoke through Window's console or even Cygwin using PuTTY.  


Is this because PuTTY and Cygwin are just using cmd commands and Powershell is not compatible, or am I just missing the point completely, and Powershell will only work for Windows networking completely?



",,False,,t5_2qo1o,False,,,True,t3_17ogg7,http://www.reddit.com/r/PowerShell/comments/17ogg7/what_are_some_things_powershell_cant_do_saw_a/,
1357820666.0,9,self.PowerShell,16b71s,How many of you powershell gurus has experience in a programming language? ,13,4,28,http://www.reddit.com/r/PowerShell/comments/16b71s/how_many_of_you_powershell_gurus_has_experience/,"I am novice powershell user and have been for some time. I can put a simple script together but after looking at some of your work; god dammit do I have a lot to learn. 

I have no prior experience in programming though and may this be the cause of my slow learning rate? I know Ill get there eventually... ",,False,,t5_2qo1o,False,,,True,t3_16b71s,http://www.reddit.com/r/PowerShell/comments/16b71s/how_many_of_you_powershell_gurus_has_experience/,
1352999849.0,10,self.PowerShell,138xle,Get-VolatileInfo - Collecting quick troubleshooting info.  [xpost from /r/SysAdmin],11,1,2,http://www.reddit.com/r/PowerShell/comments/138xle/getvolatileinfo_collecting_quick_troubleshooting/,"Hi all,

I'm tidying up a [PowerShell function](http://gallery.technet.microsoft.com/scriptcenter/Get-troubleshooting-c6b49d4a) that will query remote systems and return basic troubleshooting info.  This could be run by support or other IT folks when an issue with one or more systems is identified, but the specifics aren't known.

Here's the info I'm collecting thus far:

* Basics: OS, CPU, RAM, Disk Space, etc.
* Current Users
* Events from Application, Security and System event logs
* File shares and open files
* [Netstat -ano results parsed and resolved](http://ramblingcookiemonster.wordpress.com/2012/10/16/get-networkstatistics/)
* Installed Software
* Network adapter configuration(s)
* Processes
* Recent (user) profiles
* Recent reboots
* Services
* Services set to autostart and not running

Info I'm considering collecting:

* Autorun information
* hosts file
* Printers

Any tips on other basic troubleshooting information to collect or not to collect?  Do any of you have a similar query that can get troubleshooting off to a quick start?

Your insight would be greatly appreciated!",,False,,t5_2qo1o,False,,,True,t3_138xle,http://www.reddit.com/r/PowerShell/comments/138xle/getvolatileinfo_collecting_quick_troubleshooting/,
1348642291.0,10,scribd.com,10hvi5,Mastering PowerShell - Free PDF,14,4,8,http://www.reddit.com/r/PowerShell/comments/10hvi5/mastering_powershell_free_pdf/,,,False,,t5_2qo1o,False,,,False,t3_10hvi5,http://www.scribd.com/doc/50927091/Mastering-PowerShell,
1338911907.0,10,self.PowerShell,um85v,PowerShell to create computer accounts,10,0,5,http://www.reddit.com/r/PowerShell/comments/um85v/powershell_to_create_computer_accounts/,"I've been meaning to create a simple script to bulk add computer accounts to Active Directory.  I was never able to actually find one that did what I wanted to do.  Turns out it was very short and simple to do.  Modify the $CSV and $OU variables appropriately.

&gt; Import-module ActiveDirectory

&gt; $CSV='C:\Users\username\Desktop\Book1.csv'

&gt; $OU='OU=Workstations,DC=domain,DC=com'

&gt; import-csv -path $CSV | foreach-object { New-ADComputer -Name $_.ComputerAccount -Path $OU}


Your CSV file should look like this, the first line being a marker for the variable $_.ComputerAccount

&gt; ComputerAccount

&gt; pc-25

&gt; pc-26

&gt; pc-27

&gt; pc-28

&gt; pc-29

&gt; pc-30


[Link to my blog article on this](http://blog.jf-online.com/blog/usingpowershelltogeneratecomputeraccounts)",,False,,t5_2qo1o,1338972397.0,,,True,t3_um85v,http://www.reddit.com/r/PowerShell/comments/um85v/powershell_to_create_computer_accounts/,
1334115002.0,10,self.PowerShell,s3rdd,Is there an IRC channel where good number of PS people hang out ? ,10,0,8,http://www.reddit.com/r/PowerShell/comments/s3rdd/is_there_an_irc_channel_where_good_number_of_ps/,and are available to answer questions ?,,False,,t5_2qo1o,False,,,True,t3_s3rdd,http://www.reddit.com/r/PowerShell/comments/s3rdd/is_there_an_irc_channel_where_good_number_of_ps/,
1332344355.0,11,self.PowerShell,r6ugu,My first Powershell script. ,11,0,11,http://www.reddit.com/r/PowerShell/comments/r6ugu/my_first_powershell_script/,"Plays a wav file when a usb logical drive is attached and detached 

#method to play wav sound usage - Play-Sound ""path""
    Function Play-Sound
    {
        param($path)
        
        (new-object Media.SoundPlayer $path).play()
    }


    # Method takes argument for the path of the Wav file to  
    # be played once a USB logical drive is attached
    # Or deattached.
    Function Get-Monitor
    {
        param($path1)
        $i=1;
        
        while($i -le 5)
        {
            #USB monitoring
            Get-Event | Remove-Event
            Get-EventSubscriber | Unregister-Event
            Register-WmiEvent -class ""Win32_VolumeChangeEvent"" -SourceIdentifier volumeChange
   
            #$key = ""dd4e761d-7eb9-4440-8f13-c1eb35f50ac2""
            $key = ""volumeChange""
   
            $newEvent = Wait-Event -SourceIdentifier volumeChange
   
            If ($key -match $newEvent.SourceIdentifier)
            {
            	Play-Sound $path1
            }
            $i++
        }
    }
   
    Get-Monitor ""C:\power\VADRBRTH.WAV""",,False,,t5_2qo1o,False,,,True,t3_r6ugu,http://www.reddit.com/r/PowerShell/comments/r6ugu/my_first_powershell_script/,
1325031676.0,9,self.PowerShell,nsx3z,Can you gents point me in the direction of using powershell in my daily duties or a good place to start...i.e use a powershell script to return administrative events from event logs on target servers....anything simple!,11,2,41,http://www.reddit.com/r/PowerShell/comments/nsx3z/can_you_gents_point_me_in_the_direction_of_using/,Thank you in advance,,False,,t5_2qo1o,False,,,True,t3_nsx3z,http://www.reddit.com/r/PowerShell/comments/nsx3z/can_you_gents_point_me_in_the_direction_of_using/,
1324444524.0,10,poshconsole.codeplex.com,nkwcy,Have you guys heard of poshconsole? Just discovered it today.,10,0,5,http://www.reddit.com/r/PowerShell/comments/nkwcy/have_you_guys_heard_of_poshconsole_just/,,,False,,t5_2qo1o,False,,,False,t3_nkwcy,http://poshconsole.codeplex.com/,
1322599582.0,10,pstfsbuild.codeplex.com,mtrgf,So I created my first Open Source Application. A set of CmdLets for interacting with a TFS Build Server. ,11,1,1,http://www.reddit.com/r/PowerShell/comments/mtrgf/so_i_created_my_first_open_source_application_a/,,,False,,t5_2qo1o,False,,,False,t3_mtrgf,http://pstfsbuild.codeplex.com/,
1316056497.0,10,adminnation.com,kg3yp,PowerShell 3.0 Cmdlets!,11,1,15,http://www.reddit.com/r/PowerShell/comments/kg3yp/powershell_30_cmdlets/,,,False,,t5_2qo1o,False,,,False,t3_kg3yp,http://www.adminnation.com/blog/2011/09/14/powershell-3-0-cmdlets/,
1314716082.0,10,adminnation.com,jz3js,Active Directory and PowerShell – Speed Up Your Filtering,10,0,7,http://www.reddit.com/r/PowerShell/comments/jz3js/active_directory_and_powershell_speed_up_your/,,,False,,t5_2qo1o,False,,,False,t3_jz3js,http://www.adminnation.com/blog/2011/08/30/active-directory-and-powershell-%e2%80%93-speed-up-your-filtering/,
1314205416.0,10,adminnation.com,jt1cu,Let PowerShell Inventory your Server,10,0,7,http://www.reddit.com/r/PowerShell/comments/jt1cu/let_powershell_inventory_your_server/,,,False,,t5_2qo1o,False,,,False,t3_jt1cu,http://www.adminnation.com/tutorials/let-powershell-do-an-inventory-of-your-server/,
1310614917.0,10,self.PowerShell,ip3nz,Powershell GUI,10,0,9,http://www.reddit.com/r/PowerShell/comments/ip3nz/powershell_gui/,"So I've just started a new job. Basically I'm working as a scheduler for a tech support contractor for a major municipal power company. For the past few days I've been shadowing the head scheduler and watching her work. A lot of the job involves entering the same data repeatedly into two different and (for the most part) redundant databases, as well as writing emails to clients/techs.

My new boss asked me how I was getting along and what I thought about the work. I told him that I could think of a couple of different ways to streamline the process, and to start I already had an idea for a simple VB or AutoHotKey GUI script. I figured that rather than manually entering the same data in several different ways I would set up a simple form to collect vital data ($TECH_LAST_NAME, $TECH_FIRST_NAME, $CLIENT_LAST_NAME, $CLIENT_FIRST_NAME, $APPT_TIME, $APPT_DATE, $ASSET_ID, $LOCATION, etc) and then set buttons next to the fields that would correspond to the many different versions of this info needed and copy said info to the clipboard, as well generate notification emails and the like. Functionally rather than selecting, copying, and rearranging this data several times over I could gather it in a little window and click to copy what I need and paste from there.

He surprised me however and said that while that sounds like a good idea, he wants it in a Powershell script. He said that since it's my job and my personal project it's up to me of course, but he said that he wants someone in the office with the capability of scripting in Powershell and that it could go a long way in showing my motivation to advance. 

This seems like a nice opportunity, but I find it a little baffling at the same time because I'm not sure Powershell would be the best tool for this, or even that it would be a demonstrable exercise in showing my Powershell capabilities (if I had any). With a little hunting I've found Admin Scripting Environment and I'm going to brush up on a llittle Powershell syntax, but I figured I'd check out this sub and see what you guys think. Any advice would be much appreciated.

",,False,,t5_2qo1o,False,,,True,t3_ip3nz,http://www.reddit.com/r/PowerShell/comments/ip3nz/powershell_gui/,
1310406182.0,11,windowsitpro.com,imkvs,Meet PowerShell's Common Parameters,11,0,1,http://www.reddit.com/r/PowerShell/comments/imkvs/meet_powershells_common_parameters/,,,False,,t5_2qo1o,False,,,False,t3_imkvs,http://www.windowsitpro.com/blog/powershell-with-a-purpose-blog-36/windows-powershell/powershells-common-parameters-139691,
1309895376.0,10,pastebin.com,ihg2n,Karma Arrows,11,1,3,http://www.reddit.com/r/PowerShell/comments/ihg2n/karma_arrows/,,,False,,t5_2qo1o,False,,,False,t3_ihg2n,http://pastebin.com/PxXBYR4W,
1309365705.0,11,psam.codeplex.com,icfim,PowerShell Admin Modules for common WMI queries,11,0,0,http://www.reddit.com/r/PowerShell/comments/icfim/powershell_admin_modules_for_common_wmi_queries/,,,False,,t5_2qo1o,False,,,False,t3_icfim,http://psam.codeplex.com/,
1308284762.0,10,pastebin.com,i1uw4,"I decided to write a PowerShell function to set the RunOnce registry key, with a switch for powershell scripts (depending on your execution settings it is sometimes necessary to use the full path to powershell.exe when setting powershell scripts using RunOnce).",10,0,1,http://www.reddit.com/r/PowerShell/comments/i1uw4/i_decided_to_write_a_powershell_function_to_set/,,,False,,t5_2qo1o,False,,,False,t3_i1uw4,http://pastebin.com/azp8212A,
1306323614.0,11,self.PowerShell,hjpiz,Here is a function (stolen BTW) that exports to Excel rather than CSV.,11,0,11,http://www.reddit.com/r/PowerShell/comments/hjpiz/here_is_a_function_stolen_btw_that_exports_to/,"Kudos to the Author, whoever he was.

Usage is out-excel filename.


function out-excel {

param ($par_file_name=”c:\default_excel_file.xls” , [string[]]$property,[switch]$raw )

begin {
# start Excel and open a new workbook
$Excel = New-Object -Com Excel.Application
$Excel.visible = $True

# DisplayAlerts = $False means that Excel does not prompt even in a file already exist
$Excel.DisplayAlerts = $False

$Excel2 = $Excel.Workbooks.Add()
$Sheet = $Excel2.Worksheets.Item(1)

# initialize our row counter and create an empty hashtable
# which will hold our column headers
$Row = 1
$HeaderHash = @{}
}

process {
if ($_ -eq $null) {return}
if ($Row -eq 1) {
# when we see the first object, we need to build our header table
if (-not $property) {
# if we haven’t been provided a list of properties,
# we’ll build one from the object’s properties
$property=@()
if ($raw) {
$_.properties.PropertyNames | %{$property+=@($_)}
} else {
$_.PsObject.get_properties() | % {$property += @($_.Name.ToString())}
}
}
$Column = 1
foreach ($header in $property) {
# iterate through the property list and load the headers into the first row
# also build a hash table so we can retrieve the correct column number
# when we process each object
$HeaderHash[$header] = $Column
$Sheet.Cells.Item($Row,$Column) = $header.toupper()
$Column ++
}
# set some formatting values for the first row
$WorkBook = $Sheet.UsedRange
$WorkBook.Interior.ColorIndex = 19
$WorkBook.Font.ColorIndex = 11
$WorkBook.Font.Bold = $True
$WorkBook.HorizontalAlignment = -4108
}
$Row ++
foreach ($header in $property) {
# now for each object we can just enumerate the headers, find the matching property
# and load the data into the correct cell in the current row.
# this way we don’t have to worry about missing properties
# or the “ordering” of the properties
if ($thisColumn = $HeaderHash[$header]) {
if ($raw) {
$Sheet.Cells.Item($Row,$thisColumn) = [string]$_.properties.$header
} else {
$Sheet.Cells.Item($Row,$thisColumn) = [string]$_.$header
}
}
}
}

end {
# now just resize the columns and we’re finished
if ($Row -gt 1) { [void]$WorkBook.EntireColumn.AutoFit() }

$Sheet.SaveAs($par_file_name)
$Excel2.close()
$Excel.quit()

}

}
",,False,,t5_2qo1o,False,,,True,t3_hjpiz,http://www.reddit.com/r/PowerShell/comments/hjpiz/here_is_a_function_stolen_btw_that_exports_to/,
1306263100.0,11,self.PowerShell,hj416,*Corrected* Powershell Scriptomatic Is A Very Useful Tool.,12,1,1,http://www.reddit.com/r/PowerShell/comments/hj416/corrected_powershell_scriptomatic_is_a_very/,"Like most of you, I used to use the old scriptomatic tool with vbscript back in the day. Scriptomatic has been updated to use and generate powershell script and is a great way to explore wmi classes and properties.

[Powershell Scriptomatic 1.0](http://www.microsoft.com/downloads/en/details.aspx?FamilyID=d87daf50-e487-4b0b-995c-f36a2855016e&amp;displaylang=en)
",,False,,t5_2qo1o,False,,,True,t3_hj416,http://www.reddit.com/r/PowerShell/comments/hj416/corrected_powershell_scriptomatic_is_a_very/,
1376343051.0,10,self.PowerShell,1k8fm1,Powershell MVA voucher code 'PowerJump1' is valid until 8/31/13 for 50 MVA points,13,3,5,http://www.reddit.com/r/PowerShell/comments/1k8fm1/powershell_mva_voucher_code_powerjump1_is_valid/,"For anyone who is concerned with the MVA points (I don't really know what they're for yet), I registered for the Powershell Virtual Academy course and had issues with the 'PowerJump' voucher code.  I sent them a message through the site and today they sent me the following: 

*Dear MVA Member,

We’ve recently been made aware that an incorrect voucher code may have been communicated to you for attending the Getting Started with PowerShell 3.0 Jump Start last month.  The correct code for this Jump Start is PowerJump1 and I have extended the redemption date to August 31st to give you more time to redeem it.

I apologize for any confusion and inconvenience this may have caused you.  Thanks for being a part of the Microsoft Virtual Academy and please tell your colleagues and friends at work and in the IT industry what a great resource MVA is.

Regards,

Albert V.*
",,False,,t5_2qo1o,False,,,True,t3_1k8fm1,http://www.reddit.com/r/PowerShell/comments/1k8fm1/powershell_mva_voucher_code_powerjump1_is_valid/,
1375395364.0,8,self.PowerShell,1jiwxo,A lightweight script for time-lapsing your applications/games.,11,3,3,http://www.reddit.com/r/PowerShell/comments/1jiwxo/a_lightweight_script_for_timelapsing_your/,"Hey,
I've been using Powershell since 2011 for some automation procedures using POSH, including a script to open an application, go File -&gt; Save As and repeat over a folder of items. 

However, this was the most interresting (to the general public) script I've done. I had no clue the Powershell could take and save screenshots like that.
I used it with Football Manager 2012 and made a 6Gb timelapse with over 7000 pictures of it.

Don't know if there's any interest in it, but here it goes. A friend used it in a recent Ludum Dare to great sucess.

https://github.com/metabrain/powershell-timelapse

Cheers!",,False,,t5_2qo1o,False,,,True,t3_1jiwxo,http://www.reddit.com/r/PowerShell/comments/1jiwxo/a_lightweight_script_for_timelapsing_your/,
1375275187.0,8,gallery.technet.microsoft.com,1jf1wk,Get-NetworkStatistics - Netstat -ano against remote computers,10,2,4,http://www.reddit.com/r/PowerShell/comments/1jf1wk/getnetworkstatistics_netstat_ano_against_remote/,,,False,,t5_2qo1o,False,,,False,t3_1jf1wk,http://gallery.technet.microsoft.com/scriptcenter/Get-NetworkStatistics-66057d71,
1374421799.0,8,self.PowerShell,1ir5pz,"Provide granular access control through delegated, constrained PowerShell endpoints",11,3,1,http://www.reddit.com/r/PowerShell/comments/1ir5pz/provide_granular_access_control_through_delegated/,"PowerShell 3.0 added an interesting feature to remoting.  You can now define a RunAs account that an endpoint will always run as.  This opens up the ability to create a PowerShell session configuration that runs with privileges beyond what you would be comfortable giving out, while constraining the session to specific, whitelisted commands you can define yourself.

I wrote up a [quick post with an example on how to set this up](http://ramblingcookiemonster.wordpress.com/2013/07/20/granular-access-via-powershell-remoting/).

This opens up new doors in terms of allowing granular access.  A few example use cases:

* Provide your application, database or support teams access to functions you write that run with administrative privileges on a server... But don't give those team members administrative access to the server.
* Provide your help desk with access to a command that could take down an entire service if misused.  Wrap that command in a function that only takes parameters that won't take down the service.",,False,,t5_2qo1o,False,,,True,t3_1ir5pz,http://www.reddit.com/r/PowerShell/comments/1ir5pz/provide_granular_access_control_through_delegated/,
1372036107.0,8,csharpening.net,1gxuo3,PoshInternals – Multi Desktop Support,9,1,0,http://www.reddit.com/r/PowerShell/comments/1gxuo3/poshinternals_multi_desktop_support/,,,False,,t5_2qo1o,False,,,False,t3_1gxuo3,http://csharpening.net/?p=1657,
1367791259.0,10,self.PowerShell,1dr5ii,Load User's ThumbnailPhoto Attribute to Windows Vista/7/2008 User Account Picture,13,3,2,http://www.reddit.com/r/PowerShell/comments/1dr5ii/load_users_thumbnailphoto_attribute_to_windows/,"First things first; we need a centralized database to store these images in. This database also needs to be relational to their user account. Lucky for us, Active Directory Domain Services has a specific attribute for storing user images. This attribute is called the thumbnailPhoto attribute. The thumbnailPhoto attribute has been around in ADDS since 2000, but it is just now finally being used throughout applications. Some applications of note are Outlook (&gt;2010), Lync, and Sharepoint. The one caveat of this attribute though, it is a byte field; meaning that you cannot just upload an image and call it good (although there are other utilities that allow for this). Again we are lucky, thanks to the proliferation of PowerShell, converting files to their byte format is very simple. Also, I am keeping the system of jpg &gt; byte &gt; jpg for continuity's sake; although theoretically you could convert the images mid-stream. 

Here is the main outline of how this process looks:

1. Crop image to a square layout

2. Resize/Compress image to be less than 100 KB

3. Convert the image to a byte form

4. Set the user’s thumbnailPhoto attribute to byte form of the image

5. Have a user GPO that executes a PowerShell script at logon

6. The PowerShell script retrieves the thumbnailPhoto attribute data and saves the data as an image file
   * Then the PowerShell script calls an executable where it passes the image in

7. User’s image is set

**Steps 1-3 should be processed by a script. I haven't written one for that though.**

**Step 4 as well should be handled by a script. The below can give you an idea where to start.**

    Import-Module ActiveDirectory
    $photo = [byte[]](gc \\path\to\edited\photos\user1.jpg -Encoding Byte)
    Set-ADUser user1 –Replace @{thumbnailPhoto=$photo}

**Step 5 you will want to create a new GPO. I setup one computer policy and one user preference to accomplish this.**

    Computer Configuration =&gt; Preferences =&gt; Windows Settings =&gt; Files =&gt; New File
    	Action: Replace
    Source File: \\domain.com\netlogon\domainLogo.bmp
    Destination File: C:\ProgramData\Microsoft\User Account Pictures\user.bmp
    User Configuration =&gt; Policies =&gt; Windows Settings =&gt; Scripts =&gt; Logon =&gt; Add
    	Name: \\domain.com\netlogon\executeUserTile.ps1

**Step 6 below is the code to accomplish the actual picture creation and application.**

    # Executes PowerShell in STA (Single Threaded Apartment) Mode and then executes the actual script.
    powershell -sta \\domain.com\NETLOGON\userTile.ps1

-------------------------------------------------------------------------------------------------------------------------

    ##################################################################################
    # PowerShell script wrote by Michael Soule #
    #
    # C Sharp source code. Credit for the discovery of the DLL hook point goes to http://joco.name/ #
    ##################################################################################
    
    $source = @""
        [DllImport(""shell32.dll"", EntryPoint = ""#262"", CharSet = CharSet.Unicode, PreserveSig = false)]
        public static extern void SetUserTile(string username, int whatever, string picpath);
    
        [STAThread]
        public static void ChangeUserTile(string user, string picPath){
            SetUserTile(user, 0, picPath);
        }
    ""@
    
    # Retrieve the Username, Domain, and Temp path respectively.
    $username = $env:USERNAME
    $domain = $env:USERDOMAIN
    $temp = $env:TEMP
    
    # Retrieve the current user’s thumbnailPhoto attribute value.
    $photo = ([ADSISEARCHER]""samaccountname=$($username)"").findone().properties.thumbnailphoto
    # Save the thumbnailPhoto attribute value to an image file in the user’s temporary folder.
    $photo | set-content $temp\$domain+$username.jpg -Encoding byte
    
    # Instantiate the C Sharp code.
    Add-Type -MemberDefinition $source -Namespace DMD -Name Program
    # Call the C Sharp method and pass it the username and image file.
    [DMD.Program]::ChangeUserTile(""$domain\$username"",""$temp\$domain+$username.jpg"")

------------------------------------------------------------------------------------------------------------

Resources used:

http://www.myotherpcisacloud.com/post/2011/12/02/More-Pictures-with-AD-thumbnailPhoto.aspx

http://joco.name/2010/12/06/i-discovered-the-new-windows-user-tile-api/

http://blogs.technet.com/b/stefan_gossner/archive/2010/05/07/using-csharp-c-code-in-powershell-scripts.aspx

http://blog.cjwdev.co.uk/2010/11/03/the-thumbnailphoto-attribute-explained/

http://www.moe.am/?s=active+directory+user+picture

http://gallery.technet.microsoft.com/scriptcenter/Set-UserTileFromAD-99029716

http://technet.microsoft.com/en-us/library/hh849914.aspx

http://csharp.net-tutorials.com/classes/method-overloading/

http://depsharee.blogspot.com/2011/06/powershell-sta-and-mta.html",,False,,t5_2qo1o,False,,,True,t3_1dr5ii,http://www.reddit.com/r/PowerShell/comments/1dr5ii/load_users_thumbnailphoto_attribute_to_windows/,
1367701160.0,8,self.PowerShell,1dp3sp,Trying to get pwdlastset AD attribute from ticks to datetime,9,1,4,http://www.reddit.com/r/PowerShell/comments/1dp3sp/trying_to_get_pwdlastset_ad_attribute_from_ticks/,"We have an application that imports only attributes, not properties. Otherwise, I'd use the passwordlastset property (displays in datetime) rather than pwdlastset (displays ticks).

When I view the attribute in ADUC, it shows the correct date. When I user powershell, it shows the year as 0413. Here are my commands:

$user = get-aduser testuser2 -properties pwdlastset

$pls = [datetime]$user.pwdlastset

The pwdlastset in ticks is 130121689692942337, and when converted to datetime, it is Saturday, May 04, 0413 7:22:49 PM.

I used this website to confirm that the ticks are correct:

http://www.windowstricks.in/p/online-tools.html#timestamp

It should be returning Sat May 04 2013 15:22:49.",,False,,t5_2qo1o,False,,,True,t3_1dp3sp,http://www.reddit.com/r/PowerShell/comments/1dp3sp/trying_to_get_pwdlastset_ad_attribute_from_ticks/,
1365778099.0,9,self.PowerShell,1c7ic0,Need a .bat script that will sound an alert on Win7 remote machines.,12,3,8,http://www.reddit.com/r/PowerShell/comments/1c7ic0/need_a_bat_script_that_will_sound_an_alert_on/,"I work an IT job imaging computers with Windows 7 and need the ability to create an alert or system sound of some kind that will help me locate machines on our build bench.  We have a psexec script that will release the ip address, eject the dvd tray and shut the pc down but we need a repeating sound such as a ringer or anything that will help us physically locate the machine among the rows of computers. We had this for xp but now with win7 it won't work.  Any ideas for a script my psexec can call?   thanks in advance.",,False,,t5_2qo1o,False,,,True,t3_1c7ic0,http://www.reddit.com/r/PowerShell/comments/1c7ic0/need_a_bat_script_that_will_sound_an_alert_on/,
1364583815.0,7,self.PowerShell,1b9au9,PS newbie - How to output list of AD machines to text file,10,3,16,http://www.reddit.com/r/PowerShell/comments/1b9au9/ps_newbie_how_to_output_list_of_ad_machines_to/,"Simple script, although I can't figure out what Im doing wrong here. I'd like to output a list of machines within the OU specified to a text file but Im running into errors when trying to change the line: 

*{ Write-Host $child.Name }* to *{ Write-output $child.Name }*

Here's the entire script for reference:

    $ou = [ADSI]""LDAP://OU=Computers,DC=Domain,DC=LOCAL""
    foreach ($child in $ou.psbase.Children) { 
        if ($child.ObjectCategory -like '*computer*') { Write-Host $child.Name } 
    }
",,False,,t5_2qo1o,False,,,True,t3_1b9au9,http://www.reddit.com/r/PowerShell/comments/1b9au9/ps_newbie_how_to_output_list_of_ad_machines_to/,
1362150940.0,8,self.PowerShell,19gr7q,"Powershell script works great, but fails to send email as a scheduled task.",9,1,12,http://www.reddit.com/r/PowerShell/comments/19gr7q/powershell_script_works_great_but_fails_to_send/,"So my script, email address removed:

    $ol = New-Object -comObject Outlook.Application
    gm -InputObject $ol
    $Mail = $ol.CreateItem(0)
    $Mail.Recipients.Add(""myemail@mydomain.com"")
    $Mail.Subject = ""$User Security Audit""
    $Mail.Body = (gc $ALFullPath | out-string)
    $Mail.Send()

This codeblock is at the end of my script, and works fine when run from Powershell.  When I call the script via scheduled task (and I  have tried about 10 different ways of calling it from the task scheduler), it goes through the whole audit, creates the file, but fails to send the email.

Any thoughts or help would be greatly appreciated.  I have hit a mental wall on this one.

If there is a better way to generate and send this email, awesome.  It has to be able to get past an enterprise spam filter though, so local SMTP services on each machine is not going to be an option.",,False,,t5_2qo1o,False,,,True,t3_19gr7q,http://www.reddit.com/r/PowerShell/comments/19gr7q/powershell_script_works_great_but_fails_to_send/,
1361700704.0,8,tomorrow.uspeoples.org,194m0g,ID3 Tag Editing via Taglib-sharp.dll and Discogs API,9,1,1,http://www.reddit.com/r/PowerShell/comments/194m0g/id3_tag_editing_via_taglibsharpdll_and_discogs_api/,,,False,,t5_2qo1o,False,,,False,t3_194m0g,http://tomorrow.uspeoples.org/2013/02/powershell-id3-tag-editing-via-taglib.html,
1360384722.0,8,tomorrow.uspeoples.org,186e87,Passing PS Variables to DOS Batch Files,10,2,0,http://www.reddit.com/r/PowerShell/comments/186e87/passing_ps_variables_to_dos_batch_files/,,,False,,t5_2qo1o,False,,,False,t3_186e87,http://tomorrow.uspeoples.org/2013/02/passing-powershell-variables-to-batch.html,
1358462125.0,11,self.PowerShell,16s20a,Manning Books 40% off again till 1/23/2013...,12,1,6,http://www.reddit.com/r/PowerShell/comments/16s20a/manning_books_40_off_again_till_1232013/,"From the email: Save 40% on any purchase--eBook, pBook, or MEAP. Just enter ***j1740*** in the Promotional Code box when you check out. Expires January 23. Only at manning.com.",,False,,t5_2qo1o,False,,,True,t3_16s20a,http://www.reddit.com/r/PowerShell/comments/16s20a/manning_books_40_off_again_till_1232013/,
1354309566.0,9,powershelladmin.com,142jtb,I've personally found good use for this little function I wrote to display free/used space on mount points,9,0,1,http://www.reddit.com/r/PowerShell/comments/142jtb/ive_personally_found_good_use_for_this_little/,,,False,,t5_2qo1o,False,,,False,t3_142jtb,http://www.powershelladmin.com/wiki/Get-MountPointData_cmdlet_for_PowerShell,
1353270479.0,8,self.PowerShell,13eudi,"Not so quick, but still dirty: Script to convert nmap xml output to powershell objects.",10,2,7,http://www.reddit.com/r/PowerShell/comments/13eudi/not_so_quick_but_still_dirty_script_to_convert/,"What this [script](http://pastebin.com/iTmNBHDx) will do is take the XML output of a standard Nmap port scan and create powershell object(s).

There is still plenty that can be done, but the script is a little more functional now.  Input validation, and error handling etc.. are almost non existent.  


The usage is 
     
       $a =  .\parsenmap -targets ""scanme.nmap.org,www.example.com"" 

The returned object will contain a property $_.hostname and $_.ports.  Currently $_.ports is an array of port objects, each object contains these properties:  
   
     protocol,portid,state,reason,reason_ttl,servicename,method,conf

Since I updated a bit, I am deleting the old post and reposting a new link.

Let me know if you have questions, comments, critiques.

*Line 14:  "" -value `$t[0]..."", there is a "" ` "" causing the error message and the null value of protocol.",,False,,t5_2qo1o,1353375255.0,,,True,t3_13eudi,http://www.reddit.com/r/PowerShell/comments/13eudi/not_so_quick_but_still_dirty_script_to_convert/,
1352840356.0,8,self.PowerShell,1354fy,Use Powershell 3.0 ISE with 2.0 scripts?,10,2,5,http://www.reddit.com/r/PowerShell/comments/1354fy/use_powershell_30_ise_with_20_scripts/,"I need to write PS scripts that will work on Windows Server 2003 and maybe XP and Vista. So, can I use the Powershell 3.0 ISE to develop PS 2.0 scripts?
Or is this somehow just a plain bad idea?",,False,,t5_2qo1o,False,,,True,t3_1354fy,http://www.reddit.com/r/PowerShell/comments/1354fy/use_powershell_30_ise_with_20_scripts/,
1350004061.0,7,self.PowerShell,11cb32,PowerShell - Continuous Integration w/ Scripts,9,2,15,http://www.reddit.com/r/PowerShell/comments/11cb32/powershell_continuous_integration_w_scripts/,"Is anyone doing this?  Namely scripts you maintain for your other team members, end users, etc.

We have a SVN repository where I keep my scripts.  I'm wondering if it makes sense to automatically pull scripts, validate them and push them to a central location people have access to.

Scripts are obviously not compiled code, so I question the value in this.  Just wanted to see what people were doing.

Thanks!",,False,,t5_2qo1o,False,,,True,t3_11cb32,http://www.reddit.com/r/PowerShell/comments/11cb32/powershell_continuous_integration_w_scripts/,
1349798997.0,11,self.PowerShell,117903,Enabling shadow copies remotely...,11,0,8,http://www.reddit.com/r/PowerShell/comments/117903/enabling_shadow_copies_remotely/,"......Working script.......

$set_shadow = {&amp; vssadmin resize shadowstorage /for=C: /on=C: /maxsize=10%}

$enable_shadow = {$drive = ""C:\""; echo $drive; Enable-ComputerRestore -Drive $drive}

$computers = Get-Content -Path c:\scripts\computers-test.txt
    foreach ($computer in $computers) { Write-Host $(""{0}n{1}n{0}"" -f $('='*40)0,$computer) if (Invoke-Command -ComputerName $computer $enable_shadow) { Write-Host ""System Restore enabled"" } else { Write-Host ""System Restore NOT enabled: $($error)"" }
    if (Invoke-Command -ComputerName $computer $set_shadow) 
        { Write-Host ""Shadow set to 10%."" }
    else
        { Write-Host ""Fail"" }
}

.....Failing script......

$set_shadow = {&amp; vssadmin resize shadowstorage /for=C: /on=C: /maxsize=10%}

$enable_shadow = {$drive = ""C:\""; Enable-ComputerRestore -Drive $drive}

$computers = Get-Content -Path c:\scripts\computers-test.txt
    foreach ($computer in $computers) { Write-Host $(""{0}n{1}n{0}"" -f $('='*40)0,$computer) if (Invoke-Command -ComputerName $computer $enable_shadow) { Write-Host ""System Restore enabled"" } else { Write-Host ""System Restore NOT enabled: $($error)"" }
    if (Invoke-Command -ComputerName $computer $set_shadow) 
        { Write-Host ""Shadow set to 10%."" }
    else
        { Write-Host ""Fail"" }
}


Edited for clarity. ",,False,,t5_2qo1o,1349878670.0,,,True,t3_117903,http://www.reddit.com/r/PowerShell/comments/117903/enabling_shadow_copies_remotely/,
1348090110.0,10,self.PowerShell,105o95,Help a newb with AD simple user creation script.,12,2,8,http://www.reddit.com/r/PowerShell/comments/105o95/help_a_newb_with_ad_simple_user_creation_script/,"(disclaimer: Powershell 2.0, AD level is 2008 , using Quest active directory cmdlets)

Ive has some experience with simple scripts but I am getting tripped up on the right way to do this. I am trying to do a user creation script and I want to write it so that before I tell it to create a user it will check AD for the existing username and loop back if it finds one that already exists.  Basically what im looking for is an equivalent of a GOTO command. 

- Ive tried the Function commands but im not sure thats what i need. 

-  Here is the code... (be gentle :))


# Activate AD Module
add-PSSnapin Microsoft.Exchange.Management.PowerShell.E2010
Add-PSSnapin Quest.ActiveRoles.ADManagement
Import-Module activedirectory

#Declare Varibles and Function
function UserInfo {$UserFN=Read-Host ""Enter new users First Name""
$UserLN=Read-Host ""Enter new users Last Name""
$date=Get-Date -format d 
$admin=Read-Host ""Enter Admins username""}

#double check spelling
echo "" You have entered 
First name: $userFN
Last name: $userLN ""

#PROMPT FOR SPELLING CORRECTNESS

$title = ""Confirmation of user Creation""
$message = ""You have entered FIRSTNAME: $userFN LASTNAME: $userLN   is this Correct?""

$yes = New-Object System.Management.Automation.Host.ChoiceDescription ""&amp;Yes"", `
    ""Confirm Username and Continue""

$no = New-Object System.Management.Automation.Host.ChoiceDescription ""&amp;No"", `
    ""Retype Username""

$options = [System.Management.Automation.Host.ChoiceDescription[]]($yes, $no)

$result = $host.ui.PromptForChoice($title, $message, $options, 0) 

switch ($result)
    {
        0 {$username=$UserFN.substring(0,1)+$UserLN}
        1 {UserInfo}
    }

echo ""Username is $username""

# If then statement matching user to existing user
$usercheck = Get-QADuser -identity $username



if ($usercheck -ne $null){write-host "" The username $username already exists. Please try a diffrent name""
# I have it call the function userinfo here but I know thats wrong cause then it wont check the new name
{Userinfo}
}

Else {}

# and the rest goes on from here
 ",,False,,t5_2qo1o,False,,,True,t3_105o95,http://www.reddit.com/r/PowerShell/comments/105o95/help_a_newb_with_ad_simple_user_creation_script/,
1347386842.0,9,self.PowerShell,zpxc0,Anyone know how to get a report from Exchange 2010 on the size of attachements in the datastore,11,2,3,http://www.reddit.com/r/PowerShell/comments/zpxc0/anyone_know_how_to_get_a_report_from_exchange/,"I have been tasked to find out the amount of room attachements are taking up in the datastore. For instance, how much room are .pdfs, .tiff, .jpgs are taking. 

I have started looking around for ways to poll this information from the exchange database, but i'm either just not looking hard enough or i'm thinking properly today.

Anyone have any ideas, or at least point me in the right direction? 

TIA",,False,,t5_2qo1o,False,,,True,t3_zpxc0,http://www.reddit.com/r/PowerShell/comments/zpxc0/anyone_know_how_to_get_a_report_from_exchange/,
1345233086.0,8,self.PowerShell,ye60l,Script to find user home drives that are not associated to an active user,10,2,12,http://www.reddit.com/r/PowerShell/comments/ye60l/script_to_find_user_home_drives_that_are_not/,"This script will parse a target directory and take each folder and check AD to see if the user is present and create a report like this.

This is the first script that I have submitted, sorry if there are any formatting issues.

Directory                  : \\&lt;Server Name&gt;\&lt;Share&gt;\&lt;Path&gt;\&lt;User&gt;

User                       : &lt;User&gt;

Display Name               : &lt;Display Name from AD&gt;

Location in AD             : &lt;Domain&gt;/&lt;OU&gt;/&lt;User&gt;

Email Address              : &lt;User's Email address&gt;

Home Directory             : &lt;UNC Path to User's Home Drive&gt;

Date of Last Login         : 6/13/2011 1:48:59 PM

Share size in MB           : 0.02

Date of Last Folder Access : 4/17/2010 8:13:48 AM









#Requires -Version 2.0
#Requires –PsSnapIn Quest.ActiveRoles.ADManagement
&lt;#&gt;
==========================================================================

This script was created and tested on the following:

		Name                     Version
		-----------------        -----------------
		PowerShell               :2.0
		Quest AcitveRoles for AD :1.5.1.2421

==============================
 NAME:   |Check-Home-Shares.ps1
==============================
 AUTHOR: |Omarr
 EMAIL:  |Available upon request
==============================

COMMENT:
			This script will parse a target User Home Directory to
			determine if the directory matches a user in Active Directory.
			
		

 	You have a royalty-free right to use, modify, reproduce, and
 	distribute this script file in any way you find useful, provided that
 	you agree that the creator, owner above has no warranty, obligations,
 	or liability for such use.

REQUIREMENTS OF THIS SCRIPT:

		Name                     Version
		-----------------        -----------------
		PowerShell               :2.0
		Quest AcitveRoles for AD :1.5.1.2421
		

VERSION HISTORY:
		1.0 8/17/2012 - Initial release

==========================================================================
&lt;/#&gt;
$Dir = Read-Host ""Please enter complete path to user shares.  e.g. \\&lt;Server Name&gt;\d$\users""

$SaveFile = Read-Host ""Please enter complete path to save output csv""


$stats = @()

$DirList = Dir $Dir | Where-Object {$_.PSIsContainer}

ForEach ($UserDir in $DirList)

	{

	$U = $UserDir.name.split(""."")[0]

	Write-Progress -Activity ""Scanning User Directories"" -Status ""Processing Directory $UserDir""# Display 
progress bar

	$User = Get-QADUser -SamAccountName $U

	$objFSO = New-Object -com  Scripting.FileSystemObject

	$Directory = """" + $Dir + ""\"" + $UserDir.Name + """"

	$Share = ""{0:N2}"" -f (($objFSO.GetFolder($row.""Directory"").Size) / 1MB)

	$LastAccess = $objFSO.GetFolder($row.""Directory"").DateLastAccessed

	$row = New-Object System.Object

	$row | Add-Member -Type NoteProperty -Name ""Directory"" -Value $Directory

	$row | Add-Member -Type NoteProperty -Name ""User"" -Value $User.LogonName

	$row | Add-Member -Type NoteProperty -Name ""Display Name"" -Value $User.DisplayName

	$row | Add-Member -Type NoteProperty -Name ""Location in AD"" -Value $User.CanonicalName

	$row | Add-Member -Type NoteProperty -Name ""Email Address"" -Value $User.UserPrincipalName

	$row | Add-Member -Type NoteProperty -Name ""Home Directory"" -Value $User.HomeDirectory

	$row | Add-Member -Type NoteProperty -Name ""Date of Last Login"" -Value $User.LastLogonTimestamp

	$row | Add-Member -Type NoteProperty -Name ""Share size in MB"" -Value $Share

	$row | Add-Member -Type NoteProperty -Name ""Date of Last Folder Access"" -Value $LastAccess

	$row

	$stats += $row

	} 

$stats | Export-Csv $SaveFile -Force -NoTypeInformation

Invoke-Item $SaveFile
",,False,,t5_2qo1o,False,,,True,t3_ye60l,http://www.reddit.com/r/PowerShell/comments/ye60l/script_to_find_user_home_drives_that_are_not/,
1343584981.0,8,powershelladmin.com,xcl89,Maybe someone will find this useful. Benchmarking module.,9,1,0,http://www.reddit.com/r/PowerShell/comments/xcl89/maybe_someone_will_find_this_useful_benchmarking/,,,False,,t5_2qo1o,False,,,False,t3_xcl89,http://www.powershelladmin.com/wiki/PowerShell_benchmarking_module_built_around_Measure-Command,
1337313612.0,10,self.PowerShell,tsshd,Are there cleaner ways to pipe things out to notepad?,10,0,9,http://www.reddit.com/r/PowerShell/comments/tsshd/are_there_cleaner_ways_to_pipe_things_out_to/,"I often either pipe the output of a command into the clipboard and paste into notepad, or sometimes do this:

&gt;Get-Help about_* | Out-File x.txt | Notepad x.txt

Is there a cleaner or better way to do this that is proper?",,False,,t5_2qo1o,False,,,True,t3_tsshd,http://www.reddit.com/r/PowerShell/comments/tsshd/are_there_cleaner_ways_to_pipe_things_out_to/,
1335844815.0,9,mikecrowley.wordpress.com,t1124,Combining PowerShell Cmdlet Results,10,1,6,http://www.reddit.com/r/PowerShell/comments/t1124/combining_powershell_cmdlet_results/,,,False,,t5_2qo1o,False,,,False,t3_t1124,http://mikecrowley.wordpress.com/2012/04/17/combining-powershell-cmdlet-results/,
1334904328.0,10,github.com,sjaed,I wrote a log file e-mailer in PowerShell (first time releasing a PowerShell script and first GitHub repo... thoughts?),10,0,0,http://www.reddit.com/r/PowerShell/comments/sjaed/i_wrote_a_log_file_emailer_in_powershell_first/,,,False,,t5_2qo1o,False,,,False,t3_sjaed,https://github.com/ataylor32/PowerShell-Log-File-E-mailer,
1334863651.0,9,self.PowerShell,sia9h,Deleting local profile caches for deleted users. ,9,0,12,http://www.reddit.com/r/PowerShell/comments/sia9h/deleting_local_profile_caches_for_deleted_users/,"I am brand new to PowerShell. Usually when I start out to learn something, the easiest thing to do is pick up a project and learn as I go. 

With that in mind, what I'd love to automate would be a way to compare local profiles (on XP machines) to valid user accounts on the domain. If 1) the domain account does not exist and 2) the profile is not for a local PC account I'd like to have it delete the profile on the machine. 

Ideally, I'd like to run this against the entire domain, but I'd be almost as happy if I can execute it on individual computers as needed.  We have a lot of turnover in employees and each person can work on half a dozen different computers, so we eventually have hundreds of 'orphaned' profile caches just sitting there taking up space. 

Any tips for how to approach this would be appreciated.  

Edit: Deleting huge chunks of files across the entire domain frightens me a bit... so even if I just get it to report back to me which orphaned profiles exist, it would be a huge step forward for me. ",,False,,t5_2qo1o,True,,,True,t3_sia9h,http://www.reddit.com/r/PowerShell/comments/sia9h/deleting_local_profile_caches_for_deleted_users/,
1334277550.0,8,self.PowerShell,s74rf,Avoiding GUI lockup when running a command (e.g. a ping that fails),9,1,7,http://www.reddit.com/r/PowerShell/comments/s74rf/avoiding_gui_lockup_when_running_a_command_eg_a/,"So I've been writing a sort of dashboard GUI in PS, and one of the problems I came across was that when I wanted to run a ping, it would lock up the GUI until it finished. This is most noticeable when the ping fails, as it waits to timeout. Here I will explain my solution.

The basic concept is to create a background job, then use a timer to check if that job is done (at an interval, e.g. 200ms), and if it is done, retrieve the result.

**Note:** I'm assuming you already have the code to create the GUI using Windows Forms

Step 1. Create the timer:

    $tmrPingResult = New-Object System.Windows.Forms.Timer
    $tmrPingResult.Interval = 200 #Interval in milliseconds
    $tmrPingResult.add_Tick($tmrPingResult_Tick)

Step 2. The ping code (or anything else that causes the same lockup):

    Function PingComputer {
        #Start the ping job using -quiet to suppress output
        $j = Start-Job -InputObject $CurrentComputer {
                Test-Connection $input -Count 1 -Quiet
        }

        #The following allows the PingJob variable to be accessed by the whole script
        Set-Variable -Name PingJob -Scope script -Value $j 

        #Enable the timer to check for results
        $tmrPingResult.Enabled = $True
    }

Step 3. The timer code (runs on each tick):

**Note:** you could put this straight into *$tmrPingResult.add_Tick()* in step 1, but this is how my script is set up

    $tmrPingResult_Tick = {
        #Checks if job has completed
        IF ($PingJob.State -eq 'Completed') {
            $tmrPingResult.Enabled = $False #Disables the timer

            #Checks if ping was successful
            IF (Receive-Job -Job $PingJob) { #Ping successful
                ### PING SUCCESS CODE HERE ###
            }
            ELSE { #Ping failed
                ### PING FAILED CODE HERE ###
            }
            #Remove the job
            Remove-Job $PingJob
        }
    }

And that's it! Just running the function (in this case PingComputer) will start off the timer which will check for the result and run code based on it. This solution can of course be adopted for any other command that locks up the GUI, not just a ping.

Hope this helps a fellow PoSHer!",,False,,t5_2qo1o,True,,,True,t3_s74rf,http://www.reddit.com/r/PowerShell/comments/s74rf/avoiding_gui_lockup_when_running_a_command_eg_a/,
1329786139.0,9,techrepublic.com,pylpw,PowerShell 3 takes scripting to new heights,11,2,5,http://www.reddit.com/r/PowerShell/comments/pylpw/powershell_3_takes_scripting_to_new_heights/,,,False,,t5_2qo1o,False,,,False,t3_pylpw,http://www.techrepublic.com/blog/networking/powershell-3-takes-scripting-to-new-heights/5204,
1323105820.0,10,self.PowerShell,n1acq,Anyone every tried to make a Reddit Browsing Script?,11,1,14,http://www.reddit.com/r/PowerShell/comments/n1acq/anyone_every_tried_to_make_a_reddit_browsing/,"Hey all, 

   Seeing some posts like this one on [getting web Content with Powershell](http://waynes-world-it.blogspot.com/2008/05/reading-web-content-with-powershell.html) made me wonder if there is a way I could make a script to browse various subreddits safely from Powershell.  But I ran into a problem with formatting, namely, omitting information from the output.  

   Do you guys have any thoughts on this or have you attempted something similar?

    $web = New-Object Net.WebClient
    #$web | Get-Member

    $webtext = $web.DownloadString(""http://www.reddit.com/r/AskReddit/comments/n0ueg/whats_the_most_horrible_messed_up_joke_youve_ever/"") 


In any case, this is more to get ideas flowing than to do much else than that.  I'd also thought about making a Search-Wikipedia function to take a parameter and return the first description paragraph from the top result on a wiki search about it.  ",,False,,t5_2qo1o,False,,,True,t3_n1acq,http://www.reddit.com/r/PowerShell/comments/n1acq/anyone_every_tried_to_make_a_reddit_browsing/,
1321458614.0,9,powershellmagazine.com,megxm,PowerShell Magazine - Advanced Script Profiling,9,0,0,http://www.reddit.com/r/PowerShell/comments/megxm/powershell_magazine_advanced_script_profiling/,,,False,,t5_2qo1o,False,,,False,t3_megxm,http://www.powershellmagazine.com/2011/11/15/advanced-script-profiling/,
1319079812.0,8,self.PowerShell,lia2y,WTF? Can't cast a variable to its own type?,10,2,1,http://www.reddit.com/r/PowerShell/comments/lia2y/wtf_cant_cast_a_variable_to_its_own_type/,"I'm trying to whip something up using BES Web Services API...

Now, before you make a request, you have to set a ""metadata"" object to the request, so it can do whatever magic it needs later for version compatibility.

So I create the object, and try to assign it like the example code shows, but I'm getting a bizarre error

**Exception setting ""metadata"": ""Cannot convert the ""RequestMetadata"" value of type ""RequestMetadata"" to type ""RequestMetadata"".""**

Any idea what could be going on there?  I can't imagine what the error is trying to tell me since that looks like the same type to me.  Am I just blind?

BTW, here's the test harness I'm using to get rolling if that helps make any sense 

     $service= New-WebServiceProxy -uri ""https://$myserver/enterprise/admin/ws?wsdl""
     $util= New-WebServiceProxy -uri ""https://$myserver/enterprise/admin/util/ws?wsdl""

     $Metadata = new-object RequestMetadata
     $Metadata.clientVersion = ""5.0.3"";
     $Metadata.organizationUid = ""0"";
     $Metadata.locale = ""en_US"";

     $request = new-object GetEncodedUsernameRequest;
     $request.metadata = $Metadata;
*this assignment is what causes the error*

Any clue what that error message in bold could mean?  

-

EDIT: Never mind... solved the problem.  (though I still have no idea what the underlying error is telling me)

EDIT2: Don't ya hate that?

I actually had 2 problems... the first was that originally tried using a much [more complicated chunk of code that didn't work quite right](http://www.leeholmes.com/blog/2007/02/28/calling-a-webservice-from-powershell/), before switching to this style.  The types were still loaded from that one, so it didn't error out on the redefinitions.  (That error is the reason I switched styles originally, and I should have started fresh in a new session)

The second was that I wasn't setting up a name space usefully.  Changing some of the lines to the following got rid of errors


    $service= New-WebServiceProxy -uri ""https://besnva.office.aol.com/enterprise/admin/ws?wsdl"" -Namespace BESAdmin
    $util= New-WebServiceProxy -uri ""https://besnva.office.aol.com/enterprise/admin/util/ws?wsdl"" -Namespace BESUtil

    $Metadata = new-object BESUtil.RequestMetadata
    $request = new-object BESUtil.GetEncodedUsernameRequest;

Leaving the mistake up in case it helps someone else avoid wasting some time =)",,False,,t5_2qo1o,True,,,True,t3_lia2y,http://www.reddit.com/r/PowerShell/comments/lia2y/wtf_cant_cast_a_variable_to_its_own_type/,
1317498450.0,9,blog.richprescott.com,kxpur,New User Creation tool (Can set default entries),10,1,0,http://www.reddit.com/r/PowerShell/comments/kxpur/new_user_creation_tool_can_set_default_entries/,,,False,,t5_2qo1o,False,,,False,t3_kxpur,http://blog.richprescott.com/2011/10/arposh-new-user-creation-anuc.html,
1310647823.0,8,msdn.microsoft.com,ipdw9,Secrets to Building a WPF Application in Windows PowerShell - Excellent novice posh article with WPF GUI.,9,1,2,http://www.reddit.com/r/PowerShell/comments/ipdw9/secrets_to_building_a_wpf_application_in_windows/,,,False,,t5_2qo1o,False,,,False,t3_ipdw9,http://msdn.microsoft.com/en-us/magazine/hh288074.aspx,
1310475241.0,10,self.PowerShell,ind5l,Plaintext passwords?,10,0,7,http://www.reddit.com/r/PowerShell/comments/ind5l/plaintext_passwords/,I'm connecting to a database through powershell and I need to pass it a password... in plain text. What's the best way to ask for this? I would prefer to not have a password sitting on the screen showing.,,False,,t5_2qo1o,False,,,True,t3_ind5l,http://www.reddit.com/r/PowerShell/comments/ind5l/plaintext_passwords/,
1308626547.0,8,self.PowerShell,i4xa0,What is the point of Powershell execution policies?,10,2,15,http://www.reddit.com/r/PowerShell/comments/i4xa0/what_is_the_point_of_powershell_execution_policies/,"They seem pointless when all you have to do is ""powershell.exe -ExecutionPolicy bypass"" and the script runs. Microsoft's response goes something like [this](http://blogs.msdn.com/b/powershell/archive/2008/09/30/powershell-s-security-guiding-principles.aspx): ""Ultimately, if bad code has the ability to run this code, it already has control of the machine.""  

But if I can get a user to copy/paste some text, I can have them execute a script on a remote server.  Granted this takes user stupidity and social engineering to accomplish, but so would getting any .ps1 script to run.

Am I missing something?  Why go through all the trouble for something that is so easily bypassable?  What is actually accomplished by making legit sysadmins jump through hoops?
    
  
  
   
 &gt;    
   &gt;   
      
&gt;   







































EDIT:
As Thereal_Sandman pointed out, if digital signing is  required via a GPO, the bypass doesn't work.",,False,,t5_2qo1o,True,,,True,t3_i4xa0,http://www.reddit.com/r/PowerShell/comments/i4xa0/what_is_the_point_of_powershell_execution_policies/,
1306470783.0,9,self.PowerShell,hl996,How many of you use powershell remoting?,10,1,6,http://www.reddit.com/r/PowerShell/comments/hl996/how_many_of_you_use_powershell_remoting/,"I've been toying around with it for use with our exchange 2010 environment as exchange 2010 drops support for the management console on 32bit operating systems. Powershell remoting seems to be the quick and easy solution (mostly for the help desk) for those simple things like checking sizes, limits, etc.

I'm sure there are lots of other uses out there, but I'm just starting to explore the possibilities offered by powershell remoting.",,False,,t5_2qo1o,False,,,True,t3_hl996,http://www.reddit.com/r/PowerShell/comments/hl996/how_many_of_you_use_powershell_remoting/,
1376430914.0,8,self.PowerShell,1kb2rc,Search A File System Tree for particular User by ACL,8,0,4,http://www.reddit.com/r/PowerShell/comments/1kb2rc/search_a_file_system_tree_for_particular_user_by/,"I needed to find all instances of a user within the file system of the main share server.  She was changing companies so she were loosing all of the permissions to one company and being added to another.  Had to remove all the individual user permissions on the entire server so we could start from scratch to ensure compliance.  The groups were easy but, I did't want to go through 120,000 some odd folders and find each one she was in as an individual so - voila!
I hope this helps some of you.


http://pastebin.com/vzifhE5Y

",[Core],False,,t5_2qo1o,False,,,True,t3_1kb2rc,http://www.reddit.com/r/PowerShell/comments/1kb2rc/search_a_file_system_tree_for_particular_user_by/,
1376276777.0,9,learn-powershell.net,1k6lue,Get All Members of a Local Group Using PowerShell,9,0,4,http://www.reddit.com/r/PowerShell/comments/1k6lue/get_all_members_of_a_local_group_using_powershell/,,,False,,t5_2qo1o,False,,,False,t3_1k6lue,http://learn-powershell.net/2013/08/11/get-all-members-of-a-local-group-using-powershell/,
1374879341.0,7,self.PowerShell,1j4mgp,[script sharing] Report &amp; email a list of all RDP sessions with by-user count for remote Windows servers in an OU,10,3,6,http://www.reddit.com/r/PowerShell/comments/1j4mgp/script_sharing_report_email_a_list_of_all_rdp/,"To be used in a weekly report so that we can follow-up on dead/strange sessions.

    # Report list of all RDP sessions on all servers
    
    $serversOU = 'ou=servers,dc=somedomainhere,dc=com'
    
    Function sendEmail($strSubject, $strBody, $strSenderemail, $strRecipientemail) # Add $AttachFile to this and uncomment below, to add attachment
       {
          $strSMTP = ""smtp.somedomainhere.com""  #Change this to your SMTP/Exchange server
         
          $MailMessage = New-Object System.Net.Mail.MailMessage
          $SMTPClient = New-Object System.Net.Mail.smtpClient
          $SMTPClient.host = $strSMTP
          $Recipient = New-Object System.Net.Mail.MailAddress($strRecipientemail, ""Recipient"")
          $Sender = New-Object System.Net.Mail.MailAddress($strSenderemail, ""Sender"")
         
          $MailMessage.Sender = $Sender
          $MailMessage.From = $Sender
          $MailMessage.Subject = $strSubject
          $MailMessage.To.add($Recipient)
          $MailMessage.Body = $strBody
          #if ($AttachFile -ne $null) {$MailMessage.attachments.add($AttachFile) }
          $SMTPClient.Send($MailMessage)
       }
    
    Function Get-Duplicate {
        param($array, [switch]$count)
        begin {
            $global:hash = @{}
        }
        process {
            $array | %{ $global:hash[$_] = $global:hash[$_] + 1 }
            if($count) {
                $global:hash.GetEnumerator() | ?{$_.value -gt 1} | %{
                    New-Object PSObject -Property @{
                        Value = $_.key
                        Count = $_.value
                    }
                }
            }
            else {
                $global:hash.GetEnumerator() | ?{$_.value -gt 0} | %{
                    $_.key
                }
            }    
        }
    }
    
    $output = ''
    
    # Clear the array (and define it as an array)
    $userList = @()
    
    #Clear-Host # Not needed for scheduled task
    $ErrorActionPreference = ""SilentlyContinue""
    
    # Grab the servers from AD, then go through them, checking for RDP sessions
    $searchOU=$serversOU  #'ou=name,dc=dc,dc=com'
    Get-ADComputer -filter 'OperatingSystem -like ""Windows*""' -SearchBase $searchOU | Sort-Object | 
        Foreach-Object {
            $serverName=$_.Name
            $showAllServers = $false  # $false or $true
            if ($showAllServers -eq $true) {
                $output += $serverName
            }
            #$serverName # Uncomment to print all servers checked.
            try { $x = qwinsta /server:$serverName }
            catch { ""$serverName cannot be connected to."" }
            foreach ($y in $x) { 
                $user = $y.substring(18,15) -replace '\s*','' -replace '^.*USERNAME.*$',''
                if ($user.length -gt 0) {
                    if ($showAllServers -ne $true) {
                        $output += $serverName 
                    }
                    $userList += $user
                    $output += ""`t $user`r`n""
                }
            }
        }

    Get-Duplicate $userList -count | Out-Null
    $output += ""`r`n""
    $output += $global:hash.GetEnumerator() | %{ ""`t"",$_.key,"" :`t"",$_.value,""`r`n""}
    
    #$output
    sendEmail ""RDP Sessions report"" $output ""noreply@somedomainhere.com"" ""swimmingnaked@somedomainhere.com""
    ",,False,,t5_2qo1o,False,,,True,t3_1j4mgp,http://www.reddit.com/r/PowerShell/comments/1j4mgp/script_sharing_report_email_a_list_of_all_rdp/,
1372901956.0,8,self.PowerShell,1hluue,Fetch bad shutdowns in past 90 days.,11,3,7,http://www.reddit.com/r/PowerShell/comments/1hluue/fetch_bad_shutdowns_in_past_90_days/,"New to powershell, just trying to get a couple of scripts together I could use on a daily basis where I work.

This is what I have so far. I've spent the last hour or so fiddling with it and I think it *almost* works. 

Could someone point out where I'm going wrong with it?

&lt;# RECENT UNEXPECTED SHUTDOWNS #&gt;
get-eventlog system | 
    ? { $_.EventId -eq 6008 } | 
    select $date=(Get-Date).AddDays(-90) | 
    % { $_.TimeGenerated; break }

",,False,,t5_2qo1o,False,,,True,t3_1hluue,http://www.reddit.com/r/PowerShell/comments/1hluue/fetch_bad_shutdowns_in_past_90_days/,
1372762180.0,9,microsoft.com,1hhmvf,Windows Management Framework 4 Preview available (includes PowerShell 4),9,0,4,http://www.reddit.com/r/PowerShell/comments/1hhmvf/windows_management_framework_4_preview_available/,,,False,,t5_2qo1o,False,,,False,t3_1hhmvf,http://www.microsoft.com/en-us/download/details.aspx?id=39347,
1371828267.0,9,self.PowerShell,1gsr2b,Is anyone using PowerShell to run WindowsUpdate on Servers?,10,1,14,http://www.reddit.com/r/PowerShell/comments/1gsr2b/is_anyone_using_powershell_to_run_windowsupdate/,"I'm definitely a rookie with PowerShell.  I can't seem to find any cmdlets that allow you to run WindowsUpdate, determine what patches need to be run, and then install them.  I'd love to user PowerShell to specifically connect to 20 servers simultaneously, run WindowsUpdate, then patch accordingly.  Is anyone doing this?",,False,,t5_2qo1o,False,,,True,t3_1gsr2b,http://www.reddit.com/r/PowerShell/comments/1gsr2b/is_anyone_using_powershell_to_run_windowsupdate/,
1369945917.0,8,self.PowerShell,1fcy4o,Query remote registry and get registry get value,8,0,35,http://www.reddit.com/r/PowerShell/comments/1fcy4o/query_remote_registry_and_get_registry_get_value/,"I'm trying to retrieve the value for a registry key (HKLM\Software\ODBC\ODBC.INI\DSCFC, the value of the ""Port"" key). What I have so far is erroring out with a null value error.
    
    $strMachineName = import-csv c:\computers.txt
        foreach ($line in $strMachineName)
        {
            try {
                $reg = [Microsoft.Win32.RegistryKey]::OpenRemoteBaseKey('LocalMachine', $line.computer)
                $regkey = $reg.OpenSubkey(""SOFTWARE\\ODBC\\ODBC.INI\\DSCFC"")
                $portnumber = $regkey.GetValue(""Port"")
        
                ('""{0}"",""{1}""' -f $line.computer, $portnumber) | out-file C:\stdout.txt -append -encoding ascii
            } catch {
                ('""{0}"",""{1}""' -f $line.computer, $_) | out-file C:\stderr.txt -append -encoding ascii
            }
        }        

Any ideas?",,False,,t5_2qo1o,1369946335.0,,,True,t3_1fcy4o,http://www.reddit.com/r/PowerShell/comments/1fcy4o/query_remote_registry_and_get_registry_get_value/,
1367952824.0,7,self.PowerShell,1dvmpu,Turn off the command pane's horizontal scroll in ISE 3.0?,8,1,2,http://www.reddit.com/r/PowerShell/comments/1dvmpu/turn_off_the_command_panes_horizontal_scroll_in/,"Title says it all. Is there a way to do this so that is mirrors the wrapping in the non-ISE shell?

Thanks!",,False,,t5_2qo1o,False,,,True,t3_1dvmpu,http://www.reddit.com/r/PowerShell/comments/1dvmpu/turn_off_the_command_panes_horizontal_scroll_in/,
1367334001.0,8,self.PowerShell,1dewi0,Query each DNS record in DNS zone,10,2,9,http://www.reddit.com/r/PowerShell/comments/1dewi0/query_each_dns_record_in_dns_zone/,"Hello guys,  
  
I've got a pretty big analysis to run on multiple DNS zones.  

First step for me would be to get all the DNS Records of the ""old"" zone and to be able to extract their Recordname / RecordType / RecordData, then checking if it Resolves, to which IP address.  
  
So I'm stuck at the very first part already, getting all records of the zone.  
I tried using the DNS-Shell Commandlets.  

    Get-ADDnsPartition -server serverOLD | Get-ADDnsZone zoneOLD | where-object {$_.zonetype -eq ""Primary"" } | Get-ADDnsR
    ecord | where-object {$_.recordtype -eq ""CNAME"" } | sort    

  
**Which error's out after a few hundred records with**  


    Get-ADDnsRecord : The server does not support the control. The control is critical.
    At line:1 char:132
    + ...  ""Primary"" } | Get-ADDnsRecord | where-object {$_.recordtype -eq ""CNAME"" }
    +                    ~~~~~~~~~~~~~~~
        + CategoryInfo          : NotSpecified: (:) [Get-ADDnsRecord], DirectoryOperationException
        + FullyQualifiedErrorId : System.DirectoryServices.Protocols.DirectoryOperationException,DnsShell.PowerShell.CmdLet.GetADDnsRecord    

Odd is that the NewServer is exporting the data just, does not error out, even though it was 20x the number of records.
Btw, Oldserver is 2003, newserver is 2008. Both are DC's in a 2003 Domain.

Second step would be to query the records agains the second Zone and see if they exist and what type they are, which should be simple once i got the first part to work.  ",,False,,t5_2qo1o,False,,,True,t3_1dewi0,http://www.reddit.com/r/PowerShell/comments/1dewi0/query_each_dns_record_in_dns_zone/,
1367255211.0,7,self.PowerShell,1dcjgn,Scripting Games,8,1,34,http://www.reddit.com/r/PowerShell/comments/1dcjgn/scripting_games/,"I thought we could keep a running list of Reddit users submitted entries for the scripting games in order to give people a chance to vote on Reddit users entries.  I thought this would be a fun way to keep reddit powershell users working together and having fun with the scripting games.  I chose the beginner track.  

Basically reply to this thread and list your entries, as you submit new entries just edit your original reply and add the second entry.  

Please don't post until voting has closed for each event.",,False,,t5_2qo1o,1367260958.0,,,True,t3_1dcjgn,http://www.reddit.com/r/PowerShell/comments/1dcjgn/scripting_games/,
1364939478.0,7,self.PowerShell,1bjlsb,Powershell Google OAuth2?,9,2,8,http://www.reddit.com/r/PowerShell/comments/1bjlsb/powershell_google_oauth2/,"Has anyone been able to get OAuth working against Google as a service account?

I've been trying to translate the ""Service Accounts"" section, but it just won't work for me.


     Add-Type -Path ""K:\OAuth\System.Web.Mvc.dll""
     Add-Type -Path ""K:\OAuth\DotNetOpenAuth.dll""
     Add-Type -Path ""K:\OAuth\Google.Apis.Authentication.OAuth2.dll""
     Add-Type -Path ""K:\OAuth\Newtonsoft.Json.Net35.dll""
     Add-Type -Path ""K:\OAuth\Google.Apis.dll""


     $SERVICE_ACCOUNT_EMAIL = {mytag}
     $SERVICE_ACCOUNT_PKCS12_FILE_PATH = {pathtocert}
     $certificate = new-object System.Security.Cryptography.X509Certificates.X509Certificate2($SERVICE_ACCOUNT_PKCS12_FILE_PATH, `
            ""notasecret"", [System.Security.Cryptography.X509Certificates.X509KeyStorageFlags]::Exportable);

     $desc= [Google.Apis.Authentication.OAuth2.GoogleAuthenticationServer]::Description
     $provider = new-Object Google.Apis.Authentication.OAuth2.DotNetOpenAuth.AssertionFlowClient($desc, $certificate)
     $provider.ServiceAccountId = $SERVICE_ACCOUNT_EMAIL;
     $provider.Scope = ""https://www.google.com/m8/feeds""

     $func= [Google.Apis.Authentication.OAuth2.DotNetOpenAuth.AssertionFlowClient]::GetState
     $type=[type]""Google.Apis.Authentication.OAuth2.OAuth2Authenticator``1[Google.Apis.Authentication.OAuth2.DotNetOpenAuth.AssertionFlowClient]""

     $auth = new-Object ""Google.Apis.Authentication.OAuth2.OAuth2Authenticator``1[Google.Apis.Authentication.OAuth2.DotNetOpenAuth.AssertionFlowClient]""($provider, $func);

That's as far as I get... that last line complains about not being able to cast what looks like my second parameter into the first parameter's type.

It's driving me nuts.

EDIT: Forgot to include a reference to the code I was try to ""emulate"".  https://code.google.com/p/google-api-dotnet-client/wiki/OAuth2#Service_Accounts",,False,,t5_2qo1o,1365093353.0,,,True,t3_1bjlsb,http://www.reddit.com/r/PowerShell/comments/1bjlsb/powershell_google_oauth2/,
1364412207.0,8,self.PowerShell,1b4m9q,"PS Script pulls data from AD, permissions, etc. to generate Excel report.  Need help streamlining it!",8,0,16,http://www.reddit.com/r/PowerShell/comments/1b4m9q/ps_script_pulls_data_from_ad_permissions_etc_to/,"I've zipped &amp; put the script here:

http://www.files.com/shared/5153451670aff/AD-Reporting-ForReddit.zip

I've tried making the creation of the worksheets into functions as there's a lot of repetition in this, but I've not had any luck.  This works as is, but I'd like to clean it up &amp; make it easier to add to &amp; understand for our other staff.

Any suggestions are greatly appreciated!

Credit to http://www.petri.co.il/export-to-excel-with-powershell.htm for helping me understand the Excel bit!

EDIT: grammar

EDIT: pastebin link - http://pastebin.com/vEBpZMyV",,False,,t5_2qo1o,1364477113.0,,,True,t3_1b4m9q,http://www.reddit.com/r/PowerShell/comments/1b4m9q/ps_script_pulls_data_from_ad_permissions_etc_to/,
1363278814.0,7,self.PowerShell,1aaiul,Trying to figure out how to search for all accounts in AD that never expire and aren't disabled.,8,1,9,http://www.reddit.com/r/PowerShell/comments/1aaiul/trying_to_figure_out_how_to_search_for_all/,"The following command returns a list of accounts that have the password never expires option enabled.

     Search-ADAccount -PasswordNeverExpires | FT Name,ObjectClass -A 

The following command returns a list of all accounts that are disabled.

     Search-ADAccount -AccountDisabled | FT Name,ObjectClass -A

I'm lost on how to combine them though and since we have 100+ that match each category I reallly don't want to have to go through and compare them by hand if there's an easier way.",,False,,t5_2qo1o,False,,,True,t3_1aaiul,http://www.reddit.com/r/PowerShell/comments/1aaiul/trying_to_figure_out_how_to_search_for_all/,
1363112733.0,8,self.PowerShell,1a5szk,"Get-WmiObject : Invalid namespace ""root\cimv2""",10,2,16,http://www.reddit.com/r/PowerShell/comments/1a5szk/getwmiobject_invalid_namespace_rootcimv2/,"Ok, I'm at a loss. I'm reading Richard Siddaway's ""Powershell and WMI"" and in the [first chapter](http://www.manning.com/siddaway2/PSaWMIchapter1sample.pdf) he had a nifty script that creates a new object and populates it w/ some info from a couple of different WMI classes. So I thought I'd give it a whirl. I got a list of VMs and output it to a csv, like the sample in the book.

I keep getting the invalid namespace error. In PowerGUI, I set a break point on line 6, so I can see that the $_.Computer variable is accurately being populated. I did get-member on the $_.Computer variable, and see that it is a string. If I run the command on line 6 w/ the name of the server, it goes through fine, but if I populate a new variable from the same $_.Computer variable, I get the same error, if I were to do something like, $test = 'server_name', it works with $test.

For giggles, I tried it in Powershell_ISE and got the same error.

    Import-Csv computers.csv | 
    foreach {
      $system = """" | 
      select Name, Make, Model, CPUs, Cores, LogProc, Speed, Memory, Windows, SP
    
      $server = Get-WmiObject -Class Win32_ComputerSystem `
      -ComputerName $_.Computer
      
      $system.Name = $server.Name
      $system.Make = $server.Manufacturer
      $system.Model = $server.Model
      $system.Memory = $server.TotalPhysicalMemory
      $system.CPUs = $server.NumberOfProcessors
    
      $cpu = Get-WmiObject -Class Win32_Processor `
      -ComputerName $_.Computer | select -First 1
      
      $system.Speed = $cpu.MaxClockSpeed
      
      $os = Get-WmiObject -Class Win32_OperatingSystem `
      -ComputerName $_.Computer
      
      $system.Windows =  $os.Caption
      $system.SP =  $os.ServicePackMajorVersion
    
      if (($os.Version -split ""\."")[0] -ge 6) {
        $system.Cores = $cpu.NumberOfCores
        $system.LogProc = $cpu.NumberOfLogicalProcessors
      }
      else {
        $system.CPUs = """"
        $system.Cores = $server.NumberOfProcessors
      }
    
      $system
    }  | 
    Format-Table -AutoSize -Wrap        


Full error:

    +   $server = Get-WmiObject -Class Win32_ComputerSystem -ComputerName $_.Computer
    +             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        + CategoryInfo          : InvalidArgument: (:) [Get-WmiObject], ManagementException
        + FullyQualifiedErrorId : GetWMIManagementException,Microsoft.PowerShell.Commands.GetWmiObjectCommand


Edit: So, my system is Win 7 and I have v3. The author clearly states early in the book that he is using v2. I'm going to find a dev server w/ v2 and try it from there.",,False,,t5_2qo1o,1363196237.0,,,True,t3_1a5szk,http://www.reddit.com/r/PowerShell/comments/1a5szk/getwmiobject_invalid_namespace_rootcimv2/,
1362692783.0,8,self.PowerShell,19vcs9,Gotta be a better way to track down broken CNAMEs in DNS. Help?,10,2,2,http://www.reddit.com/r/PowerShell/comments/19vcs9/gotta_be_a_better_way_to_track_down_broken_cnames/,"Here's what I have so far, that doesn't quite work. $oname and $aname are populated properly, but the check to see if $aname resolves doesn't. Basically, I need to see what old CNAME entries are pointing to A records or other CNAMEs that no longer work. FWIW, the commented area does show that some are resolved but others are not.

Thanks for your help!

    $DNSServer = ""server1""
    $Domain = ""domainname.com""
    
    $ErrorActionPreference = 'SilentlyContinue'
    
    $CNAMErecs = Get-WMIObject -Class ""MicrosoftDNS_CNameType"" -Namespace `
        ""root\MicrosoftDNS"" -Comp $DNSServer -Filter ""DomainName='$Domain'"" | Select-Object * 
    
    foreach ($rec in $CNAMErecs) {
        $oname = $rec.OwnerName
        $aname = $rec.RecordData
        $aname = $aname.Substring(0,$aname.Length-1)
        $ip = [System.Net.Dns]::GetHostAddresses($aname) | select-object IPAddressToString -expandproperty IPAddressToString
        if ($? -eq $false) { 
            #Write-Host -NoNewLine ""$oname ""
            #Write-Host -NoNewLine ""$aname "" 
            #""$ip-FOUND""
        } else { 
            Write-Host -NoNewLine ""$oname ""
            Write-Host -NoNewLine ""$aname "" 
            ""NOT-RESOLVED"" 
        }
    }",,False,,t5_2qo1o,False,,,True,t3_19vcs9,http://www.reddit.com/r/PowerShell/comments/19vcs9/gotta_be_a_better_way_to_track_down_broken_cnames/,
1362075669.0,7,self.PowerShell,19eq62,"Counting subfolders, subtracting 1 from output",8,1,4,http://www.reddit.com/r/PowerShell/comments/19eq62/counting_subfolders_subtracting_1_from_output/,"I'm monitoring the subfolder count within a particular folder using the following:

$item = (Get-ChildItem ""C:\&lt;base search folder&gt;"" | Where$_.PSIsContainer})

$item | measure-object | select -expand Count 

This works great except the count is thrown off by 1.  There is a folder that is always there that I don't want to count.  I know to subtract the 1 mentally from the output but the people viewing the dashboard for this count do not.

Is there a way I can take the output and subtract a 1 from it?  I'm not too smart with this PowerShell stuff!",,False,,t5_2qo1o,False,,,True,t3_19eq62,http://www.reddit.com/r/PowerShell/comments/19eq62/counting_subfolders_subtracting_1_from_output/,
1361799902.0,9,self.PowerShell,196w5j,Powershell loads really slow,10,1,19,http://www.reddit.com/r/PowerShell/comments/196w5j/powershell_loads_really_slow/,"Hey gals and guys,

Is it just me or does it take forever for powershell to startup? I have a login script that runs via GPO for our users. The script only takes a second when powershell is already running, but when run at login it can take 10-30 seconds. Is this normal? Is there anything that I can do in my script or GPO that could help improve performance? 

EDIT: [Here is the pastebin of the script](http://pastebin.com/XrBnVRTG)
The main issue is that powershell (although minimized) is visibly running to the user and many users are closing the window and not letting the script run.
",,False,,t5_2qo1o,1361801331.0,,,True,t3_196w5j,http://www.reddit.com/r/PowerShell/comments/196w5j/powershell_loads_really_slow/,
1359386879.0,7,self.PowerShell,17fju1,Close MSIE tab?,8,1,3,http://www.reddit.com/r/PowerShell/comments/17fju1/close_msie_tab/,"I have a script that check a process to see if it's hung.  If it is, it will close the process and restart it.  However the process opens a second MSIE tab, leaving two tabs open for that process.  

Any way to check for an MSIE tab and close it?",,False,,t5_2qo1o,False,,,True,t3_17fju1,http://www.reddit.com/r/PowerShell/comments/17fju1/close_msie_tab/,
1359175774.0,10,learn-powershell.net,17aug0,Building an Xbox Live Widget using PowerShell,10,0,0,http://www.reddit.com/r/PowerShell/comments/17aug0/building_an_xbox_live_widget_using_powershell/,,,False,,t5_2qo1o,False,,,False,t3_17aug0,http://learn-powershell.net/2013/01/24/building-an-xbox-live-widget-using-powershell/,
1358967333.0,9,self.PowerShell,174xju,Running a EXE on a remote computer with arguments.,12,3,23,http://www.reddit.com/r/PowerShell/comments/174xju/running_a_exe_on_a_remote_computer_with_arguments/,"I have spent about 6 hours trying to get this to work.

I have a powershell script that maps a network drive to my local machine and then I was trying to use this.

invoke-command -computername $Compname { &amp; 'l:\setup.exe' -ArgumentList ""/silent"" }

I have been searching around the internet as well but most people use shorthand or dont actually explain their code and so its all useless to me. Does anyone know how I might get this to work? The error I get is

The term 'l:\setup.exe' is not recognized as the name of a cmdlet, function, sc
ript file, or operable program. Check the spelling of the name, or if a path wa
s included, verify that the path is correct and try again.
    + CategoryInfo          : ObjectNotFound: (g:\setup.exe:String) [], Comman
   dNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

I know the path is correct because I can cd to that directory and run the file.",,False,,t5_2qo1o,False,,,True,t3_174xju,http://www.reddit.com/r/PowerShell/comments/174xju/running_a_exe_on_a_remote_computer_with_arguments/,
1356747358.0,7,mattblogsit.com,15lrte,Backup Linux using PowerShell | Matt Blogs IT,8,1,0,http://www.reddit.com/r/PowerShell/comments/15lrte/backup_linux_using_powershell_matt_blogs_it/,,,False,,t5_2qo1o,False,,,False,t3_15lrte,http://mattblogsit.com/windows/backup-linux-using-powershell,
1356623682.0,8,self.PowerShell,15itlw,"I was passed a script from someone who no longer works at my company, can someone explain this code to me?",11,3,1,http://www.reddit.com/r/PowerShell/comments/15itlw/i_was_passed_a_script_from_someone_who_no_longer/,"This script deals with configuring SNMP, and this is at the beginning of the script. If there is anything I should remove from the post (information that shouldn't be made public), let me know; but it looks okay to me. If someone could explain what this does, I would greatly appreciate it!

    $bindingFlags = [Reflection.BindingFlags] “Instance,NonPublic,GetField”
    $objectRef = $host.GetType().GetField(“externalHostRef”, $bindingFlags).GetValue($host)

    $bindingFlags = [Reflection.BindingFlags] “Instance,NonPublic,GetProperty”
    $consoleHost = $objectRef.GetType().GetProperty(“Value”, $bindingFlags).GetValue($objectRef, @())
    [void] $consoleHost.GetType().GetProperty(“IsStandardOutputRedirected”, $bindingFlags).GetValue($consoleHost, @())
    $bindingFlags = [Reflection.BindingFlags] “Instance,NonPublic,GetField”
    $field = $consoleHost.GetType().GetField(“standardOutputWriter”, $bindingFlags)
    $field.SetValue($consoleHost, [Console]::Out)
    $field2 = $consoleHost.GetType().GetField(“standardErrorWriter”, $bindingFlags)
    $field2.SetValue($consoleHost, [Console]::Out)


***EDIT:***

It looks like this may be what it is: http://www.leeholmes.com/blog/2008/07/30/workaround-the-os-handles-position-is-not-what-filestream-expected/",,False,,t5_2qo1o,1356640405.0,,,True,t3_15itlw,http://www.reddit.com/r/PowerShell/comments/15itlw/i_was_passed_a_script_from_someone_who_no_longer/,
1353514288.0,8,self.PowerShell,13kk37,Tasked with updating two security groups based on a spreadsheet from HR and cross-domain users.,8,0,7,http://www.reddit.com/r/PowerShell/comments/13kk37/tasked_with_updating_two_security_groups_based_on/,"Our organization is a bit different, in that all our user accounts are on a different domain, and we run our own resource domain. We have a one-way trust with that domain (referred to as ""foreignDomain).

HR used to manage the Employees group, but they've lost interest in doing it, and now want to send us a spreadsheet exported from the ""cloud"" based time management site, and let us mange these groups.

The spreadsheet contains two sheets, one for regular employees, one for ""faculty"" and so we manage two different security groups. Each sheet has column 1 as their real name, column 2 as their email address.

This script is the culmination of my Powershell knowledge. Some comments are there so you guys know what I'm doing in it. It's the first time I've used Param, and only so I can use -verbose. So I stuck $dummy in there to avoid errors. I throw this out to you guys, looking for any advice on efficiency, or notes on what I'm doing wrong or could do better. Thanks for your time!

    Param (
        [Parameter()]
        $dummy
    )
    $xlsxFile = ""Path\And file name of.xlsx""
    $sheetEmployees = ""Employees""
    $sheetFaculty = ""Faculty""
    [int]$maxExcelRows = ""1500""
    $groupEmployees = ""Employees-Group""
    $groupFaculty = ""Faculty-Group""
    $foreignDomain = ""ForeignDomain\""
    $foreignDC = ""controller.foreigndomain.net""

    #Load names from AD employees group
    Write-Verbose ""Gathering Employees members""
    #region
    $groupEmpList = get-adgroup $groupEmployees -properties members | select -ExpandProperty members | get-adobject | select ObjectClass,name
    $groupEmpList | Add-Member -MemberType NoteProperty -Name userName -value """";
    $usersEmp = @()
    foreach ($_ in $groupEmpList) {
      if ($_.ObjectClass -like ""*Foreign*"") {
    $objSID = New-Object System.Security.Principal.SecurityIdentifier ($_.name)
    $objUser = $objSID.Translate( [System.Security.Principal.NTAccount] )
    
    $_.userName = $objUser.Value
    $usersEmp += $_.username
      }
    }
    $groupEmpList | Export-CSV (""$env:USERPROFILE\$groupEmployees"" + "".csv"")
    #endregion

    #Load names from AD faculty group
    Write-Verbose ""Gathering Faculty members""
    #region
    $groupFacList = get-adgroup $groupFaculty -properties members | select -ExpandProperty members | get-adobject | select ObjectClass,name
    $groupFacList | Add-Member -MemberType NoteProperty -Name userName -value """";
    $usersFac = @()
    foreach ($_ in $groupFacList) {
      if ($_.ObjectClass -like ""*Foreign*"") {
    $objSID = New-Object System.Security.Principal.SecurityIdentifier ($_.name)
    $objUser = $objSID.Translate( [System.Security.Principal.NTAccount] )
    
    $_.userName = $objUser.Value
    $usersFac += $_.username
      }
    }
    $groupFacList | Export-CSV (""$env:USERPROFILE\$groupFaculty"" + "".csv"")
    #endregion

    #Create Excel Connection
    Write-Verbose ""Create Excel Connection""
    #region
    Write-Verbose ""Opening $xlsxFile""
    $Excel = New-Object -ComObject ""Excel.Application""
    $Workbook = $Excel.workbooks.open($xlsxFile)
    #endregion

    #Load names from XLSX employees sheet
    Write-Verbose ""Collect Employee column values from Excel""
    #region
    $xlEmployees = @()
    $Sheet = $Workbook.Worksheets.Item($sheetEmployees)
    $count = $Sheet.Cells.Item($maxExcelRows, 2).End(-4162)
    for($startRow=2;$startRow -le $count.row;$startRow++)
    {
    	$xlEmployees += ""$foreignDomain"" + $Sheet.Cells.Item($startRow, 2).Value().split(""@"")[0]
    }
    #endregion

    #Load names from XLSX faculty sheet
    Write-Verbose ""Collect Faculty column values from Excel""
    #region
    $xlFaculty = @()
    $Sheet = $Workbook.Worksheets.Item($sheetFaculty)
    $count = $Sheet.Cells.Item($maxExcelRows, 2).End(-4162)
    for($startRow=2;$startRow -le $count.row;$startRow++)
    {
    	$xlFaculty += ""$foreignDomain"" + $Sheet.Cells.Item($startRow, 2).Value().split(""@"")[0]
    }
    #endregion
    $Excel.Quit()

    #Compare Employees
    Write-Verbose ""Comparing Emloyee lists""
    #region
    $newEmployees = @()
    $oldEmployees = @()
    foreach ($xlEmployee in $xlEmployees) {
       if ( $usersEmp -notcontains $xlEmployee) { $newEmployees += $xlEmployee }
    }
    foreach ($userEmp in $usersEmp) {
       if ( $xlEmployees -notcontains $userEmp) { $oldEmployees += $userEmp }
    }
    #endregion

    #Compare Faculty
    Write-Verbose ""Comparing Faculty lists""
    #region
    $newFaculty = @()
    $oldFaculty = @()
    foreach ($xlFac in $xlFaculty) {
       if ( $usersFac -notcontains $xlFac) { $newFaculty += $xlFac }
    }
    foreach ($userFac in $usersFac) {
       if ( $xlFaculty -notcontains $userFac) { $oldFaculty += $userFac         }
    }
    #endregion

    #Report
    Write-Verbose ""Output comparison results""
    #region
    write-output ""Employees to be added:""
    $newEmployees
    Write-Output ""Faculty to be added:""
    $newFaculty
    write-output ""Employees to be removed:""
    $oldEmployees
    Write-Output ""Faculty to be removed:""
    $oldFaculty
    #endregion

    ##Add names to AD groups

    #Create persistant AD drive with Foreign Domain
    New-PSDrive -name ForeignAD -PSProvider ActiveDirectory -Server $foreignDC -credential (Get-Credential -Message ""Enter credentials for $foreignDomain"") -root ''
    if ($?) { Write-Verbose ""AD PS Drive creation: Successful"" } 
    else { Write-Verbose ""AD PS Drive creation: Failed"" }

    #Get user info from Foreign Domain
    Write-Verbose ""Gathering user information from $foreignDC""
    #region
    $addEmployees = @()
    foreach ($_ in $newEmployees) {
        $addUser = Get-ADUser -server $foreignDC -Identity $_.split(""\"")[1] -ErrorAction SilentlyContinue
        if ($? -eq $true) { $addEmployees += $adduser }
        else { $failedEmployees += $_ }
    }
    $addFaculty = @()
    foreach ($_ in $newFaculty) {
        $addFac = Get-ADUser -server $foreignDC -Identity $_.split(""\"")[1] -ErrorAction SilentlyContinue
        if ($? -eq $true) { $addFaculty += $addFac }
        else { $failedFaculty += ""$_, "" }
    }
    #endregion
    Write-Output ""Failed to resolve:""
    Write-Output ""Employees: $failedEmployees""
    Write-Output ""Faculty: $failedFaculty""

    #Confirm Employees
    #region
    $title = ""Confirm Changes""
    $newcount = $addEmployees.count
    $message = ""$newcount new users will be added to the $groupEmployees group. Proceed?""

    $yes = New-Object     System.Management.Automation.Host.ChoiceDescription ""&amp;Yes"", `
    ""Add new members to the group.""

    $no = New-Object System.Management.Automation.Host.ChoiceDescription ""&amp;No"", `
    ""Make no changes and exit the script.""

    $options = [System.Management.Automation.Host.ChoiceDescription[]]($yes, $no)

    $result = $host.ui.PromptForChoice($title, $message, $options, 1) 

    switch ($result)
        {
            0 { Add-ADGroupMember -Identity $groupEmployees -Members $addEmployees }
            1 {""You selected No.""}
    }
    #endregion

    #Confirm Faculty
    #region
    $title = ""Confirm Changes""
    $newcount = $addFaculty.count
    $message = ""$newcount new users will be added to the $groupFaculty group. Proceed?""

    $yes = New-Object System.Management.Automation.Host.ChoiceDescription ""&amp;Yes"", `
    ""Add new members to the group.""

    $no = New-Object System.Management.Automation.Host.ChoiceDescription ""&amp;No"", `
    ""Make no changes and exit the script.""

    $options = [System.Management.Automation.Host.ChoiceDescription[]]($yes, $no)

    $result = $host.ui.PromptForChoice($title, $message, $options, 1) 

    switch ($result)
        {
            0 { Add-ADGroupMember -Identity $groupFaculty -Members $addFaculty }
            1 {""You selected No.""}
        }
    #endregion

    #Close PS Drive
    Remove-PSDrive ForeignAD
",,False,,t5_2qo1o,False,,,True,t3_13kk37,http://www.reddit.com/r/PowerShell/comments/13kk37/tasked_with_updating_two_security_groups_based_on/,
1353427091.0,9,self.PowerShell,13ihc7,Need help ending a script if no query results are found?,12,3,14,http://www.reddit.com/r/PowerShell/comments/13ihc7/need_help_ending_a_script_if_no_query_results_are/,"Here's my code that I'm using:
    
    $query = ""Query""

    #
    # Execute query and store as temporary file at $outfile
    #

    $queryout = invoke-sqlcmd -query $query -ServerInstance $server -Database $database | Export-Csv $outfile 

    #
    # Pick up $outfile and transform text to upload specification for bank ## 10/26 added Encoding ""Default"" to     format ANSI instead of unicode.
    #

    $uploadfileout = get-content C:\Scripts\Outfile.txt | ForEach-Object { 
                                            $_ -replace '""', '' `
                                               -replace '  ', '' `
                                               -replace ',' , ' ' `
                                               -replace ' ,', '' `
                                               -replace 'V ', 'V' `
                                               -replace 'T ', 'T' `
                                               -replace 'X', ' ' `
                                                                } | Select-Object -Skip 2 | out-file $uploadfile -Encoding ""Default""

What I need to do is if the query returns no results for the day, stop processing immediately. And preferably send me an e-mail saying that no results were processed that day. I just can't wrap my head around exactly how to do it.. any help would be appreciated.",,False,,t5_2qo1o,False,,,True,t3_13ihc7,http://www.reddit.com/r/PowerShell/comments/13ihc7/need_help_ending_a_script_if_no_query_results_are/,
1352787271.0,6,self.PowerShell,133ztk,Monokai Theme for Powershell ISE,10,4,8,http://www.reddit.com/r/PowerShell/comments/133ztk/monokai_theme_for_powershell_ise/,"Here is the Monokai theme for Powershell ISE 3.0. Just save it as .ps1xml and import it (Tools &gt; Options &gt; Manage Themes)

Link: http://pastebin.com/UBFNwP1a
",,False,,t5_2qo1o,False,,,True,t3_133ztk,http://www.reddit.com/r/PowerShell/comments/133ztk/monokai_theme_for_powershell_ise/,
1350880148.0,8,self.PowerShell,11vpuq,Powershell runs my python program quickly - and closes it immediately.,10,2,4,http://www.reddit.com/r/PowerShell/comments/11vpuq/powershell_runs_my_python_program_quickly_and/,"Good afternoon,

I've recently began to play around with learning Python and was recommended to use Powershell to run my python programs. Running a simple ""Hello World"" type program, it opens the command prompt and then immediately closes it. Everytime I open powershell I have to re-enter

$env:PATHEXT += "";.py""

Is there a way to permanently edit this so that I do not have to keep inputting it for new sessions?

Thank you - and yes, I looked through the FAQS.",,False,,t5_2qo1o,False,,,True,t3_11vpuq,http://www.reddit.com/r/PowerShell/comments/11vpuq/powershell_runs_my_python_program_quickly_and/,
1350688223.0,8,ramblingcookiemonster.wordpress.com,11ruw4,Parallel PowerShell - Vastly improve performance with Runspace pools,9,1,2,http://www.reddit.com/r/PowerShell/comments/11ruw4/parallel_powershell_vastly_improve_performance/,,,False,,t5_2qo1o,False,,,False,t3_11ruw4,http://ramblingcookiemonster.wordpress.com/2012/10/19/parallel-powershell/,
1350657099.0,8,self.PowerShell,11qy0g,Function - Create an Array from the Contents of your Clipboard,9,1,3,http://www.reddit.com/r/PowerShell/comments/11qy0g/function_create_an_array_from_the_contents_of/,"    &lt;# GET TEXT FROM THE CLIPBOARD; RETURN ARRAY
      i find i'm constantly opening notepad and creating .txt files just so
      i can create an array from the contents of my clipboard. i put this lil
      diddy in my profile so i can save myself a step and stop creating so many 
      damn .txt files in the process. I'm sure there's another way to do this,
      but here's my quick and dirty way. Enjoy...
    #&gt;

    function Get-ClipBoard {
        Add-Type -AssemblyName System.Windows.Forms
        $myClip = New-Object System.Windows.Forms.TextBox
        $myClip.Multiline = $true
        $myClip.Paste()
        $myClip.Text.Split(""`n"")
    }",,False,,t5_2qo1o,False,,,True,t3_11qy0g,http://www.reddit.com/r/PowerShell/comments/11qy0g/function_create_an_array_from_the_contents_of/,
1350579036.0,8,self.PowerShell,11p3i4,Update on my health reporting script,8,0,3,http://www.reddit.com/r/PowerShell/comments/11p3i4/update_on_my_health_reporting_script/,"I decided on just staying with a home grown error reporting solution vs trying to setup something such as Vcenter orchestrator to monitor the scripts.
  

The main issue I am trying to solve is having a report on all my scripts that will not overwhelm my inbox.  Currently I have a lot of scripts setup waiting for input and without checking I have no idea if they are running or not, unless they succeed or fail reading an input file. So I made some functions that can be added to scripts that will have them output a .csv file (turns out might have been a bad choice because of no -append parameter, but I digress.).
  

Another script will read this file/archive the old log and send an email with the contents of the log file.  The way I set my script up it is expecting a Report folder where current.csv will reside, and under that folder one called ""Archive"" where archive.csv will reside.  You can keep my defaults or edit those parts of the scripts.

[Place this in your script](http://pastebin.com/QBAMacnq)  

[Schedule this as a task](http://pastebin.com/7H2vDLrt)",,False,,t5_2qo1o,False,,,True,t3_11p3i4,http://www.reddit.com/r/PowerShell/comments/11p3i4/update_on_my_health_reporting_script/,
1349642257.0,8,self.PowerShell,113p7z,Function to get failover history for all nodes on a cluster.,10,2,2,http://www.reddit.com/r/PowerShell/comments/113p7z/function_to_get_failover_history_for_all_nodes_on/,"So last week I [posted](http://www.reddit.com/r/PowerShell/comments/10vo7q/geteventlog_vs_getwinevent/) a question about Get-WinEvent noting that I didn't like having to use hashtables to set a start and end date for the query.

I was primarily interested in getting the failover history for cluster nodes. So I wrote a function that will use three parameters, a server name, and two numbers, the after day, in numbers, as in 14, if you wanted events after 14 days ago, and a before day, as in before 1 day ago. If no day parameters are entered it will assume 14 days for the after and 0 for the before. Additionally, it has a check for the OS, since it can only pull the data from Server 2008 (if you have 2012 in your environment, you will need to make modifications). It will also check to make sure the server is a cluster. The function will also get the names of all the nodes in a cluster and before proceeding to get the failover history.

I posted the [function](https://github.com/Polonius19/PoSH/blob/master/func_getfailoverhistory.ps1) to GitHub. It relies on another function, a module really, that gets the OS version. I've also [posted](https://github.com/Polonius19/PoSH/blob/master/mod-osversion.ps1) it to GitHub as well.

A couple of caveats. The regex I used to pull the node names matches our naming convention. You'll need to modify to match your own. Also, this doesn't seem to work on XP systems. I wrote this for our NOC, but they have only XP workstations. So I don't know that they can't use it because they can't install PoSH v3 or if the problem is XP. The error message returned only referenced Vista and later as supported OSs for Get-WinEvent. Alas.",,False,,t5_2qo1o,False,,,True,t3_113p7z,http://www.reddit.com/r/PowerShell/comments/113p7z/function_to_get_failover_history_for_all_nodes_on/,
1348845700.0,7,self.PowerShell,10mdx0,Create user profile on computer for domain account (without logging into the computer) can powershell do this?,9,2,9,http://www.reddit.com/r/PowerShell/comments/10mdx0/create_user_profile_on_computer_for_domain/,"One of the workflows I am looking to simplify is when a desktop goes down because of a hardware failure and a new PC is dropped into place the user has to login locally to create their profile prior to restoring data.

It would be awesome if I could use a powershell commandlet to create all the registry keys and profile folder structure for a domain account on the PC without a user logging in with a username and password.

Has anyone seen anything that may be able to do this? Can you think of any glaring issue that would absolutely prevent this from working?",,False,,t5_2qo1o,False,,,True,t3_10mdx0,http://www.reddit.com/r/PowerShell/comments/10mdx0/create_user_profile_on_computer_for_domain/,
1347661822.0,7,ilnumerics.net,zwei7,Powershell finally enters the bigdata market,10,3,0,http://www.reddit.com/r/PowerShell/comments/zwei7/powershell_finally_enters_the_bigdata_market/,,,False,,t5_2qo1o,False,,,False,t3_zwei7,http://ilnumerics.net/blog/putting-on-a-good-show-with-hdf5-ilnumerics-and-powershell/,
1345708353.0,8,channel9.msdn.com,yopno,"Hands on Labs from TechEd Europe 2012 available online (Limited Period, x-post /r/sysadmin)",8,0,1,http://www.reddit.com/r/PowerShell/comments/yopno/hands_on_labs_from_teched_europe_2012_available/,,,False,,t5_2qo1o,False,,,False,t3_yopno,http://channel9.msdn.com/Events/TechEd/Europe/2012?sort=status&amp;direction=asc&amp;t%5B0%5D=hands-on%2Blab#tab_sortBy_status,
1345044559.0,6,self.PowerShell,y9jmu,Console or ISE? ,8,2,19,http://www.reddit.com/r/PowerShell/comments/y9jmu/console_or_ise/,"It seems like Microsoft is really pushing focus to the ISE, but I can't help but to pop open the console to do anything on a server (most of which is running scripts)

Where do you spend most of your time when slinging script? ",,False,,t5_2qo1o,False,,,True,t3_y9jmu,http://www.reddit.com/r/PowerShell/comments/y9jmu/console_or_ise/,
1344875222.0,9,self.PowerShell,y5ff5,Powershell and Task Scheduler,9,0,25,http://www.reddit.com/r/PowerShell/comments/y5ff5/powershell_and_task_scheduler/,"I have a powershell script that is set to run via task scheduler at 0800 and 1300 daily to import students from our registrar program (older unix program that dumps new students into a CSV) and imports the CSV into powershell that creates mailboxes and assigns distribution lists. 

I have noticed when running the script manually, it runs in about 4 minutes. When I have task scheduler, the task is still running when I get in at 915. Do I need to add anything to the bottom of my script? 

Like a Stop or Exit command? 

added myscript.bat to task scheduler, runs powershell.exe then the importscript1,2,3 sequentially. 

[Pastebin of myscript.bat](http://pastebin.com/VRYARNvc) 

Creates mailbox from CSV. Single CSV per OU

[Importscript1](http://pastebin.com/z6qtwQMp)

Adds users to distribution lists ""All Students, Fresno Students "" or ""All Students San Diego Students"" 

[Importscript2](http://pastebin.com/PCiKSKGy)

Set-ADUser -Identity adds description that the unix program gives each student, and assigns them to display ""San Diego Student""  and sets their ""H"" drive.. or home directory for \\studentfileserver\user\studentname

[Importscript3](http://pastebin.com/puMZey0L)


EDIT: Task Schedule settings as requested

[IMGUR](http://imgur.com/Ix2Iy,BwQLA,BHuJF,JkqpV,oazim,gTuEA)

EDIT2: this script runs on a Exchange HUB server, exchange 2010 and Windows 2008

Up until I started the guy before me manually ran the script twice a day. at 0800 ant 1300.. 
",,False,,t5_2qo1o,1344897957.0,,,True,t3_y5ff5,http://www.reddit.com/r/PowerShell/comments/y5ff5/powershell_and_task_scheduler/,
1343413065.0,9,jfrmilner.wordpress.com,x9bwd,Get Folder Size PowerShell Script,9,0,1,http://www.reddit.com/r/PowerShell/comments/x9bwd/get_folder_size_powershell_script/,,,False,,t5_2qo1o,False,,,False,t3_x9bwd,http://jfrmilner.wordpress.com/2011/05/02/get-folder-size-powershell-script/,
1339414110.0,8,self.PowerShell,uw02r,Critique my one-liner,8,0,4,http://www.reddit.com/r/PowerShell/comments/uw02r/critique_my_oneliner/,"    gwmi win32_logicaldisk -computer (Test-Connection -comp (get-adcomputer -filter {name -like 'server*'} | select -expand name ) -count 1 -ea silentlycontinue | select -expand address) | where {$_.description -eq 'Local Fixed Disk'} | where {$_.freespace/$_.size -lt 0.2} | select deviceid,freespace,systemname,size

So the idea of this is that it;

* gets a list of servers 
* picks out the ones that are up 
* gets the disc info from wmi
* filters to only the local HDDs
* filters to only discs with less than 20% free

Is my approach the best way of doing this? The test-connection bit in particular seems a bit hacky, I feel like it might be better handled using the -quiet switch, but I couldn't work out how. I'm pretty new to powershell, and have limited experience with programming in general, so I've no idea how sensible this is.",,False,,t5_2qo1o,False,,,True,t3_uw02r,http://www.reddit.com/r/PowerShell/comments/uw02r/critique_my_oneliner/,
1337368393.0,6,self.PowerShell,tto33,I'm sure this will help somebody. Simple script (could be easier) to log each session ,8,2,18,http://www.reddit.com/r/PowerShell/comments/tto33/im_sure_this_will_help_somebody_simple_script/,"So starting out I didn't know about the Start-Transcript commandlet and I think it's a great way for me to learn. I wrote this small set of lines and put it in my Profile.ps1 for my admin account so anything I do is logged. 

    $transcript = Get-Date -Format D;
    $tlog = ""X:\path\"" + $transcript + "".txt"";
    Start-Transcript -path $tlog;

I'm not sure if I need the semi-colons, but hey, this will be useful some day to me while I am learning Powershell and getting more comfortable with it :D If this helps anyone or they see any spots for improvements (like using a shorter variable) let me know! 

",,False,,t5_2qo1o,False,,,True,t3_tto33,http://www.reddit.com/r/PowerShell/comments/tto33/im_sure_this_will_help_somebody_simple_script/,
1336082344.0,8,csharpening.net,t5sol,A recap of the PowerShell Deep Dive. ,8,0,0,http://www.reddit.com/r/PowerShell/comments/t5sol/a_recap_of_the_powershell_deep_dive/,,,False,,t5_2qo1o,False,,,False,t3_t5sol,http://csharpening.net/?p=1128,
1335857793.0,8,self.PowerShell,t1928,Finding array index number,9,1,4,http://www.reddit.com/r/PowerShell/comments/t1928/finding_array_index_number/,"Hey guys I'm new to scripting and I'm wondering if anyone could help me with this. Is there a way to find the index number of a certain entry in an array and store it as a new variable?

Say we have an array called $animals which contains the names of various animals. Like so:

    $animals = ('dog', 'cat', 'duck', 'horse')

And the script asks the user to input the name of an animal:

    $input = read-host

And then some kind of ""if"" statement to check if $input is in $animals (I know how to do this part), and if it is it stores the index number of the array entry as $x.

Is this possible?",,False,,t5_2qo1o,False,,,True,t3_t1928,http://www.reddit.com/r/PowerShell/comments/t1928/finding_array_index_number/,
1335184511.0,9,self.PowerShell,so2jz,"Help tweaking script, reporting",9,0,19,http://www.reddit.com/r/PowerShell/comments/so2jz/help_tweaking_script_reporting/,"I have been trying to come up with a way to provide a daily list of computers that have been added or removed from our domain, and have that list emailed out to my team.  I think I have it pretty well ironed out, but I have a few issues I need help with.  Basically, this scripts starts with an existing dump of all the computers and servers in AD as reference text files.  Then when it runs, it does another 2 AD dumps, and compares them against the reference text files.  After emailing the differences, it erases the old reference doc, and makes the new stuff the reference for the next day.
    
    
In the code below, I started out by returning the name and canonical name of the computers, but then computers would get included if they were moved around.  So, I had to remove canonical name.  I would really like to get that back, but I don't know how to do it without affecting the compare-objects.  Is there some way I can read it into an array after the fact?
    
    
Also, I would really like to have the output arrays used to create a nice HTML report that can be emailed, instead of having just the text and headers I kludged together, but I have no html skills, and the few attempts I have made have been horrible failures.
    
    
Here is my current code:

    Import-Module activedirectory
    
    $Header = ""Daily Active Directory Computer Account Activity`n`n""
    $Section1 = @""
    `n`nPCs Added`n
    Name                  CanonicalName
    ----                  -------------`n
    ""@
    $Section2 = @""
    `n`nServers Added`n
    Name                  CanonicalName
    ----                  -------------`n
    ""@
    $Section3 = @""
    `n`nPCs Deleted`n
    Name                  CanonicalName
    ----                  -------------`n
    ""@
    $Section4 = @""
    `n`nServers Deleted`n
    Name                  CanonicalName
    ----                  -------------`n
    ""@
    
    
    #get-adcomputer -Filter {(OperatingSystem -NotLike ""Windows *Server*"")} -Properties Name,CanonicalName |
     FT -autosize Name,CanonicalName &gt; c:\powershellscripts\computerlist_diff.txt
    #get-adcomputer -Filter {(OperatingSystem -Like ""Windows *Server*"")} -Properties Name,CanonicalName |
     FT -autosize Name,CanonicalName &gt; c:\powershellscripts\serverlist_diff.txt
    get-adcomputer -Filter {(OperatingSystem -NotLike ""Windows *Server*"")} -Properties Name | FT Name &gt; c:\powershellscripts\computerlist_diff.txt
    get-adcomputer -Filter {(OperatingSystem -Like ""Windows *Server*"")} -Properties Name | FT Name &gt; c:\powershellscripts\serverlist_diff.txt
     
    $ComputersDeleted = compare-object $(get-content c:\powershellscripts\computerlist_ref.txt) $(get-content c:\powershellscripts\computerlist_diff.txt) -passThru |
     where-object {$_.SideIndicator -eq '&lt;='}
    $strComputersDeleted = out-string -inputobject $ComputersDeleted
     
    $ServersDeleted = compare-object $(get-content c:\powershellscripts\serverlist_ref.txt) $(get-content c:\powershellscripts\serverlist_diff.txt) -passThru |
     where-object {$_.SideIndicator -eq '&lt;='}
    $strServersDeleted = out-string -inputobject $ServersDeleted
    
    $ComputersAdded = compare-object $(get-content c:\powershellscripts\computerlist_ref.txt) $(get-content c:\powershellscripts\computerlist_diff.txt) -passThru |
     where-object {$_.SideIndicator -eq '=&gt;'}
    $strComputersAdded = out-string -inputobject $ComputersAdded
    
    $ServersAdded = compare-object $(get-content c:\powershellscripts\serverlist_ref.txt) $(get-content c:\powershellscripts\serverlist_diff.txt) -passThru |
     where-object {$_.SideIndicator -eq '=&gt;'}
    $strServersAdded = out-string -inputobject $ServersAdded
    
    $strComplete = $Header+$Section1+$strComputersAdded+$Section2+$strServersAdded+$Section3+$strComputersDeleted+$Section4+$strServersDeleted
    
    		$emailFrom = ""ActiveDirectory@company.com""
    		$emailTo = ""zeunasc@company.com""
    		$subject = ""Daily Active Directory Computer Account Activity""
    		$smtpServer = ""10.1.1.1""
    		$smtp = new-object Net.Mail.SmtpClient($smtpServer)
    		$smtp.Send($emailFrom, $emailTo, $subject, $strComplete)
    
    Remove-Item c:\powershellscripts\computerlist_ref.txt
    Remove-Item c:\powershellscripts\serverlist_ref.txt
    Rename-Item c:\powershellscripts\computerlist_diff.txt computerlist_ref.txt
    Rename-Item c:\powershellscripts\serverlist_diff.txt serverlist_ref.txt
    ",,False,,t5_2qo1o,False,,,True,t3_so2jz,http://www.reddit.com/r/PowerShell/comments/so2jz/help_tweaking_script_reporting/,
1333069727.0,8,csharpening.net,rk6tm,What Compiled PowerShell Might Look Like,8,0,0,http://www.reddit.com/r/PowerShell/comments/rk6tm/what_compiled_powershell_might_look_like/,,,False,,t5_2qo1o,False,,,False,t3_rk6tm,http://csharpening.net/?p=1023,
1328449433.0,7,self.PowerShell,pbt8r,Powershell Remoting and WinRM service,9,2,11,http://www.reddit.com/r/PowerShell/comments/pbt8r/powershell_remoting_and_winrm_service/,"I am hoping to get some more information on Powershell remoting. From what I can tell enabling the WinRM service opens port 80 on client machines and creates a listener. What are the security implications for this? I am working on a government contract and am restricted by USGCB policy for desktop computers. 

Are there any solid documentation sites that walk through all of the configuration options when setting up PS remoting? Also for those of you using PS remoting is it worth the pain of setting up? Right now I am just using SCCM to deploy scripts/commands as needed. However it would be nice to be able to use powershell remoting for things that don't need to run across an entire collection.

Thanks for any advice you can provide.",,False,,t5_2qo1o,False,,,True,t3_pbt8r,http://www.reddit.com/r/PowerShell/comments/pbt8r/powershell_remoting_and_winrm_service/,
1321008333.0,9,self.PowerShell,m8khc,Two functions: Get-SIDfromUser and Get-UserFromSID,9,0,6,http://www.reddit.com/r/PowerShell/comments/m8khc/two_functions_getsidfromuser_and_getuserfromsid/,"I found myself needing to do this a few times in the past couple of weeks so I added these to my powershell profile.

#Usage:	Get-SIDFromUser *username* or *""Domain\username""*

    function Get-SIDFromUser ($user)	{
    	$objAdUser = New-Object System.Security.Principal.NTAccount($user)
    	$strSID = $objAdUser.Translate([System.Security.Principal.SecurityIdentifier])
    	$strSID.value
    					}

#Usage: Get-UserFromSID *SID*

    function Get-UserFromSID ($SID)	{
    	$objADUser = New-Object System.Security.Principal.SecurityIdentifier($SID)
    	$strName = $objAdUser.Translate([System.Security.Principal.NTAccount])	 
    	$strSID.value
   				}


Edited for formatting.

Edit 2: Removed ""write-host"", thanks to oylenshpeegul.",,False,,t5_2qo1o,True,,,True,t3_m8khc,http://www.reddit.com/r/PowerShell/comments/m8khc/two_functions_getsidfromuser_and_getuserfromsid/,
1317657256.0,9,self.PowerShell,kzg2y,Taking a class spent an hour and a half trying to make this work... what am I doing wrong,10,1,7,http://www.reddit.com/r/PowerShell/comments/kzg2y/taking_a_class_spent_an_hour_and_a_half_trying_to/,"    $temp1 = read-host ""enter temp1""
    $temp2 = read-host ""enter temp2""
    $temp3 = read-host ""enter temp3""

    $sum = ($temp1 + $temp2 + $temp3)

if you give the first variables numbers  2, 4 , 6  $sum comes out as 246   

what am I doing wrong?

edit: nvm, figured it out.. boned myself on that exam LOL
",,False,,t5_2qo1o,True,,,True,t3_kzg2y,http://www.reddit.com/r/PowerShell/comments/kzg2y/taking_a_class_spent_an_hour_and_a_half_trying_to/,
1315281224.0,8,gallery.technet.microsoft.com,k61ur,List available WMI Methods,8,0,0,http://www.reddit.com/r/PowerShell/comments/k61ur/list_available_wmi_methods/,,,False,,t5_2qo1o,False,,,False,t3_k61ur,http://gallery.technet.microsoft.com/scriptcenter/Get-available-WMI-methods-f1574c22,
1314311769.0,8,self.PowerShell,jui6i,Quick and dirty Add/Remove Programs batch uninstaller.,8,0,2,http://www.reddit.com/r/PowerShell/comments/jui6i/quick_and_dirty_addremove_programs_batch/,"[Script](http://pastebin.com/0sYGf6Pw)


This will let you search for a list of programs or let you choose multiple items from a list which will then be silently uninstalled.

Run the script with admin privileges and you shouldn't get any prompts with the /qn switch.  Just type msiexec into your run menu to see all available uninstall options. 

As an aside, does anyone know how to get a list of all programs installed, not just ones installed with the windows installer?",,False,,t5_2qo1o,True,,,True,t3_jui6i,http://www.reddit.com/r/PowerShell/comments/jui6i/quick_and_dirty_addremove_programs_batch/,
1309007895.0,7,self.PowerShell,i8vyz,Run powershell scripts on servers remotely without opening up ports?,8,1,13,http://www.reddit.com/r/PowerShell/comments/i8vyz/run_powershell_scripts_on_servers_remotely/,"Hey guys. I'm totally new to powershell. We have a script that takes certain activities in event viewer and generates and txt output that we can use later. I'd like to be able to remotely activate this script on demand, as opposed to setting it up as a scheduled task. However, as I'm reading it looks like I may need to open up HTTP/HTTPS port 5985/5986. Since we are in a production environment, opening up those ports might be a pain. Any advice?",,False,,t5_2qo1o,False,,,True,t3_i8vyz,http://www.reddit.com/r/PowerShell/comments/i8vyz/run_powershell_scripts_on_servers_remotely/,
1307760397.0,9,self.PowerShell,hwvwx,What are some things PowerShell can't do?,9,0,39,http://www.reddit.com/r/PowerShell/comments/hwvwx/what_are_some_things_powershell_cant_do/,"What are the stuff PowerShell can not do, or the stuff you are better of using another tool for it?
I am doing a school project about PS and Active Directory PS cmdlest and for the conclusion I want to present the pros and cons of using PS fot administration of AD. I am familiar with the pros, but my googling skills seem to fail me for the cons part.",,False,,t5_2qo1o,False,,,True,t3_hwvwx,http://www.reddit.com/r/PowerShell/comments/hwvwx/what_are_some_things_powershell_cant_do/,
1307377687.0,7,simple-talk.com,hsy2s,Introduction to PowerShell Modules,8,1,1,http://www.reddit.com/r/PowerShell/comments/hsy2s/introduction_to_powershell_modules/,,,False,,t5_2qo1o,False,,,False,t3_hsy2s,http://www.simple-talk.com/sysadmin/powershell/an-introduction-to-powershell-modules/,
1306735823.0,8,self.PowerShell,hnb10,Word 2007/2010 Functions?,8,0,4,http://www.reddit.com/r/PowerShell/comments/hnb10/word_20072010_functions/,"Does anyone have any functions for writing to Word documents? I've written one that will insert a page break at the end of a Word document, and I have one that will insert ""Header"" text, what I'm looking for is things like insert a table (like the results of Get-Process for instance), create a new document, append text to an existing document, create a table of contents based on ""Header"" sections, write a custom footer, things like that.

I'm not afraid to take the time to write my own, but the COM object model for Word SUCKS to put it bluntly, and the documentation for said COM object SUCKS more (at least when it comes to using it in PowerShell). I've found a couple modules for this discussed on the internet, but after tracking them down, apparently the author never released them.",,False,,t5_2qo1o,False,,,True,t3_hnb10,http://www.reddit.com/r/PowerShell/comments/hnb10/word_20072010_functions/,
1306285030.0,10,powergui.org,hjdc4,Download PowerGUI Pro 3.0 Public Beta,12,2,1,http://www.reddit.com/r/PowerShell/comments/hjdc4/download_powergui_pro_30_public_beta/,,,False,,t5_2qo1o,False,,,False,t3_hjdc4,http://www.powergui.org/entry.jspa?externalID=3523&amp;categoryID=299,
1306250693.0,9,self.PowerShell,hiy8j,HOWTO: Simple script to perform a file action with error checking and email the results ,9,0,4,http://www.reddit.com/r/PowerShell/comments/hiy8j/howto_simple_script_to_perform_a_file_action_with/,"Here's a simple (*very* simple) script I put together to move a file or files from one location to another and email the results. I'm going from C:\Source on server1 to C:\Dest on server2. Hopefully someone here will learn something useful from it. 

Edit: Copy and paste this into ISE or whatever you use so it color codes it. Looks like arse here. :) 


~~|||||||||||||||||||||||||||||||||||||||||~~


    *# Get directory contents to include in email and set a variable with the list for the email*

        $files = Get-ChildItem -path \\server1\c$\Source

        $content = ""The script moved the following file(s):`r`r $files""


    *# Move the file or files and set the error variable if there's a problem*

        Move-Item \\server1\c$\Source\* \\server2\c$\Dest\ -ErrorVariable moveerror


    *# Error checking - I'll explain each line....*

    *# If the $files variable set above is empty or if the moveerror variable is set, there's a problem, so set the email subject as such. Otherwise set it with something positive.*

        if ((!$files ) -or ($moveerror)) { $subj = ""Error copying file"" }

        else { $subj = ""File Move Successful"" }



    *# If the problem is the $files var is empty, return a ""no files found"" message. If it's a moveerror, return the file already exists (see below). Otherwise set the file copied successfully.*

        if (!$files) { $body = ""No file was found in the directory."" }

        elseif ($moveerror) { $body = ""The file ($files) already exists in target directory."" }

        else { $body = ""The following file was moved to the target directory: $files"" }


    *# Email results to specified recipients*

        $shortdate = get-date -format g

        $smtpServer = ""10.10.10.25""

        $msg = new-object Net.Mail.MailMessage

        $smtp = new-object Net.Mail.SmtpClient($smtpServer)

        $msg.From = ""FileCopy@atlantafalcons.com""

        $msg.To.Add(""ronmexico@atlantafalcons.com"")


        $msg.Subject = ""$subj - $shortdate""

        $msg.Body = ""$body""


        $smtp.Send($msg)


~~|||||||||||||||||||||||||||||||||||||||||~~


The only part I still need to flesh out is the moveerror check. I think you can use that to return other errors (like bad destination path for example), but I haven't worked it all out yet. ",,False,,t5_2qo1o,True,,,True,t3_hiy8j,http://www.reddit.com/r/PowerShell/comments/hiy8j/howto_simple_script_to_perform_a_file_action_with/,
1376588522.0,7,self.PowerShell,1kfjdi,"Generate a ""test group"" of random users",7,0,0,http://www.reddit.com/r/PowerShell/comments/1kfjdi/generate_a_test_group_of_random_users/,"Thought that this might be useful script for others. I am trying to be better at change management, and generating AD groups to use for testing changes is one of the steps I am taking. I hacked together this today--I am sure many improvements are possible, but it seemed useful as is. This script lets you choose a single, random user from a list of departments, and places the random users in a new group (with a name you are prompted for).

Save this file as generate-test.ps1 and place a second file which has a list of AD groups that you want to select from in c:\depts.txt"". You will also need to update the OU variable to point to the OU you want the new group placed in.


    #########################################
    #	generate-test.ps1
    #	Generate a test user group, with representation from each unit
    #	Prompt for new group name at command line
    #
    #########################################
    
    ###################################
    # Variables
    
    $unitsPath = ""c:\depts.txt""
    
    $ouForNewGroup = ""OU=Test Groups,OU=Groups,DC=domain,DC=local""
    
    ###################################
    # Initialize variables
    $units = get-content $unitsPath
    
    ###################################
    # Functions
    
    ########################################
    # Return a single, random user from the selected AD group
    # $groupName is samAccountName, SID, or DN
    function selectRandomGroupMember($groupName) {
    	
    	$group = get-adgroup $groupName
    	
    	$groupMembers = get-aduser -filter {(memberof -eq $group.distinguishedName) -and (enabled -eq $true)}
    	
    	$rand = new-object System.Random
    	
    	$user = $groupMembers[$rand.Next(0, $groupMembers.Count)]
    	
    	return $user
    }
    
    ##################################
    # Generate a list of users, one from each group provided
    # groupList should be an array of group samAccountNames, SIDs, or distinguished names
    # return type: array of user objects
    function randomUserList($groupList) {
    	$users = @()
    	foreach ($group in $groupList) {
    		$users += selectRandomGroupMember($group)
    	}
    	return $users
    }
    
    function createGroup($groupName, $ou, $groupMembers) {
    	new-adgroup -path $ou -name $groupName -samAccountName $groupName -GroupScope ""Global""
    	$group = get-adgroup $groupName
    	
    	add-adgroupmember $group -members $groupMembers
    }
    
    ###################################
    # Program execution
    write-host ""This script will create a new test group with one randomly selected user per department.""
    $groupName = read-host ""Name of test group""
    
    $groupMembers = randomUserList($units)
    
    createGroup -groupName $groupName -OU $ouForNewGroup -groupMembers $groupMembers
    
    write-host ""Newly created group has been named"" $groupName ""and will be placed in the OU"" $ouForNewGroup
    
    write-host ""Group Members are""
    get-adgroupmember $groupName | select SamAccountName, Name | ft",,False,,t5_2qo1o,False,,,True,t3_1kfjdi,http://www.reddit.com/r/PowerShell/comments/1kfjdi/generate_a_test_group_of_random_users/,
1376396734.0,5,self.PowerShell,1k9v4i,netsh replacement in powershell?,7,2,14,http://www.reddit.com/r/PowerShell/comments/1k9v4i/netsh_replacement_in_powershell/,"Has anyone found a proper object/cmdlet for powershell that replaces netsh without actually calling netsh in the background? Because that I can do already. I want either a clean (com-)object or a MS written cmdlet for it.

Tho I would prefer it to work for Powershell v2 ...

Target OS level is 2008+

Management OS is Win7 32-bit",[Core],False,,t5_2qo1o,1376396919.0,,,True,t3_1k9v4i,http://www.reddit.com/r/PowerShell/comments/1k9v4i/netsh_replacement_in_powershell/,
1376203822.0,8,self.PowerShell,1k4tgu,Looking for help with https://mblogin.verizonwireless.com/amserver/UI/Login so I can download my users cell phone information as objects,9,1,9,http://www.reddit.com/r/PowerShell/comments/1k4tgu/looking_for_help_with/,"I've tried various techniques and nothing will let me log in.  I know the site is xml, uses javascript and cookies, and sends the login information to a third party site. Could someone point me to some very in-depth articles about decyphering website logins and how to create a Invoke-RestMethod, Invoke-Webrequest, or etc.?  I've also used fiddler2 to capture web traffic.  Thanks in advance.",,False,,t5_2qo1o,False,,,True,t3_1k4tgu,http://www.reddit.com/r/PowerShell/comments/1k4tgu/looking_for_help_with/,
1375726193.0,7,self.PowerShell,1jr5ql,Getting Windows product keys?,10,3,10,http://www.reddit.com/r/PowerShell/comments/1jr5ql/getting_windows_product_keys/,"So I'm wondering if there's a way to get the Windows Product key on a system using Powershell.  I've been messing with the script [here](http://learn-powershell.net/2012/05/04/updating-an-existing-get-productkey-function/) but it doesn't grab the correct keys (unless Dell OEM machines ship with the same keys in the BIOS on several systems).

Is this something that can be grabbed/decoded, and if so how might I go about doing it?",,False,,t5_2qo1o,False,,,True,t3_1jr5ql,http://www.reddit.com/r/PowerShell/comments/1jr5ql/getting_windows_product_keys/,
1375631721.0,6,self.PowerShell,1jomzm,Learning resources for PowerShell?,7,1,11,http://www.reddit.com/r/PowerShell/comments/1jomzm/learning_resources_for_powershell/,I've been using codeacademy for a while now and find it to be a great method for learning (python spec.)  Is there anything similar available for powershell?,,False,,t5_2qo1o,1375632190.0,,,True,t3_1jomzm,http://www.reddit.com/r/PowerShell/comments/1jomzm/learning_resources_for_powershell/,
1375572530.0,8,learn-powershell.net,1jngzu,PowerShell and Events: WMI Temporary Event Subscriptions,9,1,0,http://www.reddit.com/r/PowerShell/comments/1jngzu/powershell_and_events_wmi_temporary_event/,,,False,,t5_2qo1o,False,,,False,t3_1jngzu,http://learn-powershell.net/2013/08/02/powershell-and-events-wmi-temporary-event-subscriptions/,
1374846583.0,8,self.PowerShell,1j3h6x,[Script Help] Get disabled users in groups other than Domain Users,9,1,6,http://www.reddit.com/r/PowerShell/comments/1j3h6x/script_help_get_disabled_users_in_groups_other/,"Need to have a script that will compile all disabled users in the Employee container, see what groups they are in, and if they are in a group other than Domain Users, email the list of names. What I have so far is only returning the groups for last user found... I'm unsure of what else to do since the foreach loop should get each user as it's own variable. 


&gt;$disabled = (Get-QADUser -disabled -SearchRoot 'OU=Employees,OU=Users,OU=Company,DC=CompanyDomain,DC=net' | foreach {$_.Name}) 
&gt;$cmd = foreach ($username in $disabled)
&gt;{Get-QADGroup -SearchRoot 'OU=Groups,OU=Company,DC=CompanyDomain,DC=net' -ContainsMember $username | foreach {$_.Name}}
&gt;$action = Foreach ($group in $cmd)  {Write-Host $username in $group}  
 




",,False,,t5_2qo1o,False,,,True,t3_1j3h6x,http://www.reddit.com/r/PowerShell/comments/1j3h6x/script_help_get_disabled_users_in_groups_other/,
1374202340.0,7,self.PowerShell,1ilurw,HTML GUI user input for script,7,0,4,http://www.reddit.com/r/PowerShell/comments/1ilurw/html_gui_user_input_for_script/,"I've been doing some google-fu with out much luck.  I've found lots of HTA stuff, but I'm looking to host a site on an intranet and have users access.  I did find [a site using ASP.NET](http://devinfra-us.blogspot.com/2011/02/using-powershell-20-from-aspnet-part-1.html) which was hopeful but was not complete enough.  Any one else have any experience with this or could point me in the right direction?

For an example of what I'd like to accomplish would have a text field to input a computer name and a drop down list of services, put the two together to restart the service on the remote computer.",,False,,t5_2qo1o,False,,,True,t3_1ilurw,http://www.reddit.com/r/PowerShell/comments/1ilurw/html_gui_user_input_for_script/,
1373388366.0,7,virtu-al.net,1hxzri,Keeping up on blogs with PowerShell,9,2,0,http://www.reddit.com/r/PowerShell/comments/1hxzri/keeping_up_on_blogs_with_powershell/,,,False,,t5_2qo1o,False,,,False,t3_1hxzri,http://www.virtu-al.net/2013/07/08/keeping-up-on-blogs-with-powershell/,
1372638939.0,6,mattblogsit.com,1he8xr,PowerShell v4 Desired State Configuration Overview,7,1,0,http://www.reddit.com/r/PowerShell/comments/1he8xr/powershell_v4_desired_state_configuration_overview/,,,False,,t5_2qo1o,False,,,False,t3_1he8xr,http://mattblogsit.com/windows/powershell-v4-desired-state-configuration-deep-dive,
1371743403.0,6,gallery.technet.microsoft.com,1gqeby,Bean Counter - An Exchange Transaction Log File growth report,8,2,3,http://www.reddit.com/r/PowerShell/comments/1gqeby/bean_counter_an_exchange_transaction_log_file/,,,False,,t5_2qo1o,False,,,False,t3_1gqeby,http://gallery.technet.microsoft.com/exchange/Bean-Counter-An-Exchange-41448e46,
1370974304.0,9,self.PowerShell,1g4xlf,Need help with Foreach-Parallel,10,1,18,http://www.reddit.com/r/PowerShell/comments/1g4xlf/need_help_with_foreachparallel/,"I'm using Foreach-Parallel found at this link...

http://technet.microsoft.com/en-us/library/jj713711.aspx

I added the fuction then wanted to get the mailbox count of 177 databases (all exchange 2010).  Using a foreach collection method takes about 20 mins to complete.  Here is what i have been using....

foreach ($database in $databases) {write-host $database (Get-Mailbox -database $database.name -ResultSize unlimited -WarningAction silentlycontinue).count}

after reading the foreach-paralell info and the help file, including the examples, i came up with this...

foreach-parallel -throttle 20 -inputobject $databases -scriptblock {{write-host $database (Get-Mailbox -database $database.name -ResultSize unlimited -WarningAction silentlycontinue).count}}

that line will run and complete in about 20 seconds but i get no output.  Being as i am new at this function and i'm not sure how it works any help would be great!!


EDIT: I have gotten it to work using a different function so I'll share it here... http://www.reddit.com/r/PowerShell/comments/1g4xlf/need_help_with_foreachparallel/cakz60w
",,False,,t5_2qo1o,1371522617.0,,,True,t3_1g4xlf,http://www.reddit.com/r/PowerShell/comments/1g4xlf/need_help_with_foreachparallel/,
1370701575.0,8,self.PowerShell,1fxdf1,fastest way to distribute a file(s) to thousands of Windows 7 boxes,8,0,23,http://www.reddit.com/r/PowerShell/comments/1fxdf1/fastest_way_to_distribute_a_files_to_thousands_of/,"Seeking advice. I'm looking for the fastest way to distribute file(s) or folders to approx 5000 windows 7 devices.  I'm essentially looking how to mimic the functionality of Windows Server DFS but for windows 7 devices. Tinkered with SCCM but it uses BITS and isn't fast enough.  So now i'm wondering if powershell is up to the task.  

So two parts: Anyone have any luck with not only a multithreaded file copy with jobs but also creating a single powershell script that is distributed amongst many servers that will partition the request and execute a task?

I'm thinking of a central powershell script that partitions the work writes to the slave servers that actually do the task with their subset of machines (avoiding double hop credential issues).  

Or would it just be easier to just use PS jobs and instantiate thousands of Robocopy instances?  

*EDIT
Thanks for your suggestions, and it appears you all have solved the problem using the standard platform tooling.

I guess I should give some background, these are all kiosk devices with possible slow/non-reliable circuits and some devices. So that's why sometimes these tools underperfom.  These are all critical devices and in a pinch I was looking for on-demand parallel execution of file transfer that could happen within 10 minutes to all devices for a file under 1 mb.

Your suggestions are solid with SCCM, GPO, DFS but wondering if there was a faster way with more distribution and parallelism using powershell.  It seems that powershell would be a perfect option for it's flexibility to handle varying distribution needs.

Or maybe i'm just not using the tools correctly.  I'll do some more trials.",,False,,t5_2qo1o,1370707975.0,,,True,t3_1fxdf1,http://www.reddit.com/r/PowerShell/comments/1fxdf1/fastest_way_to_distribute_a_files_to_thousands_of/,
1370594180.0,7,leeholmes.com,1funz8,Removing Insecure Wireless Connections with PowerShell,9,2,0,http://www.reddit.com/r/PowerShell/comments/1funz8/removing_insecure_wireless_connections_with/,,,False,,t5_2qo1o,False,,,False,t3_1funz8,http://www.leeholmes.com/blog/2013/06/06/removing-insecure-wireless-connections-with-powershell/,
1370309995.0,8,csharpening.net,1fmft5,Getting Physical with PowerShell,8,0,0,http://www.reddit.com/r/PowerShell/comments/1fmft5/getting_physical_with_powershell/,,,False,,t5_2qo1o,False,,,False,t3_1fmft5,http://csharpening.net/?p=1646,
1369938893.0,7,self.PowerShell,1fcoob,Get example first line of log messages by event ID,7,0,4,http://www.reddit.com/r/PowerShell/comments/1fcoob/get_example_first_line_of_log_messages_by_event_id/,"I just wanted to share this.

I needed to know what event IDs were common on my server, and what the first 
line of a typical message might look like for each of these event IDs.

A typical Get-EventLog cmdlet, filtered through Group-Object, will get you most
of the way there.  What it's missing is the first line of a message:

    PS C:\&gt; get-eventlog security | group InstanceId | ft -auto

    Count Name Group
    ----- ---- -----
     4183 4719 {System.Diagnostics.EventLogEntry, System.Diagnostics.EventLogEnt...
    11459 4689 {System.Diagnostics.EventLogEntry, System.Diagnostics.EventLogEnt...
    11704 4688 {System.Diagnostics.EventLogEntry, System.Diagnostics.EventLogEnt...
      866 4624 {System.Diagnostics.EventLogEntry, System.Diagnostics.EventLogEnt...
     1940 4648 {System.Diagnostics.EventLogEntry, System.Diagnostics.EventLogEnt...
      484 4611 {System.Diagnostics.EventLogEntry, System.Diagnostics.EventLogEnt...

So what I ended up doing is breaking out the first entry of each group and 
displaying its first line.

    $logSource = 'Security'
    Get-EventLog $logSource | 
        group InstanceId | 
        % { 
            $count = $_.count
            $_.group[0] | 
                select `
                    InstanceID, `
                    @{name='Count'; exp={$count}}, `
                    @{name='Message'; exp={($_.Message -split ""`n"")[0]}}
        } | 
        sort InstanceId | 
        ft -auto

(If you want to look at a log other than the security log, change the logSource
variable in the first line.)

Some example results:

    InstanceId Count Message
    ---------- ----- -------
          4624   866 An account was successfully logged on....
          4625    35 An account failed to log on....
          4634   700 An account was logged off....
          4647   439 User initiated logoff:...
          4648  1940 A logon was attempted using explicit credentials....
",,False,,t5_2qo1o,False,,,True,t3_1fcoob,http://www.reddit.com/r/PowerShell/comments/1fcoob/get_example_first_line_of_log_messages_by_event_id/,
1369613542.0,7,self.PowerShell,1f3x8w,Creating OUs with Powershell,7,0,13,http://www.reddit.com/r/PowerShell/comments/1f3x8w/creating_ous_with_powershell/,"Hello Everyone:

I could use a bit of a hand: I am trying to automate the process of OU creation using Powershell. 

**Problem:**      I am able to create a base OU named Managed Objects and place a sub OU under Managed Objects, but I can not place any OUs under my Managed Objects sub OU.

How can achieve this using something like: New-ADOrganizationalUnit -Name ""Tax Prep"" -Path ""ou=Managed Objects,dc=$StrDCName,dc=$StrDCSuffix""

**I tried doing:** New-ADOrganizationalUnit - Name ""Workstations"" -Path ""ou=Managed Objects, ou=Tax Prep,dc=$StrDCName,dc=$StrDCSuffix but that did not seem to work.


**$StrDCName and $DCSuffix reference vars**",,False,,t5_2qo1o,False,,,True,t3_1f3x8w,http://www.reddit.com/r/PowerShell/comments/1f3x8w/creating_ous_with_powershell/,
1368163661.0,8,pastebin.com,1e1xj4,Looking for a critique on my user creation script!,8,0,6,http://www.reddit.com/r/PowerShell/comments/1e1xj4/looking_for_a_critique_on_my_user_creation_script/,,,False,,t5_2qo1o,False,,,False,t3_1e1xj4,http://pastebin.com/1LBxQzE7,
1368051541.0,6,learn-powershell.net,1dym8b,Tips on Implementing Pipeline Support,8,2,0,http://www.reddit.com/r/PowerShell/comments/1dym8b/tips_on_implementing_pipeline_support/,,,False,,t5_2qo1o,False,,,False,t3_1dym8b,http://learn-powershell.net/2013/05/07/tips-on-implementing-pipeline-support/,
1366992717.0,6,self.PowerShell,1d5sy5,Clearing out home directory and home drive in active directory,9,3,4,http://www.reddit.com/r/PowerShell/comments/1d5sy5/clearing_out_home_directory_and_home_drive_in/,"I'm moving all my personal drive maps over to a group policy preference based on group membership, and I need a much faster way to clear out these settings in AD rather than going in one by one.

I've tried this script with no luck.. I know it's just a parameter tweak but the technet page wasn't much help and I can't find anything like this on google.

    Import-Module activedirectory
    $users = get-adgroupmember -identity ""PersonalDriveMap""
    foreach($user in $users) {
    SET-ADUSER -Identity $User.name -HomeDirectory """" -HomeDrive """" }

As you can see I am just grabbing all the members that are in the group that is to be mapped with GP, and trying to erase out any settings that are currently there.  Anyone know the correct method?

Thanks!",,False,,t5_2qo1o,False,,,True,t3_1d5sy5,http://www.reddit.com/r/PowerShell/comments/1d5sy5/clearing_out_home_directory_and_home_drive_in/,
1366896405.0,8,self.PowerShell,1d2x8j,Converting an IP Address into an integer using HEX,10,2,10,http://www.reddit.com/r/PowerShell/comments/1d2x8j/converting_an_ip_address_into_an_integer_using_hex/,"I need to create a function that will turn an IP address into an integer. (it's weird I know)

I have a function that converts from integer to IP address. This works fine.

An example of this would be:

*First value received: -567235574

*Convert it to hex: de30ac0a

*segment it into four: de 30 ac 0a

*convert each segment to decimal: 222 48 172 10

*The last segment is the first segment of the ip address so swap it all around and add a few periods for readability: 10.172.48.222



I need to do the reverse of this which would be:

*Remove formatting and segment: 10 172 48 222

*convert to hex: 0a ac 30 de

*swap it back around: de 30 ac 0a

*press it into one: de30ac0a

*convert to decimal: -567235574


The function I have made for this does not seem to work, when I try to convert a decimal number to hexadecimal it remains in decimal. I'm probably doing something wrong as I'm fairly new to PowerShell.

This is my function:

        function Compress-IPAddress
        {
        param([parameter(Position=0,Mandatory=$TRUE)][string]$IPAddress)
            if(!$IPAddress.Contains('.')) {Write-error -Message ""Not a valid IP Address"" -RecommendedAction ""please use periods to denote each section of the ip address""; Return}

            $splitIP = @($IPAddress.Split('.'))
            for($i = 0; $i -lt 4; $i++)
            {$splitIP[$i] = ""{0:x2}"" -f $SplitIP[$i]}
            $IPHEX = ""$($SplitIP[3])$($SplitIP[2])$($SplitIP[1])$($SplitIP[0])""
            $CompIP = [int](""0x$IPHEX"")
    
            Return $CompIP
        }

At the moment I get an error of :
&gt;Cannot convert value ""0x2224817210"" to type ""System.Int32"". Error: ""Value was either too large or too small for a UInt32.""""

I can see this is because the numbers haven't been converted to hex though I am unsure why. Any help with this would be greatly appreciated.


For those interested, this is the other function (probably badly written too but it works):

        function Expand-IPAddress
        {
            Param([parameter(Position=0,Mandatory=$TRUE)][int]$Number)
            $ipHEX = [string]::Format(""{0:x}"",$Number)
            $SplitHEX = @()
            for($i = 0; $i -lt 4; $i++)
                {
                $SplitHEX = $SplitHEX + ""0x$($ipHEX.substring(($i*2),2))""
                Write-Verbose ""Segment $i: $($SplitHEX[$i])""
                }
            Return ""$([int]$SplitHEX[3]).$([int]$SplitHEX[2]).$([int]$SplitHEX[1]).$([int]$SplitHEX[0])""
        }

Thanks",,False,,t5_2qo1o,1366896599.0,,,True,t3_1d2x8j,http://www.reddit.com/r/PowerShell/comments/1d2x8j/converting_an_ip_address_into_an_integer_using_hex/,
1365097349.0,8,self.PowerShell,1bo9gw,Is there a list of PowerShell methods and their description anywhere?,8,0,9,http://www.reddit.com/r/PowerShell/comments/1bo9gw/is_there_a_list_of_powershell_methods_and_their/,"Here is my current list, but it clearly doesn't tell me what they do.  Can anyone help?

Clone            Method                System.Object Clone()                                                           
CompareTo        Method                int CompareTo(System.Object value), int CompareTo(string strB)                  
Contains         Method                bool Contains(string value)                                                     
CopyTo           Method                System.Void CopyTo(int sourceIndex, char[] destination, int destinationIndex,...
EndsWith         Method                bool EndsWith(string value), bool EndsWith(string value, System.StringCompari...
Equals           Method                bool Equals(System.Object obj), bool Equals(string value), bool Equals(string...
GetEnumerator    Method                System.CharEnumerator GetEnumerator()                                           
GetHashCode      Method                int GetHashCode()                                                               
GetType          Method                type GetType()                                                                  
GetTypeCode      Method                System.TypeCode GetTypeCode()                                                   
IndexOf          Method                int IndexOf(char value), int IndexOf(char value, int startIndex), int IndexOf...
IndexOfAny       Method                int IndexOfAny(char[] anyOf), int IndexOfAny(char[] anyOf, int startIndex), i...
Insert           Method                string Insert(int startIndex, string value)                                     
IsNormalized     Method                bool IsNormalized(), bool IsNormalized(System.Text.NormalizationForm normaliz...
LastIndexOf      Method                int LastIndexOf(char value), int LastIndexOf(char value, int startIndex), int...
LastIndexOfAny   Method                int LastIndexOfAny(char[] anyOf), int LastIndexOfAny(char[] anyOf, int startI...
Normalize        Method                string Normalize(), string Normalize(System.Text.NormalizationForm normalizat...
PadLeft          Method                string PadLeft(int totalWidth), string PadLeft(int totalWidth, char paddingChar)
PadRight         Method                string PadRight(int totalWidth), string PadRight(int totalWidth, char padding...
Remove           Method                string Remove(int startIndex, int count), string Remove(int startIndex)         
Replace          Method                string Replace(char oldChar, char newChar), string Replace(string oldValue, s...
Split            Method                string[] Split(Params char[] separator), string[] Split(char[] separator, int...
StartsWith       Method                bool StartsWith(string value), bool StartsWith(string value, System.StringCom...
Substring        Method                string Substring(int startIndex), string Substring(int startIndex, int length)  
ToCharArray      Method                char[] ToCharArray(), char[] ToCharArray(int startIndex, int length)            
ToLower          Method                string ToLower(), string ToLower(System.Globalization.CultureInfo culture)      
ToLowerInvariant Method                string ToLowerInvariant()                                                       
ToString         Method                string ToString(), string ToString(System.IFormatProvider provider)             
ToUpper          Method                string ToUpper(), string ToUpper(System.Globalization.CultureInfo culture)      
ToUpperInvariant Method                string ToUpperInvariant()                                                       
Trim             Method                string Trim(Params char[] trimChars), string Trim()                             
TrimEnd          Method                string TrimEnd(Params char[] trimChars)                                         
TrimStart        Method                string TrimStart(Params char[] trimChars)                                       
Chars            ParameterizedProperty char Chars(int index) {get;}                                                    
Length           Property              System.Int32 Length {get;}   ",,False,,t5_2qo1o,False,,,True,t3_1bo9gw,http://www.reddit.com/r/PowerShell/comments/1bo9gw/is_there_a_list_of_powershell_methods_and_their/,
1363199130.0,7,self.PowerShell,1a8ac6,Irritating extra space at end of every line in mail body when creating a draft,9,2,16,http://www.reddit.com/r/PowerShell/comments/1a8ac6/irritating_extra_space_at_end_of_every_line_in/,"I've written a number of scripts to automate user imports in 3rd party systems.  In those scripts, I also automate providing the user their credentials by generating an email draft using Outlook.

For whatever reason,  the draft keeps having additional space at the end of every line, and when a user goes to copy/paste the credentials for the app, it copies the extra space.  This results in a number of emails from the users saying their credentials don't work.

I've tried a number of things, but I'm not able to figure out WHY it's adding the extra space so far.  I know for certain that the $variables I'm using do not have spaces since I'm logging in the script pretty heavily - it seems 100% related to either the outlook-portion of the script OR outlook is doing some jiggery itself.

    $ol = New-Object -comObject Outlook.Application
    $mail = $ol.CreateItem(0)
    $mail.To = $email
    $mail.Subject = ""Application account for $name : $username""
    $mail.Body = ""Hello $name,
    A user ID for Application has been created for you.  Please use the following credentials to access the environment:

    URL:        $url
    Username:   $username
    Password:   $password

    If you believe you are missing access to anything let me know.

    Thank you,

    BattleChicken
    Workplace IT""
    $mail.save()

All I know for certain, so far, is that it isn't $OFS related, (setting $OFS="""" does nothing); manually adding `r, `n, `, or `r`n to the lines I really care about doesn't help; assigning the whole body to a string variable first changes nothing; and nobody else seems to be complaining about this on the net.

I suspect it might have something to do with the multi-line string or the encoding of the message (i may see if i can figure out how to send as HTML/force plaintext later on), but I can't confirm either thing currently.  Anyone have ideas what might explain the extra space?",,False,,t5_2qo1o,False,,,True,t3_1a8ac6,http://www.reddit.com/r/PowerShell/comments/1a8ac6/irritating_extra_space_at_end_of_every_line_in/,
1363108072.0,6,self.PowerShell,1a5mxp,"New to powershell, would like probably too much help with a project for work:  Script for Sdelete to delete files older than 24 hours.",12,6,17,http://www.reddit.com/r/PowerShell/comments/1a5mxp/new_to_powershell_would_like_probably_too_much/,"I have been tasked to write a PowerShell Script that will:

Use SDelete to delete files in a directory that are older than 24 hours. 

This will be scheduled to run daily or multiple times a day with Windows task scheduler. 

So far I haven't even been able to get Sdelete to run in powershell.  But it will run from cmd. 

I've been trying to watch some video's online on powershell and recently started looking into some example scripts on here and other places which are helping.  Any advice would be much appreciated.",,False,,t5_2qo1o,False,,,True,t3_1a5mxp,http://www.reddit.com/r/PowerShell/comments/1a5mxp/new_to_powershell_would_like_probably_too_much/,
1362868057.0,7,self.PowerShell,19zqd6,How Do I Join Several Outputs into One CSV?,9,2,4,http://www.reddit.com/r/PowerShell/comments/19zqd6/how_do_i_join_several_outputs_into_one_csv/,"I am trying to track growth of a transactions logs per hour to isolate a problem.  I can cheat since I know each file is 1MB (Exchange 2010 transaction logs)

The stripped down code right now is:

    $DB1 = get-childitem d:\DatabaseDir\*.log |Group {$_.LastWriteTime.ToString(""yyyy-MM-dd HH"")} |Sort Name |Select Name,Count |Out-String

    $DB2 = get-childitem d:\DatabaseDir2\*.log |Group {$_.LastWriteTime.ToString(""yyyy-MM-dd HH"")} |Sort Name |Select Name,Count |Out-String

    $DB1 would show:
    Name                      Count
    2013-03-09 14            623
    2013-03-09 15            723

    $DB2 would show:
    Name                      Count
    2013-03-09 14            555
    2013-03-09 15            655


What I would to end up with is:

    HOUR                         DB1    DB2
    2013-03-09 14            623     555
    2013-03-09 15            723     655


I am looking for an easy way to turn each of these strings/arrays into one string/array.  

Note:  the out-string is because I am using the those variables in the body of an email
",,False,,t5_2qo1o,1362868948.0,,,True,t3_19zqd6,http://www.reddit.com/r/PowerShell/comments/19zqd6/how_do_i_join_several_outputs_into_one_csv/,
1362429794.0,6,self.PowerShell,19nqmn,Post Imaging Powershell Script,7,1,12,http://www.reddit.com/r/PowerShell/comments/19nqmn/post_imaging_powershell_script/,"I have a program that needs elevated credentials to run after a computer is Imaged. I use MDT to deploy the image, and to run the powershell script with the execution policy bypassed since it's a fresh machine.

The idea is to create a scheduled task using the system account, then execute the scheduled task.
-------------------
SCHTASKS.exe /CREATE /RU ""SYSTEM"" /TR ""C:\KAS\Setup.exe /s"" /TN KAS /SC ONCE /ST ""12:12""

SCHTASKS.EXE /RUN /TN KAS 

Start-Sleep -s 20
-------------

The idea is that it creates scheduled task with the highest system level, to run a silent setup program.

The script runs fine if I execute it manually, but nothing happens when I run it as an automated deployment task. Any ideas?",,False,,t5_2qo1o,False,,,True,t3_19nqmn,http://www.reddit.com/r/PowerShell/comments/19nqmn/post_imaging_powershell_script/,
1362428683.0,6,self.PowerShell,19np69,"Help, creating first powershell script having problems logging errors. using -ErrorAction and -ErrorVariable",7,1,22,http://www.reddit.com/r/PowerShell/comments/19np69/help_creating_first_powershell_script_having/,"    $file = ""c:\file.csv""	

    $err =@()

    $csv = Import-Csv $file			

    $organizationalUnit = 'company\ou'	

    foreach ($line in $csv) {			
        Enable-MailUser -Identity ($organizationalUnit + $line.Name) -Alias $line.Alias -ExternalEmailAddress $line.Email -ErrorAction Continue -ErrorVariable +err
    }

    Write-Host $err[0]

    Write-Host $err.count

Whenever I try to print the err variable nothing comes out, the count stays 0.

What am I doing wrong?",,False,,t5_2qo1o,1362430831.0,,,True,t3_19np69,http://www.reddit.com/r/PowerShell/comments/19np69/help_creating_first_powershell_script_having/,
1362171884.0,7,self.PowerShell,19hgkh,New Powershell users. Need a bit of help removing confirmation prompt. ,7,0,2,http://www.reddit.com/r/PowerShell/comments/19hgkh/new_powershell_users_need_a_bit_of_help_removing/,"I'm working on a windows update script.

I've got the PSWindowsUpdate module in C:\Powershell &amp; set the Execution Policy to remotesigned.  
here's the script: 
&gt;Import-Module C:\Powershell\PSWindowsUpdate

&gt;Get-WUInstall -Acceptall -Verbose

&gt;Get-WURebootStatus -Silent

everything runs fine till the Get-WURebootstatus. If a reboot is required I'm requested for a confirmation. I've tried -force &amp; Confirm:$False, but still get the confirm request. Any idea to bypass this? 

",,False,,t5_2qo1o,False,,,True,t3_19hgkh,http://www.reddit.com/r/PowerShell/comments/19hgkh/new_powershell_users_need_a_bit_of_help_removing/,
1361492443.0,8,self.PowerShell,18zlxl,Preparing for Powershell Training,8,0,26,http://www.reddit.com/r/PowerShell/comments/18zlxl/preparing_for_powershell_training/,"Hi everyone!  I am going to Powershell training next week for 5 days.  It's an 8 hour a day class with a lab.  I'm a complete newbie to powershell and to IIS.  I'm an Apache and Java guy.  So what I want to know if there is anything you could suggest I do to prepare before hand?

Thank you for any advice.",,False,,t5_2qo1o,False,,,True,t3_18zlxl,http://www.reddit.com/r/PowerShell/comments/18zlxl/preparing_for_powershell_training/,
1360486720.0,8,powershelladmin.com,188o2r,Microsoft Translator API v2 Module,8,0,0,http://www.reddit.com/r/PowerShell/comments/188o2r/microsoft_translator_api_v2_module/,,,False,,t5_2qo1o,False,,,False,t3_188o2r,http://www.powershelladmin.com/wiki/Using_the_Microsoft_Translator_API_from_PowerShell,
1359987417.0,5,self.PowerShell,17v7lf,I added a custom user attribute to AD but I am having trouble populating it.,8,3,15,http://www.reddit.com/r/PowerShell/comments/17v7lf/i_added_a_custom_user_attribute_to_ad_but_i_am/,"In my test enviroment I have added a custom attribute to store hire dates for users.  I modeled it after the existing accountExpires attribute which is a Large Integer/Interval.  In powershell, piping accountExpires to Get-Member reveals it to be of type System.Int64.

So far so good, I begin playing with a datetime object and notice method .ToFileTime() appears to output the correct the correct format.   Here is what I have tried so far. 
 
     $hdate = (get-date).adddays(-10)
     [long]$Date = $hdate.ToFileTime()

$Date piped to Get-Member is showing correctly as System.Int64

     set-aduser -identity TUser -add @{hiredate='$date'}

When I use get-aduser again viewing the hiredate property shows it has been converted to a System.String.  So anyone know how to correctly populate a custom datetime attribute?  
  
  
  


*Thanks to pandiculator in the [sysadmin](http://www.reddit.com/r/sysadmin/comments/17vncv/xpost_from_rpowershell_ive_extended_the_schema/) thread, who found the solution was to open a new powershell instance. For some reason the original instance will always return string value.",,False,,t5_2qo1o,1360072551.0,,,True,t3_17v7lf,http://www.reddit.com/r/PowerShell/comments/17v7lf/i_added_a_custom_user_attribute_to_ad_but_i_am/,
1359031442.0,6,self.PowerShell,176q7n,How do you tell which module a cmdlet came from?,9,3,4,http://www.reddit.com/r/PowerShell/comments/176q7n/how_do_you_tell_which_module_a_cmdlet_came_from/,"I know that you can find what cmdlets a module contains by issuing

    Get-Command -Module moduleName

But if I have the name of a cmdlet, how do I tell which module that cmdlet lives in? We're building a library of Powershell functions and it's starting to get a little sizable.",,False,,t5_2qo1o,False,,,True,t3_176q7n,http://www.reddit.com/r/PowerShell/comments/176q7n/how_do_you_tell_which_module_a_cmdlet_came_from/,
1358528161.0,6,self.PowerShell,16toep,Need help transferring local user accouts source:win2008 r2 destination: win 2008 r2,9,3,5,http://www.reddit.com/r/PowerShell/comments/16toep/need_help_transferring_local_user_accouts/,We are switching to a new terminal server and I am a novice at powershell.  I really need help on how to do this without losing any of the user account settings. Im learning powershell at the moment and have done VB and c++ about 5 years ago. I am having trouble getting started so quickly with ps... My boss kinda dumped this on me last minute and I need to do it by the 29th and would rather not move them individually.,,False,,t5_2qo1o,False,,,True,t3_16toep,http://www.reddit.com/r/PowerShell/comments/16toep/need_help_transferring_local_user_accouts/,
1357749247.0,9,self.PowerShell,1696rh,Where do you keep scripts multiple servers use?,9,0,21,http://www.reddit.com/r/PowerShell/comments/1696rh/where_do_you_keep_scripts_multiple_servers_use/,"I'm in an environment where we have several SQL Server databases. The servers are backed up to files using SQL Server agent jobs, which right now aren't centrally logged.

So I've taken it on myself to add central logging. I've got it all figured out except where I'm going to store the script that actually writes to the event log. What's the best practice for storing a powershell script that's shared like this? Just stick it on a network share?",,False,,t5_2qo1o,False,,,True,t3_1696rh,http://www.reddit.com/r/PowerShell/comments/1696rh/where_do_you_keep_scripts_multiple_servers_use/,
1357166893.0,7,self.PowerShell,15uo7a,Anyone using the Backup Exec 2012 Powershell module? I have some questions.,7,0,6,http://www.reddit.com/r/PowerShell/comments/15uo7a/anyone_using_the_backup_exec_2012_powershell/,"We're in the process of moving from BE2010 to BE2012, and with that I want to monitor the jobs better using the [BEMCLI](http://www.symantec.com/connect/articles/preparing-your-powershell-environment-run-bemcli-and-scripts) module.

So far, so good, to a degree. Here's what I have:

---

    $serverList = @(""server01"",""server02"",""server03"")
    
    function List-BEJobs {
        param(
            $serverName
        )
        $s = New-PSSession -ComputerName $serverName
        Invoke-Command -session $s { 
            Import-Module ""C:\Program Files\Symantec\Backup Exec\Modules\BEMCLI\BEMCLI""
            Get-BEJob | Get-BEJobHistory -FromLastJobRun -JobType Backup -JobStatus Scheduled
        }
        Remove-PSSession -session $s
    }
    
    $output = ''
    foreach ($server in $serverList) {
        $BEServer = List-BEJobs -serverName $server | select-object -property *
        $BEServer
        $output += ""Server Name: "",$BEServer.BackupExecServerName,""`n"" -join ''
        $output += ""Job Name: "",$BEServer.JobName,""`n"" -join ''
        $output += ""Job Status: "",$BEServer.JobStatus,"" - "",$BEServer.SubStatus,""`n"" -join ''
        $output += ""Time: "",$BEServer.StartTime,""-"",$BEServer.EndTime,"" ("",$BEServer.ElapsedTime,"")`n"" -join ''
        $output += ""% Complete: "",$BEServer.PercentComplete,""`n`n"" -join ''
    }

---

This results in the following for a failed job:

---
    Server Name: Server01
    Job Name: Daily Backups-XYZ_Policy
    Job Status: Canceled - 
    Time: 1/1/2013 10:00:02 PM-1/1/2013 10:26:18 PM (00:26:16)
    % Complete: -1
---

Basically, althrough Get-BEJob provides SubStatus, Get-BEJobHistory does not, and this means I have very little to go on for why a job failed.

SubStatus is an enumerated list whose values can be found here: http://www.symantec.com/connect/blogs/get-bejob-substatus-and-other-properties (about halfway down).

The properties of Get-JobHistory do not appear to include any error codes, etc. that would help be find this out.

Basically, I want to reduce the need to connect to a remote server in order to start investigating the failure, since I've got ~50 BE installations in two countries and need to streamline the process.

Any advice on this would be welcome!",,False,,t5_2qo1o,False,,,True,t3_15uo7a,http://www.reddit.com/r/PowerShell/comments/15uo7a/anyone_using_the_backup_exec_2012_powershell/,
1356984396.0,6,self.PowerShell,15qlqb,Any way to export the account the services are running under?,8,2,6,http://www.reddit.com/r/PowerShell/comments/15qlqb/any_way_to_export_the_account_the_services_are/,"I've got an admin that's since left the company, and I'd like to quickly go through the 40 or so servers we have, and dump a list of all the services running, and the associated account they're running as. This is so we can change his password/disable his old account and not have something like Exchange soil the sleeping arrangements.

Then I can also create appropriately-permissioned accounts for these services if need be.",,False,,t5_2qo1o,False,,,True,t3_15qlqb,http://www.reddit.com/r/PowerShell/comments/15qlqb/any_way_to_export_the_account_the_services_are/,
1356906015.0,8,mattblogsit.com,15own8,Indianapolis PowerShell User Group | Matt Blogs IT,9,1,0,http://www.reddit.com/r/PowerShell/comments/15own8/indianapolis_powershell_user_group_matt_blogs_it/,,,False,,t5_2qo1o,False,,,False,t3_15own8,http://mattblogsit.com/windows/indianapolis-powershell-user-group,
1356744780.0,5,self.PowerShell,15lpi6,Script to throttle Exchange 2010 Mailbox moves,10,5,0,http://www.reddit.com/r/PowerShell/comments/15lpi6/script_to_throttle_exchange_2010_mailbox_moves/,"I wrote a script today that I thought might be useful for those of you that perform the occasional Exchange 2010 migration, so figured I'd share it.

This script will toggle between two MSExchangeMailboxReplication.exe.config files and can be combined with task scheduler to automatically speed up mailbox moves at night, when server performance does not need to be as high, and then slow them down in the morning when users start to log on.  

Simply make a copy of the config file and name it MSExchangeMailboxReplication.exe.config.alt and change the performance settings as desired, then run this script manually or via scheduled tasks.

Basically it suspends all queued requests, waits for active moves to finish, stops the MRE service, swaps the config files, starts the service, and queues the moves again.

More information on the config file can be found here:

http://technet.microsoft.com/en-us/library/ff963524(v=exchg.141).aspx

Comments/criticism are more than welcome, I am pretty new to this but am really falling in love with Powershell lately.

    Write-Host ""Suspending all queued move requests...""
    Get-MoveRequest -MoveStatus Queued | Suspend-MoveRequest -Confirm:$false
    
    while (Get-MoveRequest -MoveStatus Queued)
    {
    Write-Host ""Waiting for all requests to be suspended... (this could take a while if you have a large number of moves queued)""
    Start-Sleep -Seconds 120
    }
    
    while ((Get-MoveRequest -MoveStatus InProgress) -OR (Get-MoveRequest -MoveStatus CompletionInProgress))
    	{
    		Write-Host ""Waiting 2 minutes for active moves to finish... (this could take a while if a large mailbox is being moved)""
    		Start-Sleep -Seconds 120
    	}
    
    Write-Host ""Stopping MRE Service...""
    Stop-Service MSExchangeMailboxReplication
    
    while (Get-Service MSExchangeMailboxReplication | Where-Object {$_.status -eq ""running""})
    	{
    		Write-Host ""Waiting for MRE Service to stop...""
    		Start-Sleep -Seconds 30
    	}
    
    Write-Host ""MRE Service stopped.""
    Write-Host """"
    Write-Host ""Swapping throttling config files""
    
    Rename-Item ""C:\Program Files\Microsoft\Exchange Server\V14\Bin\MSExchangeMailboxReplication.exe.config"" ""MSExchangeMailboxReplication.exe.config.tmp""
    Rename-Item ""C:\Program Files\Microsoft\Exchange Server\V14\Bin\MSExchangeMailboxReplication.exe.config.alt"" ""MSExchangeMailboxReplication.exe.config""
    Rename-Item ""C:\Program Files\Microsoft\Exchange Server\V14\Bin\MSExchangeMailboxReplication.exe.config.tmp"" ""MSExchangeMailboxReplication.exe.config.alt""
    
    Write-Host ""Starting MRE Service...""
    
    Start-Service MSExchangeMailboxReplication
    
    while (Get-Service MSExchangeMailboxReplication | Where-Object {$_.status -eq ""stopped""})
    	{
    		Write-Host ""Waiting for MRE Service to start...""
    		Start-Sleep -Seconds 30
    	}
    
    Write-Host ""MRE Service Started.""
    
    Write-Host ""Resuming all move requests...""
    Get-MoveRequest -MoveStatus Suspended | Resume-MoveRequest
    
    Write-Host ""Move requests resumed.""
    ",,False,,t5_2qo1o,1356747014.0,,,True,t3_15lpi6,http://www.reddit.com/r/PowerShell/comments/15lpi6/script_to_throttle_exchange_2010_mailbox_moves/,
1355679151.0,8,self.PowerShell,14y4gz,Any idea how to write a PS script that changes Google Chat status?,11,3,3,http://www.reddit.com/r/PowerShell/comments/14y4gz/any_idea_how_to_write_a_ps_script_that_changes/,"I would love to write a script that changes my Google Chat status based on what game i'm playing. As in:

(Playing Guild Wars 2):[set status available] ""Playing Guild Wars 2""

(Playing Left 4 Dead 2):[set status away] ""Playing L4D2, come join me on Steam.""

etc.

There appears to be an API for Google Chat and I have no doubt I could figure it out eventually, but I'm curious to see if anyone has already done something like this.

[Google Talk Developer Documentation](https://developers.google.com/talk/talk_developers_home)

Thanks!",,False,,t5_2qo1o,1355684803.0,,,True,t3_14y4gz,http://www.reddit.com/r/PowerShell/comments/14y4gz/any_idea_how_to_write_a_ps_script_that_changes/,
1355531498.0,7,csharpening.net,14vdjh,Using Unregistered COM Objects in PowerShell,7,0,1,http://www.reddit.com/r/PowerShell/comments/14vdjh/using_unregistered_com_objects_in_powershell/,,,False,,t5_2qo1o,False,,,False,t3_14vdjh,http://csharpening.net/?p=1427,
1355156427.0,7,self.PowerShell,14lxvq,Question - Extract hostnames from Perfmon blg with Powershell,7,0,1,http://www.reddit.com/r/PowerShell/comments/14lxvq/question_extract_hostnames_from_perfmon_blg_with/,"I'm writing a script which will automate the extraction of data from .blg Perfmon logs.

I've worked out the primary Import-Counter commands I will need to use to get the data out, but am trying to parametrise this so that I can do it for each machine in the log file (without having to open the log up in Perfmon, which can take 15 minutes or sometimes more, and is the reason I'm writing this script), and find out what each hostname is.

The script I have does the job, but it still takes a minute to return the data I want, and I wondered if there was a simpler way to do this, as I'm not too familiar with Powershell?

Here's what I have:

    $counters = Import-Counter -Path $log_path$logfile -ListSet * | Select-Object paths -ExpandProperty paths

    $svrs = @()

    # for each line in the list of counters, extract the name of the server and    add it to the array
    foreach ($line in $counters) {
        $svrs += $line.split(""\"")[2]
    }

    # remove duplicates and sort the list of servers
    $sorted_svrs = $svrs | sort -unique

    foreach ($svr in $sorted_svrs) {
        Write-Host $svr
    }

I'm just printing the names for the moment, but they'll go into an array in the proper script, and then I'll run my Import-Counter block with each of these hosts parametrised in.

Just wondered if there was a better way of doing this?

Many thanks in advance.",,False,,t5_2qo1o,False,,,True,t3_14lxvq,http://www.reddit.com/r/PowerShell/comments/14lxvq/question_extract_hostnames_from_perfmon_blg_with/,
1354758859.0,6,self.PowerShell,14cxb0,Question about powershell and forms for end-users.,7,1,6,http://www.reddit.com/r/PowerShell/comments/14cxb0/question_about_powershell_and_forms_for_endusers/,"I am currently working with an old and overly complex system to create accounts when new users are hired.  Currently HR will fill out a form in App A which will output a csv file with the relevant information about the user.  This CSV file will be picked up by a script that will process and send an email with information, wanrings, etc.

The application that generates the CSV file is outdated and barely supported,  since I will have to re-write large parts of my current script anyway, I would like to gather opinions from /r/powershell.

I would like to have graphical forms for various end user groups and have them generate a file or call a script directly. My question is:  What is the best way to accomplish it?   I don't have large amounts of time to devote to learning how to build ""pretty"" forms from scratch, so is there anything I can leverage that will help in the creation of the front end?   We have sharepoint 2010 if that makes any difference.  The solution does not have to be free. ",,False,,t5_2qo1o,False,,,True,t3_14cxb0,http://www.reddit.com/r/PowerShell/comments/14cxb0/question_about_powershell_and_forms_for_endusers/,
1354639029.0,8,self.PowerShell,149n5n,getting groupnames from AD memberof,10,2,15,http://www.reddit.com/r/PowerShell/comments/149n5n/getting_groupnames_from_ad_memberof/,"I am trying to take the following code and get it to report the actual group names:
$usergroups = (GET-ADUSER -Identity $user -Properties MemberOf | Select-Object MemberOf).MemberOf | ConvertTo-html -Head $a -Body ""&lt;H2&gt;User ($user) groups&lt;/H2&gt;""

It appears that the it is just reporting the length of each string(as that is the only property given by get-member) and there is no other property that I can access.  How can I get it to convert all groups that are in the memberof property to an HTML table?  ($Head is the css that is being used)
 ",,False,,t5_2qo1o,False,,,True,t3_149n5n,http://www.reddit.com/r/PowerShell/comments/149n5n/getting_groupnames_from_ad_memberof/,
1352839423.0,7,self.PowerShell,1353bd,Error: The model is not installed - Newbie question,8,1,2,http://www.reddit.com/r/PowerShell/comments/1353bd/error_the_model_is_not_installed_newbie_question/,"Ok, I'm trying to teach myself PS by reading the book *Learn Windows PowerShell in a Month of Lunches* by D. Jones. If you're familiar with the book I'm on chapter 5's lab. It simply states that you're to do the following and doesn't show how to do it. 
&gt;Run a Best Practices Analyzer (BPA) report for Directory Services and DNS Server,
the two models that should be present on your Windows Server 2008 R2 domain controller.

I'll walk you through what I did to get this error (full error listed below).
&gt;*get-module -listavailable*

&gt;*import-module bestpractices*

&gt;*get-module* (to confirm bestpractices loaded)

&gt;*help bestpractices* (to figure out the commands needed to run)

&gt;*get-bpamodel*


The ID's returned are:
microsoft\windows\directoryservices

and

microsoft\windows\dnsserver

So I ran the following commands:

&gt;*invoke-bpamodel -bestpracticesmodelid microsoft\windows\directoryservices*

&gt;*invoke-bpamodel -bestpracticesmodelid microsoft\windows\dnsserver*

Both of these returned the same error:

&gt;Invoke-bpamodel : There has been a best practice analyzer for model id 'blah blah'. The model is not installed.

Why am I getting these errors? I'm assuming that it's because PS thinks these roles aren't installed? But they are. Or am I missing a step in producing the report?

I'm thoroughly confused and any help is greatly appreciated.",,False,,t5_2qo1o,False,,,True,t3_1353bd,http://www.reddit.com/r/PowerShell/comments/1353bd/error_the_model_is_not_installed_newbie_question/,
1350640928.0,8,self.PowerShell,11qoei,new-ish to powershell; need help creating a gui,9,1,6,http://www.reddit.com/r/PowerShell/comments/11qoei/newish_to_powershell_need_help_creating_a_gui/,"Hi all,

I'm relatively basic in my powershell scripting. I use it everyday for sysadmin purposes (exchange, o365, etc)
Anyway I am attempting to create a small GUI to shortcut some relatively easy tasks for office 365.

I have been learning quite a bit through all this but this problem has me scratching my head.
Heres the situation; I have a button for the user to click which I want to run the relatively easy command ""Get-MSOLUsers"" and throw this into a listbox.
However when it runs i have a listbox full of Object[]Array :( :(

Here is the code to the button. What am i doing wrong?

    $handler_GetMSOLUsers_Click={
    $usersListbox.Items.Clear()
    $userList = Get-MsolUser
    $userList=$userList | sort @{expression=""UserPrincipalName"";ascending=$true}
    foreach ($user in $userList){
        $usersListbox.Items.Add($userList)
    }
    }",,False,,t5_2qo1o,False,,,True,t3_11qoei,http://www.reddit.com/r/PowerShell/comments/11qoei/newish_to_powershell_need_help_creating_a_gui/,
1349788082.0,7,self.PowerShell,116zee,Creating a custom log,8,1,13,http://www.reddit.com/r/PowerShell/comments/116zee/creating_a_custom_log/,"I have a user termination script I'm working on. I pull user name, manager, date, etc. This goes into a log. This log is read by another script. After the required retention date has passed it will delete the mailbox, home directory, etc. I'm getting lost on how to create a log that will have all those in it, be readable by another script, and if possible be human readable as well. I was thinking about using Export-CSV but I can't really figure out how to do that with so many variables. I was also toying around with the idea of using XML or SQLITE. I just can't seem to get it formatted correctly for that too. Perhaps I'm just over thinking everything, but if anyone has an idea that would be great.

**EDIT:**

Looks like [sylver_dragon](http://www.reddit.com/user/sylver_dragon) came though with [CSV](http://www.reddit.com/r/PowerShell/comments/116zee/creating_a_custom_log/c6jwr79) and [XML](http://www.reddit.com/r/PowerShell/comments/116zee/creating_a_custom_log/c6jyc8p) based logs. 

Thanks!",,False,,t5_2qo1o,1349985761.0,,,True,t3_116zee,http://www.reddit.com/r/PowerShell/comments/116zee/creating_a_custom_log/,
1348907691.0,7,pastebin.com,10ntd2,[Power Shell] Dynamic DNS update script via HTTP,8,1,6,http://www.reddit.com/r/PowerShell/comments/10ntd2/power_shell_dynamic_dns_update_script_via_http/,,,False,,t5_2qo1o,False,,,False,t3_10ntd2,http://pastebin.com/b206ZRkX,
1347980440.0,7,self.PowerShell,102xwc,How do I use Snap-Ins in workflows?,7,0,0,http://www.reddit.com/r/PowerShell/comments/102xwc/how_do_i_use_snapins_in_workflows/,"I understand that you need to use the -PSRequiredModules parameter for activities in a workflow that need a module. But, for instance, PowerCLI is a snap-in, not a module. It seems that snap-ins are not available to activities in workflows and the Add-PSSnapin cmdlet is disallowed in workflows.

Plain test:
    
    PS C:\tmp\powershell&gt; Get-PowerCLIConfiguration
    
    Proxy Policy    Default Server
                    Mode
    ------------    ---------------
    UseSystemProxy  Multiple
    

Test the same command in a Workflow:
    
    PS C:\tmp\powershell&gt; Workflow Test-Snapin{
    &gt;&gt;     Get-PowerCLIConfiguration
    &gt;&gt;
    &gt;&gt; }
    &gt;&gt;
    PS C:\tmp\powershell&gt;
    PS C:\tmp\powershell&gt; Test-Snapin
    The term 'Get-PowerCLIConfiguration' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a     path was included, verify that the
    path is correct and try again.
        + CategoryInfo          : ObjectNotFound: (Get-PowerCLIConfiguration:String) [], CommandNotFoundException
        + FullyQualifiedErrorId : CommandNotFoundException
        + PSComputerName        : [localhost]

Can't use the Add-PSSnapin cmdlet:
    
    PS C:\tmp\powershell&gt; Workflow Test-Snapin{
    &gt;&gt;     Add-PSSnapin vmware.vimautomation.core
    &gt;&gt;     Get-PowerCLIConfiguration
    &gt;&gt;
    &gt;&gt; }
    &gt;&gt;
    At line:2 char:5
    +     Add-PSSnapin vmware.vimautomation.core
    +     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Cannot call the 'Add-PSSnapin' command. Other commands from this module have been packaged as workflow activities, but this command was specifically excluded. This is likely because the command
    requires an interactive Windows PowerShell session, or has behavior not suited for workflows. To run this command anyway, place it within an inline-script (InlineScript { Add-PSSnapin }) where it
    will be invoked in isolation.
        + CategoryInfo          : ParserError: (:) [], ParseException
        + FullyQualifiedErrorId : CommandActivityExcluded

Can't wrap it in an InlineScript (not that I expected it to work, since it runs in its own process...):
    
    PS C:\tmp\powershell&gt; Workflow Test-Snapin{
    &gt;&gt;     InlineScript{Add-PSSnapin vmware.vimautomation.core}
    &gt;&gt;     Get-PowerCLIConfiguration
    &gt;&gt;
    &gt;&gt; }
    &gt;&gt;
    PS C:\tmp\powershell&gt; Test-Snapin
    The term 'Get-PowerCLIConfiguration' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the
    path is correct and try again.
        + CategoryInfo          : ObjectNotFound: (Get-PowerCLIConfiguration:String) [], CommandNotFoundException
        + FullyQualifiedErrorId : CommandNotFoundException
        + PSComputerName        : [localhost]

Finally, can't supply Snap-Ins to the -PSRequiredModule parameter:
    
    PS C:\tmp\powershell&gt; Workflow Test-Snapin{
    &gt;&gt;     Get-PowerCLIConfiguration -PSRequiredModules vmware.vimautomation.core
    &gt;&gt;
    &gt;&gt; }
    &gt;&gt;
    PS C:\tmp\powershell&gt; Test-Snapin
    The term 'Get-PowerCLIConfiguration' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the
    path is correct and try again.
        + CategoryInfo          : ObjectNotFound: (Get-PowerCLIConfiguration:String) [], CommandNotFoundException
        + FullyQualifiedErrorId : CommandNotFoundException
        + PSComputerName        : [localhost]

Is there any way to make Snap-Ins available in Workflows? Am I totally overlooking something here?


**EDIT**
Bit of a brain fart, I guess. I can make this work by wrapping both the Add-PSSnapin and Get-PowerCLIConfiguration cmdlets in the InlineScript. 

    PS C:\tmp\powershell&gt; Workflow Test-Snapin{
    &gt;&gt;     InlineScript{
    &gt;&gt;         Add-PSSnapin vmware.vimautomation.core
    &gt;&gt;         Get-PowerCLIConfiguration
    &gt;&gt;     }
    &gt;&gt;
    &gt;&gt; }
    &gt;&gt;
    PS C:\tmp\powershell&gt; Test-Snapin
    
    Proxy Policy    Default Server  PSComputerName
                    Mode
    ------------    --------------- --------------
    UseSystemProxy  Multiple        localhost

It still just seems kludgy and not right... I'm hoping things like this will change in the future.",,False,,t5_2qo1o,1347980777.0,,,True,t3_102xwc,http://www.reddit.com/r/PowerShell/comments/102xwc/how_do_i_use_snapins_in_workflows/,
1347882415.0,8,self.PowerShell,100o1n,How do I loop through and open a new window for each process?,9,1,3,http://www.reddit.com/r/PowerShell/comments/100o1n/how_do_i_loop_through_and_open_a_new_window_for/,"For example:

Get-mailbox user1

Get-mailbox user2

Get-mailbox user3

Is there a way to make each output open in a different ps window?

Thanks. Sorry for the newb question.",,False,,t5_2qo1o,False,,,True,t3_100o1n,http://www.reddit.com/r/PowerShell/comments/100o1n/how_do_i_loop_through_and_open_a_new_window_for/,
1347570543.0,7,self.PowerShell,zubdo,Proper powershell technique,9,2,7,http://www.reddit.com/r/PowerShell/comments/zubdo/proper_powershell_technique/,"for a command like :

$reg = [Microsoft.Win32.RegistryKey]::OpenRemoteBaseKey($BaseKey, $computername )

Once that variable is out of scope (ie excution is out of the current code block, etc...), does powershell close the system handle that is held open for the remote registry key. Or should I be concerned with closing the handle myself?
",,False,,t5_2qo1o,False,,,True,t3_zubdo,http://www.reddit.com/r/PowerShell/comments/zubdo/proper_powershell_technique/,
1347294598.0,9,self.PowerShell,znqde,"mysql connections not closing, sleeping instead.",9,0,3,http://www.reddit.com/r/PowerShell/comments/znqde/mysql_connections_not_closing_sleeping_instead/,"Does anybody know how to kill a MySql connection. Alternatively can I re-use an already existing connection? 

I have a script that runs about 20 queries (It loops through a list of IP addresses and a query for each one depending on other conditions.) The problem is I want to run this script every 10 minutes and this results in too many connection after about an hour because the connections never close.

Here's the code I use for queries:

 	#open database connection to MySQL Server
	[system.reflection.assembly]::LoadWithPartialName(""MySql.Data"")
	$cn = New-Object -TypeName MySql.Data.MySqlClient.MySqlConnection
	$cn.ConnectionString = ""Server=server;Uid=mutt765;Pwd=password;database=mydatabase;"" 
	$cn.Open()
	
	#create sql command for select
	$cmd = New-Object -TypeName MySql.Data.MySqlClient.MySqlCommand
	$cmd.connection = $cn
	$cmd.commandtext = $query
    $cmd.executereader()
    
	#close database connection to MySQL Server 
	$cn.close
	$cn.kill

I thought the kill command at the end would work but it doesn't.",,False,,t5_2qo1o,False,,,True,t3_znqde,http://www.reddit.com/r/PowerShell/comments/znqde/mysql_connections_not_closing_sleeping_instead/,
1347196129.0,8,self.PowerShell,zlm89,A script to download files via HTTPS?,9,1,13,http://www.reddit.com/r/PowerShell/comments/zlm89/a_script_to_download_files_via_https/,"Hello everyone,

I've been using a script to download files from a certain FTP site, but recently they changed their FTP server to ""Tumbleweed SecureTransport"", and my script no longer works.

I have login/password and I can log in and download files manually via browser **using HTTPS**, but I cannot do it via FTP, can't even find any FTP client that works with this thing.

I know that we can spawn an instance of IE and control it from PowerShell, so currently I'm writing a script that opens it via https link... I can parse file list from the web page, but I can't figure out how to download files without IE asking ""Do you want to open or save...?"" every time.

Any help?


(**edit**)

It seemd like I should either completely emulate browser behaviour while using WebClient or WebRequest - including cookies and UserAgent, or just figure our how to manipulate an instance of IE to download files. I almost did the second, except I still don't know how to make IE save downloaded files without asking ""Do you want to save?"" and to a specific location...

(**edit 2**)

TIL that WinSCP can work with Tumbleweed SecureTransport and even has a .NET wrapper dll. Cool!",,False,,t5_2qo1o,1347432282.0,,,True,t3_zlm89,http://www.reddit.com/r/PowerShell/comments/zlm89/a_script_to_download_files_via_https/,
1346151863.0,7,self.PowerShell,yyf1r,Sharing my reporting package. Also looking for some help.,9,2,16,http://www.reddit.com/r/PowerShell/comments/yyf1r/sharing_my_reporting_package_also_looking_for/,"I am an  ERP manager, I need to generate management reports and of course I want to automatize them. I don't want to use Reporting Services or stuff like that, they are just too heavyweight. Why learn something big and complex when your needs aren't? Also such solutions typically have limitations which are difficult to explain to nontechnical managers, so I like to have full control exactly what goes into which cell and have no limitations. Hence I wanted to program my own reports from scratch.

So I just develop my reports as SQL Stored Procedures and use a PS script to write nice Excel files and e-mail them to upper managers automatically. I tried to wrap things into a reusable library so that the actual reports obey the DRY principle. I would like to share it and also ask a question because something doesn't work.

What doesn't work is that when I run it manually it is fine but when automatically, as a task, it does not actually send the attachment.

Also I would appreciate every suggestion how to improve on this. Like not having the .bat file or more error-handling or something. Or is there are better PS reporting library already out?

Here it is: https://gist.github.com/3497240

Hope someone will find it useful and can also help me to make it better. Or to make the attachment actually work. Weird. When I run it manually it works.

EDIT: I don't exactly remember why I didn't use the built-in cmdlets for runnin an SQL query and sending an e-mail. I think the first one did not manage stored procs with params and the second one had some issue with attachments or something, I don't remember anymore.

EDIT: using ""run with highest privileges"" did the trick.",,False,,t5_2qo1o,1346677421.0,,,True,t3_yyf1r,http://www.reddit.com/r/PowerShell/comments/yyf1r/sharing_my_reporting_package_also_looking_for/,
1346094687.0,7,self.PowerShell,yx1uf,Saving SQL results from a query to be used later,7,0,7,http://www.reddit.com/r/PowerShell/comments/yx1uf/saving_sql_results_from_a_query_to_be_used_later/,"I am trying to use invoke-sqlcmd to get the value of an identifier, and then use that identifier later as part of an update without SQL headers. 

So It would be like SELECT ID FROM TABLE1, and then save that ID value in a variable that I can increment later. 

I tried the following 

$a=invoke-sqlcmd -ServerInstance server -Database database  -Username user-Password password -Query ""SELECT max (ID)+1 FROM Table1"" -h-1

But that is not cutting out the header when I call $a

Also, even if I format it right, I also need to use that, so in my insert I would increment the ID by +1 . Any help would be appreciated. ",,False,,t5_2qo1o,False,,,True,t3_yx1uf,http://www.reddit.com/r/PowerShell/comments/yx1uf/saving_sql_results_from_a_query_to_be_used_later/,
1344546352.0,8,self.PowerShell,xykh1,Execute user input in ScriptBlock,8,0,4,http://www.reddit.com/r/PowerShell/comments/xykh1/execute_user_input_in_scriptblock/,"So I am trying to get [this code](http://pastie.org/4445814) to work. What I would like is to have is a script that, when run, asks for a command. I would enter the command I want run on the computers I specify, and the script would execute that command on computers in a remote session.

Right now, I either get an error (varies) or no error (but the code doesn't run). Here are the iterations of the specific line I have tried (with ""$cmd"" being the command to execute):

    Invoke-Command -Session $session -ScriptBlock {$cmd}

    Invoke-Command -Session $session -ScriptBlock {invoke-expression $cmd}    

    Invoke-Command -Session $session -ScriptBlock {$args[0]} -ArgumentList $cmd

I have also tried creating a ScriptBlock before hand using different commands, but no combination has worked. So far for all my searching I have yet to find someone discuss passing user input into ""Invoke-Command."" Everyone seems to only pass pre-defined commands, which I have no problems running.

Any suggestions?


Edit: Thanks for all the suggestions. Forgot to mention I am using PS 2 not 3. I tried to use the setup eramnes suggested with parameters and the ArgumentList option already but it didn't seem to work. I'll try it again when I get a chance though, I probably typed something wrong before...

Edit 2: No dice. I should probably ask as well: can I pass parameters that are not cmdlts? In this instance I am trying to run the command ""slmgr.vbs /ato"" on the remote machine. I know that the command itself works when initiated manually. Do I need to escape the ""/""? Thanks again.",,False,,t5_2qo1o,1344556985.0,,,True,t3_xykh1,http://www.reddit.com/r/PowerShell/comments/xykh1/execute_user_input_in_scriptblock/,
1344274220.0,7,blogs.msdn.com,xrwig,Handy Email function to add to scripts,11,4,21,http://www.reddit.com/r/PowerShell/comments/xrwig/handy_email_function_to_add_to_scripts/,,,False,,t5_2qo1o,False,,,False,t3_xrwig,http://blogs.msdn.com/b/rkramesh/archive/2012/03/16/sending-email-using-powershell-script.aspx,
1344036190.0,8,reddit.com,xn9ef,Best book or tools for learning PowerShell - [x-post] from /r/sysadmin,8,0,4,http://www.reddit.com/r/PowerShell/comments/xn9ef/best_book_or_tools_for_learning_powershell_xpost/,,,False,,t5_2qo1o,False,,,False,t3_xn9ef,http://www.reddit.com/r/sysadmin/comments/xn927/best_book_or_tools_for_learning_powershell/,
1342721848.0,7,self.PowerShell,wtupz,Need some help with a script that'll do half of my work for me,9,2,5,http://www.reddit.com/r/PowerShell/comments/wtupz/need_some_help_with_a_script_thatll_do_half_of_my/,"Dear /r/PowerShell. 

I currently work part-time in a large corporation, in the quality control department.  My job requires me to upload an enormous amount of files (mostly .pdf and .jpeg) to a database-kind-of-thing. Now, each entry in the database may or may not have a file or a couple of files associated with it. I can either upload the documents manually, one by one, via a clunky web interface (Which isn't really an option when I have tens of thousands of files to upload), or zip them up and upload a bunch at once, but only if they follow this file name format - *reference number*_YYYY-MM-DD.*extension*

So this part is kind of simple, after a couple hours of googling I figured out how to automate the copying of a file and naming the copies accordingly. [Here's](http://pastebin.com/sM66b5du) what I've got so far. Now, there's only one little problem. Say I've a certificate of conformity that needs to be uploaded 500 times, for every colour of brand X paint (The whole system is kind of retarded like that). It's a 1MB pdf file. So I run my script, zip the output up, and upload the zip, right? WRONG. There's a 20MB filesize limit on uploaded zips. So, I could just zip the files into 20 MB chunks manually, but that's a shitload of work. So my question is this : how can I build on what I've already got and automate all the zipping? Ideally, the output should be as many &lt;20MB .zip files as necessary.

My work computer has no permissions whatsoever. It's running Powershell v1. I also have 7zip. Any help would be greatly appreciated.

**EDIT** : So, I figured it out. [HERE's](http://pastebin.com/i3164zbE) what I did. Works like a charm, but I'll still keep an eye out for any errors. Thanks a lot for all your help and advice!",,False,,t5_2qo1o,1342777650.0,,,True,t3_wtupz,http://www.reddit.com/r/PowerShell/comments/wtupz/need_some_help_with_a_script_thatll_do_half_of_my/,
1342557586.0,6,self.PowerShell,wpykc,First day with PowerShell and need some clarification on running a script.,7,1,31,http://www.reddit.com/r/PowerShell/comments/wpykc/first_day_with_powershell_and_need_some/,"I have been working with PowerShell for all of 5 hours today working on a script that will allow me and other techs to rename computers on our AD.  The script (is that even the proper terminology) anyways it works when I run it using PowerShell Modules.  The issues I run into is when I try to run by right clicking and select **Run with PowerShell**.  I'm not sure if I'm running the script incorrectly or perhaps I have imported a module properly. 

Not sure if it's needed but here is the code

    Write-Host ""-----------------------------------------------------""
    Write-Host ""pcRenamifier v2.0""
    Write-Host ""Author: rbevans""
    Write-Host ""-----------------------------------------------------""
    Set-ExecutionPolicy -ExecutionPolicy Unrestricted
    Write-Host ""--Please Login using a.account--""
    #login
    $credential = Get-Credential
    #Main
    Write-Host ""--Remote Computer Rename v2.0--""
    Write-Host ""1. Query AD (Outputs to a text file)""
    Write-Host ""2. Quick computer rename""
    $choice=Read-Host ""Chose a number to continue""
    
    #AD Query for computer
    if($choice -eq 1)
    {
    Write-Host --Enter first five characters of computer name or full computer name i.e. USCLT--
    $cn=Read-Host 'Computer name'
    $out=""$cn*""
    Get-ADComputer -Filter 'SamAccountName -like $out' &gt;&gt; c:\myscripts\dsquery.txt
    Write-Host ""Query complete.  See Query.txt saved to Desktop.""
    }
    elseif($choice -eq 2)
    {
    $old=Read-Host ""Enter current computer name""
    $new=Read-Host ""Enter new computer name""
    }
    
    #checking AD for computer
    $findPC=Get-WmiObject -Class Win32_OperatingSystem -ComputerName $old
    if($findpc -eq $null)
    #computer not found
    {
    ""Computer not found in Active Directory.  Please try again.""
    }
    else
    {
    #computer rename
    ""Computer found in Active Directory! Please wait...""
    Get-WmiObject Win32_ComputerSystem -ComputerName $old -Authentication 6 | ForEach-Object {$_.Rename($new,$credential.GetNetworkCredential().Password,$credential.Username)}
    restart-computer $old
    ""Computer renamed and remote computer rebooting.  Have a nice day.""
    } ",,False,,t5_2qo1o,False,,,True,t3_wpykc,http://www.reddit.com/r/PowerShell/comments/wpykc/first_day_with_powershell_and_need_some/,
1342100503.0,8,self.PowerShell,wfvfl,Can anyone provide some guidance for why this isn't working? GCI/Where/Copy/Set-ItemProperty,8,0,8,http://www.reddit.com/r/PowerShell/comments/wfvfl/can_anyone_provide_some_guidance_for_why_this/,"The end goal is to move copies of purchase orders to a server (Server2) that houses my document management system.  I can't control a certain behavior of the document management system that moves the files out of the folder that I copy to on Server2... so I need a way to flag the original document on Server1 so I don't continually bring a new copy into document management.

Here is what I'm using:


    $Date = (get-date).AddDays(-5)
    $Dest = '\\M-App2\e$\Laserfiche\WfScanLocation\PO\Test'
    $Files = gci '\\Fritz-corp\Purchase Order' | Where-Object{$_.LastWriteTime -ge $Date -and $_.Attributes     -notMatch ""Archive""} | copy-item -dest $Dest
    foreach ($File in $Files){
    Set-ItemProperty $File.attributes -band [io.fileattributes]::Archive}

As you can see what I am doing is scanning the original folder for recent documents (5 days), checking the file attribute that says whether or not the file is archived, if not I am copying the file, and then attempting to set attribute archive on the original file.  I'm not getting the intended results, and it varies, especially when I change my date range.  I'm also copying files that already have archive set.  There is probably a better way I just don't know it.  Any help?",,False,,t5_2qo1o,1342215703.0,,,True,t3_wfvfl,http://www.reddit.com/r/PowerShell/comments/wfvfl/can_anyone_provide_some_guidance_for_why_this/,
1342007659.0,7,self.PowerShell,wdpvp,How do you retrieve a list of displaynames?,7,0,9,http://www.reddit.com/r/PowerShell/comments/wdpvp/how_do_you_retrieve_a_list_of_displaynames/,"N00b here. Basically I have a list of 1000+ userids that i need to retrieve the displaynames on so I can match them with a list of folder paths. What the easiest way to do this? It would be good if i can get them all into one long list but i cant figure out how to do it!

EDIT: Thanks for all your answers!",,False,,t5_2qo1o,1342014561.0,,,True,t3_wdpvp,http://www.reddit.com/r/PowerShell/comments/wdpvp/how_do_you_retrieve_a_list_of_displaynames/,
1341890963.0,6,self.PowerShell,wb4y7,Want to do something until a certain time? ,7,1,6,http://www.reddit.com/r/PowerShell/comments/wb4y7/want_to_do_something_until_a_certain_time/,"#Thought this was cool.  That is all.

While ((Get-Date -F hh:mm:ss) -lt '11:25:00') {echo Hello}

#assume the *something* is **echo hello** and the *time* is **11:25**",,False,,t5_2qo1o,1341924935.0,,,True,t3_wb4y7,http://www.reddit.com/r/PowerShell/comments/wb4y7/want_to_do_something_until_a_certain_time/,
1341502757.0,5,self.PowerShell,w2wf1,Powershell Version control,7,2,14,http://www.reddit.com/r/PowerShell/comments/w2wf1/powershell_version_control/,what do you guys use for version control for powershell? ,,False,,t5_2qo1o,False,,,True,t3_w2wf1,http://www.reddit.com/r/PowerShell/comments/w2wf1/powershell_version_control/,
1339156354.0,6,self.PowerShell,urfyr,New to powershell can anyone help with a script,7,1,12,http://www.reddit.com/r/PowerShell/comments/urfyr/new_to_powershell_can_anyone_help_with_a_script/,"I've managed to hash together some scripts to execute a command, in this instance it's a simple Nslookup.

The script creates an excel spreadsheet and reads from a file of domain names. The nslookup runs and I'm trying to see which IP addresses each are pointing to.

The output from an nslookup looks like this :
Server:  (DNS Server)
Address:  2.2.2.2

Non-authoritative answer:
Name:    SOME-DOMAIN.CO.UK
Address:  1.1.1.1
Aliases:  SOME-DOMAIN.CO.UK

Sometimes the nslookup comes back with nothing for non-existent domains.
What I need to happen is to take the ""Name"" ""Address"" and ""Alias"" and put these into their own cells next to the domain in the spreadsheet so the info for each domain is all in one row.

Can anyone help please, I'd really appreciate it.",,False,,t5_2qo1o,False,,,True,t3_urfyr,http://www.reddit.com/r/PowerShell/comments/urfyr/new_to_powershell_can_anyone_help_with_a_script/,
1338312246.0,7,self.PowerShell,uali3,Does anyone has experience with PoshWSUS?,8,1,9,http://www.reddit.com/r/PowerShell/comments/uali3/does_anyone_has_experience_with_poshwsus/,"I am trying to get a list of the servers that need updates, but only the ""security updates and critical updates""
I can differentiate the type of updates with ""Get-WSUSUpdateClassification"" and get the servers list with ""Get-WSUSUpdatePerClient"" but they show all needed updates.
Any suggestions?
Thanks",,False,,t5_2qo1o,False,,,True,t3_uali3,http://www.reddit.com/r/PowerShell/comments/uali3/does_anyone_has_experience_with_poshwsus/,
1337791707.0,5,self.PowerShell,u17zy,Powershell IF-Then error trapping question,7,2,6,http://www.reddit.com/r/PowerShell/comments/u17zy/powershell_ifthen_error_trapping_question/,"I am writing my first script to hand off to other users for account administration. I have a basic form with checkboxes that is generated by powershell. When the user clicks the apply button it will add the user entered into groups based on those. The problem I have is that I'd like to have some form of error trapping validation on the user name at the top. Ideally the script would exit without further processing if that failed. I've put the exit, end, end function, and break commands in there and none of them seem to to be stopping the process. 

I know that I'm missing some simple PS command that would accomplish this because when the script gets to the end the application doesn't exit at all, which would be that same function.",,False,,t5_2qo1o,False,,,True,t3_u17zy,http://www.reddit.com/r/PowerShell/comments/u17zy/powershell_ifthen_error_trapping_question/,
1337190597.0,6,vexasoft.com,tq9cp,Vexasoft cmdlets for System Administrators?,7,1,3,http://www.reddit.com/r/PowerShell/comments/tq9cp/vexasoft_cmdlets_for_system_administrators/,,,False,,t5_2qo1o,False,,,False,t3_tq9cp,http://www.vexasoft.com/cmdletlibrary/,
1336789275.0,7,dilutedthoughts.wordpress.com,tj4s5,"I did a project at work that required some 
PowerShell coding, and I thought I'd share some 
info on it.",9,2,5,http://www.reddit.com/r/PowerShell/comments/tj4s5/i_did_a_project_at_work_that_required_some/,,,False,,t5_2qo1o,False,,,False,t3_tj4s5,http://dilutedthoughts.wordpress.com/2012/05/12/leftronic-display-its-pretty-cool/,
1336669624.0,8,self.PowerShell,tgpzj,Need help calculating uptime,10,2,7,http://www.reddit.com/r/PowerShell/comments/tgpzj/need_help_calculating_uptime/,"Hey guys, I've been trying to make a script that calculates the uptime for a list of computers in a text file. However if there is more than one computer listed in the text file the script won't work. Here's the script:

    Param ( 
           $computerName
          )
    $wmi = Get-WmiObject - class Win32_OperatingSystem -computer 
    (gc $computerName)
    $LBTime = $wmi.ConvertToDateTime($wmi.Lastbootuptime)
    [Timespan]$uptime = New-Timespan $LBTime $(Get-Date)

    Write-Host $computerName ""Uptime: "" $uptime.days ""Days"" $uptime.hours
    ""Hours"" $uptime.minutes ""minutes"" $uptime.seconds ""seconds""

Any help would be greatly appreciated!",,False,,t5_2qo1o,False,,,True,t3_tgpzj,http://www.reddit.com/r/PowerShell/comments/tgpzj/need_help_calculating_uptime/,
1336570308.0,7,self.PowerShell,tennb,The use of a file with variables,8,1,12,http://www.reddit.com/r/PowerShell/comments/tennb/the_use_of_a_file_with_variables/,"I am creating a large script that automates dcpromo, dns settings, dhcp, shared folders, gpo creation+linking. I am almost done with the script(s) but now I was wondering if I can maybe place all the variables I use into a text or other file. So that when I have to change the settings for a different client/domain I can just change that file and let the scripts run without interaction.

Right now I change the variables with Read-Host commands.

(When my project is complete I might post the scripts if there is interest)",,False,,t5_2qo1o,False,,,True,t3_tennb,http://www.reddit.com/r/PowerShell/comments/tennb/the_use_of_a_file_with_variables/,
1335806962.0,8,self.PowerShell,t00il,Old-school style indeterminate progress indicator,10,2,4,http://www.reddit.com/r/PowerShell/comments/t00il/oldschool_style_indeterminate_progress_indicator/,"Here is the script:

    function BlastFromThePast(){
    	if(!$tickcounter){ Set-Variable -Name ""tickcounter"" -Scope global -Value 0 -Force -Option AllScope }
    	if(!$tickoption){ Set-Variable -Name ""tickoption"" -Scope global -Value 0 -Force -Option AllScope }
    	$chance = Get-Random -Minimum 1 -Maximum 10
    	if($chance -eq 5){ if($tickoption -eq 1){$tickoption = 0}else{$tickoption = 1} }
    	switch($tickoption){
    		0 {
    			switch($tickcounter){
    				0 { Write-Host ""`r|"" -NoNewline }
    				1 { Write-Host ""`r/"" -NoNewline }
    				2 { Write-Host ""`r-"" -NoNewline }
    				3 { Write-Host ""`r\"" -NoNewline }
    			}
    			break;
    		}
    		1 {
    			switch($tickcounter){
    				0 { Write-Host ""`r|"" -NoNewline }
    				1 { Write-Host ""`r\"" -NoNewline }
    				2 { Write-Host ""`r-"" -NoNewline }
    				3 { Write-Host ""`r/"" -NoNewline }
    			}
    			break;
    		}
    	}
    	if($tickcounter -eq 3){ $tickcounter = 0 }
    	else{ $tickcounter++ }
    }

It changes direction randomly, to confuse your user. If you want to test it, just call BlastFromThePast() by itself, and if you really want to see it in action, here is a handy loop:

    for($i=0;$i-lt200;$i++){BlastFromThePast; Start-Sleep -Milliseconds 100}Write-Host ""`r"" -no

enjoy!",,False,,t5_2qo1o,False,,,True,t3_t00il,http://www.reddit.com/r/PowerShell/comments/t00il/oldschool_style_indeterminate_progress_indicator/,
1334934656.0,6,self.PowerShell,sjqx3,Help request:  Creating users in a child domain and adding them to groups in the parent domain,7,1,5,http://www.reddit.com/r/PowerShell/comments/sjqx3/help_request_creating_users_in_a_child_domain_and/,"I can create the user object just fine with new-aduser and the -server param, but when I try to add the user to groups that are located in the parent domain I get various errors

       $user = get-aduser &lt;newEmployee&gt; -server child.domain.com
       $Memberof = (get-aduser &lt;TemplateFromParentDomain&gt; -properties memberof | select memberof).memberof

So $Member of contains a list of groups hosted in the parent domain, $user is part of our child domain.  The problem starts when I am using add-principaladgroupmembership.

      $memberof | % {add-adprinicipalgroupmembership -identity $User -memberof $_}


Returns error ""Cannot find object with identity &lt;DN of Group on parent&gt; under &lt;child DC&gt;.   So it can't find the parent group on the child server. So I specifiy the server to point to parent

    $memberof | % {add-adprinicipalgroupmembership -identity $User  -memberof $_ -server &lt;parentDC&gt;}

Returns error ""A referral was returned from the server"" 

       $memberof | % {add-adprinicipalgroupmembership -identity $User -memberof $_ -server &lt;parentDC&gt; -authtype basic}

Returns error ""Unable to contact the server. it is down or Active Directory web services are not running"" &lt;- paraphrase

Web services are running and everything else seems to run as expected.  

 

Any one else have any tricks to add parent security groups to child user accounts?  ",,False,,t5_2qo1o,False,,,True,t3_sjqx3,http://www.reddit.com/r/PowerShell/comments/sjqx3/help_request_creating_users_in_a_child_domain_and/,
1334898875.0,6,powershelladmin.com,sj6u5,"Pretty happy with this SSH module - until bugs appear, I'm sure. Enjoy?",7,1,2,http://www.reddit.com/r/PowerShell/comments/sj6u5/pretty_happy_with_this_ssh_module_until_bugs/,,,False,,t5_2qo1o,False,,,False,t3_sj6u5,http://www.powershelladmin.com/wiki/SSH_from_PowerShell_using_the_SSH.NET_library,
1334871821.0,7,joeit.wordpress.com,siig2,Find out if a specified hotfix is installed,7,0,3,http://www.reddit.com/r/PowerShell/comments/siig2/find_out_if_a_specified_hotfix_is_installed/,,,False,,t5_2qo1o,False,,,False,t3_siig2,http://joeit.wordpress.com/2012/04/09/powershell-function-find-hotfix/,
1334346175.0,9,self.PowerShell,s8f07,Script to query remote computers for a file and optionally copy if not found.,10,1,0,http://www.reddit.com/r/PowerShell/comments/s8f07/script_to_query_remote_computers_for_a_file_and/,"So boss mandated no changes to any servers on Friday the 13th so I played around with a script this afternoon.  I don't actually have a use for it and have only done basic debugging so take it as is or improve if you want.  If you do improve on it please post back, would love to see some functional critiques or what other people do with it.

There are three functions in this script, one that isn't even used but might be useful in the future.

The main function Query-FileOnComp takes the dns name of a computer and a local path.  It will return an object containing name/path/fileexist properties.  If an optional parameter of -UNCtoCopy is populated it will copy that file to the computer.

This relys on a function Convert-LocaltoUNCPath, which takes a DNS name and local path and will convert it into a UNC.

There is also a function Convert-UNCtoLocalPath which takes one parameter of a UNC and converts it to a local path.

The error trapping could be much more robust, but other than that has a few salvageable parts, all you can ask for 2 hours of lazy friday work.

[Script](http://pastebin.com/N1Bd0M3L)",,False,,t5_2qo1o,False,,,True,t3_s8f07,http://www.reddit.com/r/PowerShell/comments/s8f07/script_to_query_remote_computers_for_a_file_and/,
1329926039.0,7,csharpening.net,q10is,Windows PowerShell 3.0 First Look,8,1,0,http://www.reddit.com/r/PowerShell/comments/q10is/windows_powershell_30_first_look/,,,False,,t5_2qo1o,False,,,False,t3_q10is,http://csharpening.net/?p=897,
1326676301.0,6,csharpening.net,oimti,PowerShell 3: Generating Workflow Activities from Cmdlets ,7,1,1,http://www.reddit.com/r/PowerShell/comments/oimti/powershell_3_generating_workflow_activities_from/,,,False,,t5_2qo1o,False,,,False,t3_oimti,http://csharpening.net/?p=867,
1325878333.0,8,tomsitpro.com,o5rqz,Easily Add Users to Active Directory with PowerShell,11,3,6,http://www.reddit.com/r/PowerShell/comments/o5rqz/easily_add_users_to_active_directory_with/,,,False,,t5_2qo1o,False,,,False,t3_o5rqz,"http://www.tomsitpro.com/articles/active-directory-powershell-windows-administration-microsoft-cmdlets,2-236.html",
1325111707.0,8,self.PowerShell,nu4kz,Powershell to control Network Adapters,8,0,11,http://www.reddit.com/r/PowerShell/comments/nu4kz/powershell_to_control_network_adapters/,"I have a need to disable wireless connections when a wired connection is present, but would like the wireless adapter to be re-enabled when no wired connection is present.  All clients are Windows 7.

My plan is to Deploy signed powershell scripts to users system via GPO, and using a GPO script to set up an event monitor for MSNdis_StatusMediaConnect (which will call a script to find and disable wireless) and another monitor for MSNdis_StatusMediaDisconnect (Which will enable all adapaters without virtual in the name).

I am looking at using system.Net.NetworkInformation.NetworkInterface to find the wireless interfaces, but will use wmi's win32_NetworkAdapter class for enabling and disabling.

Just wondering if someone has already done something like this, and would share, or if some of my plan seems bad to start with.",,False,,t5_2qo1o,False,,,True,t3_nu4kz,http://www.reddit.com/r/PowerShell/comments/nu4kz/powershell_to_control_network_adapters/,
1317312905.0,7,powershelladmin.com,kvehp,"This should be a usable script for generic AD user password expiration notification. Adapt as necessary. ""Caveat"": Quest ActiveRoles needed.",7,0,0,http://www.reddit.com/r/PowerShell/comments/kvehp/this_should_be_a_usable_script_for_generic_ad/,,,False,,t5_2qo1o,False,,,False,t3_kvehp,http://www.powershelladmin.com/wiki/Active_directory_password_expiration_notification,
1311364090.0,8,self.PowerShell,ix33a,Runspace performance,8,0,2,http://www.reddit.com/r/PowerShell/comments/ix33a/runspace_performance/,"I have a particular script that needs to ping a list of servers (most of which are down). At first, this was done sequentially; then with powershell Jobs, and finally I converted it over to using runspaces. 


Sequentially: 20 Servers in approximately 2 Min 48 Sec

Jobs: 52 Seconds

Runspaces: 9.6-11.8 seconds


I noticed in this testing that using runspaces seems to run times on the order of 9.6 seconds if I only use 1 runspace, and sees no improvement from adding more runspaces. Shouldn't a single runspace have times around the same as running it sequentially? 

[code](http://pastebin.com/L2FcdUii)",,False,,t5_2qo1o,False,,,True,t3_ix33a,http://www.reddit.com/r/PowerShell/comments/ix33a/runspace_performance/,
1309970391.0,6,self.PowerShell,ii849,"Inherited a PowerShell task – longtime sysadmin, but in over my head please help!",8,2,14,http://www.reddit.com/r/PowerShell/comments/ii849/inherited_a_powershell_task_longtime_sysadmin_but/,"I’m new to Powershell, though years ago used VB to write some basic scripts and long ago I would write batch files in notepad, but I’m struggling with this. Fortunately it’s a tiny part of my job. 

I’ve recently inherited a bunch of scripts used in setting up our test environment domain controller. After creating the server we run this script to set up active directory, create 6 default users and set up SQL. 
I was just given the task  of modifying the script to also set the 6 domain accounts to have the passwords never expire. Unfortunately I cannot use the Quest cmdlets, or any other due to the insane approval and testing process mandated here. It would take too long to get through approval at this point in the project. 
So I keep trying to use ADSI methods I have found all over the net to no avail. I’m missing something as I constantly end up with it bombing and the change not happening to the accounts. 

I have tried inserting this in the function that creates the accounts and it dies on all 6 accounts
$objworker.userflags = 65536 -bor 64
$objworker.SetInfo()

I also tried, at the end of the script, to insert this to just change one account, and it fails too
$user = [ADSI]""LDAP://TestUser""
$currentUAC = [int]($user.userAccountControl.ToString())
$newUAC =  $currentUAC -bor 65536
$user.put(""userAccountControl"",$newUAC)
$user.SetInfo()

I would be fine with inserting a line at the end of the script for each account, if I knew how. Ideally I would like to add a line to the function that creates them so it would happen for all 6, but at this point I just need it to work. Unfortunately I told my boss it would be pretty simple to have the accounts we already created never expire, before I realized I didn't know how to do it without using the Quest AD cmdlet  ",,False,,t5_2qo1o,False,,,True,t3_ii849,http://www.reddit.com/r/PowerShell/comments/ii849/inherited_a_powershell_task_longtime_sysadmin_but/,
1308330989.0,6,windowsitpro.com,i2a1n,Get to Know the PowerShell ISE,10,4,3,http://www.reddit.com/r/PowerShell/comments/i2a1n/get_to_know_the_powershell_ise/,,,False,,t5_2qo1o,False,,,False,t3_i2a1n,http://www.windowsitpro.com/print/scripting/Get%20to%20Know%20the%20PowerShell%20ISE-136036,
1308255410.0,7,windowsitpro.com,i1in4,Why Can't I Pipe Format-Table to Export-CSV?,8,1,2,http://www.reddit.com/r/PowerShell/comments/i1in4/why_cant_i_pipe_formattable_to_exportcsv/,,,False,,t5_2qo1o,False,,,False,t3_i1in4,http://www.windowsitpro.com/blog/powershell-with-a-purpose-blog-36/windows-powershell/why-cant-i-pipe-format-table-to-export-csv-139488,
1307846234.0,7,self.PowerShell,hxj60,Script that encrypts folders and sends the compressed files to a dropbox folder,9,2,3,http://www.reddit.com/r/PowerShell/comments/hxj60/script_that_encrypts_folders_and_sends_the/,"Script is [here](http://pastebin.com/x0JLxXGv)

I welcome any critiques.",,False,,t5_2qo1o,True,,,True,t3_hxj60,http://www.reddit.com/r/PowerShell/comments/hxj60/script_that_encrypts_folders_and_sends_the/,
1376924034.0,6,self.PowerShell,1ko33m,Finding if value is in an Object array,7,1,0,http://www.reddit.com/r/PowerShell/comments/1ko33m/finding_if_value_is_in_an_object_array/,"I was going to post a question asking about this but figured it out at the last minute. So since I had most of it typed out anyway, I'll post it as a hint to others. 

I'm periodically processing events and to avoid processing duplicate events, I want to check the event key to make sure it doesn't match any previous events. 

I'm trying variations around:

    if (($prevEvents | Select Key) -contains $nextNewEvent.Key) { 
        # skip event
    }
    else { 
        # process event
    }

But since the first portion is an array of objects and the second is a value, it will consistently return False. 

To make sure you are comparing apples to apples, make sure your array is just of scalar values:

    if (@(($prevEvents | Select Key).Key) -contains $nextNewEvent.Key) { 
        # skip event
    }
    else { 
        # process event
    }

And that appears to work.",,False,,t5_2qo1o,False,,,True,t3_1ko33m,http://www.reddit.com/r/PowerShell/comments/1ko33m/finding_if_value_is_in_an_object_array/,
1375833539.0,5,self.PowerShell,1jujj1,"[AD] [Help] Trying to automate user archival process, need help with working with arrays from AD",6,1,5,http://www.reddit.com/r/PowerShell/comments/1jujj1/ad_help_trying_to_automate_user_archival_process/,"Hey guys,

Basically I've been tasked with automating the user archival process here at work. The process involves taking all users in the Awaiting Deletion OU in Active Directory, move their home drive to the archive location, export their mailbox to the archive location and then delete their AD account/mailbox.

I am having troubles with getting the list of users into an array that allows me to work from there.

Currently this is the code I have:
     import-module activedirectory

     # gets the date of 60 days ago
     $setdate = (get-date).adddays(-60)

     #gets the users from the Awaiting Deletion OU in Active Directory that are older than 60 days old. Lists the users account name
     $userlist = @(get-aduser -Filter 'whenchanged -lt $setdate' -searchbase ""OU=Awaiting Deletion,OU=Company Staff,DC=company,DC=org,DC=au"" | ft samaccountname)

At the moment it gets the correct list of users, however I can't do anything with the resulting array.

I can pipe it into a file using out-file and it looks normal to me. But when I try to call it using $userlist[5] I can an error.

I believe it should give me the 5th entry in the array, however I get this error:

    out-lineoutput : The object of type ""Microsoft.PowerShell.Commands.Internal.Format.FormatEntryData"" is not     valid or n
     in the correct sequence. This is likely caused by a user-specified ""format-*"" command which is conflicting with the
    fault formatting.
         + CategoryInfo          : InvalidData: (:) [out-lineoutput], InvalidOperationException
        + FullyQualifiedErrorId :       ConsoleLineOutputOutOfSequencePacket,Microsoft.PowerShell.Commands.OutLineOutputCommand
",[Active Directory],False,,t5_2qo1o,1375855171.0,,,True,t3_1jujj1,http://www.reddit.com/r/PowerShell/comments/1jujj1/ad_help_trying_to_automate_user_archival_process/,
1374778526.0,6,self.PowerShell,1j1mz3,Script to get Calendar Permissions,6,0,9,http://www.reddit.com/r/PowerShell/comments/1j1mz3/script_to_get_calendar_permissions/,"Had to share this, don't know if it's amazing or whatever but I'm proud of it. HR requested a listing of everyone that has permission on the calendars for Attorneys here in the firm.

    #Delete the output so we get clean output each time.
    Remove-Item H:\PowerShell\PHXMailboxPermissions.txt
    
    #Query AD for listing of group members, format that listing into acceptable format for get-mbxperms and output to txt
    Get-AdGroupMember ""Phoenix Attorneys"" | Select-Object SamAccountName | ForEach-Object {
    
    $user=$_.SamAccountName
    
    $path=$user+”:\Calendar”
    
    Get-MailboxFolderPermission -identity $path |ft -Wrap $path,User,AccessRights | Out-file -Append H:\Powershell\PHXMailboxPermissions.txt
    }

Outputs to a nice formatted table like so.

user1:\Calendar                  User                                    AccessRights                           
----------------------                  ----                                    ------------                           
                                        Default                                 {AvailabilityOnly}                     
                                        user2                                   {Editor}                               
                                        user3                                   {Owner}                                
                                        user4                                   {Editor}                               
                                        user5                                   {Editor}                               
                                        user6                                   {Editor} 


Any input on this is appreciated, always looking to get better.",,False,,t5_2qo1o,False,,,True,t3_1j1mz3,http://www.reddit.com/r/PowerShell/comments/1j1mz3/script_to_get_calendar_permissions/,
1374432779.0,6,self.PowerShell,1irh4j,What is the best Script Editor to use with Poweshell v3,7,1,21,http://www.reddit.com/r/PowerShell/comments/1irh4j/what_is_the_best_script_editor_to_use_with/,"I've finally taken the plunge and started my switch from VBS to Powershell scripting. I've used textpad historically but looking to see if there is a preference using another editor? Please advise some alternatives. Free or cheap as possible is always preferred! 
:-D
Thanks!",,False,,t5_2qo1o,False,,,True,t3_1irh4j,http://www.reddit.com/r/PowerShell/comments/1irh4j/what_is_the_best_script_editor_to_use_with/,
1374154471.0,4,self.PowerShell,1ik2za,Get-Printer status and email results if not 'ready',7,3,3,http://www.reddit.com/r/PowerShell/comments/1ik2za/getprinter_status_and_email_results_if_not_ready/,"Hi all,

I have a task which would solve a problem that comes up about once every two weeks. We have several label printers for our products and when one of them runs out of paper or ink, it locks up a printing application for our ERP and generally causes headaches for our large customer service department and purchasing department, as their docs all print through this app. I know exactly how I want this script to work, and even have most of the code written... but when I run this:


    $printers = get-printer -computer $printserver


and then:


    $printers.status


I get no results back. I'm running it against 50ish printers so I really do expect *something* back for at least some of them. Should I run this through some sort of a foreach or narrow my array down to $printer.status? I'm hopeful this will work...

Thanks!",,False,,t5_2qo1o,False,,,True,t3_1ik2za,http://www.reddit.com/r/PowerShell/comments/1ik2za/getprinter_status_and_email_results_if_not_ready/,
1374036809.0,6,self.PowerShell,1igt6e,Some little functions for getting Wlan information,6,0,0,http://www.reddit.com/r/PowerShell/comments/1igt6e/some_little_functions_for_getting_wlan_information/,"Some more handy little functions I've been meaning to share:

    function Get-WlanConnection
    {
        $netsh = netsh wlan show interfaces
    
        $returnObject = New-Object psobject
    
        foreach ($line in $netsh)
        {
            if ((!($line.StartsWith('There '))) -and $line -ne '')
            {
                $PropertyName = (Get-Culture).TextInfo.ToTitleCase($line.Trim().Substring(0,24).Replace(':', '').Trim()).Replace(' ', '').Replace('(','').Replace(')','')
                $PropertyValue = $line.TrimStart().SubString(24).Trim()
                Add-Member -InputObject $returnObject -MemberType NoteProperty -Name $PropertyName -Value $PropertyValue
            }
        }
    
        return $returnObject
    }
    
    function Get-WlanSSID
    {
        return (Get-WlanConnection).SSID   
    }
    
    function Get-WlanSignal
    {
        return (Get-WlanConnection).Signal
    }",,False,,t5_2qo1o,False,,,True,t3_1igt6e,http://www.reddit.com/r/PowerShell/comments/1igt6e/some_little_functions_for_getting_wlan_information/,
1373641150.0,5,blogs.technet.com,1i5men,Setting out of office replies from PowerShell,7,2,1,http://www.reddit.com/r/PowerShell/comments/1i5men/setting_out_of_office_replies_from_powershell/,,,False,,t5_2qo1o,False,,,False,t3_1i5men,http://blogs.technet.com/b/exchange/archive/2011/09/08/configure-automatic-replies-for-a-user-in-exchange-2010.aspx,
1370993471.0,5,self.PowerShell,1g5q18,Filtering AD users who don't have a matching UPN and email address.,7,2,17,http://www.reddit.com/r/PowerShell/comments/1g5q18/filtering_ad_users_who_dont_have_a_matching_upn/,"Do to a policy shift I have to go through our Active Directory and find users whose first name is different than what it is in their display name/email address and set their log in as their preferred name.

For example I have the user Robert Smith.

GivenName = Robert

Surname = Smith

Display Name = Smith, Bob

Email Address = Bob.Smith@contoso.com

**Logon/UPN = Robert.Smith@contoso.com** This is what needs to change.

Luckily enough all of the email addresses of these users reflect the desired logon/UPN. So if I can search or query active directory for users whose email address differs from their UPN I can get a list of who needs to be changed.

I am attempting to do a powershell search as such...

**Get-ADUser -f {UserPrincipalName -ne 'EmailAddress'}**

Obviously that doesn't work. It was my first attempt. That just searches for users whose email doesn't equal that value. And that's where I got stuck. I am not able to figure out how to implement to Mail/EmailAddress syntax for the filter to check against. Any advice?",,False,,t5_2qo1o,False,,,True,t3_1g5q18,http://www.reddit.com/r/PowerShell/comments/1g5q18/filtering_ad_users_who_dont_have_a_matching_upn/,
1370974659.0,5,self.PowerShell,1g4y4p,Help with a deletion script please?,7,2,5,http://www.reddit.com/r/PowerShell/comments/1g4y4p/help_with_a_deletion_script_please/,"So here is the situation, we have our my documents folders redirected to a network drive for a several hundred users, as we recently found out if you delete something from the my documents drive and it is under a certain size (several gigabytes) it gets stored on a hidden folder under my documents\$RECYCLE.BIN . I want to delete all items older than 30 days from this drive, and this one only, I want to do this from the server. I am getting stuck on how to do this, so far I have this to list the contents


get-childitem ""D:\home\*\my documents\`$RECYCLE.BIN"" -recurse

the home drive is where their documents are stored, with a name where the star is, this command lists nothing, however when I try the same command but substitute a name for the * portion, it lists several items that are in the recycle bin. I have no idea why a wildcard would change this, and I can't move forward till I fix this.

Any help would be massively appreciated.


EDIT:It looks like all files from all the recycle bin folders in all the my document folders go to the servers local recycle bin, so deleting it from there would work also",,False,,t5_2qo1o,1370975624.0,,,True,t3_1g4y4p,http://www.reddit.com/r/PowerShell/comments/1g4y4p/help_with_a_deletion_script_please/,
1370961106.0,6,self.PowerShell,1g4eya,Powershell and SCCM Reports,9,3,3,http://www.reddit.com/r/PowerShell/comments/1g4eya/powershell_and_sccm_reports/,"Does anybody know how to run a report from SCCM 2012 SP1 in Powershell? What I'd like to do is be able to create a Powershell script that queries each collection to gather what software is installed on those machines..

Any other ideas for going about this are welcome!",,False,,t5_2qo1o,False,,,True,t3_1g4eya,http://www.reddit.com/r/PowerShell/comments/1g4eya/powershell_and_sccm_reports/,
1370646851.0,6,whenindoubtbacon.wordpress.com,1fw8k1,Windows 7 Server 2008 R2 Printer Management Module,6,0,0,http://www.reddit.com/r/PowerShell/comments/1fw8k1/windows_7_server_2008_r2_printer_management_module/,,,False,,t5_2qo1o,False,,,False,t3_1fw8k1,http://whenindoubtbacon.wordpress.com/2013/06/07/windows-7-server-2008-r2-powershell-printer-management-module/,
1370456329.0,6,self.PowerShell,1fqijf,Create shortcut with computer name insterted,6,0,5,http://www.reddit.com/r/PowerShell/comments/1fqijf/create_shortcut_with_computer_name_insterted/,"I have a program that needs an internet shortcut to run. The shortcut is like this http://server/jha/ui/sl999.html?COMPUTERNAMEg1


Is there anyway to inject that computer name into the shortcut with a script?

Update: Thanks for all the help guys! Looks like the vendor of this has a way that the shortcut can pull form an ini file that maps the computer name to the required ID. 

So I now have a generic url that can be deployed, and just a single ini file i have to update. ",,False,,t5_2qo1o,1370614887.0,,,True,t3_1fqijf,http://www.reddit.com/r/PowerShell/comments/1fqijf/create_shortcut_with_computer_name_insterted/,
1370400317.0,6,bink.nu,1fp38y,Powershell 4.0 - Desired State Configuration,8,2,8,http://www.reddit.com/r/PowerShell/comments/1fp38y/powershell_40_desired_state_configuration/,,,False,,t5_2qo1o,False,,,False,t3_1fp38y,http://bink.nu/powershell-4.0-desired-state-configuration,
1369964731.0,6,self.PowerShell,1fdlm7,"A request for help, finding file locations from get-process?",6,0,7,http://www.reddit.com/r/PowerShell/comments/1fdlm7/a_request_for_help_finding_file_locations_from/,"Here's my goal, list open files and their locations on a remote computer. i do not have winrm enabled on workstations (yet) so i don't have that option. i can get the file location of the process, get-process | select path, for example, but i would like to know the location of the file opened if applicable. say if an excel file had a network located sheet open, i'd like to list that info by querying a remote computer. similar to lsof in unix. thoughts?",,False,,t5_2qo1o,False,,,True,t3_1fdlm7,http://www.reddit.com/r/PowerShell/comments/1fdlm7/a_request_for_help_finding_file_locations_from/,
1369850358.0,6,self.PowerShell,1fa5co,Evaluating various ways to encrypt/store sensitive credentials (.NET and KeePass+KPScript),7,1,6,http://www.reddit.com/r/PowerShell/comments/1fa5co/evaluating_various_ways_to_encryptstore_sensitive/,"So, let's say you're writing a script that needs to use more than a few different (e.g. backup operator) creds on differing domains--and these domains have no trusts/ADFS. But, you don't want to have to enter this set of creds every time.

Write the creds to a text file, amirite? Just kidding.

I've spent some spare time dabling in a few POC how to approach this, and sadly yes you'll have to write creds to disk at some point.

So, I'd appreciate any thoughts. If this is one of those ""give up now lest"" situations, that's an acceptable answer too.

---
####Method 1: .NET
----
[pastebin](http://pastebin.com/M17uVBzT)

This will take a list of computers with FQDN and try to gather credentials for each individual domain (e.g. ""FOO.CORP.LOCAL, BAR.BAZ-CORP.COM, FOO"" etc). It then tries to encrypt and export the credentials into an xml file that can be re-imported later and decrypted using the master password.

I had seen a lot of examples that used the simple rijndael provider, but my network has FIPS encryption enabled which will not allow this type of encryption. 

My main concern with this is I don't have enough experience with using these crypo providers, and there could easily be all manner of mistakes.

---
###Method 2: KeePass + KPScript
----
[reference](http://keepass.info/help/v2_dev/scr_sc_index.html)  
[pastebin](http://pastebin.com/M1Qb8wUH)

Why re-invent the wheel, right? My major issue with this is the output isn't great, and as noted there are some potential issues with [console encoding](http://keepass.info/help/kb/console_encoding.html) especially on pre-W7.

If this was extended, it would probably rely on querying the KDBX for an entry match on the domain.",,False,,t5_2qo1o,False,,,True,t3_1fa5co,http://www.reddit.com/r/PowerShell/comments/1fa5co/evaluating_various_ways_to_encryptstore_sensitive/,
1369764439.0,6,self.PowerShell,1f7nwf,WinRM allowing remote sessions for all servers...except 2!,7,1,8,http://www.reddit.com/r/PowerShell/comments/1f7nwf/winrm_allowing_remote_sessions_for_all/,"I've got remote sessions working on 36 of 38 remote file servers (50-50 mix of 2008 and 2003 R2). Those last two are both 2003 R2, but both appear to have WinRM configured and functional...I just can't create a session to them.

Here's some tests

Server1: 

* Local test: 
    * &gt;winrm e winrm/config/listener
        * Listener [Source=""GPO""]
        * Address = *
        * Transport = HTTP
        * Port = 5985
        * (etc.)
 * Remote test:
    * &gt;winrm get wmicimv2/Win32_Service?Name=WinRM -r:server1 Win32_Service
        * AcceptPause = false
        * AcceptStop = true
        * Caption = Windows Remote Management (WS-Management)
        * CheckPoint = 0
        * CreationClassName = Win32_Service
        * Description = Allows access to management information from local and remote machines.
        * (etc.)

Server 2 test results are identical, and these results are also identical for other, functional, file servers. My guess is that the only other potential difference is on the network side of things, but I wanted to get another opinion while I ask the network staff to look into it. Any advice welcome!",,False,,t5_2qo1o,False,,,True,t3_1f7nwf,http://www.reddit.com/r/PowerShell/comments/1f7nwf/winrm_allowing_remote_sessions_for_all/,
1369743530.0,6,self.PowerShell,1f713v,Only print the files with the archive bit set?,6,0,6,http://www.reddit.com/r/PowerShell/comments/1f713v/only_print_the_files_with_the_archive_bit_set/,"Hello, we are trying to list all the files in a directory (And subdirectorys) with the archive bit set. However, we need the full path to the files to be listed. We've been trying with this piece of code; Get-ChildItem $filesToBackup -recurse | Where-Object {$_.mode -match ""a""} | Select-Object fullname which works in the Powershellterminalthingy, but our script does not work. Any help would be appreciated. 
Function: 
$files = Get-ChildItem $filesToBackup -recurse | Where-Object {$_.mode -match ""a""} | Select-Object fullname 
$files | Copy-Item -destination $destination -force",,False,,t5_2qo1o,False,,,True,t3_1f713v,http://www.reddit.com/r/PowerShell/comments/1f713v/only_print_the_files_with_the_archive_bit_set/,
1369007043.0,5,self.PowerShell,1ent1y,What am i doing wrong?,8,3,13,http://www.reddit.com/r/PowerShell/comments/1ent1y/what_am_i_doing_wrong/,"I'm not sure why this isn't working?

    $cwd=get-location 
    $destpath=$cwd+'QAS\'

I thought i might be able to get this working, which also doesn't work?

     $cwd=get-location 
     $QASExtension='QAS\'
     $QASInstallFiles=$cwd+$QASExtension

What am I doing wrong? is there a better way to get the cwd?
This example is to robocopy files for a deployed folder(we use sccm, but also run it from the software depositary manually)?


Edit: fixed by implementing these three lines lines

    $invocation = (Get-Variable MyInvocation).Value 
    $cwd = Split-Path $invocation.MyCommand.Path
    $destpath=$cwd+'QAS\'",,False,,t5_2qo1o,1369017679.0,,,True,t3_1ent1y,http://www.reddit.com/r/PowerShell/comments/1ent1y/what_am_i_doing_wrong/,
1368725243.0,6,self.PowerShell,1egmy3,"So close, yet so far... removing users in specific OUs from all groups.",7,1,20,http://www.reddit.com/r/PowerShell/comments/1egmy3/so_close_yet_so_far_removing_users_in_specific/,"My office has multiple locations and an OU for each site. Within each OU, we have a sub-OU for termed employees. I want to set up a command that will strip anyone in one of those term'd folders out of all their security/distribution groups.

What's killing me is that while this works to strip the group memberships:

&gt; $users = get-aduser -filter *| ? {$_.DistinguishedName -like ""*OU=TestOU,DC=companyname,DC=com""}

&gt; foreach ($user in $users) {
    $groups = Get-ADUser $user -Properties memberof | select -exp memberof
    foreach ($group in $groups) {
        Get-ADGroup $group | % {Remove-ADGroupMember $_ -WhatIf -Members $user}
        }
    }

And this works to get my users out of all of my Term OUs:

&gt; $users = get-aduser -filter *| ? {$_.DistinguishedName -like ""*OU=Termed,OU=Site-A,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-B,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-C,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-D,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-E,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-F,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-G,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com""}

when I put it all together, it fails (""Get-ADGroup : Cannot validate argument on parameter 'Identity'. The argument is  null. Supply a non-null argument and try the command again.""):

&gt; $users = get-aduser -filter *| ? {$_.DistinguishedName -like ""*OU=Termed,OU=Site-A,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-B,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-C,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-D,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-E,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-F,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com"" -or $_.DistinguishedName -like ""*OU=Termed,OU=Site-G,OU=WorkstationUsers,OU=AuthorizedUsers,DC=CompanyName,DC=com""}&gt;

&gt; foreach ($user in $users) {
    $groups = Get-ADUser $user -Properties memberof | select -exp memberof
   foreach ($group in $groups) {
        Get-ADGroup $group | % {Remove-ADGroupMember $_ -WhatIf -Members $user -Confirm:$false}
        }
    }

Any ideas what I'm missing here? 

Bonus e-points if you can pull it off without using the Quest AD tools/commands. While I like them, I don't have them installed on every machine &amp; I'd like this to be functional on any DC I hop onto.



**Delayed edit**, the final working product (with formatting!). (Note: as /u/dash488 has pointed out, my end result doesn't perform the large-scale batch that I was originally going for. Instead, this prompts for a specific user and then pulls them out of all their groups):

    # Get target user
    If ($args[0] -eq $null) 
    { 
        $strUserName = Read-Host ""Enter the usersname"" 
    } 
        Else 
    { 
        $strUserName = $args[0] 
    } 

    #Remove from groups
    $groupmembership = get-aduser $strUserName -properties memberof | select -ExpandPropert memberof

    foreach ($item in $groupmembership){
        remove-adgroupmember $item -members $strUserName -Confirm:$false
    }",,False,,t5_2qo1o,1369080797.0,,,True,t3_1egmy3,http://www.reddit.com/r/PowerShell/comments/1egmy3/so_close_yet_so_far_removing_users_in_specific/,
1368596261.0,5,self.PowerShell,1ed8j9,SCCM Deployment Tool (GUI) [x-post from sysadmin],6,1,4,http://www.reddit.com/r/PowerShell/comments/1ed8j9/sccm_deployment_tool_gui_xpost_from_sysadmin/,"After some good feedback from the sysadmin subreddit, they pointed me here. Thought some of you could find it useful. 

http://www.reddit.com/r/sysadmin/comments/1ed7b7/sccm_deployment_tool_v20/


Its a Powershell GUI which ties into SCCM 2012 to give you a quicker method of seeing all SCCM packages, sort by manufacturer, program name and version, and deploy without having to go through the millions of screens. 


Let me know what you think. ",,False,,t5_2qo1o,False,,,True,t3_1ed8j9,http://www.reddit.com/r/PowerShell/comments/1ed8j9/sccm_deployment_tool_gui_xpost_from_sysadmin/,
1368099890.0,6,self.PowerShell,1dzumt,Pulling data from a ComboBox,6,0,7,http://www.reddit.com/r/PowerShell/comments/1dzumt/pulling_data_from_a_combobox/,"I am relatively new to PowerShell and have been banging my head over this little problem for a bit now. I am trying to get a function to use a selected item from a ComboBox that is randomly generated.

I am populating the box as such:

`foreach($ou in $DropDownArray )`
`{`
 `[void]$ouBox.Items.add($ou.Name)`
`}`

The Array is:

`$DropdownArray = Get-ADOrganizationalUnit -LDAPFilter '(name=*)' -SearchBase 'OU=Sample' -SearchScope Subtree | select Name`

The function I am using that is trying to actually use the selected OU:

`Function Add-ADCN`
`{ `

`$path = $ouBox.SelectedItem`

`$cnpath = $filelocText.Text`

`Get-content $cnpath | foreach {`
`New-ADComputer -Name $_.ToUpper() -SamAccountName $_.ToUpper() -Path $path -passthru`
    `}`
`} `

The ComboBox is displaying the names as opposed to the OU structure. When I set the ""$path"" manually to the OU it works beautifully but I can't seem to get it to pull from the ComboBox properly.

Any insight?

EDIT: To clarify the ""$DropdownArray"" is pulling in a subset of OU's. I have them displaying in ""$ouBox"" as ""Name"" instead of ""DistinguishedName"" which would be the proper OU. So I need to pull the ""DistinguishedName"" into the $path variable but still want it to display as ""Name"" in the ComboBox......",,False,,t5_2qo1o,1368109013.0,,,True,t3_1dzumt,http://www.reddit.com/r/PowerShell/comments/1dzumt/pulling_data_from_a_combobox/,
1367912995.0,7,self.PowerShell,1dun3w,Get-WMIObject Issues,7,0,8,http://www.reddit.com/r/PowerShell/comments/1dun3w/getwmiobject_issues/,"I am having issues with a Get-WMIObject command I am using in a script (it's being pumped into a where-object and I know it works because I have used it on other servers, although those are 2008 R2 and these are 2012.)

    Get-WmiObject -Namespace ""root/WebAdministration"" -Authentication 6 -ComputerName DB -Class Site
I am getting the below error when running it on DB (when I run it remotely from a different subnet I get an RPC error), the WMI service is running and I am a local administrator on the box.

The firewall is turned off and IIS Managment Scripts and Tools is installed.

    Get-WmiObject : Provider load failure
    At C:\Powershell\Test.ps1:10 char:13
    + $website2 = Get-WmiObject -Namespace ""root/WebAdministration"" -Authentication 6  ...
    +  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-WmiObject], ManagementException
    + FullyQualifiedErrorId : GetWMIManagementException,Microsoft.PowerShell.Commands.GetWmiObjectCommand

EDIT: I solved this issue by fixing the WMI permissions as they were incorrect for some reason even though they had not been touched, now I need to fix the DCOM communication between the servers to fix the RPC issue.

Thanks for all help thus far",,False,,t5_2qo1o,1368055716.0,,,True,t3_1dun3w,http://www.reddit.com/r/PowerShell/comments/1dun3w/getwmiobject_issues/,
1367445525.0,6,self.PowerShell,1did8x,"File Share Audit, Last Access Time",6,0,3,http://www.reddit.com/r/PowerShell/comments/1did8x/file_share_audit_last_access_time/,"I am trying to run a report on a share to find the last access time and output this to a csv file.

This is my code so far.

    get-childitem C:\share -recurse | where {!$_.PSIsContainer} | 
    select-object FullName, LastAccessTime | export-csv -notypeinformation -delimiter ',' -path C:\output.csv

Management would also like another column showing ""File Was Last Accessed"" x-number of days ago to make it easier at a glance to determine file age. I did find [this](https://ucirl.wordpress.com/2011/06/12/simple-powershell-script-to-check-what-files-have-not-been-accessed-in-over-30-days/) script, how would I combine the two and export them in a nice report?

Thanks!

",,False,,t5_2qo1o,False,,,True,t3_1did8x,http://www.reddit.com/r/PowerShell/comments/1did8x/file_share_audit_last_access_time/,
1367375166.0,6,self.PowerShell,1dgfni,Office 365 remove secondary email address for all users for one domain,8,2,5,http://www.reddit.com/r/PowerShell/comments/1dgfni/office_365_remove_secondary_email_address_for_all/,"Does anyone have a good script to remove any secondary email addresses that a user might have for a domain?  I am trying to remove an account from my o365 but I can't because I have a few hundred users that have this email domain as a secondary address.   I have tried some scripts that I have used in the past on an onpremise server but they are not working for O365.

We are not federated and currently haven't been moved to WAVE15.

",,False,,t5_2qo1o,False,,,True,t3_1dgfni,http://www.reddit.com/r/PowerShell/comments/1dgfni/office_365_remove_secondary_email_address_for_all/,
1366815646.0,7,self.PowerShell,1d0gnq,Printer Management and Powershell,7,0,14,http://www.reddit.com/r/PowerShell/comments/1d0gnq/printer_management_and_powershell/,"I'm one of the admins in charge of the print server where I work and I fucking hate dealing with it.

Assuming it's a printer that already has the driver installed on the server, is there a cmdlet to add printers or deal with them?",,False,,t5_2qo1o,False,,,True,t3_1d0gnq,http://www.reddit.com/r/PowerShell/comments/1d0gnq/printer_management_and_powershell/,
1366814561.0,5,self.PowerShell,1d0fcx,Check list of accounts against Active Directory for existence,7,2,3,http://www.reddit.com/r/PowerShell/comments/1d0fcx/check_list_of_accounts_against_active_directory/,"So I have a big list of IDs I need to verify against AD.  I need to know if they exist - Yes/No and dump the output to a csv: ID, Exists?

any thoughts?",,False,,t5_2qo1o,False,,,True,t3_1d0fcx,http://www.reddit.com/r/PowerShell/comments/1d0fcx/check_list_of_accounts_against_active_directory/,
1366217440.0,7,self.PowerShell,1cjjej,Filter Get-Eventlog with preset time(s) on a remote host,8,1,7,http://www.reddit.com/r/PowerShell/comments/1cjjej/filter_geteventlog_with_preset_times_on_a_remote/,"Hello all - 

For the past week or so, I've had quite the struggle getting the cmdlet 'Get-Eventlog' to perform something rather simple. My goal is to bind to a remote host and retrieve a list of specific logs within a specified period of time. 

First, I get the error listed below. Second, I currently have the script to output the event log from my local machine, as I can't seem to get 'Interval' section to return results from a remote host. 

The error I get is as follows:

    Get-EventLog : Parameter set cannot be resolved using the specified named parameters.
    At S:\scripts\Powershell\Event_Viewer.ps1:59 char:43
    +                           1 { Get-Eventlog &lt;&lt;&lt;&lt;  -Logname Application -list |
        + CategoryInfo          : InvalidArgument: (:) [Get-EventLog], ParameterBindingException
        + FullyQualifiedErrorId : AmbiguousParameterSet,Microsoft.PowerShell.Commands.GetEventLogCommand

Here is what I have so far:

        function Pause ($Message=""Press any key to continue...""){ 
            """" 
            Write-Host $Message 
            $null = $Host.UI.RawUI.ReadKey(""NoEcho,IncludeKeyDown"") 
        } 
         
         
        function GetCompName{ 
            $Compname = Read-Host ""Please enter a computer name or IP"" 
            CheckHost 
        } 
         
        function CheckHost{ 
            $ping = gwmi Win32_PingStatus -filter ""Address='$compname'"" 
            if($ping.StatusCode -eq 0){$pcip=$ping.ProtocolAddress; GetMenu} 
            else{Pause ""Host $compname down...Press any key to continue""; GetCompName} 
        } 
             
         function GetMenu { 
            Clear-Host 
            
                    "" *************************** ""
                    ""    ** Enter Selection **    ""
                    ""*****************************""
                    "" "" 
                    "" "" 
                    ""---- $compname ($pcip) -----""
                    """"
                    """"
                   ""1) Application Log""
                   ""2) Security Log""
                   ""3) System Log""
                   ""4) System Uptime""
                         """" 
                   ""C) Change Computer Name"" 
                   ""X) Exit The program"" 
            """" 
            $MenuSelection = Read-Host ""Enter Selection"" 
            GetInfo 
        } 
         function GetInfo{ 
            Clear-Host
            switch ($MenuSelection){ 
                1 { #Application Log 
                    
                                 
                                 ""1) 5 minutes""
                                 ""2) 30 minutes""
                                 ""3) 2 hours""
                                 ""4) 6 hours""
                                 ""5) 12 hours""
                                 ""6) 24 hours""
                                 ""7) 2 days""
                                 ""8) 3 days""
                                 
                                 $Interval = Read-Host ""Enter Selection""          
                    
                               Switch ($Interval){
                                  1 { Get-Eventlog -Logname Application -list | 
                                        Where { ($_.TimeWritten -gt (Get-date).AddMinutes(-5) ) }
                                    Pause 
                                    CheckHost 
                                    }
                                  }
                  } 
                   
                  } 
            c {Clear-Host;$compname="""";GetCompName} 
            x {Clear-Host; exit} 
            default{CheckHost} 
          } 
    } 
     
    #---------Start Main-------------- 
    $compname = $args[0] 
    if($compname){CheckHost} 
    else{GetCompname}

I've omitted some of the script to highlight the troublesome area. Thanks in advance for your help!",,False,,t5_2qo1o,1366218147.0,,,True,t3_1cjjej,http://www.reddit.com/r/PowerShell/comments/1cjjej/filter_geteventlog_with_preset_times_on_a_remote/,
1365461713.0,6,self.PowerShell,1by7j9,Trying to combine data from two cmdlets into one CSV (Office 365),6,0,8,http://www.reddit.com/r/PowerShell/comments/1by7j9/trying_to_combine_data_from_two_cmdlets_into_one/,"Office 365 has the cmdlet Get-MailboxPermission. However when it returns the ACL the user names are shown as the msol samaccountnames (ex NAMPROD04\Smi897987766). This of course is not very helpful. You can do a get-mailbox on each ACL entry. This gets you most DisplayName etc.  however does not return AccessRights.

I've written some script that will return all info but in two different variables. Ideally this will be in one output. I've Googled combining Powershell outputs but nothing seems to work. This is probably not that difficult to do but I just need a little guidance. Here's the code:

******************

    $MB = ""sharedmailbox@domain.com""
 
    write-host ""Checking Mailbox permissions for: ""  $MB -foregroundcolor ""yellow""

    $ACL = Get-MailboxPermission -Identity $MB

    $L1 = ($ACL | ForEach-Object {Get-Mailbox -Identity $_.User} | Select-Object DisplayName,UserPrincipalName,PrimarySmtpAddress)

    $L2 = ($ACL | Select-Object AccessRights)

    Write-Output $L1 $L2",,False,,t5_2qo1o,False,,,True,t3_1by7j9,http://www.reddit.com/r/PowerShell/comments/1by7j9/trying_to_combine_data_from_two_cmdlets_into_one/,
1364435279.0,7,self.PowerShell,1b5g2u,(Get-ChildItem).FullName inconsistency,7,0,18,http://www.reddit.com/r/PowerShell/comments/1b5g2u/getchilditemfullname_inconsistency/,"I have a script that does some operations on a list of files in a folder but the output of Get-ChildItem seems inconsistent to me, when there are multiple files in the folder I can refer to each filename in the folder using (Get-ChildItem).FullName[$i] incrementing $i for each file.

But when there is only one file in the folder (Get-ChildItem).FullName[0] gives back the first character of the filename, I realise this is because of the difference between an array and a string but is there a way of making the output more consistent without having to duplicate a large block of code for the special case of one file?",,False,,t5_2qo1o,False,,,True,t3_1b5g2u,http://www.reddit.com/r/PowerShell/comments/1b5g2u/getchilditemfullname_inconsistency/,
1364338300.0,7,self.PowerShell,1b2mny,*Quickly* finding users that are members of any group?,8,1,13,http://www.reddit.com/r/PowerShell/comments/1b2mny/quickly_finding_users_that_are_members_of_any/,"Another admin requested that I find all disabled users that are members of any groups. We currently (for a variety of pretty good reasons) keep all of our disabled users in an ""Inactive Users"" OU, and I need to report if any of those ~4300 have group memberships. The following code may work, but it's painfully slow. Anyone have any ideas on how to make this faster?

    Add-PSSnapin Quest.ActiveRoles.ADManagement
    
    Function GetUsersGroups {
        param ($userName)
        $user = get-qaduser -SamAccountName $userName
        $user.memberof
    }
    
    $allusers = Search-ADAccount -accountdisabled -usersonly -SearchBase ""ou=Inactive Users,OU=DIV,DC=domainname,DC=xyz""
    
    foreach ($oneUser in $allusers) {
        $oneGroups = GetUsersGroups -userName $oneUser.Name
        if ($oneGroups.length -gt 0) {
            $oneUser.DistinguishedName,$oneGroups -join ''
        }
    }",,False,,t5_2qo1o,False,,,True,t3_1b2mny,http://www.reddit.com/r/PowerShell/comments/1b2mny/quickly_finding_users_that_are_members_of_any/,
1363701385.0,5,self.PowerShell,1albv3,Moving mailboxes for users depending on Department.,7,2,3,http://www.reddit.com/r/PowerShell/comments/1albv3/moving_mailboxes_for_users_depending_on_department/,"I am moving mailboxes for users on Exchange 2007 to our Exchange 2010. So far I have been successful in moving my test users with the following script:

     Get-QADUser -SizeLimit 0 -SearchRoot 'derp.local/derp' | where Department -eq $args | ForEach-Object {
    		New-Moverequest -identity $_.samaccountname
    	}

Is this a decent way to do it? Or is there a much better way?",,False,,t5_2qo1o,False,,,True,t3_1albv3,http://www.reddit.com/r/PowerShell/comments/1albv3/moving_mailboxes_for_users_depending_on_department/,
1362567006.0,6,self.PowerShell,19rpq8,Script for updating multiple svn repositories. Need advice for simplifying and making the script idiomatic.,7,1,8,http://www.reddit.com/r/PowerShell/comments/19rpq8/script_for_updating_multiple_svn_repositories/,"I wrote a script to perform `svn update` on all the SVN repositories inside a folder. It would have been great if the folder containing all these repositories itself was a repository, but it was not setup like that, which is why I opted to write this script.


    $timestamp = get-date -f ""yyyy-M-d-h-m-s""
    $SvnLogPath=""C:\out\svnlogs\""
    
    if(test-path -path $SvnLogPath)
    {
        write-host ""SVN Log path doesn't exist. So I am creating it . . .""
        new-item -type directory $SvnLogPath | out-null
    }
    
    $logfile = ""${SvnLogPath}svn_update_${timestamp}.log""
    new-item -type file $logfile | out-null
    
    $BaseDir=""C:\TRUNK\""
    
    $RepositoryList = ""Alpha"",""Bravo"",""Charlie"",""Delta"",""Echo"",""Foxtrot"",""Golf"",""Hotel""
    
    # BUILDING FULL PATHS
    $FullPaths = $RepositoryList | %{ $BaseDir+$_}
    
    # ISSUING SVN UPDATE TO EACH DIR
    $FullPaths | % {svn update $_ 2&gt;&amp;1 | ft -AutoSize -Wrap | Out-File -Append $logfile } 
    
    # OPEN LOG FILE AFTER THE COMPLETION
    notepad $logfile

Can this script be further simplified and written more idiomatically?

PS: I am using only `svn update` without credentials as they are stored in the shell already.",,False,,t5_2qo1o,False,,,True,t3_19rpq8,http://www.reddit.com/r/PowerShell/comments/19rpq8/script_for_updating_multiple_svn_repositories/,
1361872412.0,6,self.PowerShell,19936g,Is there a maximum session time in Exchange PowerShell before it requires credentials?,6,0,2,http://www.reddit.com/r/PowerShell/comments/19936g/is_there_a_maximum_session_time_in_exchange/,"Office 365 for Education. Running some batch jobs that can take u to 24 hours to complete, sometime during the night it needs credentials so i'm wondering if there's a time limit on an active connection. Thanks!",,False,,t5_2qo1o,False,,,True,t3_19936g,http://www.reddit.com/r/PowerShell/comments/19936g/is_there_a_maximum_session_time_in_exchange/,
1361701436.0,7,self.PowerShell,194ma9,Social Media Scripting Framework Module beta 0.2,7,0,0,http://www.reddit.com/r/PowerShell/comments/194ma9/social_media_scripting_framework_module_beta_02/,"A fellow Facebook PowerShell group member (Carlos Veira Lorenzo) posted a link to his open source Social module.  It's capable of connecting to Twitter, Facebook, LinkedIn, and Bitly.com at this time and is Beta at 0.2.  Give it a shot if you'd like to analyze your social connection information and give him some feedback.

http://thinkinbig.org/2013/02/say-hello-to-the-social-media-scripting-framework/",,False,,t5_2qo1o,False,,,True,t3_194ma9,http://www.reddit.com/r/PowerShell/comments/194ma9/social_media_scripting_framework_module_beta_02/,
1361650612.0,6,self.PowerShell,193eq0,"Any good resources for someone already comfortable with powershell?  Looking for advanced training, books, etc..",6,0,5,http://www.reddit.com/r/PowerShell/comments/193eq0/any_good_resources_for_someone_already/,"Cost is not really an issue so I would prefer if there was a good 5 day classroom course that someone knows of.  Alternatively books or training videos if there are good ones available.

",,False,,t5_2qo1o,False,,,True,t3_193eq0,http://www.reddit.com/r/PowerShell/comments/193eq0/any_good_resources_for_someone_already/,
1360947860.0,5,self.PowerShell,18l6cz,change a setting in default users registry,8,3,7,http://www.reddit.com/r/PowerShell/comments/18l6cz/change_a_setting_in_default_users_registry/,"I was wondering if there was a way, using PS, to load the registry hive of the default users, then remove a specific registry key.

We made a change to Autocad, so now each user needs to search for a specific file. If we remove the key in the registry, it works. The issue is we use deepfreeze, so each time a user logs on, it's like it a fresh install and takes 5 minutes to make the changes.

We can do it manually, but there are 40 computers to do , and the classrooms are pretty much booked all day, with an hour here or there to do it.

Any help would be appreciated.

Thanks in advance.",,False,,t5_2qo1o,False,,,True,t3_18l6cz,http://www.reddit.com/r/PowerShell/comments/18l6cz/change_a_setting_in_default_users_registry/,
1360856622.0,6,self.PowerShell,18ioby,complete script to toggle remote access ,7,1,3,http://www.reddit.com/r/PowerShell/comments/18ioby/complete_script_to_toggle_remote_access/,"Noob here again. I am looking to make a complete script to turn off and on remote access and related ""stuff"" including firewall access and local policy (if needed) and System Properties&gt;Remote tab. If I am barking up the wrong tree, feel free to tell me how to better secure my system. ",,False,,t5_2qo1o,False,,,True,t3_18ioby,http://www.reddit.com/r/PowerShell/comments/18ioby/complete_script_to_toggle_remote_access/,
1360630148.0,5,self.PowerShell,18cfde,How do I Create a Group in AD under Windows 2003?,9,4,5,http://www.reddit.com/r/PowerShell/comments/18cfde/how_do_i_create_a_group_in_ad_under_windows_2003/,"Ok, I need your help. I am doing a OS deployment using MDT and as part of the deployment I have to create a group in AD and then add it to the local admin group. Easy right, yeah in Windows 2008. But I have to do it in Windows 2003 - Windows 2008. I have the 2008 stuff done using native AD cmdlets. But I need your help on how to do this with Windows 2003. Keep in mind the account that is running the script is a system account, so I need to pass a user name and password to the script so I can connect to the domain. Any help would be great! TY ",,False,,t5_2qo1o,False,,,True,t3_18cfde,http://www.reddit.com/r/PowerShell/comments/18cfde/how_do_i_create_a_group_in_ad_under_windows_2003/,
1358306501.0,8,min.us,16nuyj,Reviewing code today I came across the most helpful comments.,17,9,3,http://www.reddit.com/r/PowerShell/comments/16nuyj/reviewing_code_today_i_came_across_the_most/,,,False,,t5_2qo1o,False,,,False,t3_16nuyj,http://min.us/lbcGwvzjQUlBHD,
1357271347.0,6,csharpening.net,15xiem,Pseudo-Polymorphism in PowerShell,10,4,0,http://www.reddit.com/r/PowerShell/comments/15xiem/pseudopolymorphism_in_powershell/,,,False,,t5_2qo1o,False,,,False,t3_15xiem,http://csharpening.net/?p=1462,
1356373917.0,5,self.PowerShell,15dtmp,Failover Cluster Resource Management script help,6,1,4,http://www.reddit.com/r/PowerShell/comments/15dtmp/failover_cluster_resource_management_script_help/,"Every time I try to sit down and write this script, I spend a day in front of a command prompt... then I realize its too hard there so I open up a powershell prompt, spend 2 more days... and then my head explodes.

I'm not looking for somebody to write it, but maybe just somebody to point me in the direction of something that is similar.

---------------

**The environment:**

* Multiple Server 2008
* Failover Clustering
* Many-person administration
* Running the script on a server that isn't one of the failover nodes
* 100 Resources spread out across 1 cluster, 4 nodes, with about 20 groups.
* About 50% of the resources are java.exe...

**The problem:**

My coding team doesn't have the time to fix a problem with their code. When failover manager fails over (or even gracefully turns off) the java.exe's they don't always turn off. Leaving us to find and kill erroneous javas.

**What I'd like to do:**

Get a list of the PIDs for all the JAVA.exe's on each node of the cluster. Then look on each node/server for any JAVA.exe's that aren't on that list and terminate the process.

It seems so simple. I don't know why I've been having so much trouble. I am generally just a script-kiddy, googling something similar and adjusting it to fit my own needs, but this is something a bit too specialized I guess. I could PROBABLY do it with a batch file, but our group and resource names are pretty dynamic and I'd hate to make something that breaks when somebody puts a space in a group name or something.

--------------------------

D:\&gt;cluster /cluster:CLUSTER RES /priv | findstr ""CurrentPID""

D  RESOURCE_NAME CurrentPID                     21768 (0x5508)

Our script puts a /priv property for ""CurrentPID"" . There's about 50 or so on some clusters. No Javas are running on the servers that aren't managed by the cluster. The Get-Cluster powershell commands seem powerful, but I'm unsure how to do this...",,False,,t5_2qo1o,1356388759.0,,,True,t3_15dtmp,http://www.reddit.com/r/PowerShell/comments/15dtmp/failover_cluster_resource_management_script_help/,
1356025956.0,6,self.PowerShell,156du5,Powershell Bitlocker AD script,6,0,8,http://www.reddit.com/r/PowerShell/comments/156du5/powershell_bitlocker_ad_script/,"Hey guys,

Powershell newbie here. I've been poking around and trying to learn some scripting and I need some help with this script that I found.

The script gets the bitlocker recovery information from a machine in AD that you specify. When I run the script I am prompted by Windows that it is accessing AD and it is looking in the right OUs but I never see any information. Is there a way I can pipe this out to text or html?

Thanks in advance!

' --------------------------------------------------------------------------------
' Usage
' --------------------------------------------------------------------------------

Sub ShowUsage
   Wscript.Echo ""USAGE: Get-BitLockerRecoveryInfo [Optional Computer Name]""
   Wscript.Echo ""If no computer name is specified, the local computer is assumed.""
   WScript.Quit
End Sub

' --------------------------------------------------------------------------------
' Parse Arguments
' --------------------------------------------------------------------------------

Set args = WScript.Arguments

Select Case args.Count
  
  Case 0
      ' Get the name of the local computer      
      Set objNetwork = CreateObject(""WScript.Network"")
      strComputerName = objNetwork.ComputerName
    
  Case 1
    If args(0) = ""/?"" Or args(0) = ""-?"" Then
      ShowUsage
    Else
      strComputerName = args(0)
    End If
  
  Case Else
    ShowUsage

End Select

' --------------------------------------------------------------------------------
' Helper function: Convert the octet GUID string (byte array) to a hex string
' --------------------------------------------------------------------------------

'Reference: http://blogs.msdn.com/ericlippert/archive/2004/05/25/141525.aspx

Function HexByte(b)
      HexByte = Right(""0"" &amp; Hex(b), 2)
End Function 

Function ConvertOctetGuidToHexString(ByteArray)
  Dim Binary, S
  Binary = CStr(ByteArray)

  On Error Resume Next

  S = ""{""
  S = S &amp; HexByte(AscB(MidB(Binary, 4, 1)))
  S = S &amp; HexByte(AscB(MidB(Binary, 3, 1)))
  S = S &amp; HexByte(AscB(MidB(Binary, 2, 1)))
  S = S &amp; HexByte(AscB(MidB(Binary, 1, 1)))
  S = S &amp; ""-""  
  S = S &amp; HexByte(AscB(MidB(Binary, 6, 1)))
  S = S &amp; HexByte(AscB(MidB(Binary, 5, 1)))
  S = S &amp; ""-""  
  S = S &amp; HexByte(AscB(MidB(Binary, 8, 1)))
  S = S &amp; HexByte(AscB(MidB(Binary, 7, 1)))
  S = S &amp; ""-""  
  S = S &amp; HexByte(AscB(MidB(Binary, 9, 1)))
  S = S &amp; HexByte(AscB(MidB(Binary, 10, 1)))
  S = S &amp; ""-""  
  S = S &amp; HexByte(AscB(MidB(Binary, 11, 1)))
  S = S &amp; HexByte(AscB(MidB(Binary, 12, 1)))
  S = S &amp; HexByte(AscB(MidB(Binary, 13, 1)))
  S = S &amp; HexByte(AscB(MidB(Binary, 14, 1)))
  S = S &amp; HexByte(AscB(MidB(Binary, 15, 1)))
  S = S &amp; HexByte(AscB(MidB(Binary, 16, 1)))
  S = S &amp; ""}""

  On Error GoTo 0

  ConvertOctetGuidToHexString = S
End Function 


' --------------------------------------------------------------------------------
' Get path to Active Directory computer object associated with the computer name
' --------------------------------------------------------------------------------

Function GetStrPathToComputer(strComputerName) 

    ' Uses the global catalog to find the computer in the forest
    ' Search also includes deleted computers in the tombstone

    Set objRootLDAP = GetObject(""LDAP://rootDSE"")
    namingContext = objRootLDAP.Get(""defaultNamingContext"") ' e.g. string dc=fabrikam,dc=com    

    strBase = ""&lt;GC://"" &amp; namingContext &amp; ""&gt;""
 
    Set objConnection = CreateObject(""ADODB.Connection"") 
    Set objCommand = CreateObject(""ADODB.Command"") 
    objConnection.Provider = ""ADsDSOOBject"" 
    objConnection.Open ""Active Directory Provider"" 
    Set objCommand.ActiveConnection = objConnection 

    strFilter = ""(&amp;(objectCategory=Computer)(cn="" &amp;  strComputerName &amp; ""))""
    strQuery = strBase &amp; "";"" &amp; strFilter  &amp; "";distinguishedName;subtree"" 

    objCommand.CommandText = strQuery 
    objCommand.Properties(""Page Size"") = 100 
    objCommand.Properties(""Timeout"") = 100
    objCommand.Properties(""Cache Results"") = False 

    ' Enumerate all objects found. 

    Set objRecordSet = objCommand.Execute 
    If objRecordSet.EOF Then
      WScript.echo ""The computer name '"" &amp;  strComputerName &amp; ""' cannot be found.""
      WScript.Quit 1
    End If

    ' Found object matching name

    Do Until objRecordSet.EOF 
      dnFound = objRecordSet.Fields(""distinguishedName"")
      GetStrPathToComputer = ""LDAP://"" &amp; dnFound
      objRecordSet.MoveNext 
    Loop 


    ' Clean up. 
    Set objConnection = Nothing 
    Set objCommand = Nothing 
    Set objRecordSet = Nothing 

End Function


' --------------------------------------------------------------------------------
' Securely access the Active Directory computer object using Kerberos
' --------------------------------------------------------------------------------


Set objDSO = GetObject(""LDAP:"")
strPathToComputer = GetStrPathToComputer(strComputerName)

WScript.Echo ""Accessing object: "" + strPathToComputer

Const ADS_SECURE_AUTHENTICATION = 1
Const ADS_USE_SEALING = 64 '0x40
Const ADS_USE_SIGNING = 128 '0x80


' --------------------------------------------------------------------------------
' Get all BitLocker recovery information from the Active Directory computer object
' --------------------------------------------------------------------------------

' Get all the recovery information child objects of the computer object

Set objFveInfos = objDSO.OpenDSObject(strPathToComputer, vbNullString, vbNullString, _
                                   ADS_SECURE_AUTHENTICATION + ADS_USE_SEALING + ADS_USE_SIGNING)

objFveInfos.Filter = Array(""msFVE-RecoveryInformation"")

' Iterate through each recovery information object 

For Each objFveInfo in objFveInfos

   strName = objFveInfo.Get(""name"")

   strRecoveryGuidOctet = objFveInfo.Get(""msFVE-RecoveryGuid"")
   strRecoveryGuid = ConvertOctetGuidToHexString(strRecoveryGuidOctet)

   strRecoveryPassword = objFveInfo.Get(""msFVE-RecoveryPassword"")

   WScript.echo  
   WScript.echo ""name: "" + strName 
   WScript.echo ""msFVE-RecoveryGuid: "" + strRecoveryGuid
   WScript.echo ""msFVE-RecoveryPassword: "" + strRecoveryPassword
   

   If len(strRecoveryGuid) &lt;&gt; 38 Then
      WScript.echo ""WARNING: '"" &amp; strRecoveryGuid &amp; ""' does not appear to be a valid GUID.""
   End If

Next

WScript.Quit

",,False,,t5_2qo1o,False,,,True,t3_156du5,http://www.reddit.com/r/PowerShell/comments/156du5/powershell_bitlocker_ad_script/,
1355935902.0,6,self.PowerShell,1545xj,Adding NTFS permissions to folders,6,0,7,http://www.reddit.com/r/PowerShell/comments/1545xj/adding_ntfs_permissions_to_folders/,"I'm trying to write a powershell script that will add permissions to existing folders and I am having some troubles.  I am new to powershell, I've been learning on it for a few days.

Here is what I have:

&gt;    $folders = Get-ChildItem ""f:\folder"" -Recurse | where {$_.Attributes -eq 'Directory'}

&gt;    $Acl = Get-Acl $folders

&gt;    $Ar = New-Object  system.security.accesscontrol.filesystemaccessrule(""GROUPNAME"",""Write"",""Allow"")

&gt;    $Acl.SetAccessRule($Ar)

&gt;    Set-Acl $folders ($Acl)


I get a lot of ""cannot find path because it does not exist"" messages that specify the name of folders that do in fact exist.  Also, I need it to only go one level down, and I haven't figured out how I'm going to accomplish that yet.  Any suggestions are much appreciated.

**Edit:** Thanks for the help guys, I used what teejaded wrote and accomplished what i needed.  I'm still pretty new to this and I appreciate the assistance.",,False,,t5_2qo1o,1355953087.0,,,True,t3_1545xj,http://www.reddit.com/r/PowerShell/comments/1545xj/adding_ntfs_permissions_to_folders/,
1355207383.0,5,self.PowerShell,14nj6r,Get-Content and Export-Csv question,6,1,10,http://www.reddit.com/r/PowerShell/comments/14nj6r/getcontent_and_exportcsv_question/,"I am not sure if Powershell can do this or not, and my knowledge is really limited.  Basically I have a directory of files which I want PS to grab the first four rows of data from each file and output that to one csv file.  I got as far as getting the Get-Content cmd to output 4 lines from a file in the shell, but I am unable to get that to work in conjunction with the Export-Csv cmd, let alone do this for multiple files.  Any ideas?",,False,,t5_2qo1o,False,,,True,t3_14nj6r,http://www.reddit.com/r/PowerShell/comments/14nj6r/getcontent_and_exportcsv_question/,
1354618741.0,5,self.PowerShell,1499n5,Switching between Internet Explorer tabs?,7,2,2,http://www.reddit.com/r/PowerShell/comments/1499n5/switching_between_internet_explorer_tabs/,I'm looking for a script or pointers on how to use POSH to switch between tabs in IE. I would like the script to switch between tabs every 10 seconds or so. Is it possible to do this?,,False,,t5_2qo1o,False,,,True,t3_1499n5,http://www.reddit.com/r/PowerShell/comments/1499n5/switching_between_internet_explorer_tabs/,
1354564427.0,5,self.PowerShell,147ssl,Parsing an event into powershell-usable data,6,1,2,http://www.reddit.com/r/PowerShell/comments/147ssl/parsing_an_event_into_powershellusable_data/,"My goal here is to run a script against a server that I specify, and gather the Logon events:

&gt;512 / 4608  STARTUP

&gt;513 / 4609  SHUTDOWN

&gt;528 / 4624  LOGON

&gt;538 / 4634  LOGOFF

&gt;551 / 4647  BEGIN_LOGOFF

&gt;N/A / 4778  SESSION_RECONNECTED

&gt;N/A / 4779  SESSION_DISCONNECTED

&gt;N/A / 4800  WORKSTATION_LOCKED 

&gt;* / 4801    WORKSTATION_UNLOCKED

&gt;N/A / 4802  SCREENSAVER_INVOKED

&gt;N/A / 4803  SCREENSAVER_DISMISSED

[(source)](http://blogs.msdn.com/b/ericfitz/archive/2008/08/20/tracking-user-logon-activity-using-logon-events.aspx)

While I haven't done the looping part to go through each event or each ID, I thought I'd post the solution to the first problem I ran in to: identifying lines from the event message.

I figured Get-WinEvent might be smart enough to go through the message of an event and make each value into a property, but no. The message ends up being counted as a string, I can't even loop through each line of it because the whole thing counts as one single line.

So, the solution:

    $text = ""#text""
    $event = get-winevent -filterhashtable @{logname='security'; id=4624} -maxevents 1
    [xml]$eventmessage = $event.ToXML()
    foreach ($line in $eventmessage.Event.EventData.Data) {
        $event | Add-Member -MemberType NoteProperty -Name $line.name -Value $line.$text
    }
    $event | select -Property TimeCreated,LogonType,TargetUserName,TargetDomainName,IpAddress,ID

At first I did an ""if ($line.name -eq ""Logon Type:"")"" evaluation to it for each value I wanted to collect, but then I figured why not just assign a property for every single line? Maybe someone will want to use a property that I'm not interested in.

The problem I found when putting the message into xml, is that one of the property names ends up being #text. Since I couldn't call $line.#text without an error, I stored ""#text"" as the variable $text. 

P.S. I'm fairly new to Powershell and learning on my own. Constructive criticism is welcome. Maybe someone has already found an easy way to do this.",,False,,t5_2qo1o,False,,,True,t3_147ssl,http://www.reddit.com/r/PowerShell/comments/147ssl/parsing_an_event_into_powershellusable_data/,
1354019975.0,6,self.PowerShell,13vcvs,Passing Parameters into a Troubleshooting Pack,6,0,4,http://www.reddit.com/r/PowerShell/comments/13vcvs/passing_parameters_into_a_troubleshooting_pack/,"Hi, maybe some of you can help me with a problem im currently facing.
I'm implementing Windows Troubleshooting Packs to automate repetitive Tasks in order to relieve our Help-Desk of some work.
Now I'm in a situation where im invoking a Troubleshooting Pack from within a Powershell Script and I need to pass some Parameters which needs to be accessible in the scripts used by the Pack.
The whole Troubleshooting Pack stuff is scarcely documented and I'm wondering if some of you have some experience in this field.",,False,,t5_2qo1o,False,,,True,t3_13vcvs,http://www.reddit.com/r/PowerShell/comments/13vcvs/passing_parameters_into_a_troubleshooting_pack/,
1353351154.0,6,self.PowerShell,13gnxz,Not quite sure where to begin on this task...scan folders and subfolders to see if a group has been assigned rights,6,0,6,http://www.reddit.com/r/PowerShell/comments/13gnxz/not_quite_sure_where_to_begin_on_this_taskscan/,"Basically, I've got a list of AD groups, and a shared (SMB/CIFS) folder, and I need to find out if any of those groups have been assigned rights to anything under than folder (before a decision is made on whether the group can be deleted or not).

It's not so much that I can't do this with my present knowledge...it's trying to do this the best way. I'm going to end up running this against 80 or so shares on 40 servers at specific locations, and each of those locations have a different list of groups to be checked. Very likely, the scripts will be run locally against the folder, not against the SMB/CIFS share, due to network latency.",,False,,t5_2qo1o,False,,,True,t3_13gnxz,http://www.reddit.com/r/PowerShell/comments/13gnxz/not_quite_sure_where_to_begin_on_this_taskscan/,
1352171981.0,6,self.PowerShell,12piik,Pass user credentials into internet explorer webpage login,7,1,5,http://www.reddit.com/r/PowerShell/comments/12piik/pass_user_credentials_into_internet_explorer/,"I am currently trying to create a script that asks the user for their username and password, then after that information it opens internet explorer and fills in the User Id and Password field for them. 

Currently the process is looking at a notepad file with the username and password and then having to copy and paste into 7 different tabs.

The script I have thus far looks like this:

$Cred = Get-Credential ""Frontline""

@{'User Id'=$Cred.UserName; 'Password'=($Cred.Password | ConvertFrom-SecureString)} | Export-Clixml 

$Env:USERPROFILE \WebCred.xml

$ie = New-Object -ComObject InternetExplorer.application

$tmp = Import-Clixml $Env:USERPROFILE\WebCred.xml 

$Cred = New-Object System.Management.Automation.PSCredential $tmp['UserName'],($tmp['Password'] | ConvertTo-SecureString)

$UserName = $Cred.UserName
    if ($UserName.IndexOf('\') -eq 0) {$UserName = $UserName.Replace('\','')}
$bstr = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($Cred.Password)

$password = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto( $bstr )

[System.Runtime.InteropServices.Marshal]::ZeroFreeBSTR( $bstr)

$ie.Navigate2(""Website"")

$ie.Navigate2(""Website"", 0x1000)

$ie.Navigate2(""Website"", 0x1000)

$ie.Navigate2(""Website"", 0x1000)

$ie.Navigate2(""Website"", 0x1000)

$ie.Navigate2(""Website"", 0x1000)

$ie.Navigate2(""Website"", 0x1000)

$ie.Visible = $true

The main problem that I am having is actually taking the values the user enters and getting them onto the webpage login. It is creating the encrypted file on the local machine, the next thing I need is to get it to the point that it actually passes the user information. 

Thank you for taking the time to look this over, I appreciate any and all help that you may have.

",,False,,t5_2qo1o,1352172292.0,,,True,t3_12piik,http://www.reddit.com/r/PowerShell/comments/12piik/pass_user_credentials_into_internet_explorer/,
1351889624.0,6,self.PowerShell,12j72b,"Here's an easy one for you guys: How to exclude a particular VM from a ""Get-VM""?",6,0,6,http://www.reddit.com/r/PowerShell/comments/12j72b/heres_an_easy_one_for_you_guys_how_to_exclude_a/,"I am writing a simple PS script to shut down the guest OS's in my ESX environment to gear up for a shutdown, and I can't figure out the right way to exclude a single VM from that for loop (the vcenter box):

    Connect-VIServer MyVIServer

    # Get All the ESX Hosts
    $ESXSRV = Get-VMHost

    # For each of the VMs on the ESX hosts
    Foreach ($VM in ($ESXSRV | Get-VM)){
        # Shutdown the guest cleanly
        $VM | Shutdown-VMGuest -Confirm:$false
    }

What's the correct way to do this?",,False,,t5_2qo1o,False,,,True,t3_12j72b,http://www.reddit.com/r/PowerShell/comments/12j72b/heres_an_easy_one_for_you_guys_how_to_exclude_a/,
1351525081.0,6,thoughts.stuart-edwards.info,12a1ze,Net Use in PowerShell with stored credentials,6,0,5,http://www.reddit.com/r/PowerShell/comments/12a1ze/net_use_in_powershell_with_stored_credentials/,,,False,,t5_2qo1o,False,,,False,t3_12a1ze,http://thoughts.stuart-edwards.info/index.php/programming/net-use-in-powershell-with-stored-credentials,
1349986737.0,6,self.PowerShell,11bsp2,powershell from command line,7,1,9,http://www.reddit.com/r/PowerShell/comments/11bsp2/powershell_from_command_line/,"I need to execute a single command from the cmd shell.  This command

powershell -command {""ps notepad|select id|kill""} 

should work, but for some reason it just appends it to the open string of powershell.  It does not execute it and then it exits.

I have also tried giving it the &amp; prefix to no avail.

Any ideas?",,False,,t5_2qo1o,False,,,True,t3_11bsp2,http://www.reddit.com/r/PowerShell/comments/11bsp2/powershell_from_command_line/,
1349902949.0,6,self.PowerShell,119tfk,Get-process denying permission when executing remotely,6,0,12,http://www.reddit.com/r/PowerShell/comments/119tfk/getprocess_denying_permission_when_executing/,"Using this to try to get the process version:

Invoke-Command -computername computer -scriptblock {get-process process -fileversioninfo}

The script is returning permission denied, but when I remote into the machine I can run the get-process process -fieversioninfo and it works perfectly.  

Edit:  I'm going to need to include the double hop, it turns out that the file is actually located on a share from another server, but being ran on that server.  Any Ideas getting past the double hop issue?
Any ideas whats causing it to reject it when run remotely?
",,False,,t5_2qo1o,1349903937.0,,,True,t3_119tfk,http://www.reddit.com/r/PowerShell/comments/119tfk/getprocess_denying_permission_when_executing/,
1349799605.0,8,self.PowerShell,1179mk,Set-ExecutionPolicy on non-admin machines,8,0,9,http://www.reddit.com/r/PowerShell/comments/1179mk/setexecutionpolicy_on_nonadmin_machines/,"Currently the only way I have been able to have others run a program I created is by having them manually set the execution policy manually by opening PowerShell with admin rights and pasting the below into PowerShell and then run the program.

    Set-ExecutionPolicy unrestricted -force

I've thought about adding 

    Set-ExecutionPolicy restricted -force

at the end of my program, but I can see it being a pain to have manually change the policy to unrestricted anytime they want to run it.  What are some other options that I have that will set the ExecutionPolicies when opening and closing? 
",,False,,t5_2qo1o,False,,,True,t3_1179mk,http://www.reddit.com/r/PowerShell/comments/1179mk/setexecutionpolicy_on_nonadmin_machines/,
1349711760.0,5,self.PowerShell,1154n4,Querying AD and writing results to a SQL database has me stuck.  Little nudging in the right direction would be apprecaited.,7,2,5,http://www.reddit.com/r/PowerShell/comments/1154n4/querying_ad_and_writing_results_to_a_sql_database/,"Here's my code:

    $UserInfo = Get-ADUser -filter * -Properties givenName,Surname,EmailAddress,EmployeeID | Where-Object { $_.EmailAddress -ne $null -and $_.givenName -ne $null -and $_.surname -ne $null } | Select-Object givenName,Surname,EmailAddress,EmployeeID 
    $UserInfo | ForEach-Object { Invoke-SQLCMD -ServerInstance $server -Database $database -Query ""INSERT INTO AD_Contacts 
        (f_name, l_name, eeid, w_email)
        VALUES
        ('$($UserInfo.givenName)'),('$($UserInfo.Surname)'),('$($UserInfo.EmployeeID)'),('$($UserInfo.EmailAddress)')"" -Username un -Password pw }

I'm getting an error that states ""There are more columns in the INSERT statement than VALUES specified in the VALUES clause.  I'm guessing it is something wrong with the syntax of the query, but any help would be appreciated.",,False,,t5_2qo1o,1349715045.0,,,True,t3_1154n4,http://www.reddit.com/r/PowerShell/comments/1154n4/querying_ad_and_writing_results_to_a_sql_database/,
1349660813.0,6,penguindreams.org,1146e1,Reassigning DNS Entries in Windows/Active Directory using Powershell,6,0,0,http://www.reddit.com/r/PowerShell/comments/1146e1/reassigning_dns_entries_in_windowsactive/,,,False,,t5_2qo1o,False,,,False,t3_1146e1,http://penguindreams.org/blog/reassigning-dns-entires-in-windowsactive-directory-using-powershell/,
1349125545.0,6,self.PowerShell,10s3vt,Need Help Creating Zip Archive,6,0,6,http://www.reddit.com/r/PowerShell/comments/10s3vt/need_help_creating_zip_archive/,"I am writing a Powershell script that contains a step which requires me to zip one file.  I do not want to use any external libraries in the .zip operation (such as Xceed or 7zip).  I have not found any native Powershell or .net libraries that will allow me to do this.  I found one com library **Shell.Application** that will allow me to create a zip archive using the CopyHere method.

I've been trying to use this library with little success.  Every time I run it, I get an error stating **You cannot call a method on a null-valued expression** because zipPackage becomes null when I run the NameSpace method.  Below is my code snippet:

	$zipFile = $(Join-Path -Path $WorkingDir -ChildPath $CompressedFilename)
	if ( Test-Path -Path $zipFile -PathType Leaf ) { Remove-Item -Path $zipFile -Force }
	[System.Int32]$yestoall = ""16""
	[System.Int32]$progressBar = ""4""
	$shellApplication = New-Object -ComObject Shell.Application
	$zipPackage = $shellApplication.NameSpace($zipFile)
	$zipPackage.CopyHere($zipFile)

I found a few articles that explain how to do this which is where most of my code came from.  (Example:  http://blogs.inetium.com/blogs/mhodnick/archive/2006/08/07/295.aspx) but I don't understand what the set-content line is doing.  Does this mean they are copying the files to be compressed into another directory and specifying the directory as the parameter to the NameSpace method instead of the file to be compressed?

If someone could help me with this method or knows of a way to use another native .net library to do this (including some explanation because I'm a bit of a Powershell n00b) I'd really appreciate it.

Thanks in advance!",,False,,t5_2qo1o,False,,,True,t3_10s3vt,http://www.reddit.com/r/PowerShell/comments/10s3vt/need_help_creating_zip_archive/,
1348627501.0,7,self.PowerShell,10hjjk,"Trying to learn powershell, but I'm stuck.",7,0,22,http://www.reddit.com/r/PowerShell/comments/10hjjk/trying_to_learn_powershell_but_im_stuck/,"I want to automate a process (reading the version of Java on each computer across a domain and outputting the results to a table). I can show the Java version on the local machine using

    Get-WmiObject Win32_Product | Where-Object { $_.Name -match 'Java'} | Format-Table Name, Version

Which outputs:

        Name                                                           Version                                                      
    ----                                                           -------                                                      
    Java 7 Update 7                                                7.0.70                                                       
    Java Auto Updater                                              2.1.9.0      

Is the following the proper way to read a list of computer names from a text file in order to run the previous script against them so they return their Java version to my little table?

    Get-Content c:\scripts\ComputerNames.txt | Foreach-Object {Get-WmiObject Win32_Product | Where-Object { $_.Name -match 'Java'} | Format-Table Name, Version}

I also can't seem to exclude the Auto Updater.

Any help?",,False,,t5_2qo1o,False,,,True,t3_10hjjk,http://www.reddit.com/r/PowerShell/comments/10hjjk/trying_to_learn_powershell_but_im_stuck/,
1348583487.0,7,self.PowerShell,10g8kf,Applying Permissions via PowerShell,7,0,8,http://www.reddit.com/r/PowerShell/comments/10g8kf/applying_permissions_via_powershell/,"I'm having some trouble with my AD user creation script and applying NTFS permissions, and at this point I'm at my wits end.  Below is my script:

    Import-Module Active Directory
    $csvfile = Read-Host ""Input the path to the CSV file""

    $csvdata = Import-CSV $csvfile

    ForEach ($list in $csvdata)
    {
       $uname = $($list.Username)
       $fnme = $($list.FirstName)
       $lnme = $($list.LastName)
       $gyear = $($list.GraduationYear)
       $pass = $($list.InitPass)
       $samuname = $uname.ToLower()
       $mpass = $pass.Substring(0,4)

   **###I shortened the command New-ADUser because most of the switches were unnecessary to what is actually causing the problem**
       New-ADuser -SamAccountName ""$samuname"" -HomeDirectory ""\\\fileserver\share\$gyear\$samuname""

       Add-ADPrincipalGroupMembership -Identity $samuname -Memberof ""Students"",""$gyear Students"",""Students Authorized""

       New-Item \\fileserver\share\$gyear\$samuname -type Directory

       $acl = Get-Acl \\fileserver\share\$gyear\$samuname
       $permission = ""Domain\$samuname"",""FullControl"",ContainerInherit,ObjectInherit"",""None"",""Allow""
       $accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule $permission
       $acl.SetAccessRule($accessRule)
       $acl | Set-Acl \\fileserver\share\$gyear\$samuname
    }

Here is the problem I'm running into; it works just fine *for the first user*.  Any user after that the block that applies permissions to their ""Home Directory"" fails.  If I run this in PowerGUI Script Editor and step through line by line, it works perfectly for all users in the CSV, not just the first one.  I have tried changing my ACL path from ""\\fileserver\share\$gyear\$samuname"" to ""\\fileserver\E$\share\$gyear\$samuname"" but that also makes no difference.  Additionally, if I through that bottom block into a separate script and run it against the same CSV file, it works perfectly for all users in the list.

Thank you for taking the time to look at this.

**Edited for clarity",,False,,t5_2qo1o,1348587852.0,,,True,t3_10g8kf,http://www.reddit.com/r/PowerShell/comments/10g8kf/applying_permissions_via_powershell/,
1348347146.0,5,self.PowerShell,10b9rk,Am I missing something in my use of foreach?,6,1,7,http://www.reddit.com/r/PowerShell/comments/10b9rk/am_i_missing_something_in_my_use_of_foreach/,"Most of the time I see foreach-object (%) used, it looks like:  
     foreach ($&lt;item&gt; in $&lt;collection&gt;)

When I script I always pipe my object to % { ... } and refer to it via $_.

Is this just a matter of preference or are there functional differences between the approaches?",,False,,t5_2qo1o,False,,,True,t3_10b9rk,http://www.reddit.com/r/PowerShell/comments/10b9rk/am_i_missing_something_in_my_use_of_foreach/,
1347159800.0,5,self.PowerShell,zl3ul,PowerShell Pack,7,2,0,http://www.reddit.com/r/PowerShell/comments/zl3ul/powershell_pack/,"Just wanted to get an opinion on [PowerShell Pack](http://archive.msdn.microsoft.com/PowerShellPack). 

Is anybody here using it? How stable/nice are the various modules? (I am especially interested in FileSystem, Task Scheduler and the .NET modules).

The last release seems to be way back. Is there a different repository these days or is the project in hibernation?",,False,,t5_2qo1o,False,,,True,t3_zl3ul,http://www.reddit.com/r/PowerShell/comments/zl3ul/powershell_pack/,
1345578470.0,6,self.PowerShell,ylhly,show members of all AD groups changed in the last x days,7,1,3,http://www.reddit.com/r/PowerShell/comments/ylhly/show_members_of_all_ad_groups_changed_in_the_last/,"I have been working on a command to show the members of groups that have been changed in teh last x days.  I have been doing this with the quest snapon, but have not been able to get this to work yet.  I would eventually like to make it look like :
&lt;changedgroup name&gt;


&lt;changedgroup1&gt;  &lt;members&gt;


&lt;changedgroup2&gt;  &lt;members&gt;

here is the code I have so far:

$date = [DateTime]::Now.Subtract([TimeSpan]::FromDays(7))

get-qadgroup -lastchangedafter $date | get-qadgroupmember Name


",,False,,t5_2qo1o,False,,,True,t3_ylhly,http://www.reddit.com/r/PowerShell/comments/ylhly/show_members_of_all_ad_groups_changed_in_the_last/,
1345472947.0,7,mywinsysadm.wordpress.com,yiv37,PowerShell: Reporting NTFS Permissions of Windows File Shares,8,1,2,http://www.reddit.com/r/PowerShell/comments/yiv37/powershell_reporting_ntfs_permissions_of_windows/,,,False,,t5_2qo1o,False,,,False,t3_yiv37,http://mywinsysadm.wordpress.com/2011/08/17/powershell-reporting-ntfs-permissions-of-windows-file-shares/,
1343095697.0,7,self.PowerShell,x1tv1,Is there an easier (more efficient) way to do this?,7,0,9,http://www.reddit.com/r/PowerShell/comments/x1tv1/is_there_an_easier_more_efficient_way_to_do_this/,"    $Renames = gci $ScrubPath | % { ren $_.FullName $_.FullName.Replace(”-no1“, “”) }
    $Renames = gci $ScrubPath | % { ren $_.FullName $_.FullName.Replace(”-no2“, “”) }
    $Renames = gci $ScrubPath | % { ren $_.FullName $_.FullName.Replace(”-no3“, “”) }
    $Renames = gci $ScrubPath | % { ren $_.FullName $_.FullName.Replace(”-no4“, “”) }

I'm renaming files that have -no1 through -no4 appended to the end to just remove that piece of the name, and retain the PO # and .PDF extension.  I tried a lot of different ways and this is how I got it to work, but I'm sure there is a better way.",,False,,t5_2qo1o,False,,,True,t3_x1tv1,http://www.reddit.com/r/PowerShell/comments/x1tv1/is_there_an_easier_more_efficient_way_to_do_this/,
1342703153.0,7,nivot.org,wtcn1,"Decent threading in Windows PowerShell, or how to beep in the console",8,1,1,http://www.reddit.com/r/PowerShell/comments/wtcn1/decent_threading_in_windows_powershell_or_how_to/,,,False,,t5_2qo1o,False,,,False,t3_wtcn1,http://www.nivot.org/post/2009/01/22/CTP3TheRunspaceFactoryAndPowerShellAccelerators.aspx,
1342135017.0,7,self.PowerShell,wgwcj,What is the best way to escape input content for MySQL?,7,0,8,http://www.reddit.com/r/PowerShell/comments/wgwcj/what_is_the_best_way_to_escape_input_content_for/,"I am using the .net connector between powershell and MySQL.  My insert statements are erring out on special characters such as a single quote.

I am fairly new to powershell but, in PHP I would use something like mysqli_real_escape_string.  Is their an equivalent of some type in powershell?  Is a simple .Replace(""'"",""''"") good enough?  Or should I be using another technique that avoids this problem?

Note that I am not worried about SQL injection attacks for this application.

Thank You,",,False,,t5_2qo1o,False,,,True,t3_wgwcj,http://www.reddit.com/r/PowerShell/comments/wgwcj/what_is_the_best_way_to_escape_input_content_for/,
1341938520.0,5,self.PowerShell,wc24p,How do I find out what data type a method accepts in powershell?,6,1,4,http://www.reddit.com/r/PowerShell/comments/wc24p/how_do_i_find_out_what_data_type_a_method_accepts/,"I know some methods accept true &amp; false and some numbers but how do I know what accepts what?

For instance here is a list of methods for the win32_networkconfiguration class

METHODS
-------
EnableDHCP
RenewDHCPLease
RenewDHCPLeaseAll
ReleaseDHCPLease
ReleaseDHCPLeaseAll
EnableStatic
SetGateways
EnableDNS
SetDNSDomain
SetDNSServerSearchOrder
SetDNSSuffixSearchOrder
SetDynamicDNSRegistration
SetIPConnectionMetric
SetWINSServer
EnableWINS
SetTcpipNetbios
EnableIPSec
DisableIPSec
SetIPXVirtualNetworkNumber
SetIPXFrameTypeNetworkPairs
SetDatabasePath
SetIPUseZeroBroadcast",,False,,t5_2qo1o,False,,,True,t3_wc24p,http://www.reddit.com/r/PowerShell/comments/wc24p/how_do_i_find_out_what_data_type_a_method_accepts/,
1341862937.0,6,self.PowerShell,wabbu,Is there an easy way to set Group policy preferences for printers and drive mappings from the CLI?,6,0,5,http://www.reddit.com/r/PowerShell/comments/wabbu/is_there_an_easy_way_to_set_group_policy/,"I've searched high and low on google and in various other sites and books and can't find a way to do it despite being pretty sure it was something that was possible.

We are trying to replace some software that made login scripts for us and GPPs seemed a great way to do it.  Entering every classroom printer (I'm in a K-12 environment) by hand would mean a lot of time wasted.  What we have now is a large number of shared printers so we have one line per printer in our software.  It's the same thing for shared drives.

If I could figure out a way to cobble a script together it would save me hours.  I could just pass the name of the user's group and the shared resource.

Any pointers would be very much appreciated.  The resources are already shared on the servers.

edited with some additional information and for clarification.",,False,,t5_2qo1o,1341868532.0,,,True,t3_wabbu,http://www.reddit.com/r/PowerShell/comments/wabbu/is_there_an_easy_way_to_set_group_policy/,
1340933494.0,5,self.PowerShell,vrtxh,Is there a way to schedule a powershell script without having a brief window popup?,6,1,13,http://www.reddit.com/r/PowerShell/comments/vrtxh/is_there_a_way_to_schedule_a_powershell_script/,"Without wrapping the script in vbs or something else, is there a way to get rid of the brief command window that pops up on the screen when a scheduled task runs?

I've tried the -noninteractive and -windowstyle options, but I still get a quick popup.  I would prefer not to have users submit tickets saying something weird popped up and went away.",,False,,t5_2qo1o,False,,,True,t3_vrtxh,http://www.reddit.com/r/PowerShell/comments/vrtxh/is_there_a_way_to_schedule_a_powershell_script/,
1340892408.0,6,self.PowerShell,vqocx,"Error ""Test-Path: The given path's format is not supported"" for a String keeps occurring with when passed a string variable",6,0,6,http://www.reddit.com/r/PowerShell/comments/vqocx/error_testpath_the_given_paths_format_is_not/,"So when I try to run the following function, I keep running into the above error. I'm only posting the first two lines of the function because that's where it freaks out anyway:

    function CheckFileVersion([string]$fileName, [string]$verToCompare,      [int]$compareType){
	if (Test-Path ($fileName)){

The Test-Path cmdlet works fine when I pass it a variable called [string]$fileName in the command line itself and set it equal to a random file's path name. The script used to test the function looks like this:
    
    . .\PSFunctions.ps1

    $path = ""C:\Util\ModAllProfiles.exe"";
    CheckFileVersion($path, $path, 5);

And the error looks like this:

Test-Path : The given path's format is not supported.
At C:\Users\MAFFATNJ\documents\templates\PSFunctions.ps1:69 char:15
+     if (Test-Path &lt;&lt;&lt;&lt;  ($fileName)){
    + CategoryInfo          : InvalidOperation: (C:\Util\ModAllP...lProfiles.exe 5:String) [Test-Path], N
   ception
    + FullyQualifiedErrorId : ItemExistsNotSupportedError,Microsoft.PowerShell.Commands.TestPathCommand


Any ideas on what's going wrong?

EDIT:  Grammar*. For title, error keeps occurring with test-path when passed a string variable",,False,,t5_2qo1o,1340893537.0,,,True,t3_vqocx,http://www.reddit.com/r/PowerShell/comments/vqocx/error_testpath_the_given_paths_format_is_not/,
1340737914.0,6,self.PowerShell,vn6rz,Add IP to system report,8,2,7,http://www.reddit.com/r/PowerShell/comments/vn6rz/add_ip_to_system_report/,"http://pastebin.ca/2164847

First off this is not my script I got it from Sean Duffy at http://www.simple-talk.com/sysadmin/powershell/building-a-daily-systems-report-email-with-powershell/

I am able to run the system report without any problems, the only part that I wish to add is the IP address alongside $computer in the final HTML page. I know the commands to get an IP address from a system I just dont know how to setup the $IP variable and pull it from the computer list and then call that variable. Thank you for any help you can provide. The working commands is on line 218-219 I just need it to pull the IP from the computer list I have been using throughout the list and then put that variable on line 225 which I think I could just put:

&lt;p&gt;&lt;h2&gt;$computer Report $IP($computer)&lt;/p&gt;&lt;/h2&gt;

Any help you could provide would be really appreciated.",,False,,t5_2qo1o,False,,,True,t3_vn6rz,http://www.reddit.com/r/PowerShell/comments/vn6rz/add_ip_to_system_report/,
1340726197.0,5,self.PowerShell,vmu4e,Detect Photoshop on remote machine,6,1,18,http://www.reddit.com/r/PowerShell/comments/vmu4e/detect_photoshop_on_remote_machine/,"I realize this might be asking a bit much, but I figured if anyone knew how to do it, it would be you guys. 

Now I've done quite a bit of research into querying remote machines for software, and obviously the registry is the best place to look due to Win32_Product's known issues, but Photoshop doesn't appear to be in the proper spot in the registry.

Anyone have any ideas for detecting it?",,False,,t5_2qo1o,False,,,True,t3_vmu4e,http://www.reddit.com/r/PowerShell/comments/vmu4e/detect_photoshop_on_remote_machine/,
1340369204.0,5,self.PowerShell,vflti,I'm confused. What am I supposed to do with this?,6,1,9,http://www.reddit.com/r/PowerShell/comments/vflti/im_confused_what_am_i_supposed_to_do_with_this/,"http://gallery.technet.microsoft.com/scriptcenter/b780c4e4-e986-40a3-9296-65caadd31211

The link is just an example. I feel like I'm missing a step so basic that it doesn't need to be explained, except that it does. Am I supposed to set up some sort of repository of custom functions that I can call from anywhere in the shell or do I run the script directly?

    PS C:\&gt; .\Get-MACAddress.ps1 localhost
    PS C:\&gt;

edit: [Getting closer](http://blogs.technet.com/b/heyscriptingguy/archive/2006/11/21/how-can-i-add-a-function-to-a-windows-powershell-script.aspx).

&gt;Of course, this function will last only as long as your current Windows PowerShell session. If you’d like multiplynumbers to be a permanent addition to Windows PowerShell then add the function to your Windows PowerShell profile. To do that, type notepad $profile to bring up your default profile, **add the function call**, and then save the profile. 

What does it mean to add the function call?

edit: sysiphean got it. see [reply](http://www.reddit.com/r/PowerShell/comments/vflti/im_confused_what_am_i_supposed_to_do_with_this/#c541qpc) for additional questions.",,False,,t5_2qo1o,1340370900.0,,,True,t3_vflti,http://www.reddit.com/r/PowerShell/comments/vflti/im_confused_what_am_i_supposed_to_do_with_this/,
1340031097.0,7,self.PowerShell,v8534,Question about SQL queries in powershell,7,0,4,http://www.reddit.com/r/PowerShell/comments/v8534/question_about_sql_queries_in_powershell/,"I have worked out the connection string and query, and I think I'm just a tweek or two away from getting the data in a variable I can use, the thing is though, that I want to run about 3 queries in the script. I'm building a function, and I want to get an answer back from the first query, and based on whether or not that is a null value, to move on to the other two.

Will each of the queries need to be in its own script block, with its own connect string? or can they all share the connect string? will i be better off, writing each as its own function and calling them from 4th function?",,False,,t5_2qo1o,False,,,True,t3_v8534,http://www.reddit.com/r/PowerShell/comments/v8534/question_about_sql_queries_in_powershell/,
1339588892.0,6,self.PowerShell,uzos5,PS Script to get all ad users,6,0,6,http://www.reddit.com/r/PowerShell/comments/uzos5/ps_script_to_get_all_ad_users/,"As the title says I am looking for a script that will grab all the users of my domain and include the sam account name, the given name, and employee id into a csv.  I have this so far any help would be awesome,
Get-ADUser -Filter ""*"" -SearchBase ""OU=childou,OU=parentou,DC=yourdomain,DC=com""",,False,,t5_2qo1o,False,,,True,t3_uzos5,http://www.reddit.com/r/PowerShell/comments/uzos5/ps_script_to_get_all_ad_users/,
1338038258.0,6,self.PowerShell,u5xlw,"Exporting a remote registry key, all of the sub keys and their values as a .REG file. ",6,0,2,http://www.reddit.com/r/PowerShell/comments/u5xlw/exporting_a_remote_registry_key_all_of_the_sub/,I have been searching for a way to do this and I am not having a lot of luck. I found a [Remote Registry Module](http://psremoteregistry.codeplex.com/) but it won't download for me. The code to do this shouldn't be all that hard to put together but it is beyond me right now. I need to get the IPSEC key and all of the sub keys and values from multiple machines in my domain.Any help with this I would really appreciate.,,False,,t5_2qo1o,False,,,True,t3_u5xlw,http://www.reddit.com/r/PowerShell/comments/u5xlw/exporting_a_remote_registry_key_all_of_the_sub/,
1337881605.0,5,self.PowerShell,u32go,project euler twelve,8,3,9,http://www.reddit.com/r/PowerShell/comments/u32go/project_euler_twelve/,"I'm trying to work through these problems with powershell.  Basically, this script finds the prime factorization for a number, then attempts to apply a formula to get the number of divisors of that number.  The formula is d(n)=(a+1)(b+1)....  This is handled through the:
$divs = $divs * ($j + 1)

My real issue is that when the n gets past a certain number, it starts to return 2 separate values for $div.  Like an array.  Can anyone explain why? (ps. sorry about the sloppy code)

#What is the value of the first triangle number to have over five hundred divisors?

    function prime-factorization ($num,$stop){
        if($num -eq 1){$num++}
        $prim=2
        while($num % $prim -ne 0){
            $prim++
        }    
        if($num % $prim -eq 0){
            $j=0
            $i=$num
            while($i % $prim -eq 0){
                $rem = $i / $prim
                $i=$i/$prim
                #$i
                $j++
            }#for
            $divs = $divs * ($j + 1)
            #write-host $prim '^' $j
            
         if ($rem -ne 1){
         prime-factorization $rem
         }
         #write-host $rem   
         return $divs
         #find prime-factor for remainder
         
        }#if
        
        
    }#prime-factorization
    $prev=0
    $stop=2
    for($num=1;$a -le $stop;$num++){
        $divs=1
        $prev+=$num
        write-host ""number"" $prev
        $a = prime-factorization $prev $stop
        write-host ""divisors"" $a
    }

**Edit:** When stepping through this in the ide, for whatever reason, the return statement returns 2 separate values",,False,,t5_2qo1o,1337957586.0,,,True,t3_u32go,http://www.reddit.com/r/PowerShell/comments/u32go/project_euler_twelve/,
1336676657.0,6,csharpening.net,tgwdy,Management OData and PowerShell,6,0,3,http://www.reddit.com/r/PowerShell/comments/tgwdy/management_odata_and_powershell/,,,False,,t5_2qo1o,False,,,False,t3_tgwdy,http://csharpening.net/?p=1141,
1335609465.0,6,adicodes.com,swnmr,Config file for Powershell script in SharePoint 2010,10,4,5,http://www.reddit.com/r/PowerShell/comments/swnmr/config_file_for_powershell_script_in_sharepoint/,,,False,,t5_2qo1o,False,,,False,t3_swnmr,http://adicodes.com/config-file-for-powershell-script-in-sharepoint-2010/,
1335553425.0,4,adicodes.com,svp14,Best articles on powershell in SharePoint 2010,9,5,2,http://www.reddit.com/r/PowerShell/comments/svp14/best_articles_on_powershell_in_sharepoint_2010/,,,False,,t5_2qo1o,False,,,False,t3_svp14,http://adicodes.com/powershell/,
1334640999.0,7,self.PowerShell,sdsw1,inserting list into foreach loop,7,0,9,http://www.reddit.com/r/PowerShell/comments/sdsw1/inserting_list_into_foreach_loop/,"hey guys

**What I want to acheive**: [pastebin](http://pastebin.com/0kVwjiHp)

Have a variable which is a list of users, then while performing a foreach loop, run it against each user in the list

**What I did in the short-term, as it didnt work**: [pastebin](http://pastebin.com/mxZfwjfD)

defined each user as a seperate variable, and in the loop ran the command 4 seperate times.

Any way to acheive this? Cheers. ",,False,,t5_2qo1o,False,,,True,t3_sdsw1,http://www.reddit.com/r/PowerShell/comments/sdsw1/inserting_list_into_foreach_loop/,
1334608608.0,7,self.PowerShell,scyoi,A little help understanding a select statement,7,0,4,http://www.reddit.com/r/PowerShell/comments/scyoi/a_little_help_understanding_a_select_statement/,"I have the statement:


    $users = Get-MailBoxStatistics -Server &lt;exchange server&gt; | where {""IssueWarning"",""ProhibitSend"",""MailboxDisabled"" -contains $_.StorageLimitStatus}  

I don't understand how the select works with the 3 statuses I'm checking for being listed how they are.  I had originally been trying to do it as 

        select(where $_.StorageLimitStatus -ne ""BelowLimit""

and that wasn't working properly.  How are the two statements different?

Thanks.

edit: Fixed a typo that nsabinske pointed out.",,False,,t5_2qo1o,True,,,True,t3_scyoi,http://www.reddit.com/r/PowerShell/comments/scyoi/a_little_help_understanding_a_select_statement/,
1331692106.0,5,self.PowerShell,qvk0d,Powershell fork()?,7,2,7,http://www.reddit.com/r/PowerShell/comments/qvk0d/powershell_fork/,"Is there a way to fork out multiple processes in powershell? I have a text file I am parsing that is over 1 million lines. So far the script has been running for almost 24 hours.

Here is a copy of the [script](http://pastebin.com/nP2bkB4P)

The text file it reads is just a bunch of email addresses. What I would love to be able to do is during the foreach loop fork out 100 processes that would concurrently work through the list. I know that this can be done in Perl (but I am not very good in perl....)

",,False,,t5_2qo1o,False,,,True,t3_qvk0d,http://www.reddit.com/r/PowerShell/comments/qvk0d/powershell_fork/,
1330549411.0,6,vconferenceonline.com,qbugv,PowerShell Remoting webcast with Don Jones,6,0,0,http://www.reddit.com/r/PowerShell/comments/qbugv/powershell_remoting_webcast_with_don_jones/,,,False,,t5_2qo1o,False,,,False,t3_qbugv,https://www.vconferenceonline.com/event/regeventweb.aspx?id=543&amp;cid=EPDedMVPSIMar12WS01_M1,
1329357725.0,7,csharpening.net,prnat,Granting Access Rights to SMB Shares in PowerShell 3,7,0,0,http://www.reddit.com/r/PowerShell/comments/prnat/granting_access_rights_to_smb_shares_in/,,,False,,t5_2qo1o,False,,,False,t3_prnat,http://csharpening.net/?p=929,
1328531122.0,7,blogs.technet.com,pd3ff,"2012 Scripting Games Study Guide: A Resource for Learning PowerShell
",8,1,0,http://www.reddit.com/r/PowerShell/comments/pd3ff/2012_scripting_games_study_guide_a_resource_for/,,,False,,t5_2qo1o,False,,,False,t3_pd3ff,http://blogs.technet.com/b/heyscriptingguy/archive/2012/02/05/2012-scripting-games-study-guide-a-resource-for-learning-powershell.aspx,
1326595212.0,6,self.PowerShell,ohifs,Powershell logging,8,2,8,http://www.reddit.com/r/PowerShell/comments/ohifs/powershell_logging/,"Any tips on a simple logging function?   I have found several functions,  but each of these was really overkill for what I am looking for.      Thoughts?",,False,,t5_2qo1o,False,,,True,t3_ohifs,http://www.reddit.com/r/PowerShell/comments/ohifs/powershell_logging/,
1325739974.0,7,self.PowerShell,o3kc7,"Maybe I'm doing this wrong, but I have a fairly simple question about foreach",9,2,26,http://www.reddit.com/r/PowerShell/comments/o3kc7/maybe_im_doing_this_wrong_but_i_have_a_fairly/,"What I have is a plain text (non .csv) list of servers with a common path which I need to extract specific log file information from - this list of servers dynamically will go up and down) but what I need to do is to have a script that will Get-Content from the .txt file, use that list of IPs and ship the logs out to a unc path.  Should this be done with a counted loop (get-content counter) then build a loop from that count number, or is there a cleaner way to do it without needing the extra step?",,False,,t5_2qo1o,False,,,True,t3_o3kc7,http://www.reddit.com/r/PowerShell/comments/o3kc7/maybe_im_doing_this_wrong_but_i_have_a_fairly/,
1325273405.0,7,self.PowerShell,nwkg5,Anyone using powershell for government compliance?,7,0,11,http://www.reddit.com/r/PowerShell/comments/nwkg5/anyone_using_powershell_for_government_compliance/,"I am required to set audit permissions on the Advanced Security Settings audit tab [(example)](http://www.google.com/imgres?um=1&amp;hl=en&amp;sa=N&amp;biw=1585&amp;bih=864&amp;tbm=isch&amp;tbnid=TDN_Etk6X-G0-M:&amp;imgrefurl=http://flylib.com/books/en/1.531.1.26/1/&amp;docid=TZB-7Fn0fQMWiM&amp;imgurl=http://flylib.com/books/1/531/1/html/2/images/fig3-27.jpg&amp;w=350&amp;h=302&amp;ei=axD-TpuIF8W0iQLox6GHDQ&amp;zoom=1). 

I'd also like to find a way for powershell to apply a local security template (.inf) file. 

Does anyone here have experience in this?",,False,,t5_2qo1o,False,,,True,t3_nwkg5,http://www.reddit.com/r/PowerShell/comments/nwkg5/anyone_using_powershell_for_government_compliance/,
1323836652.0,8,powershelladmin.com,nbz93,I think the Gwmi wrapper is done. For data collection from servers/workstations. XML storage and a custom XML-parsing CSV report generator.,8,0,0,http://www.reddit.com/r/PowerShell/comments/nbz93/i_think_the_gwmi_wrapper_is_done_for_data/,,,False,,t5_2qo1o,False,,,False,t3_nbz93,http://www.powershelladmin.com/wiki/Get-wmiobject_wrapper,
1322695337.0,6,self.PowerShell,mvcme,Problems with Exchange 2010 remoting.,6,0,2,http://www.reddit.com/r/PowerShell/comments/mvcme/problems_with_exchange_2010_remoting/,"I've written a function that finds and picks an Exchange CAS server at random and connects to it via remoting.  The idea is to provide Exchange tools on administrative laptops.  This has worked great with the execption that it sometimes constantly needs to recreate the session:

Creating a new session for implicit remoting of ""Get-Mailbox"" command...

This is a problem because I set the scope to be forest wide (Set-ADServerSetting -ViewEntireForest:$true) and whenever the session gets re-created it goes back to the default of domain scope.  I've posted my function here (removing company specific info naturally):

http://pastebin.com/SigK0Rem

Does anyone have any idea what might cause this (or how I might resolve it)?",,False,,t5_2qo1o,False,,,True,t3_mvcme,http://www.reddit.com/r/PowerShell/comments/mvcme/problems_with_exchange_2010_remoting/,
1321890325.0,5,self.PowerShell,mk85p,Trying to display text in the console and update it in-place,6,1,7,http://www.reddit.com/r/PowerShell/comments/mk85p/trying_to_display_text_in_the_console_and_update/,"I can't figure out a good google-search term to do this, so I'm asking the reddit powershell Gods...

The thing I'm trying to accomplish is recursively scanning a directory and totaling file sizes by year. I have the code for that done and working, but for as long as it takes for large directories I want to show progress in the console, really just a file count.

I want to have something like this:

    Scanning...
    File count: 1

and have the ""1"" be the only part that changes

    Scanning...
    File count: 849

Is there a way to replace that line, without making any new lines?",,False,,t5_2qo1o,False,,,True,t3_mk85p,http://www.reddit.com/r/PowerShell/comments/mk85p/trying_to_display_text_in_the_console_and_update/,
1321361583.0,6,self.PowerShell,md0yb,Powershell: help with Mailbox/subfolder permissions,6,0,4,http://www.reddit.com/r/PowerShell/comments/md0yb/powershell_help_with_mailboxsubfolder_permissions/,"Hi
I'm running a groupwise &gt; exchange migration at a Law Firm which has fairly granular mailbox permission requirements.  The easiest way I can think to solve this is a script that would grant permissions to the Inbox and all subfolders via a script.

So what I need is a script that will take each users inbox then grant permission to a list of users, then recursively add these permissions to all subfolders in the inbox.

I know this sounds like permission inheritance should resolve it, however all the folders come in from groupwise and they may have dozens of folders that they need to give access to.  However we can't use 'full access' as they may have folders they need private.  So the idea is to train people to move all folders under their inbox that should be shared, and to keep any private folders out of their inbox.  My script would then grant access to those who need it.

I'm more than happy to write the script myself - I just need someone to point me in the direction of the commands I need to be using and how I acheive this, preferably with a couple of lines of pseudo-code.  I can flesh out the details myself.

Any takers?  ",,False,,t5_2qo1o,False,,,True,t3_md0yb,http://www.reddit.com/r/PowerShell/comments/md0yb/powershell_help_with_mailboxsubfolder_permissions/,
1320721086.0,6,self.PowerShell,m4c9b,Generate list of Non Microsoft startup entries with autorunsc.exe and powershell.,6,0,0,http://www.reddit.com/r/PowerShell/comments/m4c9b/generate_list_of_non_microsoft_startup_entries/,"[Code](http://pastebin.com/TRpcA1vf)

This script uses Sysinternals Autoruns command line tool, autorunsc.exe to output a csv file that contains the type of entry (Startup, Internet Explorer, Image Hijack) along with details such as registry entry, command line and description.",,False,,t5_2qo1o,False,,,True,t3_m4c9b,http://www.reddit.com/r/PowerShell/comments/m4c9b/generate_list_of_non_microsoft_startup_entries/,
1316573038.0,6,csharpening.net,kmb17,Make PowerGUI 3.0 work with PowerShell 3.0,6,0,2,http://www.reddit.com/r/PowerShell/comments/kmb17/make_powergui_30_work_with_powershell_30/,,,False,,t5_2qo1o,False,,,False,t3_kmb17,http://csharpening.net/?p=588,
1313006277.0,6,i.imgur.com,jex24,Signed Integers...,7,1,1,http://www.reddit.com/r/PowerShell/comments/jex24/signed_integers/,,,False,,t5_2qo1o,False,,,False,t3_jex24,http://i.imgur.com/8dGDB.png,
1312908304.0,5,self.PowerShell,jdmk3,This file-size + file-count script takes up more than a gig of memory on my pop server! Help me optimize it?,6,1,6,http://www.reddit.com/r/PowerShell/comments/jdmk3/this_filesize_filecount_script_takes_up_more_than/,"Hey guys. I'm pretty new to powershell in general. I'm trying to write a script to determine the total size of all files and the number of files in a directory (not including folders). The below script works, but takes a long time and requires massive amounts of memory (more than a gig by the time it finishes). I'm guessing there's some way to get the same information from running get-childitem just *once* but I can't figure it out. Any suggestions on making this task fast, better, stronger?

    $hostname=hostname
    $directory = ""F:\foo""
    $dteCurrentDate = Get-Date –f ""yyyy/MM/dd""
    
    $count = (get-childitem $directory -recurse | ?{!($_.PSIsContainer)}).Count
    $colItems = (get-childItem $directory -recurse | Measure-Object -property length -sum)
    ""$hostname;{0:N2}"" -f ($colItems.sum / 1MB) + ""MB;"" + ""$count files;"" + ""$dteCurrentDate""",,False,,t5_2qo1o,False,,,True,t3_jdmk3,http://www.reddit.com/r/PowerShell/comments/jdmk3/this_filesize_filecount_script_takes_up_more_than/,
1312658968.0,6,pastebin.com,jazf1,Bulk Load ActiveDirectory Users Using a CSV,6,0,3,http://www.reddit.com/r/PowerShell/comments/jazf1/bulk_load_activedirectory_users_using_a_csv/,,,False,,t5_2qo1o,False,,,False,t3_jazf1,http://pastebin.com/8QuMJb22,
1312313905.0,6,self.PowerShell,j6zjs,Writing to the Windows Event Log with Powershell,6,0,8,http://www.reddit.com/r/PowerShell/comments/j6zjs/writing_to_the_windows_event_log_with_powershell/,"I'm sharing this because I couldn't find a ton of good detail on the subject- I had to synthesize from a number of articles.  I started my work with a goal:  To make my Robocopy scripts log data about their tasks to the Windows Event Viewer- this would expose the details of their activities to my event aggregation systems and allow me to alert on them, etc.  
  
So, to get started, you've got to first create a new Event Log to house your alerts.  I created one called ""Robocopy Scripts"".
To do that, run this command from an elevated command prompt:  
    New-EventLog -LogName ""Robocopy Scripts"" -Source Robocopy

This only has to be done once, so it won't be called in our script.  The script in the link above will take the exit code of Robocopy and apply a little (very little) logic to connect it to a predetermined human readable text containing information about the result of the task, and the duration(a particularly important consideration for a replication task).  It will output to the event log using the ""write-eventlog"" cmdlet.

I would appreciate your input or recommendations- the script runs well as is, but it sure seems like the ""elseif"" business is way inefficient.

The script:
http://pastebin.com/SBTt5gKV 
",,False,,t5_2qo1o,True,,,True,t3_j6zjs,http://www.reddit.com/r/PowerShell/comments/j6zjs/writing_to_the_windows_event_log_with_powershell/,
1311346579.0,7,self.PowerShell,iwulu,Need help with PSObject and properties. I think... (details inside),7,0,1,http://www.reddit.com/r/PowerShell/comments/iwulu/need_help_with_psobject_and_properties_i_think/,"Okay, maybe I'm going about this the wrong way, so any advice, pointers, or corrections are definitely appreciated. First a little background information.

I'm trying to store information gathered from an xml a file about network connections on servers. The info has to come from the xml file and not pulled directly from the systems. I have multiple servers, multiple network connections, and multiple properties for each connection that I need to store information for.

I started by creating an PSObject for each server and storing all the properties using Add-Member with the NoteProperty option like this.

    $objServer = new-object PSObject
    $objServer | Add-Member -type NoteProperty -name Name -Value $Cluster.fqdn
    $objServer | Add-Member -type NoteProperty -name UniqueID -Value $Cluster.UniqueID
    $objServer | Add-Member -type NoteProperty -name SiteName -Value $Location.Name.""#text""

I then used **foreach** to loop through each network interface on the server. Sometimes theres only 1 network interface, and sometimes it can be 6, 8, or even more. Here is the code I was trying to use to store the information about each network interface. My original idea was to create a PSObject to represent each network connection and add NotePropertys to store the information. I then tried to create an object to represent the network interfaces as a group and add each individual interface as a PropertySet. My plan was then to add the object representing the group of interfaces as a PropertySet of the original server object. Here is the code I was using.

    $i = 1
    $objNetInterfaces = new-object PSObject
    foreach ($NetInterface in $Cluster.Machines.Machine.NetInterface){
    $objNetInterface = new-object PSObject -Property @{
    ClusterUniqueID = $Cluster.UniqueID.ToString()
    InterfaceNumber = $NetInterface.InterfaceNumber.ToString()
    InterfaceSide = $NetInterface.InterfaceSide.ToString()
    IPAddress = $NetInterface.IPAddress.ToString()
    }
    $objNetInterfaces | Add-Member -type PropertySet -Name Instance$i -Value $objNetInterface
    $i++
    }

I know this is a mess. My hope was to be able to store the information so that it could be represented and accessed like this.

$Server.NetInterfaces.Interface1.IPAddress

Maybe I should be using hashtables or arrays. I tried arrays before, but like the idea of properties and subproperties because they can be accessed by name as shown above. Any suggestions, questions, or recommendations?",,False,,t5_2qo1o,False,,,True,t3_iwulu,http://www.reddit.com/r/PowerShell/comments/iwulu/need_help_with_psobject_and_properties_i_think/,
1311255579.0,6,gsexdev.blogspot.com,ivt2i,Dealing with Invalid Delegates with Exchange Web Services and PowerShell,9,3,1,http://www.reddit.com/r/PowerShell/comments/ivt2i/dealing_with_invalid_delegates_with_exchange_web/,,,False,,t5_2qo1o,False,,,False,t3_ivt2i,http://gsexdev.blogspot.com/2011/03/dealing-with-invalid-delegates-with.html,
1309367531.0,7,self.PowerShell,icgj0,Free Webinar with Microsoft MVP Don Jones 7/6/2011,7,0,4,http://www.reddit.com/r/PowerShell/comments/icgj0/free_webinar_with_microsoft_mvp_don_jones_762011/,"This is a free webinar occuring next Wednesday 7/6/2011. The topic is :
Learn how easy-to-make custom objects not only let you combine output from multiple sources, but also allow you to create calculated properties and columns, customize output formatting, and easily send your output to CSV files, XML files, HTML, or pretty much anything you like.

Register for the webinar [here](https://www2.gotomeeting.com/register/132445139)",,False,,t5_2qo1o,False,,,True,t3_icgj0,http://www.reddit.com/r/PowerShell/comments/icgj0/free_webinar_with_microsoft_mvp_don_jones_762011/,
1309233752.0,6,self.PowerShell,iazdp,Hosting powershell in IIS?,8,2,7,http://www.reddit.com/r/PowerShell/comments/iazdp/hosting_powershell_in_iis/,"We have an intranet app that manages a bunch of stuff for user self service, and I want to add some Exchange 2010 nifties to it...

We can do some of the work by interacting directly with LDAP, but some of it requires calling out to PowerShell/EMS...  That that environment takes far too long to startup to be able to spawn it as needed.

Anyone doing something like that?  Where maybe someone from your legal team can put someone on litigation hold, or maybe give the users a way to trigger a data migration from one of our other email systems, etc...  but still have it responsive.

-

The angle I'm thinking now is kinda ugly... have a script start up that spawns several jobs which run simple web servers.  The master script keeps track of the status of the little scripts, so the web app can call in and get to a shell that's already loaded for bear.

Anything better?",,False,,t5_2qo1o,False,,,True,t3_iazdp,http://www.reddit.com/r/PowerShell/comments/iazdp/hosting_powershell_in_iis/,
1306511111.0,6,pastebin.com,hlkxn,"Created a script to automagically update packages in MDT, Any critiques?",6,0,1,http://www.reddit.com/r/PowerShell/comments/hlkxn/created_a_script_to_automagically_update_packages/,,,False,,t5_2qo1o,False,,,False,t3_hlkxn,http://pastebin.com/03nLgnSC,
1306270329.0,4,pastebin.com,hj78d,An example loading screen with random status,6,2,3,http://www.reddit.com/r/PowerShell/comments/hj78d/an_example_loading_screen_with_random_status/,,,False,,t5_2qo1o,False,,,False,t3_hj78d,http://pastebin.com/vxCZKY5R,
1306248290.0,6,self.PowerShell,hix95,Test for a battery,7,1,0,http://www.reddit.com/r/PowerShell/comments/hix95/test_for_a_battery/,"This may be obvious to everyone but this is a useful little function to test to see if a battery exists and return $true or $false.  I use it alot in imaging related scripts using hardware independant imaging with specific laptop only applications.

    Function Test-Battery
	{
	$wmiBattery = @(Get-WmiObject Win32_Battery).count
	IF ($wmiBattery -ne 0)
		{
		return $true
		}
	ELSE	
		{
 		return $false
		}
	}",,False,,t5_2qo1o,False,,,True,t3_hix95,http://www.reddit.com/r/PowerShell/comments/hix95/test_for_a_battery/,
1306205724.0,6,self.PowerShell,hiklj,TIL You can retrieve previous commands from the history in powershell,6,0,2,http://www.reddit.com/r/PowerShell/comments/hiklj/til_you_can_retrieve_previous_commands_from_the/,"If that command you entered previously has scrolled off the screen or there is just too much text to try looking for it. You can retrieve previous commands that you have entered in your powershell console by typing #keyword and hitting tab. The keyword can be just the first few letters of a word and does not need to be a full word.
",,False,,t5_2qo1o,False,,,True,t3_hiklj,http://www.reddit.com/r/PowerShell/comments/hiklj/til_you_can_retrieve_previous_commands_from_the/,
1306198702.0,5,self.PowerShell,hihu8,A very useful tool for building regular expressions.,8,3,1,http://www.reddit.com/r/PowerShell/comments/hihu8/a_very_useful_tool_for_building_regular/,This tool works great for building regular expressions and its [free](http://www.ultrapico.com/Expresso.htm),,False,,t5_2qo1o,False,,,True,t3_hihu8,http://www.reddit.com/r/PowerShell/comments/hihu8/a_very_useful_tool_for_building_regular/,
1285003016.0,6,self.PowerShell,dgfsf,Recommend me a book to get started?,7,1,6,http://www.reddit.com/r/PowerShell/comments/dgfsf/recommend_me_a_book_to_get_started/,"I'm going to be doing some PowerShell v2 work soon for AD user administration (creating &amp; updating users, managing group membership, etc.) with Windows Server 2008 (possible R2) controlling the domain.

I've done C#.NET(among other languages) development. I guess I'm looking for 2 classes of books: ""PowerShell for programmers"" and ""PowerShell for AD administration.""

Are William Stanek's books good? Any specific titles I should pick up? Other books I should look at?",,False,,t5_2qo1o,False,,,True,t3_dgfsf,http://www.reddit.com/r/PowerShell/comments/dgfsf/recommend_me_a_book_to_get_started/,
1376937015.0,6,self.PowerShell,1kohl4,What's you favorite function or script do?,6,0,5,http://www.reddit.com/r/PowerShell/comments/1kohl4/whats_you_favorite_function_or_script_do/,"I wrote a function to get warranty info from Dell's website, and I use this in a script that sets ad computer descriptions to ""User | WarrantyExp. | machine Model + type | OS and SP"" This has worked out pretty well.

What about you guys?

edit: And i missed the r in your. damn it. ",,False,,t5_2qo1o,False,,,True,t3_1kohl4,http://www.reddit.com/r/PowerShell/comments/1kohl4/whats_you_favorite_function_or_script_do/,
1376581540.0,5,self.PowerShell,1kfa8y,Active Directory - List users in Administrators Group on member servers in 2008 R2 domain,6,1,4,http://www.reddit.com/r/PowerShell/comments/1kfa8y/active_directory_list_users_in_administrators/,"I am the admin for a 2008 R2 domain, with around 150 member servers in different OUs, and I have a very short-notice tasking. I am required to generate a list of all users that are in any Administrators group (Administrators, Domain Admins, server Local Admins) on all member servers in the domain, as well as if their account is SmartCard enabled.

I have found a script that will generate the list of servers and the users in each ""Administrators"" group, but I'm not sure how to edit this particular script to check if ""SmartCard is required to logon"" is enabled. Also, the current output formatting of the script is far from ideal. The end result of the current script is a .csv with the following formatting:

	Server - Server#1
	User#1
	User#2
	User#3

	Server - Server#2
	User#1
	User#2
	User#3


The ideal result would be

	Server	    Username    	Display Name	SmartCard required?
	Server #1	Domain\User#1	Mr. User #1		Yes
	Server #1	Server\User#2	Miss User #2	No

	Server #2	Domain\User#1	Mr. User #1		Yes
	Server #2	Server\User#2	Miss User #2	Yes


Unfortunately, scripting is far from my area of expertise. If you guys can help, it would be most appreciated. If not, I understand not wanting to do 


    #################
    Function Search_AD 
    { 
    $ServerInfoFile = New-Item -type file -force "".\List_of_Servers.csv"" 
    ""ServerName"" | Out-File $ServerInfoFile -encoding ASCII 
     $n = 0 
     $ObjFilter = ""(objectClass=Computer)"" 
     $objSearch = New-Object System.DirectoryServices.DirectorySearcher 
     $objSearch.PageSize = 15000 
     $objSearch.Filter = $ObjFilter 
     $objSearch.SearchRoot = ""LDAP://dc=X, dc=Y, dc=Z"" 
     $AllObj = $objSearch.FindAll() 
     Write-host -nonewline ""Searching Active Direcotry for Domain Servers - "" 
    foreach ($Obj in $AllObj) 
    {  
    $objItemT = $Obj.Properties 
    $CName = $objItemT.name 
    ""$CName"" | Out-File $ServerInfoFile -encoding ASCII -append 
    $n++ 
    } 
     Write-host ""$n Domain Servers Found"" 
     write-host """"
     } 
     
    #################
     Function Search_LAdmin 
    { 
    $GFile = New-Item -type file -force "".\List_Of_Admins.csv"" 
    Import-CSV "".\List_of_Servers.csv"" | ForEach-Object { 
    $SName = $_.ServerName 
    $AdminPath = Test-Path ""\\$SName\admin$"" 
    Write-host -nonewline ""Generating list of Local Administrators on $SName - "" 
    If ($AdminPath -eq ""TRUE"") 
    {
    ""Server Name - $SName"" | Out-File $GFile -encoding ASCII -append 
    $group = [ADSI](""WinNT://$SName/Administrators,group"")  
    $GMembers = $group.psbase.invoke(""Members"") 
    $GMembers | ForEach-Object {$_.GetType().InvokeMember(""Name"",'GetProperty', $null, $_, $null) | Out-File $GFile -encoding ASCII -append} 
    Write-host ""Done!"" 
    } 
      
    else 
    { 
    write-host -fore Red ""Unable to Access $SName""  
    out-file -inputObject ""Server Name - $SName - Unable to Access Server"" -filepath $GFile -encoding ASCII -append
    
    } 
      
    $GMembers = """"
      echo """" | out-file $GFile -Encoding ascii -Append
       }
    } 
    #################
    clear 
    Search_AD 
    Search_LAdmin 
    #################


",,False,,t5_2qo1o,False,,,True,t3_1kfa8y,http://www.reddit.com/r/PowerShell/comments/1kfa8y/active_directory_list_users_in_administrators/,
1376516257.0,6,gallery.technet.microsoft.com,1kdkm0,Get-UACSetting - Query UAC settings on remote systems,6,0,1,http://www.reddit.com/r/PowerShell/comments/1kdkm0/getuacsetting_query_uac_settings_on_remote_systems/,,,False,,t5_2qo1o,False,,,False,t3_1kdkm0,http://gallery.technet.microsoft.com/scriptcenter/Get-UACSetting-Query-UAC-7afae0de,
1376486755.0,5,self.PowerShell,1kch8q,Searching AD via CSV,5,0,2,http://www.reddit.com/r/PowerShell/comments/1kch8q/searching_ad_via_csv/,"I have a CSV file that contains two columns sn,GivenName of a list exported from HR. I'm trying to query against AD to see if these users exist but can't see to get the code to search the CSV. Was wondering if you guys had any suggestions. 

$path = c:\file.csv
$csv = import-csv -path $path
forEach($line in $csv) `
{
Get-QAduser
}

All this seems to do is open the csv than search ad for every account. I'm trying to search AD than export the results to a file with the user IDs. Any thoughts would be great! Thanks! ",[Active Directory],False,,t5_2qo1o,False,,,True,t3_1kch8q,http://www.reddit.com/r/PowerShell/comments/1kch8q/searching_ad_via_csv/,
1376449906.0,5,self.PowerShell,1kbpnm,Load information from database to active directory user attributes,5,0,5,http://www.reddit.com/r/PowerShell/comments/1kbpnm/load_information_from_database_to_active/,"I am working on a project to read information from a database and then update user attributes with the information.     I have some test code in place that queries the database and pulls the table into a large psobject.  I can then go through and select anything that I need.

Where I am kind of stuck is...I need to take this psobject and somehow map it to another hashtable/psobject.   More,  there are a pile of custom ad attributes and the names will not match the column names from the database.     I need to build a object that will contain information for each user {loop of some sort} and set the name to the attribute name.    If this is set right,  I believe I should then be able to use set-aduser or set-qaduser and just update the entire ad object with a single psobject.

I only need a general idea to work off of...  any insights /etc would be appreciated.     ",[Active Directory],False,,t5_2qo1o,False,,,True,t3_1kbpnm,http://www.reddit.com/r/PowerShell/comments/1kbpnm/load_information_from_database_to_active/,
1376416543.0,4,self.PowerShell,1kaika,Help with new user informational email,5,1,7,http://www.reddit.com/r/PowerShell/comments/1kaika/help_with_new_user_informational_email/,"Hi all,

I am working on a script which will send an email to new users that has some helpful information about how to get IT support, how to access pay info, etc.. I have most of the script worked out, I just need some help with getting newly created email accounts rather than newly created active directory accounts. What I want to do is on a daily basis get all new email accounts and send those users an email message. Here's what I've got so far...

    #Import-Module activedirectory
    $time = (get-date).adddays(-1)
    #$users = get-aduser -filter {whencreated -ge $time} -Properties emailaddress     
    $companyname = ""Company Name""

    $helpdesk = ""http://ITHelpDesk""
    $intranet = ""http://intranet""
    $training = ""http://10.1.1.4/documents/m5ki_Microsoft_Training_Available_Now.pdf""

    foreach($user in $users) {
    if($user.emailaddress -ne $null) {
    $username = '$_.givenname'
    $to = $email
    $from = ""noreply@xxxxx.com""
    $sub = ""Welcome to $companyname!""
    $body = ""&lt;p style='font-family:calibri'&gt;Hi $Username,&lt;/p&gt;
    &lt;p style='font-family:calibri'&gt;Welcome to $companyname! This automated message is designed to assist you with your technological questions. Please see the list below for FAQ's.&lt;/p&gt;
    &lt;ul style='font-family:calibri'&gt;
    &lt;li&gt;To open support tickets via e-mail, address an email to ITHelpDesk@xxxxx.com with the problem you are having.&lt;/li&gt;
    &lt;li&gt;To open support tickets via a web browser, type $helpdesk in your internet browser and login using your Windows credentials.&lt;/li&gt;
    &lt;li&gt;To call the HelpDesk directly, dial extension 8870 from your desk phone.&lt;/li&gt;
    &lt;li&gt;Your personal network storage will automatically map to the 'Z:' drive on your computer. Please place any personal work related files, including Outlook data files that need to be backed up nightly in this location.&lt;/li&gt;
    &lt;li&gt;Our corporate intranet can be accessed at &lt;a href=$intranet&gt;here&lt;/a&gt;.&lt;/li&gt;
    &lt;li&gt;Training on the Microsoft Office Suite of products is available &lt;a href=$training&gt;here&lt;/a&gt;.&lt;/li&gt;

    &lt;/ul&gt;
    &lt;p style='font-family:calibri'&gt;Thanks.&lt;/p&gt;
    ""
    Send-MailMessage -To $to -From $from -Subject $sub -Body $body -SmtpServer 10.1.1.7 -BodyAsHtml
    } 
    else {}
    }

I have commented out the $users string because I don't think it is the best way, I believe that I should use an Exchange cmdlet (which I have no experience with) to find new email addresses, and it would also be more reliable, especially considering some users are given email addresses at events other than their initial AD account creation. Any help is appreciated!",[Exchange],False,,t5_2qo1o,1376423847.0,,,True,t3_1kaika,http://www.reddit.com/r/PowerShell/comments/1kaika/help_with_new_user_informational_email/,
1376415709.0,4,self.PowerShell,1kahax,Merge GPOs with PowerShell,5,1,6,http://www.reddit.com/r/PowerShell/comments/1kahax/merge_gpos_with_powershell/,"I'm attempting to clean up the mess of my predecessors. I'm sure you all know what that's like. Anyway, I found [this](http://blogs.technet.com/b/ashleymcglone/archive/2011/01/19/finally-copy-and-merge-gpos-powershell-saves-the-day.aspx) beautiful script from Ashley McGlone. I tried it and I love it but I was wondering if anyone knows of a cleaner method. It strips the pathing and formatting. For example, if a setting looks like [this](http://i.imgur.com/boHLCvq.png) normally but is then merged with another GPO, it will now appear like [this](http://i.imgur.com/mLEKngo.png) because of the way it is imported. Any guidance would be greatly appreciated!!

TL;DR: What are your favorite ways to merge GPOs with PowerShell? Or is everyone doing it manually?",[Core],False,,t5_2qo1o,False,,,True,t3_1kahax,http://www.reddit.com/r/PowerShell/comments/1kahax/merge_gpos_with_powershell/,
1376379479.0,5,self.PowerShell,1k9kv4,Powershell FOR/EACH using Excel?,5,0,8,http://www.reddit.com/r/PowerShell/comments/1k9kv4/powershell_foreach_using_excel/,"I've got an excel spreadsheet that has a list of databases in one column. The second column has the criteria that I can use for the WHERE clause in an UPDATE statement and the third column is what I would use for the SET clause of said UPDATE statement.

Is there a way I can use powershell to execute these one line at a time and have it do something like this:

for each row in %spreadsheet%
connect to %column1% database
update [table]
set [variable] = %column3%
where [variable] = %column2%

I'm still messing around with Powershell basics but I figured this would be the place to go to ask questions. I'd like to output the results (it should return ""(1 row(s) affected)"" each time but it's not necessary as everything in %column2% is a unique number.

Thank you.",,False,,t5_2qo1o,False,,,True,t3_1k9kv4,http://www.reddit.com/r/PowerShell/comments/1k9kv4/powershell_foreach_using_excel/,
1376076570.0,5,self.PowerShell,1k1mi6,OS Setup Script - Registry/UAC issue,5,0,12,http://www.reddit.com/r/PowerShell/comments/1k1mi6/os_setup_script_registryuac_issue/,"Hey Everyone!
TL;DR: noob who wrote a script in an environment where UAC is autodisabled, how can I avoid permission issues when adjusting registry – and learn how to generalize my script even more? 

It’s kinda long so here’s the link: http://pastebin.com/Q0e8Uktp
MAIN QUESTION:
I’m a PowerShell nooblet who’s trying to make my coworkers lives easier by automating our post image setup (name, join domain, add local admin, and a few other things).  I was successful in achieving this but ran into a snag today when testing my script on a fresh installation of windows 7 where I forgot to disable UAC. UAC happens to be disabled per our GPO…don’t ask me why, I’m not sure if this is best practice or not. In any case the registry edits that are pretty crucial to the smooth functioning of the script get blocked when UAC is enabled and if I wanted to make my future scripts available to others who may have UAC enabled I feel like I should figure out how to fix this – even though it’s not an issue inside of my environment.
I’m not sure if you guys do general critiques in this sub, but as I’m trying to improve myself, any thoughts would be helpful too!  I also just started looking at other scripts today where .Synopsis .Description etc  are present and I realize that I didn’t do this and would like to refactor this script to match that format

PowerShell version: 3

Operating System: Windows 7 Pro 32 bit
",,False,,t5_2qo1o,False,,,True,t3_1k1mi6,http://www.reddit.com/r/PowerShell/comments/1k1mi6/os_setup_script_registryuac_issue/,
1375985840.0,5,self.PowerShell,1jyysx,How to copy file from local computer to remote computer using powershell?,6,1,7,http://www.reddit.com/r/PowerShell/comments/1jyysx/how_to_copy_file_from_local_computer_to_remote/,"First of all, I'm a total powershell noob. I need a script that will copy a file from my machine, to a different one on the domain of the university I work at. Any help would be appreciated!",[Core],False,,t5_2qo1o,False,,,True,t3_1jyysx,http://www.reddit.com/r/PowerShell/comments/1jyysx/how_to_copy_file_from_local_computer_to_remote/,
1375884036.0,7,self.PowerShell,1jvsyh,[Daily Thread] It's Hump Day! Advance scripting Q/A!,7,0,19,http://www.reddit.com/r/PowerShell/comments/1jvsyh/daily_thread_its_hump_day_advance_scripting_qa/,"**Advance scripting Q/A!**

If your just starting with advance scripting, or are a big user of it, here is your chance to ask questions. 

----

**Daily Challenge**

Turn a script only you use into something everyone can use and post it! 

----

**Monthly Publications**

[PowerTips Monthly Volume 3](http://powershell.com/cs/media/p/25742.aspx)

----

**Tips of the day**


[Hey Scripting Guy: Use PowerShell to Get Printer Configuration](http://blogs.technet.com/b/heyscriptingguy/archive/2013/08/06/powertip-use-powershell-to-get-printer-configuration.aspx)

[Powershell.com: Exploring PowerShell ""Suggestions""](http://powershell.com/cs/blogs/tips/archive/2013/08/07/exploring-powershell-quot-suggestions-quot.aspx)

----

**Message(s) from the boys upstairs:**

* The mods added something pretty awesome! Tag your posts with flare! Make sure the right people get to see your post by adding flare. For more information check out the post by /u/Davotronic5000 [here](http://www.reddit.com/r/PowerShell/comments/1jti9z/new_feature_link_flair/).

* A bot is in the works. Hang tight. 

----

***This post will be removed in 48 Hours to remove clutter. Make sure you save it if you want to save the code. It will not be removed from your user saved directory!****",[Daily Post],False,,t5_2qo1o,False,,,True,t3_1jvsyh,http://www.reddit.com/r/PowerShell/comments/1jvsyh/daily_thread_its_hump_day_advance_scripting_qa/,
1375805004.0,5,self.PowerShell,1jtgjv,How to combine output of 2 dsquery commands,5,0,7,http://www.reddit.com/r/PowerShell/comments/1jtgjv/how_to_combine_output_of_2_dsquery_commands/,"I have a powershell command that uses dsquery and outputs all users who do not have SmartCard Required checked.  The thing is that we have 2 separate user OUs on the same level so I have to run the command once for each OU and the output in in two seperate files, can someone show me a quick way to combine these 2 commands so that the output is together in 1 file?

Thanks in advance",[Active Directory],False,,t5_2qo1o,False,,,True,t3_1jtgjv,http://www.reddit.com/r/PowerShell/comments/1jtgjv/how_to_combine_output_of_2_dsquery_commands/,
1375463360.0,4,self.PowerShell,1jkovt,Passing variables into remote PSSession,5,1,6,http://www.reddit.com/r/PowerShell/comments/1jkovt/passing_variables_into_remote_pssession/,"ok, first off, I am fairly new to powershell, so bear with me if this is a dumb question.

What I am trying to do it run a script on my backup exec server, that will look at all the previous nights jobs, and ultimatly send info to a sharepoint list I have. I have a script that will give me the data I need in $variables. So, I can make $ServerName = the actual server name, and I can make $Runtime = the time each jobs runs for, etc.

WHere my problem comes in is that I then do this:
Enter-PSSession -computername sharepointserver.domain.com
Add-PSSnaping microsoft.sharepoint.powershell

That works great, I can now run commands as if I was in sharepoint server, such as get-spweb

Problem is, all the variables I set before I entered the remote session are no longer available. Those variables contain the text that I ultimately want in my sharepoint list.

So, question is, how do I pass variables that were set before I entered the remote session into the remote session so I can do what I need to do.

Getting the Data isnt a problem. Setting the Data in sharepoint isnt a problem. Making the data I pull from Backup Exec available to the part of the script that actually sets the data in sharepoint is where I need help",,False,,t5_2qo1o,False,,,True,t3_1jkovt,http://www.reddit.com/r/PowerShell/comments/1jkovt/passing_variables_into_remote_pssession/,
1375195677.0,5,self.PowerShell,1jcmtg,"[General Discussion] /r/powercli is dead... How many of you use it on a day to day, or use VMware?",5,0,6,http://www.reddit.com/r/PowerShell/comments/1jcmtg/general_discussion_rpowercli_is_dead_how_many_of/,"For the lazy /r/powercli
",,False,,t5_2qo1o,1375196167.0,,,True,t3_1jcmtg,http://www.reddit.com/r/PowerShell/comments/1jcmtg/general_discussion_rpowercli_is_dead_how_many_of/,
1374769688.0,7,self.PowerShell,1j1ane,[Script Help] Creating a script to check status of updates/reboots needed,7,0,16,http://www.reddit.com/r/PowerShell/comments/1j1ane/script_help_creating_a_script_to_check_status_of/,"So, the org I work at has terrible monitoring. So two of the tasks after patch Tuesday is to check the status of Dev servers during the week (when they're scheduled to reboot) and Prod servers on the weekend (when they're scheduled to reboot) to make sure that nothing got hung up and they actually did reboot. Seriously, this is a task and it sucks. It takes forever and there's no need for it. My co-workers can be chumps sometimes and are against scripting things for weird reasons.

I wrote the checks to see if updates are needed to be installed (parsing C:\Windows\WindowsUpdate.log) and if the server needs a reboot due to Windows Update (there's actually a registry key for this).

So, now I want to change it to make it easier to run across my Orgs domain. It would be awesome if I could just stick with POSH remoting, but our developers suck and can code their way out of a paper bag, so Server03 will be around for the forseeable future.

I don't know how to present this code to a user of this. For right now, I'm just going to keep it a regular .ps1 script, but I want to change it so I can use it in a pipeline (like, get-updatestatus) and present the user with output that can be used as they fit.

So, for those of you who have understood all that, any suggestions?",,False,,t5_2qo1o,False,,,True,t3_1j1ane,http://www.reddit.com/r/PowerShell/comments/1j1ane/script_help_creating_a_script_to_check_status_of/,
1374761894.0,5,self.PowerShell,1j10uw,Pull back user and manager properties with Get-ADUser,6,1,15,http://www.reddit.com/r/PowerShell/comments/1j10uw/pull_back_user_and_manager_properties_with/,"Hi all,

I am working on a script that will pull back some basic user info. I'd like to get the EmployeeID of the user's manager to be able to vlookup in Excel different data to link users together. Here's what I've got:

    get-aduser -filter * -properties name,employeeid,emailaddress,manager | %{(Get-AdUser $_.Manager -Properties employeeid).employeeid}

But it only ends up returning the manager EEID. How can I link this data to the properties I'm returning with the original Get-ADUser?

Thanks!

EDIT:

Script I ended up using:

    #gather users in a new variable

    $props = ""name"",""employeeid"",""emailaddress"",""manager"",""department"",'title'

    $users = get-aduser -filter * -properties $props | select $props

    #add a new member/field to my $users array for manager eeid and name

    $users | add-member -membertype NoteProperty -value """" -name ""managerID""

    $users | Add-Member -MemberType NoteProperty -value """" -name ""managerName""

    #populate the new members with data from $users ad account

    foreach ($user in $users) { 
    $user.managerID, $user.managerName = Get-AdUser $user.Manager -Properties * | select -expand employeeid,name
}
    #Export CSV

    $users | Export-Csv ""C:\Scripts\users.csv""
",,False,,t5_2qo1o,1374786066.0,,,True,t3_1j10uw,http://www.reddit.com/r/PowerShell/comments/1j10uw/pull_back_user_and_manager_properties_with/,
1373476658.0,4,self.PowerShell,1i0p5k,Help with user creation script,6,2,7,http://www.reddit.com/r/PowerShell/comments/1i0p5k/help_with_user_creation_script/,"Hi all

I'm fairly new to powershell and not a programmer either. I'm working on a script to provision our users out of a database and have it all working, but I'm wondering if there's a better way to do this test for an already existing username. The following is a code snippet from my script.

      #user doesn't exist, create them
      #find a valid username
      $i = 1
      while ((Get-ADUser -Filter {sAMAccountName -eq $sAMAccountName}) -ne $null)
      {
        $sAMAccountName = $sAMAccountName + $i
        $i++
      }
      $i--
      $name = $givenName + "" "" + $sn  
      if ($1 -ne 0)
      #need to update Name, UPN and email because of name collison  
      {
      $otherAttributes.Set_Item(""userPrincipalName"", $sAMAccountName + ""@domain.local"")
      $otherAttributes.Set_Item(""mail"", $sAMAccountName + ""@domain.com"")
      $name = $name + $i
      }
      #create user using $sAMAccountName and set attributes and assign it to the $user variable
      $user = New-ADUser -sAMAccountName $sAMAccountName -Name $name -Path $path -otherAttributes $otherAttributes -Enable $true -AccountPassword $password  

Additional information:
$sAMAccountName is initially set based on joining firstname.lastname from the database information that is returned
$otherAttributes is a hashtable that has the ldapattribute names and values I want to set.
Any comments or help would be appreciated. Thanks!",,False,,t5_2qo1o,False,,,True,t3_1i0p5k,http://www.reddit.com/r/PowerShell/comments/1i0p5k/help_with_user_creation_script/,
1373382883.0,4,self.PowerShell,1hxsq8,[Help] Script to display passwords expiring in XX days. Output time shows 12/31/1600,6,2,10,http://www.reddit.com/r/PowerShell/comments/1hxsq8/help_script_to_display_passwords_expiring_in_xx/,"Update 07/17

Here is what I have been working on and gotten to work. 

    # LOG FILE
    $LogPath = ""C:\""
    $a=get-date -format ""MM.dd.yyyy""
    echo ""Daily Log for $a"" | Out-File $LogPath\$a.txt -append
    echo ""-----------------------"" | Out-File $LogPath\$a.txt -append
    
    #Load Active Directory Module
    #if(@(get-module | where-object {$_.Name -eq ""ActiveDirectory""} ).count -eq 0) {import-module ActiveDirectory}
    $Userlist = @()
    #Searches all of Active Directory for users that are enabled and password does expire
    $UserObjects= Get-ADUser -filter {(Enabled -eq $True) -and (PasswordNeverExpires -eq $False) -and (mail -like ""*"")} -Properties * | Select-Object PasswordLastSet,EmailAddress,Name,SamAccountName,ExpiryDate
    ForEach($User in $UserObjects) 
    {
    $TodaysDate= Get-Date
    $maxPasswordAgeTimeSpan = (Get-ADDefaultDomainPasswordPolicy).MaxPasswordAge
    $Username= $User.Name
    $UserEmail = $User.EmailAddress
    $UserAccountName= $User.SamAccountName
    $passwordsetdate = $User.PasswordLastSet
    $passwordExpireDate = $TodaysDate.AddDays($daystoexpire.days)
    $expireson = $passwordsetdate.AddDays($maxpasswordagetimespan.days)
    $daystoexpire = ($expireson - $TodaysDate)
    $Days=$daystoexpire.days
    
    
    #This is where you define how many days before the password expires you want to send out the alert for
    if ( ($daystoexpire.days -gt 0) -and ($daystoexpire.days -lt 2))
    {
    #Send Email Section
    #######################################################################################################
    $SMTPserver = ""XXXXXXXX""
    $from = ""Helpdesk@XXXXX
    $to = $UserEmail
    $subject = ""Password Reminder: Your Windows password will expire in $Days days""
    $emailbody = 
        @""
    	&lt;body&gt;
    		&lt;p&gt;
    			&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;Your Windows Account &lt;span style=""font-size:16px;""&gt;&lt;strong&gt;$UserAccountName&lt;/strong&gt;&lt;/span&gt; password will expire in &lt;span style=""font-size:16px;""&gt;&lt;strong&gt;$Days&lt;/strong&gt;&lt;/span&gt; days.&amp;nbsp; You will need to change your password.&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
    		&lt;p&gt;
    			&amp;nbsp;&lt;/p&gt;
    		&lt;p&gt;
    			&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;For those of you at an office location connected directly to the network on a Windows machine, please press &lt;span style=""font-size:16px;""&gt;&lt;strong&gt;CTRL-ALT-DEL&lt;/strong&gt;&lt;/span&gt; and click Change Password.&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
    		&lt;p&gt;
    			&amp;nbsp;&lt;/p&gt;
    		&lt;p&gt;
    			&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;&lt;strong&gt;Password Requirement&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
    		&lt;p&gt;
    			&amp;nbsp;&lt;/p&gt;
    		&lt;ul&gt;
    			&lt;li&gt;
    				&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;Not contain the user&amp;#39;s account name or parts of the user&amp;#39;s full name that exceed two consecutive characters&lt;/span&gt;&lt;/span&gt;&lt;/li&gt;
    			&lt;li&gt;
    				&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;Be at least eight characters in length&lt;/span&gt;&lt;/span&gt;&lt;/li&gt;
    			&lt;li&gt;
    				&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;Contain At Least One English uppercase characters (A through Z)&lt;/span&gt;&lt;/span&gt;&lt;/li&gt;
    			&lt;li&gt;
    				&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;Contain At Least One English lowercase characters (a through z)&lt;/span&gt;&lt;/span&gt;&lt;/li&gt;
    			&lt;li&gt;
    				&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;Contain At Least One Base 10 digits (0 through 9)&lt;/span&gt;&lt;/span&gt;&lt;/li&gt;
    			&lt;li&gt;
    				&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;Contain At Least One Non-alphabetic characters (for example, !, $, #, %)&lt;/span&gt;&lt;/span&gt;&lt;/li&gt;
    		&lt;/ul&gt;
    		&lt;p&gt;
    			&amp;nbsp;&lt;/p&gt;
    		&lt;p&gt;
    			&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;&lt;span style=""font-size:16px;""&gt;&lt;strong&gt;For Remote Users&lt;/strong&gt;&lt;/span&gt;, you can change it with a web browser by using this link: &lt;a href=""https://webmail.XXXXXXXXXX/ecp/?rfr=owa&amp;amp;p=PersonalSettings/Password.aspx""&gt;https://webmail.XXXXXXXX.org/ecp/?rfr=owa&amp;amp;p=PersonalSettings/Password.aspx&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
    		&lt;p&gt;
    			&amp;nbsp;&lt;/p&gt;
    		&lt;p&gt;
    			&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;To log into Web Mail use your Windows User ID and Password.&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
    		&lt;p&gt;
    			&amp;nbsp;&lt;/p&gt;
    		&lt;p&gt;
    			&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;&lt;span style=""color: rgb(255, 0, 0);""&gt;&lt;u&gt;&lt;strong&gt;Please remember to also update your password on your mobile device if you have it setup to receive emails. &lt;/strong&gt;&lt;/u&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
    		&lt;p&gt;
    			&amp;nbsp;&lt;/p&gt;
    		&lt;p&gt;
    			&lt;span style=""font-size:14px;""&gt;&lt;span style=""font-family: arial, helvetica, sans-serif;""&gt;If you need help changing your password please contact &lt;a href=""mailto:Helpdesk@XXXXXXXX""&gt;Helpdesk@XXXXXXX&lt;/a&gt; or call the Help Desk at XXXXXXXX&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
    	&lt;/body&gt;
    ""@ 
    
    $mailer = new-object Net.Mail.SMTPclient($SMTPserver)
    $msg = new-object Net.Mail.MailMessage($from, $to, $subject, $emailbody)
    $msg.IsBodyHtml = $True
    $mailer.send($msg)
    
    echo $Username,$UserEmail,$daystoexpire.days, "" ""  | Out-File $LogPath\$a.txt -append
    #######################################################################################################

  
    # This next section will create a new object containing the information below then export to a .CSV file
    #######################################################################################################
    $Output = new-object PSObject
    $Output | add-member NoteProperty Name $Username 
    $Output | add-member NoteProperty Username $UserAccountName
    $Output | add-member NoteProperty Email $UserEmail
    $Output | add-member NoteProperty DateExpire $passwordExpireDate.ToShortDateString()
    $Output | add-member NoteProperty DaysTillExpire $daystoexpire.days
    
    $UserList += $output
    
    }
    }
    
    
    $Userlist | export-csv C:\Expiring.csv -notypeinformation
    #######################################################################################################",,False,,t5_2qo1o,1374113942.0,,,True,t3_1hxsq8,http://www.reddit.com/r/PowerShell/comments/1hxsq8/help_script_to_display_passwords_expiring_in_xx/,
1373381204.0,3,self.PowerShell,1hxqny,List of all users with a line for each security group membership,6,3,11,http://www.reddit.com/r/PowerShell/comments/1hxqny/list_of_all_users_with_a_line_for_each_security/,"Hello! I was asked by my boss to build a list of users that repeats the user name for each group they're a member of, preferably with a ""&gt;"" concatenated in the middle. Ultimately it'll go into a diagram program she's using. It would look something like this:


     Bob &gt; Domain Users
     Bob &gt; IT Staff
     Bob &gt; Domain Admins
     Eric &gt; Domain Users
     Eric &gt; HR staff


I think I might be able to figure out how to do it if anyone can help me get started. What modules do I need to use this? Do I need QAD or is just the active directory module from Microsoft enough?

I'm currently using PS 3.0 if that makes a difference.

Thank you!",,False,,t5_2qo1o,False,,,True,t3_1hxqny,http://www.reddit.com/r/PowerShell/comments/1hxqny/list_of_all_users_with_a_line_for_each_security/,
1372425552.0,5,self.PowerShell,1h8v70,Help with cleaning up my logic,5,0,7,http://www.reddit.com/r/PowerShell/comments/1h8v70/help_with_cleaning_up_my_logic/,"I'm writing a script which has two switches, one for Users and one for Computers.  Depending on the state of each switch, I am changing the way an LDAP filter is constructed.  Right now I have a three step If..Then..ElseIf type construct and I can't help feeling that I should really be able to force this into some type of switch statement.  While this is probably just me trying to be a perfectionist, it just strikes me as a better coding practice to use switches rather than cascading if..thens.  
The intended result is that is either switch exists to the exclusion of the other, the LDAP filter text for that objectCategory is included.  If both switches exist or both switches are missing, then the LDAP filter text performs an OR on both types.  
so at the moment, here is what I am doing: 

    if(($User -AND $Computer) -OR (-NOT $User -AND -NOT $Computer)){
        $TypeFilter = ""(|(objectCategory=person)(objectCategory=computer))""
    }
    elseif($User -AND -NOT $Computer) {
        $TypeFilter = ""(objectCategory=person)""
    }
    elseif($Computer -AND -NOT $User)  {
        $TypeFilter = ""(objectCategory=computer)""
    }

Now, this works and I can go with it.  I just want to see if there is a better way.  
Also, since someone may bring it up, the ActiveDirectory module is unusable in my environment as we do not have Active Directory Web Services Installed.  So, no cheating and using those commandlets. ;-)

EDIT: Typo in line 2, thank you /u/dakboy",,False,,t5_2qo1o,1372427475.0,,,True,t3_1h8v70,http://www.reddit.com/r/PowerShell/comments/1h8v70/help_with_cleaning_up_my_logic/,
1372346984.0,5,self.PowerShell,1h6lnl,"Powershell, .NET web services, and ADP",6,1,9,http://www.reddit.com/r/PowerShell/comments/1h6lnl/powershell_net_web_services_and_adp/,"Hi all,

My company recently switched to ADP for payroll processing. They offer .NET integration to our data stored in their systems. I am wanting to use Powershell to connect in, query info, and write the info I need in to a database internally for use in other systems.... Has anyone ever attempted this? Searching online has yielded several results about .NET web services, but no luck with the specific authentication mechanism that ADP uses.. (username/password/certificates..)

Thanks in advance.",,False,,t5_2qo1o,False,,,True,t3_1h6lnl,http://www.reddit.com/r/PowerShell/comments/1h6lnl/powershell_net_web_services_and_adp/,
1371513044.0,3,self.PowerShell,1gjuo4,How to monitor a rolling log file.,6,3,7,http://www.reddit.com/r/PowerShell/comments/1gjuo4/how_to_monitor_a_rolling_log_file/,"How would I go about monitoring a rolling log file (log1.log, then log2.log, then log3.log etc) to make sure it's being updated with some frequency.  I'm obviously still fairly new at this, but it's not clear how to approach it.  I found     *Get-Content -Path C:\fso\mylogfile.log -Tail 1*, which will give me the last line of the file I can then just check for the existance of the timestamp, but I'm not sure how to find the latest log file.

Help!",,False,,t5_2qo1o,False,,,True,t3_1gjuo4,http://www.reddit.com/r/PowerShell/comments/1gjuo4/how_to_monitor_a_rolling_log_file/,
1371196533.0,4,self.PowerShell,1gbrnd,"Having issues with remote powershell ""hoping""",5,1,8,http://www.reddit.com/r/PowerShell/comments/1gbrnd/having_issues_with_remote_powershell_hoping/,"Not really sure how to describe this, I'm far from a powershell expert but want to learn more.

I am having issues with a management server perfoming the actions I want it to perform.

The management server does powershell commands to server ""A"" and the last step in the process is extracting data from our database server. Which works fine. But then it is supposed to export the data to Server B. Thats where it fails. If we perform this all from Server A instead of going from the management server it works. But as soon as we go from the management server we get denied from doing this on server B from management server to server A and forward to B.

There are no rights that needs to be solved as it works from Server A but not when it needs to invoke commands through another server from what I understand.

Anyone have any ideas how to fix this? and sorry for the bad explanation.

",,False,,t5_2qo1o,False,,,True,t3_1gbrnd,http://www.reddit.com/r/PowerShell/comments/1gbrnd/having_issues_with_remote_powershell_hoping/,
1371054860.0,5,self.PowerShell,1g7d3p,Can anyone debug this for me?,5,0,5,http://www.reddit.com/r/PowerShell/comments/1g7d3p/can_anyone_debug_this_for_me/,"I'm trying to get the length of time it took to shut down and boot up and append it to a file.

    $a = Get-Content c:\users\regress6\desktop\bootlog.txt 

    $shutdownevents = Get-WinEvent -FilterHashtable @{logname=""Microsoft-Windows-Diagnostics-Performance/Operational""; id=200}
    $shutdownevent = [xml]$shutdownevents[0].ToXml()
    $shutdownevent.Event.EventData.Data | Where-Object {$_.name -eq ""ShutdownTime"" -or $_.name -eq ""ShutdownStartTime""} | Out-File c:\users\regress6\desktop\bootlog.txt

    $bootevents = Get-WinEvent -FilterHashtable @{logname=""Microsoft-Windows-Diagnostics-Performance/Operational""; id=100}
    $bootevent = [xml]$bootevents[0].ToXml()
    $bootevent.Event.EventData.Data | Where-Object {$_.name -eq ""BootTime"" -or $_.name -eq ""BootStartTime""} | Out-File c:\users\regress6\desktop\bootlog.txt -append

    $b= Get-Content c:\users\regress6\desktop\bootlog.txt 

    Set-Content c:\users\regress6\desktop\bootlog.txt –value $b, $a

Sometimes, I am getting identical values when that is very statistically improbable.  For example:
                              
**Shutdown1:**  2013-06-06T00:31:14.785009800Z 
        
**Shutdown1Time:** 18332                                  
                      
**Boot1:** 2013-06-05T23:31:59.609200200Z   
      
**Boot1Time:** 54302                                  
                               
**Shutdown2:** 2013-06-05T23:31:15.143251400Z         

**Shutdown2Time:** 18005                                  
                       
**Boot2:** 2013-06-05T23:31:59.609200200Z     
    
**Boot2Time:** 54302                                  

Notice how Boot1 and Boot2 time is the same.  What gives?  
",,False,,t5_2qo1o,1371055087.0,,,True,t3_1g7d3p,http://www.reddit.com/r/PowerShell/comments/1g7d3p/can_anyone_debug_this_for_me/,
1370954774.0,7,self.PowerShell,1g4893,SQL Prepared statements,10,3,6,http://www.reddit.com/r/PowerShell/comments/1g4893/sql_prepared_statements/,"http://pastebin.com/Kd0m1aAz

I've got these few bits of code where one returns something and the other doesn't.

The only difference between them is that one uses SQL prepared statement and the other doesn't.

If anyone can point out what I'm apparently doing wrong, I'd be very happy, because my head is starting to hurt from all the banging against walls and tables.

**Edit: It turns out you can't have single quotes around a @variable, or it'll be interpreted as a literal string, not a variable. Why don't authors point this out when they write articles on how to use the feature...**",,False,,t5_2qo1o,1370957381.0,,,True,t3_1g4893,http://www.reddit.com/r/PowerShell/comments/1g4893/sql_prepared_statements/,
1370526722.0,6,standalone-sysadmin.com,1fsfv3,One way to clone vSwitch interfaces in powercli. Is there a better way?,6,0,2,http://www.reddit.com/r/PowerShell/comments/1fsfv3/one_way_to_clone_vswitch_interfaces_in_powercli/,,,False,,t5_2qo1o,False,,,False,t3_1fsfv3,http://www.standalone-sysadmin.com/blog/2013/06/cloning-vswitch-interfaces-with-powershell/,
1370461160.0,5,self.PowerShell,1fqp5p,WinRM help with powershell,5,0,7,http://www.reddit.com/r/PowerShell/comments/1fqp5p/winrm_help_with_powershell/,"On a 7 workstation that is joined to my local domain which i have ran Winrm Quickconfig (and or in powershell Enable-PsREmoting).  When i ran a simple invoke-command i receive  the error *""The WinRM client sent a request to a HTTP server and got a response saying the requested HTTP URL was not available.  This is usually returned by a HTTP server that does not support the WS-Management protocol""*  Everything i seen online regarding this error is for exchange managment but, this is a standard windows 7 PC. Anyhelp?  Below is the workstations listener config. 
    PS C:\windows\system32&gt; winrm e winrm/config/listener
    Listener [Source=""GPO""]
    Address = *
    Transport = HTTP
    Port = 5985
    Hostname
    Enabled = true
    URLPrefix = wsman
    CertificateThumbprint
    ListeningOn = 127.0.0.1, x.x.x.x",,False,,t5_2qo1o,False,,,True,t3_1fqp5p,http://www.reddit.com/r/PowerShell/comments/1fqp5p/winrm_help_with_powershell/,
1370397188.0,5,self.PowerShell,1fozct,Possible to replace prompt with timestamp?,6,1,1,http://www.reddit.com/r/PowerShell/comments/1fozct/possible_to_replace_prompt_with_timestamp/,"On my prompt I have a :
PS C:\Users\MyUserName&gt; 

I'd rather if it was :
PS DD/MM/YYYY&gt;

or something similar.. is that possible? ",,False,,t5_2qo1o,False,,,True,t3_1fozct,http://www.reddit.com/r/PowerShell/comments/1fozct/possible_to_replace_prompt_with_timestamp/,
1369957216.0,5,self.PowerShell,1fdcsn,Copy files from IIS enabled server to a local non-IIS server.,5,0,2,http://www.reddit.com/r/PowerShell/comments/1fdcsn/copy_files_from_iis_enabled_server_to_a_local/,"I need to copy a bunch of files from a remote server to a local server. The local server is where the script is being executed from. 

  The remote server has IIS installed and I must copy via IIS server. I don't have the option to use a UNC share. I have enabled the WebAdministration module on the remote server. 

  How do I go about copying files from the remote to the local? Do I need to install IIS on the local server as well?

The following snippet of code finds a bunch of missing files on the local server. With this code I need to copy the files from the remote source to a local source. The remote source and the local source have the same dir structure. I.E c:\temp\x64 and c:\temp\x86.

$CompareXmlFiles = (Compare-object -Ref $RCompareXmlFileValue -Diff $LCompareXmlFileValue -SyncWindow 75) 

  Another example which is less complicated is that I have a single XML file on the remote server that I need to copy to the local server in a very specific folder. How would I go about this?

I have tried, but my code is failing...
foreach ($x64Files in $CompareXmlFiles)
{
Write-Host ""Copying files from remote to localhost x64 folder""
Invoke-Command -ComputerName $computername -ScriptBlock {Import-Module 'WebAdministration'; gci ""IIS:\Sites\WSU\2008\x64"" | Where-Object { $_.SideIndicator -eq '&lt;=' } | Foreach-Object -process} | copy-item $_ -destination ""E:\WSU_REPO\2008\x64""
}

Any suggestions? Someone help me with syntax? Point me in the right direction? I'm using Powershell v3.
",,False,,t5_2qo1o,1369958501.0,,,True,t3_1fdcsn,http://www.reddit.com/r/PowerShell/comments/1fdcsn/copy_files_from_iis_enabled_server_to_a_local/,
1369881601.0,5,self.PowerShell,1fb8za,Distributing the active directory module to user machines,5,0,11,http://www.reddit.com/r/PowerShell/comments/1fb8za/distributing_the_active_directory_module_to_user/,"i am a sysadmin for a high school and i have written a script in power shell that will populate a combo-box with the usernames of every student currently enrolled and allow staff members to unlock student accounts and reset their passwords back to their default password.

Now the script works as intended when i run it on my machine and is failing when i try to run it on a staff machine with staff credentials, i have given staff appropriate permissions to reset/unlock accounts and i have realized that my issue is down to the staff machines not having RSAT installed nor do they have local access to the active directory module for power shell.

I am interested to know what other people have done and what you guys think about deploying RSAT and only enabling the AD DS and AD LDS tools or if anyone can think of a better way to accomplish what i am trying to do.",,False,,t5_2qo1o,False,,,True,t3_1fb8za,http://www.reddit.com/r/PowerShell/comments/1fb8za/distributing_the_active_directory_module_to_user/,
1369843800.0,4,self.PowerShell,1f9x04,Some advice on text manipulation,5,1,4,http://www.reddit.com/r/PowerShell/comments/1f9x04/some_advice_on_text_manipulation/,"Hey guys, I'm trying to write a script which will systematically manipulate text files nested in several directories. I have gotten as far as traversing the directory and locating the involved files, but I am stomped when it comes the the text replacement.

The files come from unix setting, which means they line jump is basically ASCII(10). I need to keep the line jump enconded in the same way, but need to add a period mark just after each line jump (ASCII 10, ASCII 46).

Unfortunately Windows insists on treating the new line as a CR+LF combo (ASCII 13+ASCII 10) which will bork the file when placed into the end system (Windows SQUID). My script currently looks like this:

    Get-ChildItem -Recurse | Where-Object { $_.Name -match 'domains'} | 
        ForEach-Object 
           {cat ""$($_.DirectoryName)\$($_.Name)"" |  %{$_ -replace ""^"", "".""} &gt; ""$($_.DirectoryName)\$($_.Name)2"" }

Any advice on accomplishing what I want?",,False,,t5_2qo1o,False,,,True,t3_1f9x04,http://www.reddit.com/r/PowerShell/comments/1f9x04/some_advice_on_text_manipulation/,
1368710938.0,5,self.PowerShell,1eg6bx,Query Active Directory for Computers/Users and export to excel,5,0,11,http://www.reddit.com/r/PowerShell/comments/1eg6bx/query_active_directory_for_computersusers_and/,"Hey all, im extremely new to powershell with not a whole lot of experience in scripting at all. 

I have to import alot of data into our sharepoint server and i found that it would be pretty useful that i could import an excel document.

The data i have is coming from AD and if i could get all my info from AD and put into an excel file, it would do wonders for my data entry.

Ive been searching some repositories and found a couple of really good scripts that while they do have what i want, just not all parts together..

one has exporting to excel, one has getting user names, one has getting computer names, etc. 

Idk how to take the code from each of the scripts and create a new script from it all. 

If anyone could give me a hand/point me in the right direction, i would greatly appreciate it. Thank you.",,False,,t5_2qo1o,False,,,True,t3_1eg6bx,http://www.reddit.com/r/PowerShell/comments/1eg6bx/query_active_directory_for_computersusers_and/,
1368622869.0,6,self.PowerShell,1edolb,I need some help with a script for new users.,6,0,4,http://www.reddit.com/r/PowerShell/comments/1edolb/i_need_some_help_with_a_script_for_new_users/,"I have done quite a bit of research regarding a script to automate user creation. We usually enter new users one at a time so I'm wanting to make a script that asks the users firstname, lastname etc and then create the user and enable them for exchange. 

My question is regarding adding users to groups. We have multiple locations and  about 80 defined business roles which determine what applications and groups they are added to. Basically what I'm wanting to make is something that you could select what business role the user has and then adds the user to specified groups, is this possible?",,False,,t5_2qo1o,False,,,True,t3_1edolb,http://www.reddit.com/r/PowerShell/comments/1edolb/i_need_some_help_with_a_script_for_new_users/,
1368540300.0,5,self.PowerShell,1ebblm,script to search and export results into a logfile,9,4,15,http://www.reddit.com/r/PowerShell/comments/1ebblm/script_to_search_and_export_results_into_a_logfile/,"I am sorry if this is posted in the wrong subreddit first of all.

I am looking to create some sort of script which I can then add as a scheduled task to search certain terms and then export the findings into a text log file if at all possible. I have little to no experience writing scripts so any help you can give would be appreciated.

This is in a windows 7 32 bit environment

Thanks,
",,False,,t5_2qo1o,False,,,True,t3_1ebblm,http://www.reddit.com/r/PowerShell/comments/1ebblm/script_to_search_and_export_results_into_a_logfile/,
1368223916.0,6,self.PowerShell,1e3gnm,Deletion script works in PS1.1 but not in PS2.0?,6,0,3,http://www.reddit.com/r/PowerShell/comments/1e3gnm/deletion_script_works_in_ps11_but_not_in_ps20/,"I know the title sounds weird, but bear with me.

I came up with a script that deletes all the files in a folder EXCEPT the oldest and the newest. I figure it'll be handy for editing pictures and I want to jump back to the last backup, or go right back to the master. The script worked great in PS1.1, but in PS2.0 it works differently. I'll post it below

* get-childitem d:\backup\ -include *.jpg -exclude (Get-ChildItem | Sort LastWriteTime | Select -First 1 -Last 2) -recurse | foreach ($_) {remove-item $_.fullname -recurse -WhatIf}

In 1.1 it works fine in each subfolder of D:\backup, but in 2.0 it seems like it's taking every file in D:\backup (and it's subdirectories) sorting that entire list, and deleting everything but the oldest and newest in there. So instead of keeping 2 files in each sub, it's only going to keep 2 files in the entire parent (I LOVE -WhatIf). Did something change between versions, or is my code just flawed?

I'm kind of new to the PS scene, but this is so much better than Batch that I want to figure it our rather than get some exe off sourceforge or something.

EDIT: Apparently reddit is remove some underscores, but there's one after the dollar sign in the ""foreach"" and one after the dollar sign in the remove-item part too.",,False,,t5_2qo1o,False,,,True,t3_1e3gnm,http://www.reddit.com/r/PowerShell/comments/1e3gnm/deletion_script_works_in_ps11_but_not_in_ps20/,
1367521181.0,4,self.PowerShell,1dkgk8,Open remote file locally,6,2,11,http://www.reddit.com/r/PowerShell/comments/1dkgk8/open_remote_file_locally/,I have not noticed anyone talking about this and thought it might be useful for some people. If you cd to a remote directory for example I cd \\domaincontroller\c$ then you can for example go to a directory where there is txt files. If you type the name of a file (e.g. .\test.txt) it will open on your local machine in notepad. I have only tried it with text files so far but it might work with other file types as well.,,False,,t5_2qo1o,False,,,True,t3_1dkgk8,http://www.reddit.com/r/PowerShell/comments/1dkgk8/open_remote_file_locally/,
1366833903.0,4,self.PowerShell,1d15rp,Changing network adapter preferred band and wireless mode,5,1,3,http://www.reddit.com/r/PowerShell/comments/1d15rp/changing_network_adapter_preferred_band_and/,"Im trying to create a script that will change the Prefered band and Wireless mode settings of the adapter to specific values. i tried googling this but have not come up with anything. Does anyone know of any ways to do this?

Thanks
",,False,,t5_2qo1o,False,,,True,t3_1d15rp,http://www.reddit.com/r/PowerShell/comments/1d15rp/changing_network_adapter_preferred_band_and/,
1366301866.0,5,self.PowerShell,1cm31p,Just wanted to give these guys the recognition they deserve.,7,2,1,http://www.reddit.com/r/PowerShell/comments/1cm31p/just_wanted_to_give_these_guys_the_recognition/,"http://www.nsoftware.com

I've been testing out[ PowerShell Server](http://www.nsoftware.com/powershell/) to test out converting a few of my powersell scripts into web pages that can be used by our sales and project managers so that they can self-serve some tasks instead of having to come to me to run the scripts.

I've gone to these guys with a few minor tweaks and within days they have released new builds with the requests implemented.  

I've been very impressed with them and just wanted to let others know that if you're on the fence about this software the development and support teams have exceeded my expectations.",,False,,t5_2qo1o,False,,,True,t3_1cm31p,http://www.reddit.com/r/PowerShell/comments/1cm31p/just_wanted_to_give_these_guys_the_recognition/,
1366064464.0,5,self.PowerShell,1cf3yd,"The mysterious whitespace, that won't go away...",5,0,8,http://www.reddit.com/r/PowerShell/comments/1cf3yd/the_mysterious_whitespace_that_wont_go_away/,"I have an array that's formatted somewhat like this (there are many more entries for a large number of servers):

    ""server01==SUN-Nightly-Differential"",
    ""server01==SUN-Weekly-Full""

I split it as such:

    $server,$jobname = $bjob.split(""=="")

I print it like this (as a test):

    Write-Host ""Checking $server- -$jobname""

The result looks like this:

    server01- - SUN-Nightly-Differential
    server01- - SUN-Weekly-Full

The leading whitespace at the start of $jobname will not go away, either with a -replace of ""\s+"" or by using the Trim or TrimStart methods. That whitespace is part of $jobname's value, but it won't go away.

Any suggestions here? I can't use the value in further processing because of this.

Thanks!

",,False,,t5_2qo1o,False,,,True,t3_1cf3yd,http://www.reddit.com/r/PowerShell/comments/1cf3yd/the_mysterious_whitespace_that_wont_go_away/,
1365490444.0,6,labofapenetrationtester.blogspot.in,1bz5lp,Poshing the hashes: Using PowerShell to play with password hashes,6,0,0,http://www.reddit.com/r/PowerShell/comments/1bz5lp/poshing_the_hashes_using_powershell_to_play_with/,,,False,,t5_2qo1o,False,,,False,t3_1bz5lp,http://labofapenetrationtester.blogspot.in/2013/04/poshing-the-hashes.html,
1365440813.0,6,self.PowerShell,1bxeo4,Moving Items older than x date from one server to another.,7,1,8,http://www.reddit.com/r/PowerShell/comments/1bxeo4/moving_items_older_than_x_date_from_one_server_to/,"I am new to powershell and not familiar with the syntax, and am wondering if there simple way to move items from one networked drive to another networked drive which hasn't been modified since x date. I found out that move-item would not work as it doesn't allow you to move across volumes.",,False,,t5_2qo1o,False,,,True,t3_1bxeo4,http://www.reddit.com/r/PowerShell/comments/1bxeo4/moving_items_older_than_x_date_from_one_server_to/,
1365373853.0,5,self.PowerShell,1bvn5b,Having trouble creating PS Window for Exchange Online - what am I doing wrong?,8,3,6,http://www.reddit.com/r/PowerShell/comments/1bvn5b/having_trouble_creating_ps_window_for_exchange/,"I would like to create a script file that I can right-click and run with Powershell to connect to Exchange Online and give me a PS prompt.

I created the file and can run it but for some reason it unloads the Exchange Online cmdlets after they are imported - what am I doing wrong?

I created other scripts that run actual commands (get-mailbox, etc...) and they work fine. 


$LiveCred = Get-Credential
$Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri https://ps.outlook.com/powershell/ -Credential $LiveCred -Authentication Basic -AllowRedirection
Import-PSSession $Session

write-host ""Connection to Office 365 Established..."" -foregroundcolor ""yellow""
write-host """"

powershell -noexit ",,False,,t5_2qo1o,False,,,True,t3_1bvn5b,http://www.reddit.com/r/PowerShell/comments/1bvn5b/having_trouble_creating_ps_window_for_exchange/,
1364991735.0,5,self.PowerShell,1bkzv9,"Set ACL issue. Grant User Full Control of Folders, subfolders and files",5,0,6,http://www.reddit.com/r/PowerShell/comments/1bkzv9/set_acl_issue_grant_user_full_control_of_folders/,"Hi, i am trying to set permissions on a DFS share.

I want to grant a user full control of it with inheritance.

My code gets the top folder correct and on the permission and it Applies to : 

This Folder,subfolders and files.
but the folders and files below actually don't have this user propagated in the permissions.

My code is:

$acl = get-acl -path $dfsfolder

$new=$user,”FullControl”,”ContainerInherit,ObjectInherit”,”None”,”Allow”

$accessRule = new-object System.Security.AccessControl.FileSystemAccessRule $new

$acl.AddAccessRule($accessRule)

$acl | Set-Acl $dfsfolder


Am i missing something?

Thanks


",,False,,t5_2qo1o,False,,,True,t3_1bkzv9,http://www.reddit.com/r/PowerShell/comments/1bkzv9/set_acl_issue_grant_user_full_control_of_folders/,
1363968713.0,6,self.PowerShell,1at018,Exchange mail conversion script.,7,1,14,http://www.reddit.com/r/PowerShell/comments/1at018/exchange_mail_conversion_script/,"I'm trying to gauge interest in an mail store conversion script that I wrote in Powershell. The basic functionality behind it is that you give it a mail source and destination, and it will ""convert"" between the two. 

For example, you can specify an Outlook inbox as a source, and then some file system location as the destination to have the script take all the mail from the Inbox and write it out to the file system as .msg files (recreating the folder structure from the Inbox, of course). You can reverse the source and destination to have it save a folder full of .msg files back in the Inbox, too. Or the destination could be another mail folder in the profile, or even a .pst.

The script goes further when it outputs to the file system as .msgs. If you give it access to run LDAP queries, it will assign explicit permissions to each .msg to allow access to the file only to the sender and recipients of that particular message. It also has an option write the important data from each message to a SQL database (stuff like sender, recipients, subject, body, attachment names and sizes, and certain dates).

It is heavily based around the Outlook COM object model, so it requires Office 2007 or later to be installed.

As far as I know, I haven't found anything that will perform all the functionality, even in the commercial space. Initially, it started out as something simple to automate some trivial task, but it ballooned into this massive script spread across multiple modules totalling thousands of lines of code. At some point I began thinking it might be fun to convert it into a C# console application, which got me thinking if there might be any value in this for others.

What do you think? Could this be something that a lot of people might be interested in?

**Edit:** Since most of the interest seemed to be about exporting to .msg files, here's most of the module that was written to do that: [Extract-Mailstore](http://poshcode.org/4039)
Any questions or even better, feedback or suggestions on this would really float my boat. Please don't make fun of my documentation :(",,False,,t5_2qo1o,1364159331.0,,,True,t3_1at018,http://www.reddit.com/r/PowerShell/comments/1at018/exchange_mail_conversion_script/,
1363883004.0,5,self.PowerShell,1aqmn7,"First foray into using powershell, I could use some help with my script.",5,0,22,http://www.reddit.com/r/PowerShell/comments/1aqmn7/first_foray_into_using_powershell_i_could_use/,"    #Begin Script


    #Check for x64 or x86
    $Architecture = (Get-WMIObject Win32_OperatingSystem).OSArchitecture

    if ($Architecture -eq ""64-Bit"")
    {
    #x64 routine

    $path=""C:\Program Files (x86)\Malwarebytes' Anti-Malware""

    #Tests for existing installation, Uninstalls, and Reboots
    
    if(test-path -path $path)
    {
    cd ""\\dc01\Updates\MBAM""
    .\mbam-clean.exe /silent /noreboot
    Set-ItemProperty -Path ""HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"" -Name ""Malwarebytes' Install"" -Value ""C:\Windows\System32\Windows\Powershell\v1.0\powershell.exe&amp;C:\Installation Media\Malwarebytes' Deployment.ps1""
    Restart-Computer -force
    }
    #Installs MBAM, updates, registers, schedules scans, and adds registry keys
    cd ""\\dc01\Updates\MBAM""
    .\mbam-corporate.exe /nocancel /noicons /norestart /SP- /SUPPRESSMSGBOXES /TASKS=""""
    cd $path
    .\mbam.exe /register 5092161521
    .\mbam.exe /update -silent
    .\mbamgui.exe /install /silent
    .\mbamgui.exe /startalways /silent
    .\mbam.exe /schedule /update /weekly /starting 01/01/2013 03:00:00 /every 1 /wakefromsleep /log
    .\mbam.exe /schedule /scan -full -silent -remove -reboot /weekly /starting 01/01/2013 03:00:00 /every 1 /wakefromsleep /log
    reg add ""HKLM\Software\Wow6432Node\Malwarebytes' Anti-Malware"" /v fullsilentmode /t REG_DWORD /d 1
    reg add ""HKLM\Software\Wow6432Node\Malwarebytes' Anti-Malware"" /v autoquarantine /t REG_DWORD /d 1


    #Removes script from logon queue 
    Remove-ItemProperty -Path ""HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"" -Name ""Malwarebytes' Install""
    #x64 log installation


    #End x64 routine
    }

    Else
    {
    $path= ""C:\Program Files\Malwarebytes' Anti-Malware""

    #Tests for current install, Removes, and Reboots
    if(test-path -path $path)
    {
    cd ""\\dc01\Updates\MBAM""
    .\mbam-clean.exe /silent /noreboot
    Set-ItemProperty -Path ""HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"" -Name ""Malwarebytes' Install"" -Value ""C:\Windows\System32\Windows\Powershell\v1.0\powershell.exe&amp;C:\Installation Media\Malwarebytes' Deployment.ps1""
    Restart-Computer -force
    }
    cd ""\\dc01\Updates\MBAM""
    .\mbam-corporate.exe /nocancel /noicons /norestart /SP- /SUPPRESSMSGBOXES /TASKS=""""
    cd $path
    .\mbam.exe /register 149613061235
    .\mbam.exe /update -silent
    .\mbamgui.exe /install /silent
    .\mbamgui.exe /startalways /silent
    .\mbam.exe /schedule /update /weekly /starting 01/01/2013 03:00:00 /every 1 /wakefromsleep /log
    .\mbam.exe /schedule /scan -full -silent -remove -reboot /weekly /starting 01/01/2013 03:00:00 /every 1 /wakefromsleep /log

    reg add ""HKLM\Software\Malwarebytes' Anti-Malware"" /v fullsilentmode /t REG_DWORD /d 1
    reg add ""HKLM\Software\Malwarebytes' Anti-Malware"" /v autoquarantine /t REG_DWORD /d 1
    #Removes script from logon queue 
    Remove-ItemProperty -Path ""HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"" -Name ""Malwarebytes' Install""
    }

    #End

I ran the debugger, and the only errors it gives me are the ""path not found"" errors I would expect since the program isn't installed on my machine yet. However, when I attempt to run the script as an administrator nothing happens. Sorry if my code is horribly convoluted, any input would be awesome.

EDIT: Well this is embarrassing. I created my shortcut run so there was a brief cmd prompt showing up saying it wasn't able to run the .ps1 it was pointing to. Thank you all for your suggestions on my code!",,False,,t5_2qo1o,1363892629.0,,,True,t3_1aqmn7,http://www.reddit.com/r/PowerShell/comments/1aqmn7/first_foray_into_using_powershell_i_could_use/,
1363753630.0,7,self.PowerShell,1an80j,LF script to backup/transfer user profiles via scanstate/loadstate 5.0 and thumb drive.,7,0,2,http://www.reddit.com/r/PowerShell/comments/1an80j/lf_script_to_backuptransfer_user_profiles_via/,"I'm befuddled with USMT 5.0's scanstate/loadstate. I'm trying to script a way of backing up user profiles from their old machines onto a UFD then loadstate them onto their new computer. Does anyone currently do this or can point me to a location where this is used? I'm not using any server-based deployment options, just a thumb drive and Windows PE 4.0. Thanks in advance.",,False,,t5_2qo1o,1363754487.0,,,True,t3_1an80j,http://www.reddit.com/r/PowerShell/comments/1an80j/lf_script_to_backuptransfer_user_profiles_via/,
1363501412.0,6,self.PowerShell,1agc0g,How do I grab the output of a power shell command for use in a cmd,6,0,11,http://www.reddit.com/r/PowerShell/comments/1agc0g/how_do_i_grab_the_output_of_a_power_shell_command/,"I have a .cmd that at some point during execution needs to cd into a folder. The structure of the folders have changed such that I found it easiest to write a PS command to find the relevant folder. However, how do I use the output of the command as a variable in my .cmd script?? I execute the powershell command using -command.",,False,,t5_2qo1o,False,,,True,t3_1agc0g,http://www.reddit.com/r/PowerShell/comments/1agc0g/how_do_i_grab_the_output_of_a_power_shell_command/,
1363034034.0,5,self.PowerShell,1a3oii,Finding all email addresses via Exchange Management Shell,6,1,10,http://www.reddit.com/r/PowerShell/comments/1a3oii/finding_all_email_addresses_via_exchange/,"I just wanted to share this.  The exercise was to find all SMTP email addresses on the server.  Sounds simple, I think it should be far simpler than what I ended up with:

    function Get-AllEmailAddresses {
        . {
            # here be dragons
            # ignore warnings at your peril
            Get-Mailbox -warningaction silentlycontinue
            Get-MailContact -warningaction silentlycontinue
            Get-DistributionGroup -warningaction silentlycontinue
            Get-MailPublicFolder -warningaction silentlycontinue
        } | % {
            $name = $_.Name
            $identity = $_.Identity
            if ($type -match 'PublicFolder') {
                # because public folders are being a pain in the tuchus for us today
                $identity = $_ | 
                    get-publicfolder -erroraction silentlycontinue -warningaction silentlycontinue | 
                    select -exp identity
                if (-not $identity) {
                    $identity = 'NotFound: {0}' -f $_.Identity
                }
            }
            $identity = [string] $identity
            $type = [string] $_.RecipientType 
            select -inputobject $_ -expandproperty EmailAddresses | 
                ? { $_.PrefixString -imatch '^smtp' } | 
                % {
                    $address = $_.AddressString
                    $parts = $address -split '@'
                    new-object psobject -property @{
                        Name = $name
                        Type = $type
                        Identity = $identity
                        Address = $address
                        Account = $parts[0]
                        Domain = $parts[1]
                }
            }
        }
    }

I'm not sure if there's a simpler way of doing this.  Perhaps in more recent versions of Exchange or PowerShell.  We're currently using Exchange 2007, in the process of upgrading to 2013.
",,False,,t5_2qo1o,False,,,True,t3_1a3oii,http://www.reddit.com/r/PowerShell/comments/1a3oii/finding_all_email_addresses_via_exchange/,
1362815795.0,6,self.PowerShell,19yog3,Using Invoke-RestMethod with Reddit's API. (PowerShell 3.0),6,0,1,http://www.reddit.com/r/PowerShell/comments/19yog3/using_invokerestmethod_with_reddits_api/,"I'm new to API usage but have been enjoying discogs.com API to pull music information into my MP3's.  Today I've been experimenting with Reddit's API.  Here's a sample: 
    
    (irm http://www.reddit.com/r/powershell/.json).data.children.data|?{$_.selftext_html.count -gt 0}

Can you guys think of some fun stuff we can do with Reddit's API?",,False,,t5_2qo1o,False,,,True,t3_19yog3,http://www.reddit.com/r/PowerShell/comments/19yog3/using_invokerestmethod_with_reddits_api/,
1361773645.0,4,tomorrow.uspeoples.org,196h49,A Get-Hash one-liner to filter file duplicates from the root down,5,1,0,http://www.reddit.com/r/PowerShell/comments/196h49/a_gethash_oneliner_to_filter_file_duplicates_from/,,,False,,t5_2qo1o,False,,,False,t3_196h49,http://tomorrow.uspeoples.org/2013/02/powershell-get-hash-to-filter-file.html,
1361556211.0,6,self.PowerShell,1916j3,Finding a string within a Variable?,8,2,7,http://www.reddit.com/r/PowerShell/comments/1916j3/finding_a_string_within_a_variable/,"So I'm a complete noob at powershell my skill level is set to basic commands. I'm sure there is much better ways to do what I'm trying to accomplish. So I would like to avoid scripts until I get a solid understanding of how commands work outside of a script before I start scripting. So the basic goal is to look at a domain, get the number of computers in a domain and output only the count instead of all the extra info it comes with.

So far without making the command without a variable gives me:

    Get-ADComputer -Filter * -Server 'server.domain.org:3268' -SearchBase ""DC=childdomain,DC=domain,DC=ORG' | Measure-Object

    Count    : 260
    Average :
    Sum      :
    Maximum:
    Minimum :
    Property :

So I figured if I only want the line that has the count, I would let a variable = the command and then search the variable.

    PS C:\Users\gex&gt; $count= Get-ADComputer -Filter * -Server 'server.domain.org:3268' -SearchBase ""DC=childdomain,DC=domain,DC=ORG' | Measure-Object

    PS C:\Users\gex&gt; $count | Select-String -Pattern ""count""

This returns a blank (nothing) to the screen.

But when I actually think about it, the results of $count does not equal what is displayed above. Rather $count is holding the actual command as a string.

So I think what I need to figure out is how to get the results of the command into a variable. And then use:

    PS C:\Users\gex&gt; $count | Select-String -Pattern ""count""

to actually read the varible and display the line that says ""count"". Once I figure that out, then I can move into substrings and all that glorious stuff.

Domain functional level is 2003 but these commands are being ran on 2008r2 servers with PS 2.0 I believe.",,False,,t5_2qo1o,False,,,True,t3_1916j3,http://www.reddit.com/r/PowerShell/comments/1916j3/finding_a_string_within_a_variable/,
1361227582.0,5,learn-powershell.net,18s2b8,"Read File Without Updating LastAccess TimeStamp using PowerShell
",7,2,1,http://www.reddit.com/r/PowerShell/comments/18s2b8/read_file_without_updating_lastaccess_timestamp/,,,False,,t5_2qo1o,False,,,False,t3_18s2b8,http://learn-powershell.net/2013/02/18/read-file-without-updating-lastaccess-timestamp-using-powershell/,
1360837890.0,5,self.PowerShell,18iag5,Using variables in get-wmiobject -query. [noob],7,2,7,http://www.reddit.com/r/PowerShell/comments/18iag5/using_variables_in_getwmiobject_query_noob/,"I can't get the query to recognize my variable $_.Name. I'm clearly misunderstanding something here.


    Get-Service myservicenames* | ForEach-Object { 
    	$service = get-wmiobject -query 'select * from win32_service where name=""$_.Name""'
    	echo $service.PathName
     }

How can I solve this? ",,False,,t5_2qo1o,False,,,True,t3_18iag5,http://www.reddit.com/r/PowerShell/comments/18iag5/using_variables_in_getwmiobject_query_noob/,
1360650637.0,4,tomorrow.uspeoples.org,18d4zy,Creating &amp; Deleting Outlook 2003-2010 Calendar Appointments,7,3,1,http://www.reddit.com/r/PowerShell/comments/18d4zy/creating_deleting_outlook_20032010_calendar/,,,False,,t5_2qo1o,False,,,False,t3_18d4zy,http://tomorrow.uspeoples.org/2013/02/powershell-creating-and-deleting.html,
1360560510.0,6,self.PowerShell,18akcx,Is there a multi-tab app ?,8,2,20,http://www.reddit.com/r/PowerShell/comments/18akcx/is_there_a_multitab_app/,I'm tired of dealing with multiple separate PS windows,,False,,t5_2qo1o,False,,,True,t3_18akcx,http://www.reddit.com/r/PowerShell/comments/18akcx/is_there_a_multitab_app/,
1360259267.0,6,self.PowerShell,182q5k,Removing SID history from old domains,7,1,5,http://www.reddit.com/r/PowerShell/comments/182q5k/removing_sid_history_from_old_domains/,"I've been tasked with removing SID history from old domains. However, I'm not able to find any resources for such a task. My desktop is an XP box so I'm not able to import the Active-Directory or SIDHistory modules, but our environment does contain 08 R2's. The most promising link I've found online is a VBS that I'm not entirely sure what it does (http://support.microsoft.com/kb/295758/en-us).

I've scoured TechNET and every link a few search result pages deep. Help?",,False,,t5_2qo1o,False,,,True,t3_182q5k,http://www.reddit.com/r/PowerShell/comments/182q5k/removing_sid_history_from_old_domains/,
1360092347.0,6,self.PowerShell,17y5rp,What are your thoughts on upgrading to 3.0 (Windows Server 2008 R2 SP1)? ,7,1,8,http://www.reddit.com/r/PowerShell/comments/17y5rp/what_are_your_thoughts_on_upgrading_to_30_windows/,"Especially, since I have 100+ servers to do this on, scripting this?

I did see a note that the 3.0 msu installer was connecting to the internet as part of the install, which would be difficult here since we have to authenticate to the internet. Anyone know of a re-distributable installer?

Edit: Also, does anyone have a script to check the requirements for install (otherwise I'll end up writing my own)?",,False,,t5_2qo1o,1360093020.0,,,True,t3_17y5rp,http://www.reddit.com/r/PowerShell/comments/17y5rp/what_are_your_thoughts_on_upgrading_to_30_windows/,
1359058528.0,6,self.PowerShell,177j3i,Interacting with your local Outlook mailbox via Powershell?,8,2,6,http://www.reddit.com/r/PowerShell/comments/177j3i/interacting_with_your_local_outlook_mailbox_via/,"My company, like many others, has an email problem. We have users with 50, 60, or 70GB mailboxes. Tens or hundreds of thousands of mail items in their inbox alone. It's absurd. We're moving towards implementing a quota policy from the mail server, but before we do that, sanity must be restored. We've got over 100 users with mailbox sizes over the soon-to-be quota.

What we're trying to teach users is to create multiple PST files (one for each year) and move files from their mailbox to the PST in manageable chunks of several thousand at a time. Ultimately, these PSTs will be copied up to a central network location for long-term backup. We document the process with pretty pictures ELI5 style, but 95% of our users don't follow up. They're too busy, it's too overwhelming, etc. They just want to give my team their passwords and let us do it for them which is a bad idea on several levels.

Our Exchange admin is wary of running any powershell scripts on the exchange server under an account with mailbox rights to the enterprise, so this leaves me looking at a user-based solution. So far I've been able to list out the folder structure in the user's mailbox and count how many messages are in each. Beyond that, I'm stuck.

We're using Windows 7 Enterprise x64 with Office 2010 (32-bit). Anyone have any pointers regarding a script to be run from the user level that will create PST files, copy the folder structure of the mailbox to the PST, and move messages within a certain date range to the new PST? Thanks for your insight!",,False,,t5_2qo1o,1359058909.0,,,True,t3_177j3i,http://www.reddit.com/r/PowerShell/comments/177j3i/interacting_with_your_local_outlook_mailbox_via/,
1358535747.0,5,self.PowerShell,16txqg,WinRM quick config errors,8,3,9,http://www.reddit.com/r/PowerShell/comments/16txqg/winrm_quick_config_errors/,"I'm getting this error when I use winrm quick config on a server 2008 R2 server anyone have any ideas on what i can do?

***Error***


C:\Windows\system32&gt;sc config ""WinRM"" start= auto
[SC] ChangeServiceConfig SUCCESS

C:\Windows\system32&gt;net start WinRM
The requested service has already been started.

More help is available by typing NET HELPMSG 2182.


C:\Windows\system32&gt;winrm create winrm/config/listener?Address=*+Transport=HTTP
WSManFault
    Message = WinRM cannot process the request. The following error occured whil
e using Negotiate authentication: An unknown security error occurred.
 Possible causes are:
  -The user name or password specified are invalid.
  -Kerberos is used when no authentication method and no user name are specified
.
  -Kerberos accepts domain user names, but not local user names.
  -The Service Principal Name (SPN) for the remote computer name and port does n
ot exist.
  -The client and remote computers are in different domains and there is no trus
t between the two domains.
 After checking for the above issues, try the following:
  -Check the Event Viewer for events related to authentication.
  -Change the authentication method; add the destination computer to the WinRM T
rustedHosts configuration setting or use HTTPS transport.
 Note that computers in the TrustedHosts list might not be authenticated.
   -For more information about WinRM configuration, run the following command: w
inrm help config.

Error number:  -2144108387 0x8033809D
An unknown security error occurred.

C:\Windows\system32&gt;iisreset

Attempting stop...
Internet services successfully stopped
Attempting start...
Internet services successfully restarted

C:\Windows\system32&gt;winrm create winrm/config/listener?Address=*+Transport=HTTP
WSManFault
    Message = WinRM cannot process the request. The following error occured whil
e using Negotiate authentication: An unknown security error occurred.
 Possible causes are:
  -The user name or password specified are invalid.
  -Kerberos is used when no authentication method and no user name are specified
.
  -Kerberos accepts domain user names, but not local user names.
  -The Service Principal Name (SPN) for the remote computer name and port does n
ot exist.
  -The client and remote computers are in different domains and there is no trus
t between the two domains.
 After checking for the above issues, try the following:
  -Check the Event Viewer for events related to authentication.
  -Change the authentication method; add the destination computer to the WinRM T
rustedHosts configuration setting or use HTTPS transport.
 Note that computers in the TrustedHosts list might not be authenticated.
   -For more information about WinRM configuration, run the following command: w
inrm help config.

Error number:  -2144108387 0x8033809D
An unknown security error occurred.

C:\Windows\system32&gt;",,False,,t5_2qo1o,False,,,True,t3_16txqg,http://www.reddit.com/r/PowerShell/comments/16txqg/winrm_quick_config_errors/,
1358460045.0,6,self.PowerShell,16rzcm,"How can I make a cleaner output when my script is run, but no argument is passed with a parameter? Better parameter handling?",7,1,9,http://www.reddit.com/r/PowerShell/comments/16rzcm/how_can_i_make_a_cleaner_output_when_my_script_is/,"I have a script like this:

    param(
      [Alias('a')]
      [string]$aval,
      [Alias('b')]
      [switch]$bval,
      [Alias('c')]
      [string]$cval
    )
    
    if($aval.length -gt 1)
    {
      Do-Something
    }
    elseif($bval)
    {
      Do-Something-Else
    }
    elseif($cval.length -gt 1)
    {
      Do-Another-Thing
    }
    else
    {
      Do-This
    }

If someone calls my script like so, an ugly error is displayed saying it is missing an argument for parameter 'aval/bval/cval':

    PS C:\&gt; .\MyScript.ps1 -a
    C:\MyScript.ps1 : Missing an argument for parameter 'aval'. Specify a
    parameter of type 'System.String' and try again.
    At line:1 char:18
    + .\MyScript.ps1 -n &lt;&lt;&lt;&lt;
        + CategoryInfo          : InvalidArgument: (:) [MyScript.ps1], ParameterBindingException
        + FullyQualifiedErrorId : MissingArgument,MyScript.ps1

Is there any way to make a cleaner, possibly one line, error appear instead? Also, is there a better way to handle parameters then a list of elseif statements (my actual script has ~10 parameters)?

Thanks for any help!",,False,,t5_2qo1o,False,,,True,t3_16rzcm,http://www.reddit.com/r/PowerShell/comments/16rzcm/how_can_i_make_a_cleaner_output_when_my_script_is/,
1357588217.0,5,self.PowerShell,164wpx,Removing certain lines before importing a .csv in powershell,6,1,10,http://www.reddit.com/r/PowerShell/comments/164wpx/removing_certain_lines_before_importing_a_csv_in/,"While trying to run an import-csv against a .csv I am having an issue.. First of all this is the format of the .csv:

  Case Owner | Edited By | Edit Date | Field / Event | Old Value
  -----
  -----
  -----

  Daily
  Copyright(c)
  Confidential

Now when I run a import-csv all data is populated properly in a hash table but my problem is that there are a bunch of ghost entries for each of my columns in the .csv due to the fact that there is that footer at the end of the .csv. I am unable to change the way that this is generated as this is generated by a webscript outside of our company so I would like to parse the .csv before presenting the hash tables and removing these lines. If this is possible please let me know as after quite a bit of googling I have been unable to properly figure out how to do this. 


",,False,,t5_2qo1o,False,,,True,t3_164wpx,http://www.reddit.com/r/PowerShell/comments/164wpx/removing_certain_lines_before_importing_a_csv_in/,
1356728716.0,5,self.PowerShell,15la0y,Looking for direction on renaming 6000 home directories.,7,2,16,http://www.reddit.com/r/PowerShell/comments/15la0y/looking_for_direction_on_renaming_6000_home/,"So here is my scenario that I can hopefully get some help with. My organization currently has 6000 home directories that are saved across three different shares such as:

* \\\storage\home\
* \\\storage\home_2\
* \\\storage\home_3\

My co-workers and I have recently gone through and deleted 6000 invalid home directories. The next item on the list of things to do is bringing the remaining home folders into compliance with a new naming standard. Previously there was NO naming standard everyone just named the home directories what they wished, but as you can guess trying to track down folders for restores and other admin functions has gotten very time consuming. The new naming standard makes all home directories the same as the users username so ""firstname.lastname"". Has anyone run into a situation such as this?

I can do a bulk user update using a CSV file and the Set-QADUser command. But I have no idea where to start on writing a script that would look at a users current home directory and then rename that to the users username field. 

Thank you for any help you can provide.

edit: Current home directories are configured in AD.",,False,,t5_2qo1o,1356731476.0,,,True,t3_15la0y,http://www.reddit.com/r/PowerShell/comments/15la0y/looking_for_direction_on_renaming_6000_home/,
1355939879.0,6,self.PowerShell,154a31,Get-WMIObject from background job on Windows XP,6,0,5,http://www.reddit.com/r/PowerShell/comments/154a31/getwmiobject_from_background_job_on_windows_xp/,"Has anyone successfully run Get-WMIObject with the ComputerName parameter from inside a background job? Every time I try it it hangs forever but if I run the same command from the current session it works fine. 

    Start-Job -Scriptblock { Get-WMIObject win32_process -ComputerName server1 }

Also, everything works fine on my main workstation which has Windows 7 and PowerShell v3, but I need to get it to run from a Windows XP workstation with PowerShell v2.",,False,,t5_2qo1o,False,,,True,t3_154a31,http://www.reddit.com/r/PowerShell/comments/154a31/getwmiobject_from_background_job_on_windows_xp/,
1355183194.0,6,self.PowerShell,14mt10,Question - Handling warnings/checking warning text,6,0,4,http://www.reddit.com/r/PowerShell/comments/14mt10/question_handling_warningschecking_warning_text/,"Code snippet:

    function timeout($val) { #pass a timeout value in seconds
        $input = $($input);
        job $script:timed = Start-Job { #make sure to scope this job properly
            if(&amp; ($input)) { #success
                return 1;
            } else { #failure
                Write-EventLog -LogName Scripts -Source VMBackup -EntryType Error -EventId 2212 -Message ""$($error[0])""; #if the command stored in $input fails, write to the error log
                return 0;
            }
        }
        Wait-Job $timed -Timeout $val; #use passed value
        Stop-Job $timed;
        Receive-Job $timed;
    }

    &lt;...&gt;


    if(stop-vm -name $vmName | timeout(300)) { #stop the VM, timeout of 300s before failing
        Write-EventLog -LogName Scripts -Source VMBackup -EntryType Information -EventId 2201 -Message ""$vmName stopped successfully.""; #we log success events here instead of in timeout()
        write-host ""stopped."";
        write-host "" "";
    } else {
        write-host ""failed."";
        write-host "" "";
        continue; #if this fails, we need to skip to the next VM
    }

    Remove-Job $timed;

While I realize it seems silly to just return values, I'm using this as part of a timeout function, so just ignore that for the time being.

In this script, the code block stored in $input is either a stop-vm or start-vm command. I'm testing the success of that command, and it works fine -- I end up in the first part of the if statement if it's successful, and return 1; I end up in the else block if it fails, and return 0. In a failure case, I want to skip to the next item in my loop, and do so.

But there's another case I want to catch here, and that's a *warning* response. Stop-VM (or Start-VM) can return a warning indicating that the VM is already in the specified state, and in these cases I want to continue this item in my loop -- a VM being stopped already doesn't preclude the rest of the stuff I'm doing in this script.

Trouble is, a warning is evaluated as a failure in my logic, and I'm not sure how to fix that. I tried sending the output of Stop-VM -name $whatever to a variable, but the warning text doesn't actually end up in the variable. It doesn't end up in $error, either. If I could somehow *check* the warning text, I could just add an extra block in my if statement which would allow me to check the text the command fails with and return (but log) a success in the case of an ""already in the specified state"" warning.

Is there any way to catch the warning text? Or is there some way to check that I've gotten a warning, rather than an error?

**tl;dr** I want to be able to catch the warning text returned from Stop-VM so I can evaluate it.",,False,,t5_2qo1o,1355183566.0,,,True,t3_14mt10,http://www.reddit.com/r/PowerShell/comments/14mt10/question_handling_warningschecking_warning_text/,
1354824940.0,5,gallery.technet.microsoft.com,14eg6c,"Compress and Remove Log Files - I hope it helps you all, and would be great to get r/PowerShell's feedback on this script I wrote",7,2,4,http://www.reddit.com/r/PowerShell/comments/14eg6c/compress_and_remove_log_files_i_hope_it_helps_you/,,,False,,t5_2qo1o,False,,,False,t3_14eg6c,http://gallery.technet.microsoft.com/31db73b4-746c-4d33-a0aa-7a79006317e6,
1354635519.0,6,self.PowerShell,149k2l,How can I best combine these 2 powershell queries into one?,6,0,10,http://www.reddit.com/r/PowerShell/comments/149k2l/how_can_i_best_combine_these_2_powershell_queries/,"When I run:  

Get-mailboxdatabase - Server BLOG01  

I get the following output:

* Name                           Server          Recovery        ReplicationType
* ----                           ------          --------        ---------------
* EMEA-MB-RR                 BLOG01       False             Remote
* EMEA-MBA-01               BLOG01       False             Remote
* EMEA-MB-A                  BLOG02       False             Remote
* EMEA-MB-B                  BLOG02       False             Remote  


I want to do a ForEach query and have what's under the name column be put as the value of -database in the below query.

get-mailbox -database ????????? | where {$_.prohibitsendquota -ne ""unlimited""} | format-table Name,prohibitsendquota | out-file c:\text -append


I kinda know I have to make a variable of the first command but once I make a $EXMB variable I can't just put it behind the -database part of the second query.

Can anyone help me?
",,False,,t5_2qo1o,False,,,True,t3_149k2l,http://www.reddit.com/r/PowerShell/comments/149k2l/how_can_i_best_combine_these_2_powershell_queries/,
1351741775.0,5,self.PowerShell,12fvre,Do I need a security certificate?,6,1,4,http://www.reddit.com/r/PowerShell/comments/12fvre/do_i_need_a_security_certificate/,"I'm just starting to learn Powershell. I run a small IT company and I run an RMM tool on a number of my clients's machines. The RMM lets me execute scripts on the monitored machines. I've been using some VBScripts I've cobbled together. 

I'm obviously talking about machines scattered in a number of different offices. 

Do I need a buy a security certificate to sign my scripts? It doesn't seem that a self-signed certificate would be practical across numerous organizations. 

If so, what's a good and cheap place to get a certificate?

Thanks for your help. I'm sure I'll stick my head in here from time to time as I'm learning. ",,False,,t5_2qo1o,False,,,True,t3_12fvre,http://www.reddit.com/r/PowerShell/comments/12fvre/do_i_need_a_security_certificate/,
1350658434.0,6,self.PowerShell,11qz9k,referencing problem,6,0,2,http://www.reddit.com/r/PowerShell/comments/11qz9k/referencing_problem/,"I have a problem from the additional section of code
$Machine = get-wmiobject -computername $computer -query ""select * from Win32_ComputerSystem"" | select Manufacturer , Model

switch ($Machine.Manufacturer)
 {
   ""Dell Inc.""  {$Model = ""Dell $Machine.Model""}

   ""Hewlett-Packard"" {$Model = ""$Machine.Model""}
 }

$Model


$Model is returning my entire result set, when I am just trying to get the Model field from its results.  How can I correct that?  

In addition, these always seem to be the sticking points that I have the most problems with powershell.  Is there a good webpage that explains how to handle string concatenation in all ""referencing methods""?",,False,,t5_2qo1o,False,,,True,t3_11qz9k,http://www.reddit.com/r/PowerShell/comments/11qz9k/referencing_problem/,
1350590279.0,6,self.PowerShell,11pgdf,AD Users + IIS + FTP,6,0,4,http://www.reddit.com/r/PowerShell/comments/11pgdf/ad_users_iis_ftp/,"Hi there,

I have been trying to get a better grip on powershell and starting with some tasks that would take a lot of time to do manually, to totally script these in powershell.
(Using a virtual machine of win server2012)
I can create my users from an csv file already but is there actually a possibility to create a webpage for each of these users (location http://localhost/Users/&lt;username_dir&gt;/) and once this is created to give them acces to those dirs by the means of ftp?

I've tried tackeling this with guides for the iis and ftp induvidually but I don't really can get it all togheter.

If someone could guide me in the right direction how to tackle this I would be gratefull.

PS:  I was actually wondering if this was actually possible at all to do in 1 script.
It might come in handy one day if I need to set this all up somewhere.

And if someone has a nice site with a lot of challenges in powershell I would love to hear, so I can practice my skills.",,False,,t5_2qo1o,False,,,True,t3_11pgdf,http://www.reddit.com/r/PowerShell/comments/11pgdf/ad_users_iis_ftp/,
1350059602.0,5,self.PowerShell,11degr,Get-Content crashing when it hits a computer that is turned off how can I keep that from happening...,5,0,6,http://www.reddit.com/r/PowerShell/comments/11degr/getcontent_crashing_when_it_hits_a_computer_that/,"I need a way to report some information based on a list of computers.  Occasionally I'll come across either  a computer that is turned off, probably an old computer that is no longer an asset, or something that I can't explain and I'll get an error and it'll cease to run.  Is there a way I can just skip computers not turned on or maybe even right to the excel file ""turn the damn computer on""?

**ERROR**

    Get-WmiObject : The RPC server is unavailable. (Exception from HRESULT: 0x800706BA)
    At line:4 char:14
    + Get-WmiObject &lt;&lt;&lt;&lt;  -Class Win32_OperatingSystem -computername $content -Authentication 6 -credential $credential | select CSName, Description | Export-Csv $env:userprofile\desktop\SDIInfo.csv
        + CategoryInfo          : InvalidOperation: (:) [Get-WmiObject], COMException
        + FullyQualifiedErrorId : GetWMICOMException,Microsoft.PowerShell.Commands.GetWmiObjectCommand

**My Code**

    $content = Get-Content $env:userprofile\desktop\dsquery.csv
    Get-WmiObject -Class Win32_OperatingSystem -computername $content -Authentication 6 -credential $credential | select CSName, Description | Export-Csv $env:userprofile\desktop\SDIInfo.csv
",,False,,t5_2qo1o,False,,,True,t3_11degr,http://www.reddit.com/r/PowerShell/comments/11degr/getcontent_crashing_when_it_hits_a_computer_that/,
1349977138.0,5,self.PowerShell,11bhwu,Q: anyone doing anything cool with PowerShell and SharePoint / TFS? ,5,0,5,http://www.reddit.com/r/PowerShell/comments/11bhwu/q_anyone_doing_anything_cool_with_powershell_and/,"I've been rewriting some of my old tools in PowerShell and I fancy doing something a bit cleverer with the output (currently only dumping to stdout for me only). One tool rattles through each build server/agent and tells me if it's been disabled or down, it'd make sense to publish that in a report somehow but I'm not quite sure how to start. I think there's an out-html cmdlet which I should be able to push to an SP web-site (I could schedule it I guess, seems a clunky way to do it).

Anyway... anyone doing anything cool? fancy sharing? :)",,False,,t5_2qo1o,False,,,True,t3_11bhwu,http://www.reddit.com/r/PowerShell/comments/11bhwu/q_anyone_doing_anything_cool_with_powershell_and/,
1349771948.0,5,self.PowerShell,116rrv,How do i output results into a CSV?,5,0,5,http://www.reddit.com/r/PowerShell/comments/116rrv/how_do_i_output_results_into_a_csv/,"I have this:

-Get Mailbox

$objMailbox = fnFindMailbox (""Please enter the userid of the user"")
$MailboxSamAccountName = $objMailbox.WindowsLiveID

 -State reason for removing from group

fnDisplayMessage
write-host ""Please give a specific reason for allowing access to the specified user""
fnDisplayInput
$reason = Read-Host

-Remove from group

Remove-QADGroupMember ""disabletestGroup"" -Member $MailboxSamAccountName

fnDisplayReset
Write-Host """"
Write-Host ""Script Finished""
Write-Host """"

$LogEntry  = ($global:MyLiveAdminObject).alias + ""_"" + $ScriptTitle.replace("" "","""") + ""_"" +$ScriptStartTime
$LogEntry &gt;&gt; ""$global:strTranscriptLogLocation\CompletedRunReport.txt""

FnMenuMessage

And i need to output results into a CSV in the format 

Name, Reason for Request, Time/Date

Ill still need the transcript in place but also need  a separate log for this.

Sorry for the newby question and thanks for the help!",,False,,t5_2qo1o,False,,,True,t3_116rrv,http://www.reddit.com/r/PowerShell/comments/116rrv/how_do_i_output_results_into_a_csv/,
1349409333.0,5,stackoverflow.com,10z5yh,Problem converting char array to string,5,0,9,http://www.reddit.com/r/PowerShell/comments/10z5yh/problem_converting_char_array_to_string/,,,False,,t5_2qo1o,False,,,False,t3_10z5yh,http://stackoverflow.com/questions/12738121/powershell-convert-char-array-to-string,
1349358174.0,5,self.PowerShell,10xnw9,Introduction to calling values from the Registry?,5,0,6,http://www.reddit.com/r/PowerShell/comments/10xnw9/introduction_to_calling_values_from_the_registry/,"Is there a basic introduction on how to write scripts that call values from the registry? For example, if I have a PCI card and I want to look at its GUID, how would I access the registry in a script (not the PS prompt) and print out values?",,False,,t5_2qo1o,False,,,True,t3_10xnw9,http://www.reddit.com/r/PowerShell/comments/10xnw9/introduction_to_calling_values_from_the_registry/,
1349292419.0,5,self.PowerShell,10w3db,Using a Module to define global variables,5,0,3,http://www.reddit.com/r/PowerShell/comments/10w3db/using_a_module_to_define_global_variables/,"I'm trying to have a module which has all the common functions and variables I use in any powershell script.  Without defining every variable as global, I was hoping Import-Module -Global would work, but it's not:

script.ps1:

    Import-Module .\themodule.psm1 -Global
    Write-Host $Var1

themodule.psm1

    $Var1 = ""TheVariable""

Write-Host outputs nothing, unless I do $Global:Var1 in the module.  I figured with -Global I wouldn't need to, but that doesn't seem to be the case.  I really don't want to have to explicitly use $Global:Var1 syntax 500+ times - I really want EVERYTHING to be global, that's the whole point of the module.

Any ideas?

Edit: I'm sure I could ""Dot Source"" the file, just seems like the ""old"" way to do it...",,False,,t5_2qo1o,1349293117.0,,,True,t3_10w3db,http://www.reddit.com/r/PowerShell/comments/10w3db/using_a_module_to_define_global_variables/,
1349279105.0,5,self.PowerShell,10vo7q,Get-Eventlog vs. Get-Winevent,5,0,7,http://www.reddit.com/r/PowerShell/comments/10vo7q/geteventlog_vs_getwinevent/,"I was used to  being able to use the -after and -before parameters to specify a time frame. It seems that the only way to get that functionality  w/ Get-Winevent is to use the -filterhashtable parameter. Do I have that right?

That is going to add a lot of complexity to what would otherwise be a simple query.",,False,,t5_2qo1o,False,,,True,t3_10vo7q,http://www.reddit.com/r/PowerShell/comments/10vo7q/geteventlog_vs_getwinevent/,
1348778858.0,5,self.PowerShell,10kz2v,Input Redirection to Executable,6,1,14,http://www.reddit.com/r/PowerShell/comments/10kz2v/input_redirection_to_executable/,"I am trying to write a Powershell script that performs some tasks in Perforce using p4.exe.  We are trying to use a custom client profile.   One of the parameters allows you to do this by reading a text file from standard input.

So normally in the command shell you'd do something like:

**p4 client -i &lt; myProfile.txt**

I can't figure out how to do the equivalent in Powershell.  I could also be misunderstanding how **p4 client** is working.

Any help is appreciated.

Thanks",,False,,t5_2qo1o,False,,,True,t3_10kz2v,http://www.reddit.com/r/PowerShell/comments/10kz2v/input_redirection_to_executable/,
1348649870.0,5,powershell.com,10hyus,I signed up for these and have been quite impressed with the daily emails. [Power Tips],10,5,3,http://www.reddit.com/r/PowerShell/comments/10hyus/i_signed_up_for_these_and_have_been_quite/,,,False,,t5_2qo1o,False,,,False,t3_10hyus,http://powershell.com/cs/blogs/tips/,
1348520952.0,6,self.PowerShell,10euox,Is it possible to call Excel macros from PowerShell if the macros are not in your PERSONAL.XLSB file?,6,0,2,http://www.reddit.com/r/PowerShell/comments/10euox/is_it_possible_to_call_excel_macros_from/,"I'm writing a script that calls macros from my PERSONAL.XLSB file with the following code:

    $excel.Application.Run(""PERSONAL.XLSB!mymacro"")

I want to be able to put an excel file containing the macros, with the .ps1 file so that the script could be run for any computer/user without adding the macros to the other user's PERSONAL.XLSB file. The macros would be called on a seperate sheet that is downloaded and deleted often (this is why I can't just put the macros in the workbook) Is it possible to call the macros from a second workbook, or import the macros from a second workbook?

EDIT:
If I plan on running this script on a server, would the best option be to create a new module on the server's/user's PERSONAL.XLSB file, and put my macros into that module? I would prefer to put an excel sheet with the script, but if this is my only option, I can do it (it will just be a pain if I plan to move it to another server).

SOLUTION:
This was much easier than I thought. You simply must open the file, then call the XLSB infront of the macroname:

    $global:scriptpath = split-path $script:MyInvocation.MyCommand.Path
    $macrofile = $global:scriptpath + ""\Macros\MACROS.XLSB""
    $mcrfl = $excel.Workbooks.Open($macrofile)
    $excel.Application.Run(""MACROS.XLSB!Module1.MyMacro"")",,False,,t5_2qo1o,1348662518.0,,,True,t3_10euox,http://www.reddit.com/r/PowerShell/comments/10euox/is_it_possible_to_call_excel_macros_from/,
1347976827.0,5,self.PowerShell,102ulw,What's the proper way to write a function with more than one switch parameter?,5,0,10,http://www.reddit.com/r/PowerShell/comments/102ulw/whats_the_proper_way_to_write_a_function_with/,"Normally I'd write something like this:
    
    Function myfunction {
         Param([switch]$myswitch)
         If ($myswitch) {Do something}
         Else {Do Something else}
    }

But if I put a second switch in there I now have 4 possible outcomes instead of two, and a third switch would make it 8, and so on... 

There has to be a better conditional for handling switches than If statements, right?",,False,,t5_2qo1o,False,,,True,t3_102ulw,http://www.reddit.com/r/PowerShell/comments/102ulw/whats_the_proper_way_to_write_a_function_with/,
1347839863.0,5,self.PowerShell,zzunu,Question about parsing a log file.,6,1,2,http://www.reddit.com/r/PowerShell/comments/zzunu/question_about_parsing_a_log_file/,"First off, I'm extremely new to PowerShell.  With that being said I'm trying to parse a log file from FileZilla to email me when there is a new upload.  Basically I'm looking for STOR.  So far I just have the script parse the file looking for STOR and writing a new text file.  I really need to run this script every 5 minutes or so and find the latest entries.  Any suggestions or help is greatly appreciated.

    $Response = Select-String -Path C:\Users\Fletch\Desktop\Logs\FileZilla` Server.log -pattern ""STOR""

    Add-Content -Path ""C:\Users\Fletch\Desktop\Logs\logresponse.txt"" -Value ""`r`n $Response""",,False,,t5_2qo1o,False,,,True,t3_zzunu,http://www.reddit.com/r/PowerShell/comments/zzunu/question_about_parsing_a_log_file/,
1347176395.0,4,theagreeablecow.com,zlez7,SysAdmin Modular Reporting (SAMReports),6,2,8,http://www.reddit.com/r/PowerShell/comments/zlez7/sysadmin_modular_reporting_samreports/,,,False,,t5_2qo1o,False,,,False,t3_zlez7,http://www.theagreeablecow.com/2012/09/sysadmin-modular-reporting-samreports.html,
1346885574.0,6,self.PowerShell,zf25r,Is it possible to get TAB to autocomplete with directory trailing backslashes?,8,2,15,http://www.reddit.com/r/PowerShell/comments/zf25r/is_it_possible_to_get_tab_to_autocomplete_with/,"TCC/LE and bash TAB autocomplete directory paths with trailing slashes/backslashes.  It's annoying having to type backslashes into PowerShell as I am used to having them there automatically.

I was hoping that PowerShell 3.0 would finally add this, but it doesn't look like it has.

Is there any way to enable it?  If modules like PowerTab can do some pretty fancy stuff with TAB autocomplete, surely it's possible?",,False,,t5_2qo1o,1346946165.0,,,True,t3_zf25r,http://www.reddit.com/r/PowerShell/comments/zf25r/is_it_possible_to_get_tab_to_autocomplete_with/,
1346186487.0,5,self.PowerShell,yzbni,Alternative for WaitForExit on remote computer,5,0,3,http://www.reddit.com/r/PowerShell/comments/yzbni/alternative_for_waitforexit_on_remote_computer/,"Hello everyone,

I'm creating a powershell script to remotely install .net4 on a list of machines. I would like to have the .net install process complete before continuing with the the next operation. 

Invoke-WmiMethod -class Win32_Process -name Create -ArgumentList ($exe) -ComputerName $_ 

$net4 = get-process -Computer $_ dotNetFx40_Full_x86_x64

$net4.WaitForExit()


I found out that WaitForExit is not supported for remote machines. What would be an alternate way, other than specifying a timeout value, to pause the script until the .net process is complete?

Thanks!",,False,,t5_2qo1o,False,,,True,t3_yzbni,http://www.reddit.com/r/PowerShell/comments/yzbni/alternative_for_waitforexit_on_remote_computer/,
1343800795.0,5,self.PowerShell,xhrpo,need help with scheduled task and script that uses cmdlets from an imported module,5,0,13,http://www.reddit.com/r/PowerShell/comments/xhrpo/need_help_with_scheduled_task_and_script_that/,"I'm having trouble trying to figure out why a script that I am trying to call from a scheduled task on a windows 2008 R2 server is failing to run properly.  

I have successfully created other scheduled tasks on other servers in a similar manner so the fact that I can't figure this one out is extra frustrating.

The script that I have written uses the Cisco UCS Powertool module (CiscoUcsPS).

If I run the script manually myself it runs correctly.  If I run the script inside a session for the user the scheduled task runs as (using run as different user from the context menu) it runs successfully.

Running the scheduled tasks generates a System.Management.Automation.CommandNotFoundException from the calls to the cmdlets provided by the CiscoUcsPS module.

The script:


    #Import the UCS module
    Import-Module CiscoUcsPS
    
    # Get the credentials setup
    $password = ""********"" | ConvertTo-SecureString -AsPlainText -Force
    $UCScred = New-Object System.Management.Automation.PSCredential ""admin"",$password
    
    try {
        # Login
        $UCSlogin=Connect-Ucs ""colo-ucsmgmt"" -Credential:$UCScred -NotDefault
        
        # print something
        Get-UcsChassis -Ucs:$UCSlogin | Format-Table -Property Id, Serial, ConfigState, Power, Thermal
        
        #Creates and Downloads full-state system backup of UCS
        Backup-Ucs -Ucs:$UCSlogin -Type:full-state -PathPattern:""R:\BackupsGoHere\UCS\${ucs}-${yyyy}${MM}${dd}-${HH}${mm}-full-state.xml""
        
        #Creates and Downloads logical backup of UCS
        Backup-Ucs -Ucs:$UCSlogin -Type:config-logical -PathPattern:""R:\BackupsGoHere\UCS\${ucs}-${yyyy}${MM}${dd}-${HH}${mm}-config-logical.xml""
        
        #Creates and Downloads system backup of UCS
        Backup-Ucs -Ucs:$UCSlogin -Type:config-system -PathPattern:""R:\BackupsGoHere\UCS\${ucs}-${yyyy}${MM}${dd}-${HH}${mm}-config-system.xml""
        
        #Creates and Downloads config-all backup of UCS
        Backup-Ucs -Ucs:$UCSlogin -Type:config-all -PathPattern:""R:\BackupsGoHere\UCS\${ucs}-${yyyy}${MM}${dd}-${HH}${mm}-config-all.xml""
        
        Disconnect-Ucs -Ucs:$UCSlogin
    }
    catch {
        $ex = $_.Exception
        Send-MailMessage -SmtpServer:$SMTPSERVER -To:$MYEMAIL -From:$MYEMAIL -Subject:""script-debug-testing"" -Body:""debug: exception with UCS commands - $ex""
    }


The variables used in the Send-MailMessage cmdlet are defined, I just haven't pasted those lines.

Any suggestions on where I should look to find out why it's not working would be appreciated.

Action for the scheduled task is Start a program.  The details of the action are **powershell.exe -command ""&amp; R:\BackupsGoHere\Scripts\powershell\UCS_Backup.ps1""**.

Everything after the powershell.exe is in the ""Add arguments (optional)"" field.  I have tried this with the full path to the powershell exe.  I've tried it both with and without a Start in value in the action.

",,False,,t5_2qo1o,1343804631.0,,,True,t3_xhrpo,http://www.reddit.com/r/PowerShell/comments/xhrpo/need_help_with_scheduled_task_and_script_that/,
1343749505.0,6,self.PowerShell,xgbtw,And Or Conditional Statements? ,6,0,10,http://www.reddit.com/r/PowerShell/comments/xgbtw/and_or_conditional_statements/,"I'm trying to write a search function that will select an object if two of the objects contain the search query. But I don't know how to do an AND OR here's the snippet that matters:

where-object {$_.Name -contains $search ANDOR $_.DisplayName -contains $search ANDOR $_.ServiceName -contains $search}",,False,,t5_2qo1o,False,,,True,t3_xgbtw,http://www.reddit.com/r/PowerShell/comments/xgbtw/and_or_conditional_statements/,
1343658253.0,5,self.PowerShell,xe450,Totally Nub Beginner,9,4,19,http://www.reddit.com/r/PowerShell/comments/xe450/totally_nub_beginner/,"So, I've been subscribed to /r/powershell for a good few months now, but I've only recently had time to work on learning it.  Aside from the links on the right, is there any available training to be had online?  I've seen the technet labs, but I'd like to find lab work that could be completed on my own servers.",,False,,t5_2qo1o,False,,,True,t3_xe450,http://www.reddit.com/r/PowerShell/comments/xe450/totally_nub_beginner/,
1343401654.0,6,csharpening.net,x902a,Inside PowerShell 3.0: Parameter Value Completion,6,0,1,http://www.reddit.com/r/PowerShell/comments/x902a/inside_powershell_30_parameter_value_completion/,,,False,,t5_2qo1o,False,,,False,t3_x902a,http://csharpening.net/?p=1252,
1342492584.0,4,csharpening.net,wohn1,Tandem PowerShell Sessions,7,3,0,http://www.reddit.com/r/PowerShell/comments/wohn1/tandem_powershell_sessions/,,,False,,t5_2qo1o,False,,,False,t3_wohn1,http://csharpening.net/?p=1237,
1340839442.0,5,self.PowerShell,vpmgo,Archival Script,5,0,4,http://www.reddit.com/r/PowerShell/comments/vpmgo/archival_script/,"I've been asked to put together a script that will:
  
* Scan our shared drives for files older then 18 months.(E, F, G, H, I, J, K, L, M, N, O, P, Q, R, T)
* Add them to a tar/zip/whatever with the FULL PATH intact   
* Create a log of the files that were archived, and delete the original files.  

I put together a bash script that was able to accomplish the tasks, but it required mounting the drives on a seperate linux box and was inherently slow since it had to pull the files across the network from the fileserver to the linux box and then back to the file server.   It worked, but the performance was severely lacking and the more I think about it the more I think we'd be better off investing a few hours to put together a Powershell script that can run locally on our Windows file server rather than the linux box with each of the shares mounted.   I've never done anything in powershell, but I've been reading about it this morning and so far I've been able to put together the following:

     # This portion should get a list of the local disks excluding the C:\ and Z:\ OS and Archives
     Write-Host ""Searching for Physical Drives to Archive"" –foregroundcolor “green” #Can be removed, but helpful for debugging purposes
     	gwmi win32_logicaldisk | 
	     	where {$_.DriveType -eq 3} |
	     	where {$_.DeviceID -like ""*:""} |
	     	where {($_.DeviceID -ne ""C:"") -and ($_.DeviceID -ne ""Z:"")}

     # This portion should return all of the files on d drive that were last modified over a year and a half ago.
     Write-Host ""Checking for old files"" –foregroundcolor “green” #Can be removed, but helpful for debugging purposes
     	Get-ChildItem -r D:\ |
		where-object {$_.LastWriteTime -lt (get-date).AddDays(-548)}

If you have any tips/points/advice I'd greatly appreciate them since it's taking me a while to put it together.",,False,,t5_2qo1o,1340846277.0,,,True,t3_vpmgo,http://www.reddit.com/r/PowerShell/comments/vpmgo/archival_script/,
1340560977.0,4,self.PowerShell,vj5o2,0xc0000142 Errors with powershell.,5,1,6,http://www.reddit.com/r/PowerShell/comments/vj5o2/0xc0000142_errors_with_powershell/,"Ok so basically when ever I try to run non native commands in powershell I get this error(ex ping, tracert, net use, etc).

&gt;The application was unable to start correctly (0xc0000142). Click OK to close the application.

I'm doing this on Windows 7 pro x64 using powershell ISE under admin rights. If I go into cmd those commands work. If I go into cmd, type powershell, and then the command it still works as well as just going straight to powershell.

It also works on my desktop running 7 Ultimate x64. What could be the problem? I am on a dual boot Mac book pro but I doubt that is causing issues.

It seems like powershell is having trouble executing cmd in the background to run these commands. Today is my first day trying powershell and I'm only taking a shot in the dark guess that is what is the problem.",,False,,t5_2qo1o,False,,,True,t3_vj5o2,http://www.reddit.com/r/PowerShell/comments/vj5o2/0xc0000142_errors_with_powershell/,
1340489487.0,6,csharpening.net,vhzp7,Creating a PowerShell Profiler,6,0,0,http://www.reddit.com/r/PowerShell/comments/vhzp7/creating_a_powershell_profiler/,,,False,,t5_2qo1o,False,,,False,t3_vhzp7,http://csharpening.net/?p=1226,
1339642147.0,5,self.PowerShell,v0zs3,Exporting a hashtable to a CSV file,5,0,5,http://www.reddit.com/r/PowerShell/comments/v0zs3/exporting_a_hashtable_to_a_csv_file/,"The script I have so far exports the hash table, but the formatting does not carry over. When it creates the CSV file it just keeps adding a column for each user instead of just staying at two columns and adding rows per user. Is there a better way to approach this, or a different command besides New-Object psobject which I suspect is breaking the formatting? Any help is appreciated.

Visual:
http://imgur.com/a/0CXbO

    $Password=@{}
    $Userlist=Import-Csv ""E:\Users.csv""
    FOREACH ($Person in $UserList) {
    $Username=$Person.Firstname.substring(0,1)+$Person.Lastname
		    $rand = New-Object System.Random
		    1..10 | ForEach { $NewPassword = $NewPassword + [char]((Get-Random -Minimum 65 -Maximum 91) + (Get-Random -Maximum 2)*32) };
		    $Userpassword=$NewPassword
		    Clear-Variable NewPassword
    $Password +=@{""$Username"" = ""$Userpassword""}
    }		
    New-Object psobject -Property $Password | Export-CSV ""E:\Logs\test.csv"" -NoTypeInformation
",,False,,t5_2qo1o,1339674764.0,,,True,t3_v0zs3,http://www.reddit.com/r/PowerShell/comments/v0zs3/exporting_a_hashtable_to_a_csv_file/,
1339100532.0,5,gist.github.com,uqcj9,Native PowerShell wrapper for MKLINK.,7,2,0,http://www.reddit.com/r/PowerShell/comments/uqcj9/native_powershell_wrapper_for_mklink/,,,False,,t5_2qo1o,False,,,False,t3_uqcj9,https://gist.github.com/2891103,
1339037126.0,5,self.PowerShell,up4mj,Using PowerShell to set the default Explorer Folder view for Printers and Devices in Windows 7,6,1,1,http://www.reddit.com/r/PowerShell/comments/up4mj/using_powershell_to_set_the_default_explorer/,"I've been working with PowerShell scripts to automate setting up a workstation. Because of our policy, I cannot make changes via a GPO, hence the need for scripts. I've hit a problem that I can't figure out. I'm trying to set the default view for Printers and Devices to Details, set the columns up the way I want, etc.
I've gotten that to work. Using Regshot, I was able to find the following registry key stored that information: 

* HKCU:\Software\Classes\Local Settings\Software\Microsoft\Windows\Shell\Bags[#]\Shell\\[CLSID]

What I can't figure out is how to determine the Bag number that corresponds to the Printers and Devices. Any ideas how to determine the correct Bag# dynamically using PowerShell or any form of registry wizardry? Any help in the matter would be greatly appreciated.

EDIT: I have the script I'd be willing to share if someone helps me finish it this last remaining part.",,False,,t5_2qo1o,1339037834.0,,,True,t3_up4mj,http://www.reddit.com/r/PowerShell/comments/up4mj/using_powershell_to_set_the_default_explorer/,
1338976071.0,6,self.PowerShell,unq2s,Made my first script ever in Powershell. Any thoughts?,9,3,13,http://www.reddit.com/r/PowerShell/comments/unq2s/made_my_first_script_ever_in_powershell_any/,"Hello,
I just finished my first powershell script for creating new users in exchange 2010 with a mailbox. I really enjoyed doing it and learned a lot from it! Most of the text in it is dutch but you should be able to recognize commands and variables (wrote them in english).
What do you people think? Any suggestions?

[Script on pastebin](http://pastebin.com/JeL6Ticz)

I also have a question. In the last switch command I set the default value to restart the script after telling the user that the input was not recognized. Is it possible to set the default value to ask for a proper answer and restart the switch command?",,False,,t5_2qo1o,False,,,True,t3_unq2s,http://www.reddit.com/r/PowerShell/comments/unq2s/made_my_first_script_ever_in_powershell_any/,
1338899617.0,5,madposh.wordpress.com,ulz68,Trevor Sullivan Presents PowerShell and WMI « Madison PowerShell Users Group,5,0,2,http://www.reddit.com/r/PowerShell/comments/ulz68/trevor_sullivan_presents_powershell_and_wmi/,,,False,,t5_2qo1o,False,,,False,t3_ulz68,http://madposh.wordpress.com/2012/05/14/june-meeting-trevor-sullivan-presents-powershell-and-wmi/,
1336939461.0,5,self.PowerShell,tld32,Can anyone explain how and or why [DateTime]::Now works?,5,0,6,http://www.reddit.com/r/PowerShell/comments/tld32/can_anyone_explain_how_and_or_why_datetimenow/,"A co-worker was asking me for a one-liner that returned yesterday's date. I came up with (get-date).adddays(-1) after looking at get-member for get-date.  

On a lark, I took thought I'd see what the Google might have to say about the subject and found a link to stack overflow that referenced [DateTime]::Today, which returns the current day/date, but indicates the time as 12 AM, ::Now gives the current time, much like Get-Date would. 

I haven't seen that syntax use before and can't really find a reference to what it might be or be capable of. Why does that work/exist?",,False,,t5_2qo1o,False,,,True,t3_tld32,http://www.reddit.com/r/PowerShell/comments/tld32/can_anyone_explain_how_and_or_why_datetimenow/,
1336866262.0,5,self.PowerShell,tk9vq,Newb needs advice,5,0,7,http://www.reddit.com/r/PowerShell/comments/tk9vq/newb_needs_advice/,"I've never used Powershell except to do some basic moving about in the filesystem. I'm very unfamiliar with what it is, why it is, and what it can do. I have a task that needs to get done and I'm not even sure if Powershell is the correct tool to use. Please offer advice.

I want to call a command on/in a directory and have it generate a file with the (recursive) list of files and the md5 hash of the file (ignoring the generated file obviously).

FILE.txt would look like this:
----------------------------
    fileA.txt deafbeefdeadbeefdeadbeef12345
    fileB.txt beefdeadbeefdeaf1234567890123
    folderA\fileC.txt 123beadfeedabcdef123455321deadbeef
    folderB\fileD.txt beefdead918228384391deadbeef123123
----------------------------

From a logical point of view, I will need to get a listing of the files, recursively and then somehow take the md5 hash of each file and put the result into FILE.txt

Any ideas how i would do this?",,False,,t5_2qo1o,False,,,True,t3_tk9vq,http://www.reddit.com/r/PowerShell/comments/tk9vq/newb_needs_advice/,
1336656972.0,6,self.PowerShell,tgfx6,"Reddit, Export Formatting, what am I doing wrong? ",6,0,6,http://www.reddit.com/r/PowerShell/comments/tgfx6/reddit_export_formatting_what_am_i_doing_wrong/,"Basically, my goal is to export specific information from an event log collector. After some research and trial and error, I put together something that works. My only issue is I can't figure out how to get the export to display headings for each item at the top of my CSV file. 

Here is what I have so far: 

# Variables
$filedate = get-date -uformat ""%m-%d-%Y""
$yesterday = (get-date) - (new-timespan -day 1)

# Event log Query, csv output
$LogonTypes=Get-WinEvent -FilterHashtable @{Logname='ForwardedEvents'}
foreach ($item in $LogonTypes) {($item | where {$_.timecreated -ge $yesterday} | Select TimeCreated,Message,MachineName,TaskDisplayName | fl * | findstr /I /G:search.lst) -replace"" "","""" -join "","" | out-file -append Activity_$filedate.csv}

Search.lst includes:

TimeCreated
TaskDisplayName
Account Name:
MachineName

Is there a better way to write this? I've tried using select-object and format-table but they don't give me the results I need with the included findstr. 
",,False,,t5_2qo1o,False,,,True,t3_tgfx6,http://www.reddit.com/r/PowerShell/comments/tgfx6/reddit_export_formatting_what_am_i_doing_wrong/,
1336163473.0,6,self.PowerShell,t7e15,Property Ambiguity,7,1,3,http://www.reddit.com/r/PowerShell/comments/t7e15/property_ambiguity/,"So this works, but I'm not sure why it works and I was wondering if someone could give an explanation as to what the rules are here for interpreting whether something is a property or a string concatenation in this context. Here are the lines:
      
    $users = (""bob"", ""alice"")
    $users | %{get-mailbox $_ | export-mailbox \\storage\PSTs\$_.pst}
  
Obviously that could be more (or less!) concise, but hopefully it illustrates what I'm talking about. So that works, it exports Bob and Alice's mailboxes into seperate PST files in the format &lt;name&gt;.pst. My question is: shouldn't $_.pst try to access a property of $_ called ""pst"" and cause export-pst to throw an exception? How does Powershell know that I want to concatenate $_ and "".pst"" as opposed to accessing ""$_.pst?"" What if I *did* have a property called ""pst"" and I wanted to access it in that context? I apologize in advance if I'm missing something really obvious here or grossly misinterpreting something. Any insight would be greatly appreciated!
    ",,False,,t5_2qo1o,False,,,True,t3_t7e15,http://www.reddit.com/r/PowerShell/comments/t7e15/property_ambiguity/,
1334944443.0,4,self.PowerShell,sk0lv,Powershell to Modify Print Queues,5,1,4,http://www.reddit.com/r/PowerShell/comments/sk0lv/powershell_to_modify_print_queues/,"**Backgroud:**  

1. Due to some processes in my department, we sometimes have to change the port from one printer to another. 

2. Because of poor planning by those who set up our remote sites, our print servers are domain controllers.  So only domain admins can log in to administer these printers.

**Problem:**  

I want to empower our first line of problem solvers to manage these print queues and change the ports as needed without logging in to the servers to do so. 

**Idea:**

I would like to create a Powershell script to which I may pass input (Source Queue and Destination Port) in order to allow them to make this change.

I have never worked with printers in this way and I assume that I will have to do this through WMI.  I am just not sure where to begin.  Any help would be greatly appreciated.  Thanks!",,False,,t5_2qo1o,False,,,True,t3_sk0lv,http://www.reddit.com/r/PowerShell/comments/sk0lv/powershell_to_modify_print_queues/,
1334127315.0,5,self.PowerShell,s401h,Scripted New User/ Mailbox/ Lync Setup/ Unified Messaging,6,1,5,http://www.reddit.com/r/PowerShell/comments/s401h/scripted_new_user_mailbox_lync_setup_unified/,"Hey,
I have pieced together other peoples scripts from the internet and various other sources, combined with some self scripting and now have a working script to Prompt for Name, Password etc then Create an AD User\Mailbox, UM and Lync Account.

The problem I am hitting is, once the user account and mailbox are created - it seems to take a good 2-5 minutes before I can create the UM due to propagation I guess, what would be a good method of catching is isn't completed as expected and Retrying?

I'm assuming this is a common problem because any Windows Administrator would love an 'All In One' do my job script. Hopefully someone has found and implemented a solution.

I imagine the two methods to attack it would be run some kind of check before hand, then attempt to continue once the check is returning expected results - the other would be keep retrying to write until it works.

Script can be found http://pastebin.com/BX90sF7g - works over the course of 10-15 minutes if you wait a while at the 'debug pauses'",,False,,t5_2qo1o,False,,,True,t3_s401h,http://www.reddit.com/r/PowerShell/comments/s401h/scripted_new_user_mailbox_lync_setup_unified/,
1333906734.0,5,self.PowerShell,rzftx,Powershell beautifier?,7,2,8,http://www.reddit.com/r/PowerShell/comments/rzftx/powershell_beautifier/,Does anyone use a beautifier that will auto format powershell code?,,False,,t5_2qo1o,False,,,True,t3_rzftx,http://www.reddit.com/r/PowerShell/comments/rzftx/powershell_beautifier/,
1332905179.0,5,self.PowerShell,rgzgz,restarting a process and sending an email,5,0,2,http://www.reddit.com/r/PowerShell/comments/rgzgz/restarting_a_process_and_sending_an_email/,"im in need of a script to send an email if a certain process hits 90% cpu utilization and restart that process, here is my script so far, 

is it correct???



Get-Process php-cgi | Where-Object {$_.cpu -gt 250} | out-string; send-mailmessage -from servers@mail.com -to sysadmin@mail.com -subject “CPU Info” -body “message” -smtpserver smtp.mail.com





im kinda newbie to this, sorry for any trouble

thanks in advanced.
",,False,,t5_2qo1o,True,,,True,t3_rgzgz,http://www.reddit.com/r/PowerShell/comments/rgzgz/restarting_a_process_and_sending_an_email/,
1332776239.0,5,self.PowerShell,reb0m,Looking for a little assistance with a piece of code:,5,0,5,http://www.reddit.com/r/PowerShell/comments/reb0m/looking_for_a_little_assistance_with_a_piece_of/,"I need to get a file name and FTP it to a destination. The problem is the file name will always have a date / time stamp. I would like to be able to grab the file using a wild card for FTP transfer.
I was looking at some code on [stackoverflow](http://stackoverflow.com/questions/1867385/upload-files-with-ftp-using-powershell).

And I know little to nothing about powershell, is there an easy way to do this, or should I just try a solution I am more familiar with( I.E. C#)?

thanks!",,False,,t5_2qo1o,False,,,True,t3_reb0m,http://www.reddit.com/r/PowerShell/comments/reb0m/looking_for_a_little_assistance_with_a_piece_of/,
1330454237.0,6,self.PowerShell,q9zw4,Powershell and WMI Queries 32 vs 64,6,0,5,http://www.reddit.com/r/PowerShell/comments/q9zw4/powershell_and_wmi_queries_32_vs_64/,"When running a x86 version of powershell, I can run the following queries:
    
    Get-WmiObject -Query ""Select * from Win32Reg_AddRemovePrograms64 where DisplayName like '%Java%'"" | select DisplayName

    Get-WmiObject -Query ""Select * from Win32Reg_AddRemovePrograms where DisplayName like '%Java%'"" | select DisplayName

They both return 32-bit applications. When I run the same queries in a x64 version of powershell they only return the 64 bit versions. Why is this and what can I do to view the respective bit versions in either version of powershell?",,False,,t5_2qo1o,False,,,True,t3_q9zw4,http://www.reddit.com/r/PowerShell/comments/q9zw4/powershell_and_wmi_queries_32_vs_64/,
1330302216.0,6,self.PowerShell,q7cpv,Help getting file size\version info from multiple remote machines?,6,0,13,http://www.reddit.com/r/PowerShell/comments/q7cpv/help_getting_file_sizeversion_info_from_multiple/,"I'm pretty new to powershell (As in learning it over the past week), but I am trying to use it to gather some information from some servers. I managed to get it to run through a text file with a list of about 200 servers, query each server for hard drive space free, then log the results in a seperate text file. Now I am trying something a little more difficult. 

I need it to log into each server (via a list of servers in a text file), run through a folder (recursively) on the server and get a list of every file (including time stamp, file size and file version). I am having a heck of a time doing this. I have this, which will get the info on a specific file, but I need ALL files. Any instruction\advice is appreciated.

gc C:\temp\Servers.txt | foreach { [system.diagnostics.fileversioninfo]::GetVersionInfo(""\\C$\location\file.dll"") } | Out-File C:\temp\results.txt

Any sites with some beginners tutorials are appreciated, as well. The scripting guy has been a godsend. ",,False,,t5_2qo1o,False,,,True,t3_q7cpv,http://www.reddit.com/r/PowerShell/comments/q7cpv/help_getting_file_sizeversion_info_from_multiple/,
1329762040.0,5,self.PowerShell,py273,Need to list AD Users who have Write Member permissions on DistributionLists,5,0,1,http://www.reddit.com/r/PowerShell/comments/py273/need_to_list_ad_users_who_have_write_member/,"Hi all,

   So todays fun-fun Super Challenge!  We have migrated from Exchange 2003 to 2010.  Yay!  But for some reason in the olden days of yore, an errant Exchange Administrator gave individual user accounts permission to modify membership of some of our distribution lists.  This is no bueno.

   I've now been tasked with figuring out which accounts have permissions related to changing membership of every one of our distribution lists.  And we have a lot.

   The particular permission I'm looking for can be seen if you enable Advanced Permissions in Active Directory then click Security, Advanced, Edit, Properties, and finally Write Member.  

   My current strategy looks like this:

    Get-DistributionGroup | Get-AdPermission | ? {$_.AccessRights -like ""*Write Members*""}

This does not seem to work.  Any thoughts? ",,False,,t5_2qo1o,False,,,True,t3_py273,http://www.reddit.com/r/PowerShell/comments/py273/need_to_list_ad_users_who_have_write_member/,
1329524141.0,4,defndo.com,pum21,Anonymous functions and code blocks in PowerShell,8,4,0,http://www.reddit.com/r/PowerShell/comments/pum21/anonymous_functions_and_code_blocks_in_powershell/,,,False,,t5_2qo1o,False,,,False,t3_pum21,http://defndo.com/powershell-code-blocks-and-anonymous-functions/,
1329195288.0,6,self.PowerShell,ponpv,So I need to do constant DNS testing from multiple sites around my enterprise - I decided to distribute a powershell script to my field sites which (should) be doing 100 rounds of DNS record searches using the below code..  my only issue is that the loop does one iteration and then exits ,8,2,6,http://www.reddit.com/r/PowerShell/comments/ponpv/so_i_need_to_do_constant_dns_testing_from/,"import-module dnsshell
$WorkstationPathName = $WorkstationName | foreach-object {$_.Name} | Out-String -Stream #Turns the $WorkstationName Object into a readable string to pass to out-file

$LogonServer = NLTEST /DSGETDC:mydomain.domain | select-object -first 1 #Locates the login server that the computer is attached to

$LogPath = ""\\directorylogging\"" #Logs all output of the tests to a consistant directory
$TestTime = get-date -format G  #sets the standard format for my time logging
$LoopCounter = 1

do 
    { ""Pass $TestCount $TestTime $LogonServer"" | out-file -append -    FilePath ""$LogPath\$WorkstationName.log""
try 
    {Get-Dns ar.ds.army.mil -RecordType A -NSSearch | select-object TimeTaken, Server | out-file -append -filepath ""$LogPath\$workstationName.log""}
catch        {[System.Net.Sockets.SocketException,DnsShell.PowerShell.CmdLet.GetDns]
    ""DNS CONNECT FAILURE $TestTime"" | out-file -append -filepath      ""$LogPath\$workstationName.log""}
    finally {$LoopCounter++}
} 
until ($LoopCounter = 100)",,False,,t5_2qo1o,False,,,True,t3_ponpv,http://www.reddit.com/r/PowerShell/comments/ponpv/so_i_need_to_do_constant_dns_testing_from/,
1328824835.0,6,self.PowerShell,pie39,"Script taking Greater than 24 hours to run in V2, runs fine in v1",6,0,8,http://www.reddit.com/r/PowerShell/comments/pie39/script_taking_greater_than_24_hours_to_run_in_v2/,"I inherited this script that uses the Operations Manager Snap In to retrieve and output group members from groups in Operations Manager to a text file.  Now the issue is that this always ran fine in PowerShell 1.0, but once 2.0 was installed, the script started taking over 24 hours, in fact it never completed because the scheduled task would cancel the job and start it over.

Here is the Loop and output version of the script, if anyone could give me a hint as to why this would work fine in PowerShell 1 and not PowerShell 2, I would greatly appereciate it.

	$RootLocation = Get-Location

	$FilteredGroups = (Get-MonitoringObjectGroup) | where{$_.DisplayName -like ""group2*"" -or $_.DisplayName -like ""group3*"" -or $_.DisplayName -like ""Group1""}
	
	ForEach($Group in $FilteredGroups)
	{
		Set-Location $RootLocation
		$GroupName = $Group.DisplayName
		Write-Host -Foreground Yellow $GroupName
		$FileName = $LOCAL_PATH + $GroupName + "".txt""
		Write-Host -Foreground Green $FileName
		
		$GroupInfo = Get-ChildItem | where-Object {$_.DisplayName -eq $GroupName} -ErrorAction SilentlyContinue;
		
		If($GroupInfo -eq $null)
		{
			#No ChildItem to match the Group name
		}
		Else
		{
			If($GroupInfo.Count -eq $null)
			{
			Out-File $FileName
			}
			Else
			{
				#Duplicate Group Name - Alert if we so choose
			}
		}
	}
",,False,,t5_2qo1o,False,,,True,t3_pie39,http://www.reddit.com/r/PowerShell/comments/pie39/script_taking_greater_than_24_hours_to_run_in_v2/,
1327513067.0,5,self.PowerShell,owa17,Compare object with hashtable,5,0,3,http://www.reddit.com/r/PowerShell/comments/owa17/compare_object_with_hashtable/,"I am working on a script to update user attributes.   Specifically,  a delimited file will be dropped nightly and I will process this and loaded the
updated attributes for all users.     My question involves the current information and possible future info.    

To help with speed,   I was thinking of grabbing the current user attributes and then compare the future update.   If they are different, the update
should be loaded.     I was doing this per attribute, but it seems somewhat inefficient  when dealing with several thousand users.  

I am now playing with a query of the current user and compare the incoming information.   If anything has changed,  I would just load the hashtable.
What I am not sure of is,  what is the most efficient way to compare a hashtable with an object?

&lt;snip&gt; 

$header = ""username"",""DisplayName"",""FirstName"",""MiddleName"",""MiddleInitial"",""LastName""  
$Users = Import-Csv short.dat -Delimiter ""|"" -Header $header  
  
  
foreach ($User in $Users)  
{  
    $useriNFO=Get-QADUser $User.Username -includeallproperties|select-object DisplayName,GivenName,middleName,initials,SN  
     
	$UserHash= @{}  
	$UserHash= @{  
	     #'samAccountName'	= $user.Username  
		 'DisplayName'   	= $User.DisplayName  
		 'GivenName' 		= $User.FirstName  
		 'middleName' 		= $User.MiddleName  
		 'initials' 		= $User.MiddleInitial  
		 'SN' 			= $User.LastName  
    
} #End of User hashtable  

  
  $useriNFO  
  $UserHash  
  
 Compare-Object $useriNFO  $UserHash  
  
}  

&lt;/snip&gt;

I will be adding more attributes to this over time,  so I thought that a hashtable might makes things easier over time.    Any insights/suggestions
would be appreciated.     I am also open to other approaches on this  ..  not looking for completed code  ...just some ideas on how to keep this simple and clean :)",,False,,t5_2qo1o,False,,,True,t3_owa17,http://www.reddit.com/r/PowerShell/comments/owa17/compare_object_with_hashtable/,
1326997969.0,3,gist.github.com,onlek,Improved Module loading code for your Powershell Profile.,7,4,0,http://www.reddit.com/r/PowerShell/comments/onlek/improved_module_loading_code_for_your_powershell/,,,False,,t5_2qo1o,False,,,False,t3_onlek,https://gist.github.com/1641637,
1326733895.0,6,self.PowerShell,ojgq4,Exchange Powershell - Get mailbox and forwarding contact.,6,0,5,http://www.reddit.com/r/PowerShell/comments/ojgq4/exchange_powershell_get_mailbox_and_forwarding/,"I am trying to get a powershell command together that will show, If the user has forwarding enabled , the user's mailbox, primary smtp address (or even the DN), and the address the user's mailbox is forwarding to.  

 I have a command I found that will show the user's name, the forwarding address, and the type of forward.  I need to add in the user's primary smtp or DN so I can identify where they are at in the organization. 

The second part is, can you help me convert this over to a write-output so I can dump it to a csv file. I tried but it added strange info to it, like a length field and didn't actually dump the email addresses properly.  I can attach screen shots if needed.  

Here is the command I have:

    Get-Mailbox -Filter {ForwardingAddress -ne $null} | foreach {$recipient = $_; $forwardingsmtp = (Get-Recipient $_.ForwardingAddress).PrimarySmtpAddress ; Write-Host $recipient.Name, $recipient.DN, $forwardingsmtp, $recipient.DeliverToMailboxAndForward }",,False,,t5_2qo1o,False,,,True,t3_ojgq4,http://www.reddit.com/r/PowerShell/comments/ojgq4/exchange_powershell_get_mailbox_and_forwarding/,
1323740306.0,4,powershelladmin.com,nadvs,"Obscure...? PowerShell PsExec wrapper. CSV and XML, baby. Working on a gwmi wrapper.",6,2,0,http://www.reddit.com/r/PowerShell/comments/nadvs/obscure_powershell_psexec_wrapper_csv_and_xml/,,,False,,t5_2qo1o,False,,,False,t3_nadvs,http://www.powershelladmin.com/wiki/Powershell_psexec_wrapper,
1323724815.0,6,self.PowerShell,na32z,Exporting top level folder size,7,1,9,http://www.reddit.com/r/PowerShell/comments/na32z/exporting_top_level_folder_size/,"Hello everyone I am trying to get this script to export a list of our users home directories sizes to a .CSV file. The script mostly works it shows all the sizes and lists the folders but it will not export to a .CSV file meaning no .CSV shows up in the directory. the original code can be found here:
[Original Code](http://jdhitsolutions.com/blog/2011/07/get-top-level-folder-usage/)

Here is my modified code:
[slightly modified](http://pastebin.com/yvknY0H2)

I am really new to powershell and the only thing I can think of is on the export line the select part is incorrect maybe I am trying to select things that are not there. Any help you can provide would be much appreciated",,False,,t5_2qo1o,False,,,True,t3_na32z,http://www.reddit.com/r/PowerShell/comments/na32z/exporting_top_level_folder_size/,
1323673109.0,5,self.PowerShell,n9f3n,Is there a powershell equivalent to .bashrc?,6,1,3,http://www.reddit.com/r/PowerShell/comments/n9f3n/is_there_a_powershell_equivalent_to_bashrc/,"I don't really grok powershell yet, and am by no means an expert in bash, though I just took a bash scripting class. If I want to run set-aliases and the like every I open powershell, how would I go about it?

And is editing the system path variable the correct/proper way to get the command “gvim.exe” running no matter the current working directory? (Told you I was no expert).

And one final, even less related note: Are there any console programs with vi/vim bindings? guess I could just try to get the conque-term plugin working in vim.

Thank you!",,False,,t5_2qo1o,False,,,True,t3_n9f3n,http://www.reddit.com/r/PowerShell/comments/n9f3n/is_there_a_powershell_equivalent_to_bashrc/,
1322845155.0,5,csharpening.net,mxoee,Building Binary PowerShell Modules,6,1,0,http://www.reddit.com/r/PowerShell/comments/mxoee/building_binary_powershell_modules/,,,False,,t5_2qo1o,False,,,False,t3_mxoee,http://csharpening.net/?p=738,
1321579304.0,5,self.PowerShell,mgdjp,Running Powershell with elevated permissions,5,0,3,http://www.reddit.com/r/PowerShell/comments/mgdjp/running_powershell_with_elevated_permissions/,"I have a script that I am trying to run using sccm 2007. In sccm, I package it up and then have the task use a batch file to call powershell and run the script. Because I am using SCCM the script is not run as my user and thus errors.



The issue is that I am attempting to modify IIS with the web-administration snapin. To do this I need to authenticate. I have read a lot of ways to do this but I am trying to find a way that will allow my script to work and will allow me to store the authentication credentials securely. Please take note that I will be deploying and running this script via deployment software so whatever solution has to fit inside that scheme.



Can anyone help?



Here is the error I get:
New-Item : Filename: \\?\UNC\place.it.lives\config\cluster003\applicationHost.config
Error: Cannot write configuration file due to insufficient permissions



Here is some of the script:



if ([System.Version] (Get-ItemProperty -path ""HKLM:\Software\Microsoft\Windows NT\CurrentVersion"").CurrentVersion -ge [System.Version] ""6.1"") { Import-Module WebAdministration } else { Add-PSSnapin WebAdministration }


$DNNAppPool = [string] ""NewAppPool""


New-WebAppPool $DNNAppPool
  ",,False,,t5_2qo1o,False,,,True,t3_mgdjp,http://www.reddit.com/r/PowerShell/comments/mgdjp/running_powershell_with_elevated_permissions/,
1319560060.0,7,self.PowerShell,lojf5,Checking if one string contains another,7,0,6,http://www.reddit.com/r/PowerShell/comments/lojf5/checking_if_one_string_contains_another/,"I am working on a script which creates users in AD, and I want to make sure the sAMAccoutname contains the user's last name.

I have tried the $accountname.Contains($lastname), but it only seems to work when the two string are equal.

Example:

Input

Last Name - Johnson

Valid Username: 234xxxjohnsonx234 (anything containing 'johnson' with not matter to the pre/postfix

Invalid Username: johnso

Do you guys have any ideas?

EDIT: Resolved by using toLower() on both strings before checking if the latter contains the first.",,False,,t5_2qo1o,True,,,True,t3_lojf5,http://www.reddit.com/r/PowerShell/comments/lojf5/checking_if_one_string_contains_another/,
1318002600.0,7,self.PowerShell,l47wi,New To PowerShell,8,1,4,http://www.reddit.com/r/PowerShell/comments/l47wi/new_to_powershell/,"I'm new to PowerShell and want to start doing basic scripting, but have no money for classes.  What's a good place to start, already looking on the Microsoft Website in the Powershell section (The owner's manual and such)",,False,,t5_2qo1o,False,,,True,t3_l47wi,http://www.reddit.com/r/PowerShell/comments/l47wi/new_to_powershell/,
1316529297.0,5,self.PowerShell,klm17,foreach $oldaccount in oldaccounts AND $newaccount in newaccounts?,5,0,11,http://www.reddit.com/r/PowerShell/comments/klm17/foreach_oldaccount_in_oldaccounts_and_newaccount/,"Hey powershell guru's, hoping someone can help me out here, or tell me I am off my rocker.

We have an office move coming up for a subsidiary we acquired a few years. For every user that is moving we want them to login using their credentials in our domain and not their old domain. Their old domain had a naming standard of %lastname% and our domain has a naming standard of %firstname.lastname%.

Their accounts already exist in both directories, but I want to come up with a script to copy all of their home drive data and for bonus points, maybe assign security rights for their account in our domain.

As my title suggests, what I would like to do is:
$oldaccounts = gc oldaccounts.txt
$newaccounts = gc newaccounts.txt

foreach $oldaccount in $oldaccounts AND $newaccount in $newaccounts {
robocopy \\oldserver\home\$oldaccount \\newserver\home\$newaccount
}

If there isn't the same number of items in each variable then this would probably bomb?

EDIT:
Thanks for the help everyone, here is the answer:
    $usernames = Import-Csv e:\Admin\Scripts\powershell\old_new\accounts.csv
    $exe = ""robocopy""
    $param1 = ""/COPY:DAT""
    $param2 = ""/MIR""
    $param3 = ""/R:0""
    $param4 = ""/W:0""

    ForEach ($entry in $usernames){
        $source = (""\\dphcs0\home$\"" + $entry.olduser)
        $dest = (""\\fsrvcdc1\home\"" + $entry.newuser)
        $log = (""/LOG:dph_to_cdc_"" + $entry.olduser + "".txt"")

        echo (robocopy $source $dest $param1 $param2 $param3 $param4 $log)
    }",,False,,t5_2qo1o,True,,,True,t3_klm17,http://www.reddit.com/r/PowerShell/comments/klm17/foreach_oldaccount_in_oldaccounts_and_newaccount/,
1315428712.0,7,self.PowerShell,k802l,Can I get a value between two other known values withinin a string?,7,0,5,http://www.reddit.com/r/PowerShell/comments/k802l/can_i_get_a_value_between_two_other_known_values/,"EDIT: I ended up figuring out what I need to know, see my comment if you're interested.

I'm working on a script that needs to grab a line from a log file, and then look within that string for a specific section of it.  A sample line from the log:

abcfile.0000.xxxx.*yyyyMMdd*.zip

The 'abcfile.0000.' part and the date (in .*yyyyMMdd form*) are constant.  I just can't for the life of me figure out a way to get just the 'xxxx' portion of the string and save that as a variable.

If anyone could offer any insight I would greatly appreciate it.

A bit of googling got me [this article](http://blogs.technet.com/b/heyscriptingguy/archive/2006/11/14/how-can-i-extract-information-located-between-two-known-values-in-a-text-file.aspx), which describes exactly what I need to do.  It even has a sample script, but it is not in powershell syntax and I do not understand the scripting language used.",,False,,t5_2qo1o,True,,,True,t3_k802l,http://www.reddit.com/r/PowerShell/comments/k802l/can_i_get_a_value_between_two_other_known_values/,
1314194433.0,5,self.PowerShell,jsv1y,Most used cmdlets / Pipes?,5,0,2,http://www.reddit.com/r/PowerShell/comments/jsv1y/most_used_cmdlets_pipes/,"What are some of your most used commands, cmdlets or piped commands  that you use on a daily basis? 

get-help and 
get-service | where-object {$_.Status -eq ""Stopped""}
is probably my most used. ",,False,,t5_2qo1o,False,,,True,t3_jsv1y,http://www.reddit.com/r/PowerShell/comments/jsv1y/most_used_cmdlets_pipes/,
1311011018.0,5,blogs.msdn.com,iszmv,Invoke-Expression considered harmful?,5,0,1,http://www.reddit.com/r/PowerShell/comments/iszmv/invokeexpression_considered_harmful/,,,False,,t5_2qo1o,False,,,False,t3_iszmv,http://blogs.msdn.com/b/powershell/archive/2011/06/03/invoke-expression-considered-harmful.aspx,
1309576469.0,6,self.PowerShell,ieqhc,"I am completely new to powershell, and have been tasked with writing a script.  Any help/advice would be super appreciated",6,0,9,http://www.reddit.com/r/PowerShell/comments/ieqhc/i_am_completely_new_to_powershell_and_have_been/,"[The script I've been tasked with writing](http://pastebin.com/AzPT26cM) needs to check an external FTP server periodically to see when a nightly set of files have been posted.  As I said in the title, I am completely new to powershell, but that said I do have a bit of background programming in C.  I could not find a way to simply use ""Test-Path"" since I am checking an FTP server, so I decided to simply get a full listing of files posted on the server, output that list to a .txt file, then search the text file to see if the files needed have been posted.  I did a bit of googling and found a script written by Jrich [here](http://social.technet.microsoft.com/Forums/en-US/winserverpowershell/thread/20431c47-bf83-4425-963d-c833f491d71b).  The script gets the directory listing I needed, and takes up the bulk of what the below script is.  I simply added a loop so it could run periodically, and then an if-else statement that searches the output .txt file for what I'm looking for.

Naturally, since I'm a bit new to powershell, I don't understand a lot of the syntax used by Jrich.  I just have a couple of questions that someone more well-versed may be able to answer:

1) Will this script disconnect and reconnect to the FTP server with each pass it makes through the loop?  If so, how can I make it stay connected through the duration of the script?  Or vice versa?

2) What does JRich mean when he says ""Allow data to buffer for a bit"" near the beginning of the main script?

~~PS the formatting is a bit wonky when I post it here but I did my best to make it read-able.  If anyone can recommend a place to upload it to make it more read-able I will do so ASAP.~~

Thanks so much for your time anyone who helps :P

EDIT: Uploaded to Pastebin [here](http://pastebin.com/AzPT26cM)

",,False,,t5_2qo1o,True,,,True,t3_ieqhc,http://www.reddit.com/r/PowerShell/comments/ieqhc/i_am_completely_new_to_powershell_and_have_been/,
1309534279.0,4,self.PowerShell,ie9t1,Set Permissions on remote drives [x-post from /r/SysAdmin],5,1,8,http://www.reddit.com/r/PowerShell/comments/ie9t1/set_permissions_on_remote_drives_xpost_from/,"Had this question show up in /r/SysAdmin:  
[Batch file or other script to change security settings on a partition?](http://www.reddit.com/r/sysadmin/comments/ie4vj/batch_file_or_other_script_to_change_security/)  
I thought it was an interesting question and a good place for PowerShell, so I came up with a script and posted this response.  I thought /r/PowerShell might be interested as well; so, copy-pasta:  

[Script is here](http://pastebin.com/xMJvdvxV).  Just provide the parameters for Account (""Domain\Group Name""), Permission(see [MSDN](http://msdn.microsoft.com/en-us/library/system.security.accesscontrol.filesystemrights.aspx) for options), DriveLetter(""E"") and the Computers (Which can be piped in).  
Example:

    Get-Content MyComputers.txt | .\SetDrivePermissions.ps1 `
      -Account ""CONTOSO\Sylver Dragon"" `
      -Permission ""FullControl"" `
      -DriveLetter ""E""

Assuming MyComputers.txt is a text file with a list of computers to change.  
Because I am an AD nut, I would probably just go with:

    $ds = New-object System.DirectoryServices.DirectorySearcher(""LDAP://OU=User Workstations,DC=Contoso,DC=com"")
    $ds.filter = ""(ObjectClass=computer)""
    $Computers = $ds.FindAll() | %{$_.Properties[""cn""]}
    $Computers | .\SetDrivePermissions.ps1 `
      -Account ""CONTOSO\Domain Users"" `
      -Permission ""Modify"" `
      -DriveLetter ""E""

This must be run under an account which has admin access to the computers in question, and can access the admin share for the drive in question (\\computer\e$).  If there are a lot of files/folders on the drive, it may take as while as the inheritance flags are set.

EDIT: Made link to script clearer.",,False,,t5_2qo1o,True,,,True,t3_ie9t1,http://www.reddit.com/r/PowerShell/comments/ie9t1/set_permissions_on_remote_drives_xpost_from/,
1309365742.0,4,blogs.technet.com,icfjg,"Don't Write Scripts, Write Functions!",5,1,0,http://www.reddit.com/r/PowerShell/comments/icfjg/dont_write_scripts_write_functions/,,,False,,t5_2qo1o,False,,,False,t3_icfjg,http://blogs.technet.com/b/heyscriptingguy/archive/2011/06/26/don-t-write-scripts-write-powershell-functions.aspx,
1308774741.0,6,self.PowerShell,i6iny,Small Problem When Exporting Win32 Info To Excel,8,2,6,http://www.reddit.com/r/PowerShell/comments/i6iny/small_problem_when_exporting_win32_info_to_excel/,"I actually have two problems. What i'm trying to do is run a report off of a .txt file with an inventory of computers. 

I've run into a small problem which when the script reports into Excel it replaces the line before it. So when a computer comes that has multiple harddrives i only get one visable readout because it was overwritten in excel. How do i avoid this? I tried throwing $intRow = $intRow + 1 in after that line, it kinda worked but threw everything off kilter.

Also, my processor and physical memory queries do not return anything in Excel. Is this due to a syntax error or am i using something incorrectly?
Thanks, i'm still learning a lot about scripting and PS.
Here is a link to the pastebin. http://pastebin.com/DV3amsdy 

Thanks for your input

*Edit, i'm so close to getting this thing to work properly. Im hitting a problem now where its reporting all the information properly for one machine. It uses the machines name thats next on the list- then gives me all the information from the previous machine for the current machine. The code has been updated on the paste bin.",,False,,t5_2qo1o,True,,,True,t3_i6iny,http://www.reddit.com/r/PowerShell/comments/i6iny/small_problem_when_exporting_win32_info_to_excel/,
1308339576.0,5,powershell.com,i2e47,Easily Add New PowerShell Drives,6,1,1,http://www.reddit.com/r/PowerShell/comments/i2e47/easily_add_new_powershell_drives/,,,False,,t5_2qo1o,False,,,False,t3_i2e47,http://powershell.com/cs/blogs/tips/archive/2011/06/17/adding-new-powershell-drives.aspx,
1308252845.0,5,gallery.technet.microsoft.com,i1hfd,Get-InstalledSoftware,5,0,1,http://www.reddit.com/r/PowerShell/comments/i1hfd/getinstalledsoftware/,,,False,,t5_2qo1o,False,,,False,t3_i1hfd,http://gallery.technet.microsoft.com/scriptcenter/519e1d3a-6318-4e3d-b507-692e962c6666,
1307660405.0,6,self.PowerShell,hvx0x,newb request - Powershell for storage reporting,6,0,7,http://www.reddit.com/r/PowerShell/comments/hvx0x/newb_request_powershell_for_storage_reporting/,"Hi /r/powershell

I'm starting on the journey to learn powershell and I am pretty much at level 0. I've got this book ""Learn Powershell in a month of lunches"" which is pretty good so far.

I recently put together a storage report for my boss and I wanted to brainstorm some ways that powershell could be used to automate portions of my report. My requirement is pretty simple I think:

I want to query our AD domains: corp, corpdev, corptest, corpexternal, corpexternaltest for all member servers and DCs (optionally those which are VMs) and get a list of disk size AND disk size free space

Is this doable? Easily doable? One red flag that I see right away is the different credentials for those domains. 

Really just want to talk about this, get some feedback etc. Thanks!",,False,,t5_2qo1o,False,,,True,t3_hvx0x,http://www.reddit.com/r/PowerShell/comments/hvx0x/newb_request_powershell_for_storage_reporting/,
1307447304.0,5,self.PowerShell,htnz2,Delete Files Question,5,0,12,http://www.reddit.com/r/PowerShell/comments/htnz2/delete_files_question/,"I have a PS script that creates a SQL dump, zips it and then dumps it to a location on our SAN.  We are currently backing up everyday and would like to delete files within specific dates on a rolling basis.
If the file is 0-6 months old, I am keeping every day.  If the file is between 6-12 months old, I want to only keep one backup for the week.  And if it is over 12 months old, I just need to keep one backup per month.
I know I can leverage date created and delete accordingly, but I'm having some problems writing in the validation logic so I don't delete a backup that represents a week or month backup.  Any ideas are greatly appreciated.",,False,,t5_2qo1o,False,,,True,t3_htnz2,http://www.reddit.com/r/PowerShell/comments/htnz2/delete_files_question/,
1306413100.0,4,self.PowerShell,hklma,Questions about scripting environments,5,1,13,http://www.reddit.com/r/PowerShell/comments/hklma/questions_about_scripting_environments/,"Are there any scripting environments out there that will tell you what members are contained in a variable and show them to you on screen?  

For example:  If I create a variable  ""  $Event = get-eventlog -logname security  ""

I would like for the next time I type  "" $Event. ""  to have a pop up detailing a list of methods and properties that are available to this variable type.",,False,,t5_2qo1o,False,,,True,t3_hklma,http://www.reddit.com/r/PowerShell/comments/hklma/questions_about_scripting_environments/,
1306283643.0,6,blogs.msdn.com,hjctf,Powershell Interactive Remoting,6,0,0,http://www.reddit.com/r/PowerShell/comments/hjctf/powershell_interactive_remoting/,,,False,,t5_2qo1o,False,,,False,t3_hjctf,http://blogs.msdn.com/b/powershell/archive/2009/01/13/interactive-remoting-in-ctp3.aspx,
1376534843.0,2,learn-powershell.net,1ke7wl,PowerShell and Events: Permanent WMI Event Subscriptions,5,3,4,http://www.reddit.com/r/PowerShell/comments/1ke7wl/powershell_and_events_permanent_wmi_event/,,,False,,t5_2qo1o,False,,,False,t3_1ke7wl,http://learn-powershell.net/2013/08/14/powershell-and-events-permanent-wmi-event-subscriptions/,
1376351771.0,4,self.PowerShell,1k8r3f,"Would anyone find a ""smart file delete"" script useful? What features should I add?",4,0,5,http://www.reddit.com/r/PowerShell/comments/1k8r3f/would_anyone_find_a_smart_file_delete_script/,"In the environment I'm working in right now, we deal with a lot of web server logs and without getting too into the details, we have identical logs on the web server, a ""hot"" location and a final resting place.  This results in the logs living in 3 different places, and necessitates purging the files older than X days from the web server and hot locations from time to time.  If the sometimes janky backup processes bomb, this Could theoretically result in purging files that haven't yet been backed up since the deletion method is outside of the backup method.   

So, I'm currently writing a smart-purge script that takes a source, destination, and number of days as parameters and checks each file on source older than X days.  If it exists on both source and destination, compares the modified date and sizes of the files.  If they are identical, it deletes the file from source.

I thought someone else might find such a thing useful for either home file management or work environments that are ... similarly non-optimized... and, if so, I'd like to share it if anyone is interested.

I started this evening and I'm mostly done but I thought it would be a good idea to get opinions from anyone who has similar needs if there are additional functions, options, or features I should add to it.  Right now, if the file doesn't exist on the destination it just doesn't delete the file and I'll probably log it or send an email if it runs into issues.

Edit: even if it's been done before by a hundred different people, I decided to finish the script since I was enjoying the process of writing it.  I completed iteration 1, full testing on my local machine.. everything worked great.. then when I decided to test on some live data I encountered an issue where the SAN and server reported different timestamps for the same file, resulting in no objects matching the conditions. 

I reworked the function to get MD5 hashes of the source and backed-up files instead since it was less prone to error.  Still refining my output but the core logic is basically done.

Edit2:  Hit to performance for using hash files is too high, going back to the other method and will determine a proper threshold for acceptable deviance for time.
",[Core],False,,t5_2qo1o,1376438890.0,,,True,t3_1k8r3f,http://www.reddit.com/r/PowerShell/comments/1k8r3f/would_anyone_find_a_smart_file_delete_script/,
1376327129.0,5,self.PowerShell,1k7tfz,"Need a script that will monitor file size, move &amp; warn user when size exceeds ""X""",5,0,6,http://www.reddit.com/r/PowerShell/comments/1k7tfz/need_a_script_that_will_monitor_file_size_move/,"I need to create a script that will query a files size. Then if the size exceeds a certain size to warn user with a popup that the files will be moved to their ""K:"" drive (users cloud storage), transfer the files to said cloud storage and  mklink(shortcut) ntfs symbolic link of the moved file. I do apologize for the poor wording. I'm very new to powershell. I basically just have pseudo-code. Any help would be much appreciated. ",,False,,t5_2qo1o,1376336186.0,,,True,t3_1k7tfz,http://www.reddit.com/r/PowerShell/comments/1k7tfz/need_a_script_that_will_monitor_file_size_move/,
1375806317.0,4,self.PowerShell,1jti9z,New Feature - Link Flair,4,0,1,http://www.reddit.com/r/PowerShell/comments/1jti9z/new_feature_link_flair/,"As a follow up to /u/HandCannon's suggestion of introducing tags to submissions in the sub,  We have now configured the link flair.  

Now after submitting a post to this subreddit there will be a button below the post allowing you to select flair to help target posts to the right audience.

If you have any topics you think should be added to the flair then send a message to the mods and we will look at getting it added in.",,False,,t5_2qo1o,False,,,True,t3_1jti9z,http://www.reddit.com/r/PowerShell/comments/1jti9z/new_feature_link_flair/,moderator
1375206773.0,3,self.PowerShell,1jd25w,i suck at powershell volume 0.1,5,2,4,http://www.reddit.com/r/PowerShell/comments/1jd25w/i_suck_at_powershell_volume_01/,"i am pretty sure this is possible, just not for me, at my current ps skill level. i am looking to create a script that will email me a time stamp when a particular user logs onto the network for the first time each morning for a specific set of dates? any pointers/help greatly appreciated.",,False,,t5_2qo1o,False,,,True,t3_1jd25w,http://www.reddit.com/r/PowerShell/comments/1jd25w/i_suck_at_powershell_volume_01/,
1374703403.0,4,self.PowerShell,1izidm,Search string within files!,5,1,7,http://www.reddit.com/r/PowerShell/comments/1izidm/search_string_within_files/,"Hi guys, could someone let me know if it's possible to search for a specific string across a multitude of file types. I know the select-string parameter works for text files but I need to search a string inside: 

.pdf,.txt,.csv,.doc,.docx,.dotx,.xls,.xlsx.

Is there a way to get powershell to search a string within all these file types?",,False,,t5_2qo1o,False,,,True,t3_1izidm,http://www.reddit.com/r/PowerShell/comments/1izidm/search_string_within_files/,
1374589965.0,3,self.PowerShell,1ivwbv,[Script help] Trying to view CPU util per core in powershell,6,3,3,http://www.reddit.com/r/PowerShell/comments/1ivwbv/script_help_trying_to_view_cpu_util_per_core_in/,"Anybody know how to get CPU utilization per core? I can only find references for how to do this per socket:

  &gt; Get-WmiObject win32_processor | select SocketDesignation, DeviceId,LoadPercentage

  SocketDesignation                       DeviceId                                                         LoadPercentage
  -----------------                       --------                                                         --------------
  Proc 1                                  CPU0                                                                          0
  Proc 2                                  CPU1                                                                          0


  &gt; Get-WmiObject win32_processor | ft deviceid,numberofcores,numberoflogicalprocessors
  
  deviceid                                                          numberofcores               numberoflogicalprocessors
  --------                                                          -------------               -------------------------
  CPU0                                                                          6                                      12
  CPU1                                                                          6                                      12

On the monster CPUs out there these days, this doesn't help much. I could have a single threaded process jam up a whole core here and only read 16% utilized. On a 16 core, you would never see it.

Thanks!",,False,,t5_2qo1o,False,,,True,t3_1ivwbv,http://www.reddit.com/r/PowerShell/comments/1ivwbv/script_help_trying_to_view_cpu_util_per_core_in/,
1374462728.0,4,self.PowerShell,1iseti,Copy folder structure!,4,0,7,http://www.reddit.com/r/PowerShell/comments/1iseti/copy_folder_structure/,"Hi there reddit,

I wrote a basic search script which exports my results to a text file. I want to use paths in the text file to copy all results into a different folder. My dilemma is that I need to copy the entire folder structure not just the files and I can't get it going. I played with robocopy and xcopy and I'm not sure if I just keep doing it wrong but it still only copies individual items not the entire structure no matter what parameters I assign to the command. 

I tried below but neither of them generate desired results.

    get-content H:\Scripts\Filter.txt | foreach-object{ copy-item -Path $_ -destination H:\Scripts}

    get-content H:\Scripts\Filter.txt | foreach-object{ xcopy $_ H:\Scripts /E /C /I /F /R /Y}

Could you please point me in the right direction, the structure of the exported paths can be seen below: ( I also assume I need to filter out the drive letter right?)

H:\Downloads\1.exe

H:\mleach\My Documents\My Pictures\sample.jpg

H:\My Pictures\Chrysanthemum.jpg

H:\My Pictures\Desert.jpg



Basically if I want to copy H:\My Pictures\Untitled.jpg to H:\Scripts the result should look like this H:\Scripts\My Pictures\Untitled.jpg but at the moment I can only get it to do H:\Scripts\Untitled.jpg

Thanks in advance for any help.",,False,,t5_2qo1o,1374463174.0,,,True,t3_1iseti,http://www.reddit.com/r/PowerShell/comments/1iseti/copy_folder_structure/,
1374252052.0,4,self.PowerShell,1in25u,Combine Get-Mailbox with Get-MailboxStatistics to display a chart using information from both?,4,0,7,http://www.reddit.com/r/PowerShell/comments/1in25u/combine_getmailbox_with_getmailboxstatistics_to/,"This may be an easy one, as I'm somewhat of a powershell weenie, but I want to display information from Exchange mailboxes that includes the User's name, their total mailbox size, whether they are over the quota or not, and what their prohibit send quota actually is.

However, TotalItemSize and StorageLimitStatus has to be pulled from Get-mailboxStatistics, and ProhibitSendQuota has to be pulled from Get-Mailbox.

&gt;get-mailboxdatabase ""mailbox database"" | Get-mailbox | sort totalitemsize -desc | ft Displayname, totalitemsize, storagelimitstatus, ProhibitSendQuota

Returns a chart with all the proper headers of course, but only populates DisplayName and ProhibitSendQuota.

&gt;get-mailboxdatabase ""mailbox database"" | Get-mailboxstatistics | sort totalitemsize -desc | ft
 Displayname, totalitemsize, storagelimitstatus, ProhibitSendQuota

This of course does the opposite, populating DisplayName, TotalItemSize, and StorageLimitStatus, but not ProhobitSendQuota.

It doesn't seem to be as easy as just Get-mailbox | get-mailboxstatics. How can I pull data from both of these cmdlets to populate the full chart?",,False,,t5_2qo1o,False,,,True,t3_1in25u,http://www.reddit.com/r/PowerShell/comments/1in25u/combine_getmailbox_with_getmailboxstatistics_to/,
1374012166.0,5,self.PowerShell,1ifzb4,Why won't my logon script run from a Group Policy,5,0,22,http://www.reddit.com/r/PowerShell/comments/1ifzb4/why_wont_my_logon_script_run_from_a_group_policy/,"I couldn't find any resource(subreddit search, google, etc) on this subject that match my needs. No one apparently has problems with this. :/

Domain operation Level: 2008 r2

Client: Windows 7 Pro

Problem: I created a group policy that should run one script at the user's logon. It doesn't run.

Diag so far: I have singed my script with a code signing cert from my CA. I have set execution level to allay any powershell script to run. I can run the script on the workstation just fine.

I have three methods of determining if the script ran. Two that tell me if it ran, but couldn't save to the network share.
Neither the popup pops up, not the log is created.

If I run the script from the workstation, it runs fine.

The GPO has the defaults plus Domain Users included in the Delegation and without, with Read access to this GPO.

The script is ran like this from the GPO in the Scripts tab: C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -noexit &amp;'\\\server\NETLOGON\save-pcinfo.ps1'
I also tried running the script from the PowerShell Scripts tab, but that does the same thing.
I can run my other .cmd script just fine, just not powershell scripts. :/

I have added other items in the GPO, create a blank file in C:\temp. That gets created. The GPO gets executed as Group Policy Results states that it was applied.


The script is as follows:

    #variables for site
    $centLocation = ""\\server\share\login\hosts.info""
    
    #get needed info for AD
    $name = (get-wmiobject win32_OperatingSystem).__SERVER
    $serial = (Get-wmiobject win32_bios serialnumber).SerialNumber
    $model = (Get-wmiobject Win32_ComputerSystem Model).Model
    $user = (Get-ItemProperty 'hklm:\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\LogonUI\' -Name LastLoggedOnSAMUser).LastLoggedOnSAMUser
    
    #save needed to centLocation
    Get-Content $centLocation | Where-Object {$_ -notmatch ""$serial""} | Out-File $centLocation
    $name + "","" + $serial + "","" + $user + "","" + $model| Out-File -Append $centLocation
    
    #My Diag
    
    #make a popup
    $a = get-content env:username
    if ($a -eq ""spyingwind"")
    {
    $a = new-object -comobject wscript.shell
    $b = $a.popup(""spyingwind"",0,""You are"",1)
    }
    
    #Make a log file
    $msg = ""$(Get-Date -format 'u'): save-pcinfo.ps1 Finished.""
    $msg | Out-File c:\temp\pcinfo.txt



Edit: updated with correct \\

Edit2: Moving the script to the Computer Config on Startup runs the script. I've tried adding Domain Users to the Policy, but that didn't change a thing. Adding Loopback as TheMuffnMan suggested, just caused the test machine to take longer to login than normal.

As a treat here is the other half of the script that runs on a schedule on a server.

    import-module ActiveDirectory
    $centLocation = ""\\server\share\login\hosts.info""
    $header = ""COMP"",""SERI"",""USER"",""MODEL""
    $cont = (Get-Content $centLocation); $cont = $cont[0], $cont[1]; $cont = $centLocation
    
    $contH = Import-Csv $centLocation -Header $header
    Foreach ( $line in $contH ) {
    	$comp = $line.COMP
    	$serial = $line.SERI
        $user = $line.USER
        $model = $line.MODEL
        $desc = $serial + "" - "" + $user + "" - "" + $model
    	Set-ADComputer $comp -Description $desc
    }

Edit3:

Found the actual fix for this. Instead of ""-noexit &amp;'\\..."" it shouldof been ""-file '\\...""",,False,,t5_2qo1o,1374092763.0,,,True,t3_1ifzb4,http://www.reddit.com/r/PowerShell/comments/1ifzb4/why_wont_my_logon_script_run_from_a_group_policy/,
1373143167.0,4,self.PowerShell,1hrl7g,Using PowerShell Studio 2012 - Save &amp; Export CSV,5,1,6,http://www.reddit.com/r/PowerShell/comments/1hrl7g/using_powershell_studio_2012_save_export_csv/,"So, I have a application that I'm building and when I run a query of machines (based on dns or ip) it returns values to the appropriate fields and then when I click on my export to csv button is where the problem lies.

When i run the .pff in PowerShell Studio 12 it works fine, it takes bit to query as well, but not sure what that's about either.  But when I export it to an application it and run the query it works but when I run the export it either locks up or crashes.  Can someone take look at the following code and see if you see anything enhancements that could be made to the speed and this issue of exporting?

Thanks a lot!!!!

Here's the Code
    
    $global:Euros
    $global:PCProcessor 
    $global:cred
    $global:PCBios
    $global:PCMemory
    $global:PCHDTotal
    $global:PCHDFree
    $global:PCLocalAdmins
    $global:PCPrinters
    $global:DirectoryToSave



    function OnApplicationLoad {
    	    #Note: This function is not called in Projects
	    #Note: This function runs before the form is created
	    #Note: To get the script directory in the Packager use: Split-            Path $hostinvocation.MyCommand.path
	    #Note: To get the console output in the Packager (Windows Mode) use: $ConsoleOutput (Type: System.Collections.ArrayList)
	    #Important: Form controls cannot be accessed in this function
	    #TODO: Add snapins and custom code to validate the application load
	
	    return $true #return true for success or false for failure
    }

    function GetComputerProcessor {
	    param ($PCName)
	    $value = (Get-WmiObject Win32_Processor -ComputerName $PCName).Name 
	    $global:PCProcessor = $value
    }

    function GetComputerBios {
        	param ($PCName)
	    $value = (Get-WmiObject Win32_Bios -ComputerName $PCName).Name
	    $global:PCBios = $value
    }

    function GetComputerMemory {
	    param ($PCName)
	    $value = (Get-WmiObject Win32_PhysicalMemory -ComputerName $PCName).Capacity / 1048576
	    $global:PCMemory = $value
    }

    function GetComputerHDTotal {
	    param ($PCName)
	    $value = (Get-WmiObject win32_logicaldisk -filter “drivetype=3” -ComputerName $PCName).size
	    $value -as [int]
	    $value = $value / 1048576
	    $global:PCHDTotal = $value
    }


    function GetComputerHDFree {
        	param ($PCName)
	    $value = (Get-WmiObject win32_logicaldisk -filter “drivetype=3” -ComputerName $PCName).FreeSpace  
	    $value -as [int]
	    $value = $value / 1048576
	    $global:PCHDFree = $value
    }

    function GetComputerPrinters {
	    param ($PCName)
	    $value = (Get-WmiObject Win32_Printer -ComputerName $PCName).Name  
	    $global:PCPrinters = $value
    }

    function get-localadmin {  
    param ($PCName)  
  
    $admins = Gwmi win32_groupuser –computer $PCName       
    $admins = $admins |? {$_.groupcomponent –like '*""Administrators""'}  
  
    $value = $admins |% {  
    $_.partcomponent –match “.+Domain\=(.+)\,Name\=(.+)$” &gt; $nul  
    $matches[1].trim('""') + “\” + $matches[2].trim('""')      
    }  

    $global:PCLocalAdmins = $value
    }

    function ExportComputerInfo {
	    Param($global:DirectoryToSave)
    $global:table=@""
	    ""PCProcessor"",""PCBios"",""PCMemory"",""PCHDTotal"",""PCHDFree"",""PCPrinters"",""PCLocalAdmins""
	        ""$global:PCProcessor"",""$global:PCBios"",""$global:PCMemory"",""$global:PCHDTotal"",""$global:PCHDFree"",""$global:PCPrinters"",""$global:PCLocalAdmins""
    ""@	

        	$global:table&gt;&gt;$global:DirectoryToSave
    }


    Function Get-FileName($initialDirectory)
    {   
     [System.Reflection.Assembly]::LoadWithPartialName(""System.windows.forms"") |
     Out-Null

     $SaveFileDialog = New-Object System.Windows.Forms.SaveFileDialog
     $SaveFileDialog.initialDirectory = $initialDirectory    
     $SaveFileDialog.filter = ""All files (*.*)| *.*""
     $SaveFileDialog.ShowDialog() | Out-Null
     $SaveFileDialog.FileName
    } #end function Get-FileName





    function OnApplicationExit {
        	#Note: This function is not called in Projects
	    #Note: This function runs after the form is closed
        	#TODO: Add custom code to clean up and unload snapins when the application exits
	
	    $script:ExitCode = 0 #Set the exit code for the Packager
    }

    $formCurrencyConversion_Load={    
        	#TODO: Initialize Form Controls here
	
    }

    $labelConvertFromBritishPo_Click={
        	#TODO: Place custom script here
	
    }




    $form1_Load={
        	#TODO: Initialize Form Controls here
	
    }


    $buttonQuery_Click={
    #TODO: Place custom script here
    #TODO: Place custom script here
    #$global:cred = Get-Credential
    $PCName = Read-Host ""Please enter the computer name:""
    GetComputerProcessor $PCName
    GetComputerBios $PCName
    GetComputerMemory $PCName
    GetComputerHDTotal $PCName
    GetComputerHDFree $PCName
    get-localadmin $PCName
    GetComputerPrinters $PCName
	
    $Result =  “$Global:PCProcessor”
	
    $textbox1.Text = ""$Result""

    $Result = ""$Global:PCBios""
    $textbox2.Text = ""$Result""
	
    $Result = ""$Global:PCMemory""
    $textbox3.Text = ""$Result""
	
    $Result = ""$global:PCHDTotal""
    $textbox4.Text = ""$Result""
	
    $Result = ""$global:PCHDFree""
    $textbox5.Text = ""$Result""

    $Result = ""$global:PCLocalAdmins""
    $Textbox6.Text = ""$Result""
	
    $Result = ""$global:PCPrinters""
    $Textbox7.Text = ""$Result""
	

    $formPCInfo.Refresh
	
    }

    $buttonExportCSV_Click={
    	    #TODO: Place custom script here
	
	    # *** Entry Point to Script ***

    $global:DirectoryToSave = Get-FileName -initialDirectory ""c:\""
	
	    ExportComputerInfo $global:DirectoryToSave
    }
",,False,,t5_2qo1o,False,,,True,t3_1hrl7g,http://www.reddit.com/r/PowerShell/comments/1hrl7g/using_powershell_studio_2012_save_export_csv/,
1373013364.0,5,self.PowerShell,1hokc6,New-webbinding asks for name?,5,0,2,http://www.reddit.com/r/PowerShell/comments/1hokc6/newwebbinding_asks_for_name/,"I have done some csv files that are imported and used with the new-webbinding cmdlet. Problem I have is that it always asks for a name even if it is written in the CSV file.
CSV File:  
Name,Port,Hostheader  
bla.test.com,80,bla.test.com  
bla.test.com,80,bla2.test.com 

Import-CSV CSVfile | new-webbinding
It then asks for a name, but I can write asdf and it still executes the CSV file correctly. But I don't want it to ask for a name at all because it's written in the CSV.

I have done the same with new-website and that works fine and looks just like this but with the new-website attributes. ",,False,,t5_2qo1o,False,,,True,t3_1hokc6,http://www.reddit.com/r/PowerShell/comments/1hokc6/newwebbinding_asks_for_name/,
1372971625.0,3,self.PowerShell,1hnlax,Grouping and retrieving objects from Invoke-Command in a remote session,4,1,2,http://www.reddit.com/r/PowerShell/comments/1hnlax/grouping_and_retrieving_objects_from/,"Regarding the following code:

---

    foreach ($bjob in $backupJobs) {
        $server  = $bjob -replace ""==.*""
        $jobname = $bjob -replace "".*==""
        $s = New-PSSession -ComputerName $server -SessionOption (New-PSSessionOption -NoMachineProfile)
        $out += Invoke-Command -session $s {
            Import-Module ""C:\Program Files\Symantec\Backup Exec\Modules\BEMCLI\BEMCLI""
            $NfJob = Get-BEjob -Name $args[0] | Get-BEJobHistory -FromLastJobRun -JobType Backup
            $NFJob | select -Property Name,JobStatus,StartTime,EndTime,ElapsedTime,TotalDataSizeBytes 
        } -Args $jobname
        Remove-PSSession -session $s
    }
    
    $out | ft -wrap

---

The last line returns just the last set of objects in $NFJob into $out, even though I am using += to group them. What am I missing? Thanks!

**SOLVED**: I needed to add $out = @() at the start, to define the object as an array.",,False,,t5_2qo1o,1372974659.0,,,True,t3_1hnlax,http://www.reddit.com/r/PowerShell/comments/1hnlax/grouping_and_retrieving_objects_from/,
1372877605.0,4,self.PowerShell,1hl18s,Folder Permissions,5,1,4,http://www.reddit.com/r/PowerShell/comments/1hl18s/folder_permissions/,"I have a PS script that creates a folder and then adds 2 folders inside it. The permissions are set on each folder after it is created. The permissions are being set properly but they don't show on the main security tab. I have to go into advanced and look at the special permissions. Is there a way to get powershell to tick say the modify box on the security tab instead of creating a special permission. 

Thanks for any assistance.


Here is a link to the code at PasteBin http://pastebin.com/sMjRBBfs

",,False,,t5_2qo1o,False,,,True,t3_1hl18s,http://www.reddit.com/r/PowerShell/comments/1hl18s/folder_permissions/,
1372871791.0,6,self.PowerShell,1hktkn,How to set a variable based on the value of another?,6,0,8,http://www.reddit.com/r/PowerShell/comments/1hktkn/how_to_set_a_variable_based_on_the_value_of/,"I have a scriplet that prompts user input for a value. I know the input is going to be one of 7 things, so I'd like to add some sort of component to set a different variable.

To illustrate it, I'm looking for something like this
&gt; $Var1 = Read-Host ""Enter value""

&gt; if $Var1 = ""1"", set-variable $Var2=""A""

&gt; if $Var1 = ""2"", set-variable $Var2=""B""

&gt; if $Var1 = ""3"", set-variable $Var2=""C""

&gt; ...

My brain says PS should be able to do this, but I'm coming up empty handed on how to actually set the 2nd variable value. Does anyone have any pointers for me?
",,False,,t5_2qo1o,False,,,True,t3_1hktkn,http://www.reddit.com/r/PowerShell/comments/1hktkn/how_to_set_a_variable_based_on_the_value_of/,
1372093416.0,3,self.PowerShell,1gz8bh,Basic question scripting commands to run in a remote ps-session,4,1,15,http://www.reddit.com/r/PowerShell/comments/1gz8bh/basic_question_scripting_commands_to_run_in_a/,"I'm very new to Powershell, and I'm probably going about this in the wrong way. But can anyone tell me what is wrong with this script?

I am attempting to begin a PSSession on a remote server, check the reboot time, return that value, and then possibly repeat the process. For some reason, the reboot time reports the local machine's reboot time, not the far end.

    do {
        clv svr
        cls
        $account= Read-Host 'Account Name'
        $server = Read-Host 'Server Name'
        Enter-PSSession -ComputerName $server -Credential $account
        cls
        Write-Host """"
        Write-Host $server was last rebooted at the following time:
        Get-EventLog system | 
            ? { $_.EventId -eq 6009 } | 
            select -first 1 | 
            % { $_.TimeGenerated }
        Exit-PSSession
        Write-Host """"
        $response = read-host ""Repeat? (Y/N)""
    }
    while ($response -eq ""Y"")


Do I need to use invoke-command instead?

I'm trying to get the commands to actually execute in the remote session so that when I want to write more complicated scripts that run multiple commands on the remote host I can keep things as simple as possible.",,False,,t5_2qo1o,False,,,True,t3_1gz8bh,http://www.reddit.com/r/PowerShell/comments/1gz8bh/basic_question_scripting_commands_to_run_in_a/,
1371830749.0,4,self.PowerShell,1gsu9x,Some Hyper-V commands don't work for Win 8 Hyper-V?,6,2,3,http://www.reddit.com/r/PowerShell/comments/1gsu9x/some_hyperv_commands_dont_work_for_win_8_hyperv/,"**SOLVED, always import the module before you try a command!  Thanks /u/Agressiv**

  I've been working on a script based method to standardize my VM lab on whatever hardware I move to, but I'm running into a hitch.

  I've found that with Windows 8 Hyper-V, I can't use the Get-VM command to see which VMs are running on my host for some reason.  

  I can use Get-VMHost to return my host, but Get-VM doesn't return any output at all.  Can anyone else verify this behavior?",,False,,t5_2qo1o,1372018483.0,,,True,t3_1gsu9x,http://www.reddit.com/r/PowerShell/comments/1gsu9x/some_hyperv_commands_dont_work_for_win_8_hyperv/,
1371587207.0,3,self.PowerShell,1glwd0,check_mk extension for windows SMART monitoring,5,2,0,http://www.reddit.com/r/PowerShell/comments/1glwd0/check_mk_extension_for_windows_smart_monitoring/,"I am running Check_MK and I would like to extend it to be able to monitor SMART HDD status in windows.  CMK runs an agent on the machine that provides text information to the nagios server via telnet; The output is then interpreted by scripts on the nagios host.  You can add information to the agent output by placing scripts in the cmk scripts folder on each client.  My script uses smartmontools smartctl and produces the correct output.  On my windows 7 hosts, smartctl can be run without admin access and grab the required data.  On windows 8, it cannot.  On windows 8, smartctl must be run as admin in order to produce output.


------
output on 7(admin or user)/8(admin only):

     &lt;&lt;&lt;smart&gt;&gt;&gt;
     HDD0 ATA WDC_WD5000BEVT-00ZAT0   1 Raw_Read_Error_Rate     0x002f   200   200   051    Pre-fail  Always       -       299
     HDD0 ATA WDC_WD5000BEVT-00ZAT0   3 Spin_Up_Time            0x0027   184   181   021    Pre-fail  Always       -       1766
     HDD0 ATA WDC_WD5000BEVT-00ZAT0   4 Start_Stop_Count        0x0032   097   097   000    Old_age   Always       -       3654
     HDD0 ATA WDC_WD5000BEVT-00ZAT0   5 Reallocated_Sector_Ct   0x0033   200   200   140    Pre-fail  Always       -       0
     HDD0 ATA WDC_WD5000BEVT-00ZAT0   7 Seek_Error_Rate         0x002e   100   253   000    Old_age   Always       -       0
     HDD0 ATA WDC_WD5000BEVT-00ZAT0   9 Power_On_Hours          0x0032   085   085   000    Old_age   Always       -       11474
     HDD0 ATA WDC_WD5000BEVT-00ZAT0  10 Spin_Retry_Count        0x0033   100   100   051    Pre-fail  Always       -       0
     HDD0 ATA WDC_WD5000BEVT-00ZAT0  11 Calibration_Retry_Count 0x0032   100   100   000    Old_age   Always       -       0
     HDD0 ATA WDC_WD5000BEVT-00ZAT0  12 Power_Cycle_Count       0x0032   097   097   000    Old_age   Always       -       3504
     HDD0 ATA WDC_WD5000BEVT-00ZAT0 192 Power-Off_Retract_Count 0x0032   198   198   000    Old_age   Always       -       1864
     HDD0 ATA WDC_WD5000BEVT-00ZAT0 193 Load_Cycle_Count        0x0032   039   039   000    Old_age   Always       -       485689
     HDD0 ATA WDC_WD5000BEVT-00ZAT0 194 Temperature_Celsius     0x0022   103   093   000    Old_age   Always       -       44
     HDD0 ATA WDC_WD5000BEVT-00ZAT0 196 Reallocated_Event_Count 0x0032   200   200   000    Old_age   Always       -       0
     HDD0 ATA WDC_WD5000BEVT-00ZAT0 197 Current_Pending_Sector  0x0032   200   200   000    Old_age   Always       -       0
     HDD0 ATA WDC_WD5000BEVT-00ZAT0 199 UDMA_CRC_Error_Count    0x0032   200   200   000    Old_age   Always       -       0
------
------
output as administrative user (not run as admin) on windows 8:
 
     &lt;&lt;&lt;smart&gt;&gt;&gt;

-----

Now, here's the catch... output from these scripts must output to the current shell, if they open a new shell, output, and close, cmk will not catch it.  I should be able to runas administrator, dump the output to a file, and then have the script read the output file in the current shell, but I cannot believe that windows does not have a way to run an elevated process in the current shell, and I really don't want to write a file to the HDD once a minute for no godly reason.

------
contents of ""cmk-powerchecks.bat"" (to set executionpolicy at runtime):

     @ECHO OFF
     mode con:cols=150 lines=130
     powershell -ExecutionPolicy RemoteSigned ""&amp; """".\smart.ps1""""""
------
------
contents of ""smart.ps1"" (to do the heavy lifting):

     $env:Path = $env:Path + "";C:\Program Files\smartmontools\bin\;C:\Program Files (x86)\smartmontools\bin\""
     echo ""&lt;&lt;&lt;smart&gt;&gt;&gt;""

     try{
          $MODEL = smartctl -a /dev/sda | select-string -pattern ""device model"" | %{$_.Line -replace "" "", ""_""} | %{$_ -Split(""_"",3)} | select-string -pattern ""_"" | %{$_.Line.Substring(4)}
          smartctl -A /dev/sda | select-string -pattern ""Always"" | foreach-object {%{""HDD0 ATA "" + $MODEL + "" "" + $_}}
     }catch{}finally{}

     try{
          $MODEL = smartctl -a /dev/sdb | select-string -pattern ""device model"" | %{$_.Line -replace "" "", ""_""} | %{$_ -Split(""_"",3)} | select-string -pattern ""_"" | %{$_.Line.Substring(4)}
          smartctl -A /dev/sdb | select-string -pattern ""Always"" | foreach-object {%{""HDD0 ATA "" + $MODEL + "" "" + $_}}
     }catch{}finally{}

     try{
          $MODEL = smartctl -a /dev/sdc | select-string -pattern ""device model"" | %{$_.Line -replace "" "", ""_""} | %{$_ -Split(""_"",3)} | select-string -pattern ""_"" | %{$_.Line.Substring(4)}
          smartctl -A /dev/sdc | select-string -pattern ""Always"" | foreach-object {%{""HDD0 ATA "" + $MODEL + "" "" + $_}}
     }catch{}finally{}

     try{
          $MODEL = smartctl -a /dev/sdd | select-string -pattern ""device model"" | %{$_.Line -replace "" "", ""_""} | %{$_ -Split(""_"",3)} | select-string -pattern ""_"" | %{$_.Line.Substring(4)}
          smartctl -A /dev/sdd | select-string -pattern ""Always"" | foreach-object {%{""HDD0 ATA "" + $MODEL + "" "" + $_}}
     }catch{}finally{}

     try{
          $MODEL = smartctl -a /dev/sde | select-string -pattern ""device model"" | %{$_.Line -replace "" "", ""_""} | %{$_ -Split(""_"",3)} | select-string -pattern ""_"" | %{$_.Line.Substring(4)}
          smartctl -A /dev/sde | select-string -pattern ""Always"" | foreach-object {%{""HDD0 ATA "" + $MODEL + "" "" + $_}}
     }catch{}finally{}

     try{
          $MODEL = smartctl -a /dev/sdf | select-string -pattern ""device model"" | %{$_.Line -replace "" "", ""_""} | %{$_ -Split(""_"",3)} | select-string -pattern ""_"" | %{$_.Line.Substring(4)}
          smartctl -A /dev/sdf | select-string -pattern ""Always"" | foreach-object {%{""HDD0 ATA "" + $MODEL + "" "" + $_}}
     }catch{}finally{}

     try{
          $MODEL = smartctl -a /dev/sdg | select-string -pattern ""device model"" | %{$_.Line -replace "" "", ""_""} | %{$_ -Split(""_"",3)} | select-string -pattern ""_"" | %{$_.Line.Substring(4)}
          smartctl -A /dev/sdg | select-string -pattern ""Always"" | foreach-object {%{""HDD0 ATA "" + $MODEL + "" "" + $_}}
     }catch{}finally{}

     try{
          $MODEL = smartctl -a /dev/sdh | select-string -pattern ""device model"" | %{$_.Line -replace "" "", ""_""} | %{$_ -Split(""_"",3)} | select-string -pattern ""_"" | %{$_.Line.Substring(4)}
           smartctl -A /dev/sdh | select-string -pattern ""Always"" | foreach-object {%{""HDD1 ATA "" + $MODEL + "" "" + $_}}
     }catch{}finally{}

-------
tl/dr: can you run a script, with elevated privileges, and output to the current shell? (sudo ./smart.ps1)

",,False,,t5_2qo1o,False,,,True,t3_1glwd0,http://www.reddit.com/r/PowerShell/comments/1glwd0/check_mk_extension_for_windows_smart_monitoring/,
1371238485.0,6,self.PowerShell,1gcvyr,get-casmailbox and output-csv,6,0,5,http://www.reddit.com/r/PowerShell/comments/1gcvyr/getcasmailbox_and_outputcsv/,"So I'm working on a script that will assist us with some auditing duties and part of it is to get a list of users who have ActiveSync enabled. The following would give me a nicely formatted table in column layout:  

     get-casmailbox -identity bwonga |ft ActiveSyncEnabled, SamAccountName |out-file activesync.txt    

I would love to get a csv output out of this but if I change this to

    get-casmailbox |ft Samaccountname, activesyncenabled -auto | export-csv activesync.csv -notype

Then I don't get any data in my csv file.  If I just do:

    get-casmailbox | export-csv activesync.csv -notype

Then my file contains a lot more columns than is just output with get-casmailbox (when output to the terminal).

Has anyone experienced this before or what I could do to only get sAmAccountName and ActiveSyncEnabled to a csv?",,False,,t5_2qo1o,False,,,True,t3_1gcvyr,http://www.reddit.com/r/PowerShell/comments/1gcvyr/getcasmailbox_and_outputcsv/,
1371043229.0,6,self.PowerShell,1g6z76,"Finding a service ""log on""-user.",6,0,8,http://www.reddit.com/r/PowerShell/comments/1g6z76/finding_a_service_log_onuser/,For a service:   How to find which user a service is set up to log on as?,,False,,t5_2qo1o,False,,,True,t3_1g6z76,http://www.reddit.com/r/PowerShell/comments/1g6z76/finding_a_service_log_onuser/,
1370887305.0,5,self.PowerShell,1g24db,Import .CSV into Outlook contacts.,5,0,5,http://www.reddit.com/r/PowerShell/comments/1g24db/import_csv_into_outlook_contacts/,"Is there anyway to write a script that does exactly this: 

http://www.csus.edu/saclink/email/importaddresses.stm

Would very much appreciate it if it is possible or if anyone can send me anywhere with information on completing this task.

Thanks!",,False,,t5_2qo1o,False,,,True,t3_1g24db,http://www.reddit.com/r/PowerShell/comments/1g24db/import_csv_into_outlook_contacts/,
1370637800.0,4,self.PowerShell,1fvx9y,"Powershell Uninstall Script, I gave up, can you show me where I went wrong?",4,0,4,http://www.reddit.com/r/PowerShell/comments/1fvx9y/powershell_uninstall_script_i_gave_up_can_you/,"Hey guys! I've been using Powershell for a while now and even though I'm not 100% technical on the ins and outs of PS, I had a quick project that I needed to uninstall an application/service from 300+ workstations and figured PS was the way to go as I've used it before.

So the problem, the application wasn't showing up when I would perform Get-WMIObject queries, the application was also not installed using an MSI file and repackaging it as an MSI file wasn't helping either.

I quickly discovered that if I executed the following in command line, it would successfully remove the application using the app's own uninstaller executable:

    C:\Program Files\application\unins000.exe /Silent

So I wrote a quick script in PS to attempt to perform this action, but every time I ran it, the script would either appear to exit successfully or it would give me some errors which all seemed to be more from my lack of experience with flags and operators than anything. 

Here's the script:

    $servers = Get-Content serverlist.txt
    $command = &amp; ""C:\Program Files\app\unins000.exe"" /Silent
    
    foreach($server in $servers){
    Invoke-Command -ComputerName $server -ScriptBlock {$command}}

That's pretty much the bulk of the issue at hand, I have more for the script but it's mostly for logging and installing the new application (which was thankfully packaged in a nice MSI file). 

I had a PS Shell open on my own workstation and this string worked perfectly for me:

    &amp; ""C:\Program Files\app\unins000.exe"" /Silent

But go and throw it in the above and nothing was working :-/

I ended up using PSTools with the following one-liner, but I want to know where I went wrong in Powershell and how I can fix it for future reference

    psexec.exe @list.txt ""C:\Program Files\app\unins000.exe"" /Silent",,False,,t5_2qo1o,False,,,True,t3_1fvx9y,http://www.reddit.com/r/PowerShell/comments/1fvx9y/powershell_uninstall_script_i_gave_up_can_you/,
1370537348.0,4,self.PowerShell,1fstah,"Favorite Ways to Handle ""Logging""?",4,0,3,http://www.reddit.com/r/PowerShell/comments/1fstah/favorite_ways_to_handle_logging/,"Generally, my favorite way to handle logging is wrapping the `.ps1` in a `.bat` that redirects the output e.g.  

    powershell -noprofile -c ""&amp; %PSFILE%"" &gt;&gt; %location%\logs\%logFIle% 2&gt;&amp;1 

However, this often requires this stdin/stderr fix for PS v2:

	$bindingFlags = [Reflection.BindingFlags] “Instance,NonPublic,GetField”
	$objectRef = $host.GetType().GetField(“externalHostRef”, $bindingFlags).GetValue($host)

	$bindingFlags = [Reflection.BindingFlags] “Instance,NonPublic,GetProperty”
	$consoleHost = $objectRef.GetType().GetProperty(“Value”, $bindingFlags).GetValue($objectRef, @())

	[void] $consoleHost.GetType().GetProperty(“IsStandardOutputRedirected”, $bindingFlags).GetValue($consoleHost, @())
	$bindingFlags = [Reflection.BindingFlags] “Instance,NonPublic,GetField”
	$field = $consoleHost.GetType().GetField(“standardOutputWriter”, $bindingFlags)
	$field.SetValue($consoleHost, [Console]::Out)
	$field2 = $consoleHost.GetType().GetField(“standardErrorWriter”, $bindingFlags)
	$field2.SetValue($consoleHost, [Console]::Out)

Then I generally handle writing to a ""log"" by just letting stuff fall through the pipe to write-output

    ""$(Get-Date -f 'yyyyMMdd-HHmmss') INFO | DOING SOMETHING""

I really like this because it handles any errors I might forget to grab in a `try/catch/fail`. 

**However**, letting stuff fall through the pipe can have one PITA problem -- if you're returning objects.

Take the following example of code that would cause issues:

    $disksToUse = Foreach ($disk in $disks) {
	if ($archiveLocationsRoots -contains $disk.DeviceID)
	{
		$diskTotal += $disk.Freespace
		
		$percentageFreeSpace = ($disk.FreeSpace / $disk.Size)
		if ($percentageFreeSpace -le 0.95)
		{
			(Get-Date -f ""yyyMMdd-HHmmss"") + "" WARNING! The amount of free space in $($disk.DeviceID) is only $percentageFreeSpace - $($disk.FreeSpace/1024/1024/1024) GB free of $($disk.Size/1024/1024/1024) GB total.""
		} else {
			(Get-Date -f ""yyyMMdd-HHmmss"") + "" The amount of free space in $($disk.DeviceID) is $percentageFreeSpace - $($disk.FreeSpace/1024/1024/1024) GB free of $($disk.Size/1024/1024/1024) GB total.""
		}
		$disk | Select *,@{N=""percentageFreeSpace"";E={$percentageFreeSpace}}
	}

The alternative would be to re-write the application logic to perform another query against the returned data *afterwards*.

**I realize** that common solutions are to use `Start-Transcript` or using a custom `Write-ToLogFile` that just uses `Set-Content -Append`. However, the one thing I don't like about that approach is it won't capture any errors I might have foolishly not tried to handle. I'm also not a huge fan of the output from `Start-Transcript` as I often don't really want to see such a cluttered log.

",,False,,t5_2qo1o,False,,,True,t3_1fstah,http://www.reddit.com/r/PowerShell/comments/1fstah/favorite_ways_to_handle_logging/,
1370526753.0,4,self.PowerShell,1fsfwd,Escalating privileges,4,0,13,http://www.reddit.com/r/PowerShell/comments/1fsfwd/escalating_privileges/,"I have a script that I want to be able to run a powershell script on a non user workstation by opening it, it asking for my admin credentials and then it running some installers. I have the installer portion all set I just need to get the privilege escalation part worked out. 

How could I go about doing this? 

",,False,,t5_2qo1o,False,,,True,t3_1fsfwd,http://www.reddit.com/r/PowerShell/comments/1fsfwd/escalating_privileges/,
1370455335.0,5,self.PowerShell,1fqh67,Handling poorly coded executable Standard Output/Error returns,5,0,7,http://www.reddit.com/r/PowerShell/comments/1fqh67/handling_poorly_coded_executable_standard/,"I am in the process of creating a PowerShell utility which makes heavy use of a set of third party executables for managing a storage array (EMC Symmetrix).  

These executables seem to be poorly written in that, even on a successful operation, they output the result to Standard Error instead of Standard Output.  

For example:

    .\symclone.exe -g $groupName -establish $sourceDevice sym ld $targetDevice -noprompt

Returns:

    symclone.exe :
    + CategoryInfo         : NotSpecified: (:String) [], RemoteException
    + FullyQualifiedErrorID : NativeCommandError
    
    'Incremental Establish' operation is in progress for device 'SourceDevice' paired with target device 'TargetDevice' in device group 'DeviceGroup'. Please wait...
    
    'Incremental Establish' operation successfully initiated for device 'SourceDevice' in group 'DeviceGroup' paired with target device 'TargetDevice'.

This is perfectly expected and running as normal.  Unfortunately the tool has been written to throw an error for this.  Even worse: this is not consistent. Another executable from the same set of tools will output the result to Standard Output.  

My dilemma is how to best handle this from PowerShell since I then need to parse the return string to check it's doing what I want.  

My current solution involves using *Start-Process* with *-RedirectStandardError* and *-RedirectStandardOutput* to output to a text file (these switches don't allow output to variables).  I then check both of the text files and do my RegEx on the contents to check what the executable has done.  

Has anyone dealt with a situation like this?  Is there a better way around it?",,False,,t5_2qo1o,False,,,True,t3_1fqh67,http://www.reddit.com/r/PowerShell/comments/1fqh67/handling_poorly_coded_executable_standard/,
1370283939.0,3,self.PowerShell,1flgo0,Trying to determine SharePoint welcome page,4,1,3,http://www.reddit.com/r/PowerShell/comments/1flgo0/trying_to_determine_sharepoint_welcome_page/,"I'm trying to pull the welcome page from each sub-web in every site collection and I'm failing horrible.  I'm afraid I'm not very good at Powershell!  Here's my attempt thus far:

    Add-PSSnapin Microsoft.SharePoint.Powershell
    $sites = get-spsite
    foreach ($site in $sites) {
    $web = get-spweb -identity $sites
    $rootfolder = $web.RootFolder
    echo $rootfolder.WelcomePage
    }
",,False,,t5_2qo1o,False,,,True,t3_1flgo0,http://www.reddit.com/r/PowerShell/comments/1flgo0/trying_to_determine_sharepoint_welcome_page/,
1369835305.0,4,self.PowerShell,1f9n8x,Server 2008 SP2 Active Directory Cmdlets?,4,0,12,http://www.reddit.com/r/PowerShell/comments/1f9n8x/server_2008_sp2_active_directory_cmdlets/,"Can I get AD Cmdlets on a Server 2008 SP2? I have quest installed but I would like to use some of the regular Powershell cmdlets in scripts. 

I am trying to make a new user script to pull data from an excel sheet but I am having trouble getting the formatting of the OU path as the company I am trying to use it for has a Users OU/Then divided by state/ then location.

What I am trying to do is get a Dynamic Dependent Drop Down List in excel when you choose the state it will show the location only in that state. Good idea? or I would take some suggestions from some pros. After getting the new user script up and running I would also like to get it to create exchange accounts as well. Would I be able to create exchange scripts on the AD server or do I need to log onto the Exchange 2010 

Thanks much. ",,False,,t5_2qo1o,False,,,True,t3_1f9n8x,http://www.reddit.com/r/PowerShell/comments/1f9n8x/server_2008_sp2_active_directory_cmdlets/,
1369577263.0,5,self.PowerShell,1f2xit,Using mounted drives while the script is still running,5,0,14,http://www.reddit.com/r/PowerShell/comments/1f2xit/using_mounted_drives_while_the_script_is_still/,"Hi,

I am trying to mount drives in my script and then use them. Unfortunately the drives are unknown in the session after mounting them. Get-PSDrive does not list them. To test if they are available, i thought of using the Start-Job Cmdlet like this:

[code]

    function checkPath ($path) {
       $job = Start-Job -ScriptBlock {Test-Path $path}
       $state = Receive-Job -Job $job
       Write-Host $state
       return $state
    }
    
    checkPath ""Y:\""
    
    [/code]

There is an exception with the Test-Path cmdlet

+ CategoryInfo          : InvalidData: (:) [Test-Path], ParameterBindingValidationException

and i can't figure out why. Does anybody have an idea why it doesn't work that way? It must be an beginner-error since I am just starting :)

Regards                ",,False,,t5_2qo1o,False,,,True,t3_1f2xit,http://www.reddit.com/r/PowerShell/comments/1f2xit/using_mounted_drives_while_the_script_is_still/,
1369496449.0,5,self.PowerShell,1f170m,Script for disabling scheduled defrag if drive is SSD,7,2,4,http://www.reddit.com/r/PowerShell/comments/1f170m/script_for_disabling_scheduled_defrag_if_drive_is/,"Hey!

Quite new to powershell, so i'm gonna need some help with from you guys :)

I'm setting up a lot of computers daily and i'm using a script to take care of most of the work. Most of the computers are old and use a regular harddrive, but some of them use a SSD drive, so i need a way to identify if the computer has a SSD-disk and then disable scheduled defrag. 

Here is what i have found on Google so far. Tried this and it does indeed manage to separate SSD-disk and harddrive.

Get-WmiObject win32_diskdrive | where { $_.model -match 'SSD'}

I have managed to disable defrag with CMD, but not with PowerShell.",,False,,t5_2qo1o,False,,,True,t3_1f170m,http://www.reddit.com/r/PowerShell/comments/1f170m/script_for_disabling_scheduled_defrag_if_drive_is/,
1369247879.0,5,self.PowerShell,1eum6c,Citrix XenApp Admins!,6,1,2,http://www.reddit.com/r/PowerShell/comments/1eum6c/citrix_xenapp_admins/,"So, things are quiet right now where I work. There's a big merge happening and my team was told to put a hold on new projects. That was a month ago. Now all we're doing is break-fixes and personal projects/growth, and reading the Internet since we've run out of things to do.

One of the things I've just started reading into the Citrix XenApp SDK/API just to see what I could do there.

I'm just curious what other Admins have done with this.

Thanks!",,False,,t5_2qo1o,False,,,True,t3_1eum6c,http://www.reddit.com/r/PowerShell/comments/1eum6c/citrix_xenapp_admins/,
1369146116.0,5,self.PowerShell,1erjge,[Assistance] Generate CSR File,6,1,4,http://www.reddit.com/r/PowerShell/comments/1erjge/assistance_generate_csr_file/,"Hi Everyone.

I am new to PowerShell and am enjoying it a lot. Below is a small script I created to generate a CSR file. It works (I haven't tested with a real SSL Certificate yet) however I am interested to see if there are any improvements I can make to it.

    cls
    Write-host ""############################################################"" -foreground ""yellow""
    Write-host """"
    Write-host ""Enter the CN that you want to generate the CSR for""  -foreground ""yellow""
    Write-host ""Example: mail.domain.com.au, *.domain.com.au""  -foreground ""yellow""
    Write-host """"

    $CompanyName = Read-Host ""Company Name""
    $Country = Read-Host ""Country""
    $State = Read-Host ""State""
    $City = Read-Host ""City""
    $OU = Read-Host ""Organisational Unit""
    $HostHeader = Read-Host ""CN=""

    $CertINI = ""$HostHeader.inf""
    $CertReq = ""$HostHeader.txt""

    echo ""[NewRequest]"" &gt;&gt; ""$CertINI""
    echo ""Subject= """"C=$Country,S=$State,L=$City,OU=$OU,CN=$HostHeader"""""" &gt;&gt; ""$CertINI""
    echo ""KeySpec = 1"" &gt;&gt; ""$CertINI""
    echo ""KeyLength = 2048"" &gt;&gt; ""$CertINI""
    echo ""Exportable = True"" &gt;&gt; ""$CertINI""
    echo ""RequestType = CMC"" &gt;&gt; ""$CertINI""
    echo ""FriendlyName = Rapid SSL $HostHeader"" &gt;&gt; ""$CertINI""

    certreq -new -f $CertINI $CertReq

    Write-host """"
    Write-host ""Certificate Request Created!"" $pwd\$CertReq -foreground ""yellow""
    Write-host """"
    Write-host ""############################################################"" -foreground ""yellow""
    Write-host """"",,False,,t5_2qo1o,False,,,True,t3_1erjge,http://www.reddit.com/r/PowerShell/comments/1erjge/assistance_generate_csr_file/,
1369084601.0,3,self.PowerShell,1epwta,MailboxExportRequest,4,1,5,http://www.reddit.com/r/PowerShell/comments/1epwta/mailboxexportrequest/,"I was tasked with cleaning up the exchange server at my current gig. After an initial overview there were around 50 disabled users that need to have their mailboxes purged from exchange. 

I know about,

    New-MailboxExportRequest -Mailbox user -FilePath \\server\temp\user.pst

And that works just fine if I had 3 users, but is there anyways to point the SAMAccountName to a list in Excel?",,False,,t5_2qo1o,False,,,True,t3_1epwta,http://www.reddit.com/r/PowerShell/comments/1epwta/mailboxexportrequest/,
1369066284.0,5,self.PowerShell,1ep8be,Getting a count of pipeline objects in the Begin block,6,1,20,http://www.reddit.com/r/PowerShell/comments/1ep8be/getting_a_count_of_pipeline_objects_in_the_begin/,"I'm working on a script which performs some simple WMI queries against a set of computer names from a text file, passed in via the pipeline.  Since this script can run for a while, I want to useful provide output via Write-Progess .  This means getting count of the incoming objects from the pipeline in the begin block of my script, which will then be referenced in the process block to let me do some simple math and have a progress bar which is reasonable valid.  Something like:  

    Param(
        [Parameter(position=0,mandatory=$true,valuefrompipeline=$true)]
        $Computer
    )

    Begin{
        $CompCount = $Computer.count
        $curCount = 0
        Write-Progress `
            -Id 0 `
            -Activity 'Doing Stuff' `
            -Status 'Starting' `
            -PercentComplete 0
    }

    Process {
        $curCount++
        Write-Progress `
            -Id 0 `
            -Activity 'Doing Stuff' `
            -Status (""Doing Stuff to: {0}"" -f $Computer) `
            -PercentComplete ([system.math]::round(($curCount/$CompCount)*100,0))
        # Do some stuff here
        Write-Output $myOutputObject
    }

    End {
        Write-Progress `
            -Id 0 `
            -Activity 'Doing Stuff' `
            -Status 'Done' `
            -PercentComplete 100 `
            -Complete
    }

Unfortunately, even in the Begin block, there only seems to be a single object in the $Computers object.  I tries $input as well; but, this seems to have the same issue.  Does anyone know how to get the collection of all objects coming from the pipeline so that I can get a count from it?

EDIT:  
Points to [sudo_giev_SoJ](http://www.reddit.com/r/PowerShell/comments/1ep8be/getting_a_count_of_pipeline_objects_in_the_begin/ca2f6hj) It looks like the Begin/Process/End control structure is getting in my way and will be until I go PS v3.0.  The right way to do this seems to be:  

    Param(
        [Parameter(position=0,mandatory=$true,valuefrompipeline=$true)]
        $Computer
    )

    # Get the collection of objects from the $Input enumerator
    $MyComps = @($Input)
    $CompCount = $MyComps.count

    # This picks up cases where the $Computer variable was given as a command line parameter vs. from the pipeline
    if(($CompCount -eq 0) -AND ($Computer -ne $null)) {
        $MyComps = @()
        $MyComps += $Computer
        $CompCount = $MyComps.count
    }
    $curCount = 0
    Write-Progress `
        -Id 0 `
        -Activity 'Doing Stuff' `
        -Status 'Starting' `
        -PercentComplete 0

    ForEach($Comp in $MyComps){
        $curCount++
        write-host $CompCount '-' $CurCount
        Write-Progress `
            -Id 0 `
            -Activity 'Doing Stuff' `
            -Status (""Doing Stuff to: {0}"" -f $Comp) `
            -PercentComplete ([system.math]::round(($curCount/$CompCount)*100,0))
        # Do some stuff here
        Start-Sleep 2
        
    }
    Write-Progress `
        -Id 0 `
        -Activity 'Doing Stuff' `
        -Status 'Done' `
        -PercentComplete 100 `
        -Complete",,False,,t5_2qo1o,1369077793.0,,,True,t3_1ep8be,http://www.reddit.com/r/PowerShell/comments/1ep8be/getting_a_count_of_pipeline_objects_in_the_begin/,
1368724812.0,4,self.PowerShell,1egmfy,Resolve FQDN with System.Net.Dns,4,0,6,http://www.reddit.com/r/PowerShell/comments/1egmfy/resolve_fqdn_with_systemnetdns/,"So I have a function, getFQDN, that returns the FQDN from a host name.  I support thousands of servers in multiple domains and forests and sometimes I need to know where they are.  

The function works fine, using [System.Net.Dns]::GetHostEntry($hostname).HostName to retrieve the FQDN if one exists, and it returns just server name if not.  

However I've found that when I try to run through a list, e.g. foreach($x in $list){getFQDN $x} I only get the FQDN of the first  server, the rest return just the short name.  If I run the function manually one at a time, It does resolve each server.  

I even found this script [](http://awesome-machine.net/?p=454) which does something similar, but the results are exactly the same. 

I tried to run from the shell with the same results -  foreach($hostname in $list){[System.Net.Dns]::GetHostEntry($hostname).HostName}

What gives?  Do I need to clear System.Net.Dns in some fashion before each attempt?",,False,,t5_2qo1o,False,,,True,t3_1egmfy,http://www.reddit.com/r/PowerShell/comments/1egmfy/resolve_fqdn_with_systemnetdns/,
1368585177.0,5,self.PowerShell,1ecwy7,PowerShell to send out mass message?,7,2,8,http://www.reddit.com/r/PowerShell/comments/1ecwy7/powershell_to_send_out_mass_message/,"My company has asked me if I could develop a solution to display pop-up notifications when events in the building occur. I've had moderate success, however my problem occurs when I change from sending out the message to the entire organization. 100 computers takes about 2:15 seconds for this script to send out. I've edited the script now to only send to computer that are ping-able. This brought my time down to :45 seconds. Scaling this, the 5,000 computers in my organization will approx 36 minutes to send to everyone. This obviously wont work, as they are expecting a solution that is under a minute.

Does /r/powershell have a solution for me that can broadcast out all at once?

Does anyone know of a software solution to do the same?








&gt; # Selects the message to be sent based on arguments used
$MsgSel = $args[0];
switch ($MsgSel) {
   ""Message1"" {$Msg = ""Message1""; break}
   ""Message2"" {$Msg = ""Message2""; break}
   ""Message3"" {$Msg = ""Message3""; break}
   ""Message4"" {$Msg = ""Message4""; break}
   default{$Msg = ""This is a test of the emergency broadcast system.  This is only a test.""}
}

# Set the file of pc's to recieve the message
    $PCList = ""\\Networkpath\ComputersList.txt""
# Set the # of seconds the message will show before disappearing
    $Time = 10
	
# Sends Message to a given PC
Function Send-NetMessage{
Param(
    [Parameter(Mandatory=$True)]
    [String]$Message,
    [String]$Session=""*"",
    [Parameter(ValueFromPipeline=$True,ValueFromPipelineByPropertyName=$True)]
    [Alias(""Name"")]
    [String[]]$Computername=$env:computername,
    [Int]$Seconds=""5""
    )
Process{
    ForEach ($Computer in $ComputerName){
		if (IsThere($Computer)){
			$cmd = ""msg.exe $Session /Time:$($Seconds)""
			if ($Computername){$cmd += "" /SERVER:$($Computer)""}
				$cmd += "" $($Message)""
				Invoke-Expression $cmd
			}
		}
    }
}

function IsThere ([string]$C = ""LocalHost""){  #pings pc to see if it is there prior to sending msg
	$results= gwmi -query ""select * from Win32_pingstatus Where address='$_'""
	if ($results.statuscode -eq 0){ return 1 }
	else{ return 0 }
}

# Gets a file with list of computers and pipse into Send-NetMessage:
	get-content $PCList | Send-NetMessage $Msg -Seconds $Time
	
	
	
&lt;#  **** Description ****
 Sends message via a pop-up textbox to multiple computers
 Parms:  	- Seconds nn Notification stays for nn seconds or until user clicks OK.
.EXAMPLES
    Send-NetMessage ""MSG""   (MSG sent to all users on local computer.)
    Send-NetMessage ""MSG"" -Computername testbox01 -Seconds 30 (MSG sent to all users on Testbox01) 
	get-content ComputersList.txt | Send-NetMessage $Msg -Seconds 10 ($Msg contents sent to users on all computers listed in the ComputersList.txt file (10 second delay)
#&gt;

#Dump computers from certain OU to a file:
#get-QADComputer -searchroot 'OU' | select name | ft @{Expression={$_.name};width=15} -hide &gt; OUDump.txt
#Add more to the file:
#get-QADComputer -searchroot 'OU2' | select name | ft @{Expression={$_.name};width=15} -hide &gt;&gt; OU2.txt",,False,,t5_2qo1o,False,,,True,t3_1ecwy7,http://www.reddit.com/r/PowerShell/comments/1ecwy7/powershell_to_send_out_mass_message/,
1368562821.0,4,self.PowerShell,1ec4kz,Match array values - Why doesn't this work?,4,0,11,http://www.reddit.com/r/PowerShell/comments/1ec4kz/match_array_values_why_doesnt_this_work/,"Hey guys. I am trying to match array values, then print the matches. The idea behind this script is to delete folders that fall within an entered date range. The two portions seem to work seperately, but when put together they do not return the match I am expecting.

    # Prompt for start date of range    
    $start = [datetime]::parse((Read-Host ""What date should the range start with? Enter in the format DD/MM/YYYY""))  

    # Prompt for end date of range    
    $end = [datetime]::parse((Read-Host ""What date should the range end with? Enter in the format DD/MM/YYYY""))  

    # Recurse the current directory and list all folders whose lastwritetime falls within the range we specified.  
    $dirlist = gci -Recurse | ?{$_.PSIsContainer } |?{$_.LastWriteTime -gt $start -and $_.LastAccessTime -lt $end} | Select-Object Name  
    $exceptions = Get-Content \\SVR\SCRIPT\EXCEPTIONS.LIST  

    Foreach ($listval1 in $exceptions) {  
    If ('$dirlist' -contains '$listval1')  
    { Write-Host $listval1 }  
    Else { Exit }  
   }  
",,False,,t5_2qo1o,1368566839.0,,,True,t3_1ec4kz,http://www.reddit.com/r/PowerShell/comments/1ec4kz/match_array_values_why_doesnt_this_work/,
1368002229.0,3,self.PowerShell,1dx6wi,"Array search is ultra slow, other ways to search?",4,1,6,http://www.reddit.com/r/PowerShell/comments/1dx6wi/array_search_is_ultra_slow_other_ways_to_search/,"Hello guys,  


I've got one medium big csv file, and one huge one (145k records).  
File #1 contains something like  

    name,type,data  
    dnsrecord,A,127.0.0.1  
    aliasrecord,CNAME,hostname.otherdomain.com  

File #2 now holds ""hostname"" somewhere in the .name field.
I want to get the .type for that .name, so when i find the .name i need the value right next to it. Both are imported-csv files btw.

I found no good way of doing it, so i'm running two searches, where the second one is super slow (performing | where {_.name -eq $dataONE} 


    If ($inputTWO.name -contains $dataONE)
    			{$inTWO = ""RecordISinTWO""
    			$matching = ($inputTWO -match $dataONE)
    			$matchingCORRECT = ($matching | where {$_.name -eq $dataONE})
    			$inTWOType = $matchingCORRECT.type
    			}
    
The problem with the first search ""-match"" is that it also gives me records that are called ""hostnameBLABLA"" as -match is not -equals, and -eq can only search in .name and not the whole array. 

**See example for fast, not exact search:**

    
    PS C:\Tools\Scripts\Powershell\test&gt; $fruit -match 'Apple'
    
        Fruit                                                 Colour                                               Shape
        -----                                                 ------                                               -----
        Apple                                                 Red                                                  Round
        Strawberry                                            Applecoloured                                        Pearshaped
        
    
    
    ",,False,,t5_2qo1o,1368122576.0,,,True,t3_1dx6wi,http://www.reddit.com/r/PowerShell/comments/1dx6wi/array_search_is_ultra_slow_other_ways_to_search/,
1367963134.0,5,self.PowerShell,1dw15u,Getting User-only ACLs,5,0,2,http://www.reddit.com/r/PowerShell/comments/1dw15u/getting_useronly_acls/,"I must be missing something obvious (too close to the problem), but can someone tell me how I could use Get-ACL, pointed at a folder or share location, to report only files or folders where an ACL has been added for any User, but not report on ACLs for Groups (AD or local)?

Thanks!",,False,,t5_2qo1o,False,,,True,t3_1dw15u,http://www.reddit.com/r/PowerShell/comments/1dw15u/getting_useronly_acls/,
1367843896.0,3,self.PowerShell,1dselu,get-childitem returning files with filename extensions,5,2,9,http://www.reddit.com/r/PowerShell/comments/1dselu/getchilditem_returning_files_with_filename/,"I have the following script looking for .bak files

    $filter =  '*.bak'
    $filename = get-childitem $server_drive -filter $filter
    write-host $filename

Someone renamed a few .bak files to .bak_a .bak_b and these are being returned as well. Why is the search finding *.bak*?  How can I exclude these files?",,False,,t5_2qo1o,False,,,True,t3_1dselu,http://www.reddit.com/r/PowerShell/comments/1dselu/getchilditem_returning_files_with_filename/,
1367801992.0,6,self.PowerShell,1drhtr,Need help with a computer info script.,6,0,12,http://www.reddit.com/r/PowerShell/comments/1drhtr/need_help_with_a_computer_info_script/,"I am extremely new to scripting and need to put together a powershell script for pulling remote computer information.

I will need to pull the computer name, hard drive size, free space on hard drive, and the current logged on user (if any).

I have seen quite a few things pertaining to get-Wmi functions, but i just cant wrap my head around how to format this script to get it working.  Any help is greatly appreciated.",,False,,t5_2qo1o,False,,,True,t3_1drhtr,http://www.reddit.com/r/PowerShell/comments/1drhtr/need_help_with_a_computer_info_script/,
1365998251.0,4,self.PowerShell,1cdaw7,Select screen position for explorer.exe,4,0,1,http://www.reddit.com/r/PowerShell/comments/1cdaw7/select_screen_position_for_explorerexe/,"hi guys, I'm learning power shell and am trying to create a script that starts explorer.exe on start-up in fullscreen mode on my secondary screen.

I have created a batch file to execute on start-up as a scheduled task. I'm quite confident I can figure out how to force it to start in fullscreen, but how do I specifically tell it to open on my secondary screen?

My main question would be how to script screen positions in powershell?",,False,,t5_2qo1o,False,,,True,t3_1cdaw7,http://www.reddit.com/r/PowerShell/comments/1cdaw7/select_screen_position_for_explorerexe/,
1365714171.0,5,self.PowerShell,1c5snt,test-path multiple locations\files - help?,5,0,3,http://www.reddit.com/r/PowerShell/comments/1c5snt/testpath_multiple_locationsfiles_help/,"I'm completely new to powershell so could really do with some help with this.

I've given myself a project to help me learn but I'm stuck on the test-path command. What I want to do is check multiple locations to see if a file exists and return a true or false value. Ideally, I'd like to be able to list those locations in a text file for easy updating / adding to in the future.

The only real example I can give is what i've already got for testing whether computers are online

    $names = Get-Content ""C:\temp\testcomputers.txt""
    foreach ($name in $names) {
    if ( Test-Connection -ComputerName $name -Count 1 -ErrorAction SilentlyContinue ) {
    Write-Host ""# $name is up"" -ForegroundColor DarkGreen
    }
    else {
    Write-Host ""# $name is down"" -ForegroundColor Red
    }
    }

I'd like to get the same as the above, but for checking if files exist. 

Can someone give me some pointers?

",,False,,t5_2qo1o,False,,,True,t3_1c5snt,http://www.reddit.com/r/PowerShell/comments/1c5snt/testpath_multiple_locationsfiles_help/,
1365640350.0,4,self.PowerShell,1c3ove,Unable to install Remote Server Administration Tools on Windows 8,4,0,10,http://www.reddit.com/r/PowerShell/comments/1c3ove/unable_to_install_remote_server_administration/,"Running Win 8 64bit. Downloaded Windows6.2-KB2693643-x64.msu, ran it, went through installation - it only takes a couple of seconds to finish (tried multiple times). Then, nothing. No Server Manager, no AD module, it just doesn't work.

Has anyone experienced this or have any ideas?

EDIT: [Solved](http://www.reddit.com/r/PowerShell/comments/1c3ove/unable_to_install_remote_server_administration/c9ctnsj)",,False,,t5_2qo1o,1365654244.0,,,True,t3_1c3ove,http://www.reddit.com/r/PowerShell/comments/1c3ove/unable_to_install_remote_server_administration/,
1365264860.0,4,thisprogrammingthing.com,1bsubp,Get the Number of Users in an AD Group,4,0,2,http://www.reddit.com/r/PowerShell/comments/1bsubp/get_the_number_of_users_in_an_ad_group/,,,False,,t5_2qo1o,False,,,False,t3_1bsubp,http://www.thisprogrammingthing.com/2012/get-the-count-of-the-number-of-users-in-an-ad-group/,
1365172751.0,3,self.PowerShell,1bqgoi,ACL Audit Script Against DFS Too Hungry For Server and Still Runs For Days,5,2,7,http://www.reddit.com/r/PowerShell/comments/1bqgoi/acl_audit_script_against_dfs_too_hungry_for/,"Below is my script that I have been working on for auditing ACLs on our DFS shares, but first some background.

All servers are 08R2.  The server the script runs from is a VM with an allocated 16GB RAM and 4 X5680 Intel Xeon processors at 3.33 Ghz.  The script runs fine, pulling information and inputting it into the desired format.  However, the script runs incredibly slow and hogs all the memory.  All 16 GB. Every iteration it seems to increase anywhere from 1MB to 10MB of usage until the server has nothing left.  This of course affects other processes on the server.  I have played around with using outstream versus Out-File, piping the directories directly through a foreach-object loop, and a couple other simple things.  It also takes forever to run.  Most of the DFS shares we are auditing have roughly 50k folders and the script will run for days, keeping the server memory pegged the whole time.  In addition, and this is really tangential but worth mentioning, it does nothing to address the wonderful character limit for processing files / folders.  Anyway, I have been beating my head against a wall for a little while now, trying various things, so I am appealing to this community for help.  Thanks in advance!

Edit1: I should also add, I am using Powershell v3.0 and the DFS shares are hosted on separate servers sitting on the same subnet with response times of less than a millisecond.

    &lt;#
    .Synopsis
    Audits ACLs on provided directory and sub-directories
    .Description
    Outputs ACL information on provided root folder and all sub-folders to screen and acl_output.csv file using parameters to customize output (Default: Checks for blocked inheritance, compares each ACL to the root ACL, and compares each ACL to the parent ACL).
    .Parameter Path
    Root directory to run search on
    .Parameter OutputFile
    Name of output file
    #&gt;

    Param(
        [Parameter(Mandatory=$true)]
        [ValidateScript({Test-Path $_ -PathType 'Container'})]
        [string]$Path
    ,
        [Parameter(Mandatory=$true)]
        [string]$outputFile
    )

    Add-PSSnapin Quest.ActiveRoles.ADManagement;
    $rootCount = $Path.Split(""\"").Count;

    # -----------------------------------------------------------------------------------------------
    # Writes Header
    # -----------------------------------------------------------------------------------------------
    Out-File -filePath $outputFile -inputObject ""DEPTH|BI|ROOT|PARENT|E/I|ENTRY|TYPE|PERMISSIONS|DIRECTORY"";
    $rootACLS = (Get-ACL $Path).Access | Where-Object {($_.identityreference -ne ""NT AUTHORITY\SYSTEM"") -and ($_.identityreference -ne ""BUILTIN\Administrators"")} | Select IsInherited,IdentityReference,FileSystemRights;
    foreach($rootACL in $rootACLS){
        $rootType = """";
        $isRootACLInherited = """";

        if((Get-QADObject $($rootACL.IdentityReference.value)) -ne $Null) {$rootType = (Get-QADObject $($rootACL.IdentityReference.value)).Type;}
        else {$rootType = ""Unfound"";}

        if($($rootACL.IsInherited) -like ""*False*"") {$isRootACLInherited = ""E"";}
        elseif($($rootACL.IsInherited) -like ""*True*"") {$isRootACLInherited = ""I"";}
        else {$isRootACLInherited = ""Error"";}
        Out-File -filePath $outputFile -inputObject ""0|N/A|N/A|N/A|$isRootACLInherited|$($rootACL.IdentityReference)|$rootType|$($rootACL.FileSystemRights)|$Path"" -append;
        # $rootType = $Null;
        # $isRootACLInherited = $Null;
    }

    # -----------------------------------------------------------------------------------------------
    # Main loop through all sub-directories of provided root path
    # -----------------------------------------------------------------------------------------------
    $rootDirACL = Get-ACL $Path;

    $dirs = cmd /c ""dir $Path /a:d /b /s"";
    foreach($dir in $dirs){
        if($dir -like ""*dfsrPrivate*"") { continue; }
        Write-Host ""Processing $dir"";
        $isBlocked = """";
        $isRootDiff = """";
        $isParentDiff = """";
        $dirLevel = ($dir).Split(""\"").Count - $rootCount;

        # -----------------------------------------------------------------------------------------------
        # Checks for blocked inheritance
        # -----------------------------------------------------------------------------------------------
        $dirACL = Get-ACL $dir;
        if($($dirACL.AreAccessRulesProtected) -eq ""TRUE"") { $isBlocked = ""X""; }

        # -----------------------------------------------------------------------------------------------
        # Compares ACL to root's ACL
        # -----------------------------------------------------------------------------------------------
        $compareRoot = Compare-Object -referenceObject $dirACL -differenceObject $rootDirACL -Property Access;
        if ($compareRoot -ne $Null) { $isRootDiff = ""X""; }

        # -----------------------------------------------------------------------------------------------
        # Compares ACL to parent folder's ACL
        # -----------------------------------------------------------------------------------------------
        $parentDirACL = Get-ACL $((Get-Item $dir).Parent.FullName);
        $compareParent = Compare-Object -referenceObject $dirACL -differenceObject $parentDirACL -Property Access;
        if ($compareParent -ne $Null) { $isParentDiff = ""X""; }

        # -----------------------------------------------------------------------------------------------
        # Output Logic
        # -----------------------------------------------------------------------------------------------
        $ACLS = @{};
        $ACLS = $dirACL.Access | Where-Object {($_.identityreference -ne ""NT AUTHORITY\SYSTEM"") -and ($_.identityreference -ne ""BUILTIN\Administrators"")} | Select IsInherited,IdentityReference,FileSystemRights;
        if($ACLS -ne $Null) {
            # -----------------------------------------------------------------------------------------------
            # foreach loop through all ACL entries of sub-directory currently being processed
            # -----------------------------------------------------------------------------------------------
            foreach($ACL in $ACLS){
                $acctType = ""Unfound"";
                $isACLInherited = ""Error"";
                if((Get-QADObject $($ACL.IdentityReference.value)) -ne $Null) {$acctType = (Get-QADObject $($ACL.IdentityReference.value)).Type;}

                if($($ACL.IsInherited) -like ""*False*"") {$isACLInherited = ""E"";}
                elseif($($ACL.IsInherited) -like ""*True*"") {$isACLInherited = ""I"";}

                Out-File -filePath $outputFile -inputObject ""$dirLevel|$isBlocked|$isRootDiff|$isParentDiff|$isACLInherited|$($ACL.IdentityReference)|$acctType|$($ACL.FileSystemRights)|$dir"" -append;
                $acctType = $Null;
                $isACLInherited = $Null;
            }
        $isBlocked = $Null;
        $isRootDiff = $Null;
        $isParentDiff = $Null;
        $dirLevel = $Null;
        $ACLS = $Null;
        }
    }
    $dirs = $Null;",,False,,t5_2qo1o,1365174313.0,,,True,t3_1bqgoi,http://www.reddit.com/r/PowerShell/comments/1bqgoi/acl_audit_script_against_dfs_too_hungry_for/,
1365092544.0,3,self.PowerShell,1bo2sm,[Share] Using the Pcsx module to do folder listings of UNC paths for other servers,4,1,0,http://www.reddit.com/r/PowerShell/comments/1bo2sm/share_using_the_pcsx_module_to_do_folder_listings/,"I needed this to manage some data for a conversion (company I work for made an acquisition). Basically, we needed to have a list of folders on old servers to decide where the data needs to go on a new server. In this case, I specific the administrative share (ie. c$) but this could easily be altered to work against any SMB/CIFS share. Output includes last-accessed and last-written timestamps to see if the data is even being used.

    
    # Script to get output tree listing of folders underneath a share.
    
    Import-Module Pscx
    
    $serverName = 'server01'
    
    $Depth = 5
    
    $Drives = @(""e"",""g"",""h"")
    
    Clear-Host
    
    foreach ($drive in $Drives) {
        $results = Show-Tree ""\\$serverName\$drive`$\"" -Depth $Depth -ShowProperty -ExcludeProperty 'Attributes','CreationTime','CreationTimeUtc','Exists','Extension','LastAccessTimeUtc','LastWriteTimeUtc','Mode','Parent','ReparsePoint','Root'
        ""FullName, LastAccessTime, LastWriteTime""
        foreach ($line in $results) {
            if ($line -like '*Property: *') {
                if ($line -like '*BaseName*') { $BaseName = $line -replace ""^.*= "",''; continue }
                if ($line -like '*FullName*') { $FullName = $line -replace ""^.*= "",'' ; continue }
                if ($line -like '*LastAccessTime*') { $LastAccessTime = $line -replace ""^.*= "",'' ; continue }
                if ($line -like '*LastWriteTime*') { 
                    $LastWriteTime = $line -replace ""^.*= "",''
                    $output = $FullName,$LastAccessTime,$LastWriteTime -join ','
                    $output
                    $BaseName = $null; $FullName = $null; $LastAccessTime = $null; $LastWriteTime = $null; $output = $null
                }
            }
        }
        Write-Host """"
    }",,False,,t5_2qo1o,False,,,True,t3_1bo2sm,http://www.reddit.com/r/PowerShell/comments/1bo2sm/share_using_the_pcsx_module_to_do_folder_listings/,
1364995659.0,2,self.PowerShell,1bl37d,Changing AD usernames and email,4,2,9,http://www.reddit.com/r/PowerShell/comments/1bl37d/changing_ad_usernames_and_email/,"Hey all.  I've written a script to change all user's AD SAMAccountName and email to first.last from first*lastinitial*.  I'd like to be able to add an email alias at the same time as well.  I've got the Exchange 2007 management tools on my workstation and the Exchange management shell works properly.  However, when attempting 

    Add-PSSnapin Microsoft.Exchange.Management.PowerShell.Admin

I'm met with 

    Add-PSSnapin : The Windows PowerShell snap-in 
        'microsoft.exchange.management.powershell.admin' 
         is not installed on this machine.    

I've already uninstalled and reinstalled the management tools.  Get-PSSnapIn only lists the AD and PowerCLI snapins.  Has anybody encountered this before? Workstation is Win7 64-bit.",,False,,t5_2qo1o,False,,,True,t3_1bl37d,http://www.reddit.com/r/PowerShell/comments/1bl37d/changing_ad_usernames_and_email/,
1363712842.0,4,self.PowerShell,1alpae,Returning to a previous line in a script,5,1,6,http://www.reddit.com/r/PowerShell/comments/1alpae/returning_to_a_previous_line_in_a_script/,"    # Lets do this!

$pw = convertto-securestring -AsPlainText -Force -String 'Pass1234'

$cred = new-object -typename  System.Management.Automation.PSCredential -argumentlist ""Company\PC"",$pw

$sb = 
{

 #Imports the LocalAccounts Module from
 
C:/Users/Username/Documents/WindowsPowerShell/Modules

Import-Module LocalAccounts

 #Determines what the user wants to accomplis: 1 - new user, 2 - delete user, 3 - diable user, 4 - re-enable user

Write-Host 'Please select one of the following options:'

Write-Host '1 - Create a new user'

Write-Host '2 - Delete a currently exsisting user'

Write-Host '3 - Disable a currently exsisting user'

Write-Host '4 - Re-Enable a currently exsisting user'

Write-Host '5 - Exit Program'

$UserAction = Read-Host 'Select option, press enter to continue'

Clear-Host

If ($UserAction -eq '1')
    {    
    #Sets the Username Variable
    $Username = Read-Host 'Please enter the username, press Enter to continue'
    
    Clear-Host

    if ((Get-LocalUser -all | Where-Object {$_.name -eq $Username} | Select-Object -ExpandProperty Name) -eq ($Username) -or (!$Username))
        {
        #Do, Until loop that checks whether the the username is unique and is not Null
        Do 
            {
            $Username = Read-Host 'Invalid username, Please try again'
            
            Clear-Host
            
            }

        Until ((Get-LocalUser -all | Where-Object {$_.name -eq $Username} | Select-Object -ExpandProperty Name) -ne ($Username) -and ($Username))       
        }
        
    #sets the Password varible
    $Password = Read-Host 'Enter a password for that username'

    Clear-Host
        
    #Creates the new user with the specified Username and Password variables
    New-LocalUser -Name $Username -Password $password -ErrorAction 'silentlycontinue'
        
    if ((Get-LocalUser -all | Where-Object {$_.name -eq $Username} | Select-Object -ExpandProperty Name) -eq ($Username))
        {
        Read-Host 'New user has been created, press Enter to continue'
        
        Clear-Host
        
        .$sb         
        }
        
    Else
        {
        Read-Host 'Error: User was unable to be created'
        
        Clear-Host
        
        .$sb      
        }        
    }

Elseif ($UserAction -eq '2')
    {
    #Sets the Username Variable
    $Username = Read-Host 'Enter the user you wish to be removed, press Enter to continue'
    
    Clear-Host

    if ((Get-LocalUser -all | Where-Object {$_.name -eq $Username} | Select-Object -ExpandProperty Name) -ne ($Username) -or (!$Username))
        {
        #Do, Until loop that checks whether the the username is unique and is not Null
        Do 
            {
            $Username = Read-Host 'User does not exsist, enter another username'
            
            Clear-Host            
            }

        Until ((Get-LocalUser -all | Where-Object {$_.name -eq $Username} | Select-Object -ExpandProperty Name) -eq ($Username) -and ($Username))
        }
    
    Read-Host $Username 'is about to be removed, press Enter to continue'
    
    Clear-Host
        
    Remove-LocalUser -Name $UserName -ErrorAction 'silentlycontinue'
    
    if ((Get-LocalUser -all | Where-Object {$_.name -eq $Username} | Select-Object -ExpandProperty Name) -ne ($Username))
        {
        Read-Host 'User has been removed, press Enter to continue'
        
        Clear-Host
        
        .$sb         
        }
        
    Else
        {
        Read-Host 'Error: User was unable to be removed'
        
        Clear-Host 
        
        .$sb      
        }       
        
    }    
    
Elseif ($UserAction -eq '3')
    {
    Read-Host 'You have selected option 3'
    } 
    
Elseif ($UserAction -eq '4')
    {
    Read-Host 'You have selected option 4'
    } 
    
Elseif ($UserAction -eq '5')
    {
    Exit
    } 
    
Else
    {
    Read-Host 'You have entered an invalid command, press enter to continue'
    
    .$sb 
    } 
        
}

Invoke-Command -ComputerName DC-Jeryn -Credential $cred -ScriptBlock $sb
",,False,,t5_2qo1o,False,,,True,t3_1alpae,http://www.reddit.com/r/PowerShell/comments/1alpae/returning_to_a_previous_line_in_a_script/,
1363615871.0,2,self.PowerShell,1aiw0u,Powershell slow from command line,4,2,6,http://www.reddit.com/r/PowerShell/comments/1aiw0u/powershell_slow_from_command_line/,"Using Powershell 2 on Windows 2008 R2 server.

If I launch a powershell command window and run a script such as test.ps1 it completes in just a few milliseconds. If I instead run powershell from the command line such as ""powershell.exe -nologo -noninteractive -noprofile -file test.ps1"", it takes about 10 seconds to complete. I knew there would be some overhead of loading powershell modules, and .Net framework, but I didn't expect it to be that long. Is there a way to easily get powershell to run faster from a command line? Is it better with version 3? I think 3 only loads modules on the fly if you need them.


Should note that this server has a sql server instance on it that consumes a vast majority of system memory, but that is what sql normally does.",,False,,t5_2qo1o,1363616557.0,,,True,t3_1aiw0u,http://www.reddit.com/r/PowerShell/comments/1aiw0u/powershell_slow_from_command_line/,
1361267444.0,3,self.PowerShell,18t7l7,"Noob help: Foreach and then IF, Else ",5,2,13,http://www.reddit.com/r/PowerShell/comments/18t7l7/noob_help_foreach_and_then_if_else/,"Please educate me. I am trying to test if a file exists on a group of computers' desktop. Some computers are Windows 7 and some are Windows XP. 

When I run the code, It doesn't test the path on every computer and returns every computer as ""has URL"" even computers where the file doesn't exist. 
I'm not sure where I have gone wrong. 

    $a = Get-Content ""C:\Computers.txt""
    $windowsXP = ""\\$i\c$\Documents and Settings\All Users\Desktop\file.url""
    $windows7 = ""\\$i\c$\Users\Public\Desktop\file.url"" 

    ForEach ($i in $a){
    # Test file on WindowsXP
    if ((test-path $windowsXP) -eq $True)
        {Write-Output ""$i WindowsXP has URL""}

    elseif ((test-path $windowsXP) -eq $False)
        {Write-Output ""$i WindowsXP needs URL""}
    
    # Test file on Windows7
    elseif((test-path $windows7) -eq $True)
        {Write-Output ""$I Windows7 has URL""}
    
    elseif ((test-path $windows7) -eq $False)
       {Write-Output ""$I Windows7 needs URL""}
    }",,False,,t5_2qo1o,False,,,True,t3_18t7l7,http://www.reddit.com/r/PowerShell/comments/18t7l7/noob_help_foreach_and_then_if_else/,
1361224936.0,3,self.PowerShell,18ryv7,"PS3's Invoke-RestMethod, API's, and your music collection",4,1,1,http://www.reddit.com/r/PowerShell/comments/18ryv7/ps3s_invokerestmethod_apis_and_your_music/,"I've been interested in using Application Programming Interfaces but never found a good app for handling the objects.  With PowerShell 3 comes Invoke-RestMethod (irm).  It makes quick work of accessing online databases and creating objects to use in your PowerShell scripts.  The potential is enormous as you can pull in any website API information.  I've written about my exploits using IRM to rename my MP3's extended properties (ID3 tags).

http://tomorrow.uspeoples.org/2013/02/powershell-invoke-restmethod-apis-and.html",,False,,t5_2qo1o,False,,,True,t3_18ryv7,http://www.reddit.com/r/PowerShell/comments/18ryv7/ps3s_invokerestmethod_apis_and_your_music/,
1360869761.0,5,self.PowerShell,18j5k4,Writing a script to do a daily dump of a Server 2008 print logs to a SQL database.,6,1,2,http://www.reddit.com/r/PowerShell/comments/18j5k4/writing_a_script_to_do_a_daily_dump_of_a_server/,"The pertinent information is located in two separate events.  Event 805 and Event 307.

Initially I was using the $event805.Event.UserData.RenderJobDiag.JobId to match the two events but I have found that the JobID resets after it hits 255.

I would like to use the $event805.Event.System.Execution.ThreadID to match the events, but I am unsure as to whether the ThreadID is always constant for any given print job.

Alternatively I could use the $event805.Event.System.EventRecordID which appears to log event805 and then event307, this would allow me to search for the previous event when joining the data.

Anyone have insight into this issue or know of a better way to connect the two events?

---

The code:

    Function GetDepartment{
                    [CmdletBinding()]
                	Param(
                		[Parameter(Mandatory = $true)]
                		[string]$User
                	)
                	
                	Process{
                        ## create a read only variable for reader object
                		## create an Active Directory search object
                		New-Variable -Name adReader -Option ReadOnly -Scope Script
                		Set-Variable -Name adReader -Value (New-Object -TypeName DirectoryServices.DirectorySearcher) -Force
                		
                        ## make the user variable searchable
                        $strFilter = '(&amp;(objectClass=user)(sAMAccountName=' + $User + '*))'
                        
                		## set the root to the OU=_Users 
                		## make sure the results contain only users with departments, home drives, and non-volunteer
                		$adReader.SearchRoot = 'LDAP://OU=_Users,DC=domain,DC=org'
                        $adReader.Filter = $strFilter
                        
                        ## get the department
                        $adReader.PropertiesToLoad.Add(""department"")
                        
                        ## find the department and assign it to $adDepartment
                        $adOutput = $adReader.FindOne()
                        $adProperties = $adOutput.Properties
                        $adDepartment = $adProperties.department
                    }
                    End{
                		Remove-Variable -Name adReader -Force -Scope Script
                        ## return the variable
                        Return $adDepartment
                    }
                }
                
                Function GetPrintEvents{
                    Process{
                        # get the event logs from Utility0 
                        $events307 = Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-PrintService/Operational';ID='307'}
                        $events805 = Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-PrintService/Operational';ID='805'}
                
                        # create an array to store the log information
                        $arrayPrintJobs = @()
                
                        # get the relevent information from event 805 and log it to an xml file
                        Foreach($event805 in $events805){
                            $event805 = ([xml]$event805.ToXml())
                            $jobID = $event805.Event.UserData.RenderJobDiag.JobId
                            $pathXml = ""C:\PrintLogs\"" + $jobID + ""_"" + $recordID + "".xml""
                            $eventOutput = New-Object -TypeName PSobject -Property @{
                                JobId = $event805.Event.UserData.RenderJobDiag.JobId
                                Color = $event805.Event.UserData.RenderJobDiag.Color
                                Copies = $event805.Event.UserData.RenderJobDiag.Copies
                            }
                            
                            Export-Clixml -InputObject $eventOutput -Path $pathXml
                        }
                
                        # get the relevent information from event 307 and import the xml
                        Foreach($event307 in $events307){
                            $Date = $event307.TimeCreated
                            $event307 = ([xml]$event307.ToXml())
                            $pathXml = ""C:\PrintLogs\"" + $event307.Event.UserData.DocumentPrinted.Param1 + "".xml""
                            
                            $Department = GetDepartment $event307.Event.UserData.DocumentPrinted.Param3
                            
                            If(Test-Path -Path $pathXml){
                                $Color = (Import-Clixml -Path $pathXml).Color
                                $Copies = (Import-Clixml -Path $pathXml).Copies
                            }
                            Else{
                                $Color = '1'
                                $Copies = '1'
                            }
                            
                            If($Color -eq '2'){
                                $Color = $True
                            }
                            Else{
                                $Color = $False
                            }
                            
                            # add the properties to a system object
                            $printLog = New-Object System.Object
                            $printLog | Add-Member -Type NoteProperty -Name Job -Value $event307.Event.UserData.DocumentPrinted.Param1
                            $printLog | Add-Member -Type NoteProperty -Name Document -Value $event307.Event.UserData.DocumentPrinted.Param2
                            $printLog | Add-Member -Type NoteProperty -Name User -Value $event307.Event.UserData.DocumentPrinted.Param3
                            $printLog | Add-Member -Type NoteProperty -Name Department -Value $Department.Get(1)
                            $printLog | Add-Member -Type NoteProperty -Name Printer -Value $event307.Event.UserData.DocumentPrinted.Param5
                            $printLog | Add-Member -Type NoteProperty -Name Port -Value $event307.Event.UserData.DocumentPrinted.Param6
                            $printLog | Add-Member -Type NoteProperty -Name Size -Value $event307.Event.UserData.DocumentPrinted.Param7
                            $printLog | Add-Member -Type NoteProperty -Name Pages -Value $event307.Event.UserData.DocumentPrinted.Param8
                            $printLog | Add-Member -Type NoteProperty -Name Copies -Value $Copies
                            $printLog | Add-Member -Type NoteProperty -Name Color -Value $Color
                            $printLog | Add-Member -Type NoteProperty -Name Date -Value $Date
                            
                            # write the values to the array
                        	$arrayPrintJobs += $printLog
                        }
                    }
                    End{
                        # return the array
                        Return $arrayPrintJobs
                    }
                }
                
                Function SendToSQL{
                    [CmdletBinding()]
                	Param(
                		[Parameter(Mandatory = $true)]
                		[object]$PrintJobs
                	)      
                    Process{
                        # define the SQL Connection object
                        # define the connection string
                        $SQLConnection = New-Object System.Data.SQLClient.SQLConnection
                        $SQLConnection.ConnectionString = ""server=SQLServer;database=Print_Jobs;trusted_connection=true;""
                        
                        # open the connection
                        $SQLConnection.Open()
                        
                        # define the SQL Command object
                        # define the connection object for the command
                        $SQLCommand = New-Object System.Data.SQLClient.SQLCommand
                        $SQLCommand.Connection = $SQLConnection
                        
                        # loop for inserting data        
                        Foreach($PrintJob in $PrintJobs){
                            # cast the data as the proper types
                            $Job = [int]$PrintJob.Job
                            
                            $Document = [string]$PrintJob.Document
                            $Document = $Document -Replace ""['%?$]"",""""
                            If($Document.Length -gt 200){                
                                $Document = $Document.Substring(0,197) + ""[t]""
                            }
                            
                
                            $User = [string]$PrintJob.User
                            If($User.Length -gt 20){
                                $User = $User.Substring(0,17) + ""[t]""
                            }
                            
                            $Department = [string]$PrintJob.Department
                            If($Department.Length -gt 10){
                                $Department = $Department.Substring(0,7) + ""[t]""
                            }
                            
                            $Printer = [string]$PrintJob.Printer
                            If($Printer.Length -gt 20){
                                $Printer = $Printer.Substring(0,17) + ""[t]""
                            }
                            
                            $Port = [string]$PrintJob.Port
                        If($Port.Length -gt 20){
                            $Port = $Port.Substring(0,17) + ""[t]""
                        }
                        
                        $Size = [int]$PrintJob.Size
                        $Pages = [int]$PrintJob.Pages
                        $Copies = [int]$PrintJob.Copies
                        $Color = [bool]$PrintJob.Color
                        $Date = [datetime]$PrintJob.Date
                    
                        # define the command text
                        $SQLCommand.CommandText = ""INSERT INTO [Print_Jobs].[dbo].[Job_Log] ([Job],[Document],[User],[Department],[Printer],[Port],[Size],[Pages],[Copies],[Color],[Date]) VALUES('$Job','$Document','$User','$Department','$Printer','$Port','$Size','$Pages','$Copies','$Color','$Date')""
                    
                    Try{
                        # run the command
                        $SQLCommand.ExecuteNonQuery()
                    }
                    Catch{
                        Write-Host $SQLCommand.CommandText
                    }
                }
                # close the connection
                $SQLConnection.Close()   
            }
        }
        
        # call the function to get print events
        $PrintJobs = GetPrintEvents
        
        # write the events to a csv (temp)
        $PrintJobs | Export-Csv -Path 'C:\PrintLogs\PrintLog.csv' -NoTypeInformation -Force
        
        # call the function to write the log data to SQL
        SendToSQL $PrintJobs",,False,,t5_2qo1o,1360876350.0,,,True,t3_18j5k4,http://www.reddit.com/r/PowerShell/comments/18j5k4/writing_a_script_to_do_a_daily_dump_of_a_server/,
1360807132.0,4,self.PowerShell,18hi13,Powershell function to get sysinternals tools from the web.,4,0,4,http://www.reddit.com/r/PowerShell/comments/18hi13/powershell_function_to_get_sysinternals_tools/,"[script](http://pastebin.com/EAsaeewM)

     SYNOPSIS
     Downloads Sysinternal tools from the web.
     DESCRIPTION
     This function will can download a single Sysinternals utility,
     an array (either string[] or csv) or if no paramater specified
     will download the entire set.  Optional path to download can be 
     specified, defaults to working directory.
     .PARAMATER ToolName 
     Single name, [string[]] or CSV.
     .PARAMATER Path
      Local or UNC path to place file(s)
",,False,,t5_2qo1o,1360807362.0,,,True,t3_18hi13,http://www.reddit.com/r/PowerShell/comments/18hi13/powershell_function_to_get_sysinternals_tools/,
1360779574.0,3,self.PowerShell,18ghjt,"WinRM listener on Windows Server 2003...how can I make this work (it does work on some, but not others)?",4,1,8,http://www.reddit.com/r/PowerShell/comments/18ghjt/winrm_listener_on_windows_server_2003how_can_i/,"I've got a big mix of Windows 2008 and 2003 servers, and I would like to be able to use WinRM to make remote changes on both. 

In Windows 2008, it's simple...Just ""winrm quickconfig"" and it starts a listener that Powershell can connect to for a session. In Windows 2003, WinRM is running, and apparently configured, but will not allow a session ***ON SOME 2003 SERVERS***. Some other 2003 servers will not respond, and I need to figure out why and how to fix this.

Here is the output of some winrm commands on a Windows 2003 server that does ***NOT*** allow sessions:

    &gt;winrm get winrm/config
    Config
        MaxEnvelopeSizekb = 150
        MaxTimeoutms = 60000
        MaxBatchItems = 32000
        MaxProviderRequests = 4294967295
        Client
            NetworkDelayms = 5000
            URLPrefix = wsman
            AllowUnencrypted = false
            Auth
                Basic = true
                Digest = true
                Kerberos = true
                Negotiate = true
                Certificate = true
            DefaultPorts
                HTTP = 5985
                HTTPS = 5986
            TrustedHosts
        Service
            RootSDDL = O:NSG:BAD:P(A;;GA;;;BA)S:P(AU;FA;GA;;;WD)(AU;SA;GWGX;;;WD)
            MaxConcurrentOperations = 4294967295
            MaxConcurrentOperationsPerUser = 15
            EnumerationTimeoutms = 60000
            MaxConnections = 25
            MaxPacketRetrievalTimeSeconds = 120
            AllowUnencrypted = false
            Auth
                Basic = false
                Kerberos = true
                Negotiate = true
                Certificate = false
                CbtHardeningLevel = Relaxed
            DefaultPorts
                HTTP = 5985
                HTTPS = 5986
            IPv4Filter = * [Source=""GPO""]
            IPv6Filter = * [Source=""GPO""]
            EnableCompatibilityHttpListener = false
            EnableCompatibilityHttpsListener = false
            CertificateThumbprint
        Winrs
            AllowRemoteShellAccess = true
            IdleTimeout = 180000
            MaxConcurrentUsers = 5
            MaxShellRunTime = 2147483647
            MaxProcessesPerShell = 15
            MaxMemoryPerShellMB = 150
            MaxShellsPerUser = 5
    
    
    &gt;winrm e winrm/config/listener
    Listener [Source=""GPO""]
        Address = *
        Transport = HTTP
        Port = 5985
        Hostname
        Enabled = true
        URLPrefix = wsman
        CertificateThumbprint
        ListeningOn = 10.0.124.4, 127.0.0.1
    
Here are the same command on a Windows 2003 server that ***DOES*** allow sessions:

    &gt;winrm get winrm/config
    Config
        MaxEnvelopeSizekb = 150
        MaxTimeoutms = 60000
        MaxBatchItems = 32000
        MaxProviderRequests = 4294967295
        Client
            NetworkDelayms = 5000
            URLPrefix = wsman
            AllowUnencrypted = false
            Auth
                Basic = true
                Digest = true
                Kerberos = true
                Negotiate = true
                Certificate = true
            DefaultPorts
                HTTP = 5985
                HTTPS = 5986
            TrustedHosts
        Service
            RootSDDL = O:NSG:BAD:P(A;;GA;;;BA)S:P(AU;FA;GA;;;WD)(AU;SA;GWGX;;;WD)
            MaxConcurrentOperations = 4294967295
            MaxConcurrentOperationsPerUser = 15
            EnumerationTimeoutms = 60000
            MaxConnections = 25
            MaxPacketRetrievalTimeSeconds = 120
            AllowUnencrypted = false
            Auth
                Basic = false
                Kerberos = true
                Negotiate = true
                Certificate = false
                CbtHardeningLevel = Relaxed
            DefaultPorts
                HTTP = 5985
                HTTPS = 5986
            IPv4Filter = *
            IPv6Filter = *
            EnableCompatibilityHttpListener = false
            EnableCompatibilityHttpsListener = false
            CertificateThumbprint
        Winrs
            AllowRemoteShellAccess = true
            IdleTimeout = 180000
            MaxConcurrentUsers = 5
            MaxShellRunTime = 2147483647
            MaxProcessesPerShell = 15
            MaxMemoryPerShellMB = 150
            MaxShellsPerUser = 5
    
    
    &gt;winrm e winrm/config/listener
    Listener
        Address = *
        Transport = HTTP
        Port = 5985
        Hostname
        Enabled = true
        URLPrefix = wsman
        CertificateThumbprint
        ListeningOn = 10.10.204.4, 127.0.0.1
    
Maybe I'm missing something from looking at this so long, but I don't see the difference. Help?

***Thanks!***",,False,,t5_2qo1o,False,,,True,t3_18ghjt,http://www.reddit.com/r/PowerShell/comments/18ghjt/winrm_listener_on_windows_server_2003how_can_i/,
1360611594.0,6,self.PowerShell,18bqu3,Install printers on remote machines(Win 7) using powershell?,6,0,15,http://www.reddit.com/r/PowerShell/comments/18bqu3/install_printers_on_remote_machineswin_7_using/,Is it possible to install printers on windows 7 machines remotely without interfering with the users? It would be nice if they could continue to do their jobs while I installed the printer. ,,False,,t5_2qo1o,False,,,True,t3_18bqu3,http://www.reddit.com/r/PowerShell/comments/18bqu3/install_printers_on_remote_machineswin_7_using/,
1358988738.0,5,imgur.com,175qnn,"[XPOST from Programming] Issue reading csv file to create bulk AD users, getting error message: Cannot convert SystemObject[] to System.String req' by parameter SamAccountName",6,1,15,http://www.reddit.com/r/PowerShell/comments/175qnn/xpost_from_programming_issue_reading_csv_file_to/,,,False,,t5_2qo1o,False,,,False,t3_175qnn,http://imgur.com/OCXixdB,
1358792578.0,4,self.PowerShell,1701p0,Evaluating the results of Start-VM and Stop-VM,8,4,8,http://www.reddit.com/r/PowerShell/comments/1701p0/evaluating_the_results_of_startvm_and_stopvm/,"Test snippet:

    if(Start-VM -Name wolfram) {
            write-host ""started"";
        } else {
            write-host ""not started"";
        }

Regardless of the actual results of Start-VM, I end up in the else block, here. VM starts fine? ""not started."" VM doesn't start? ""not started."" Same thing happens with Stop-VM.

How the devil do I actually evaluate the results of a Start-VM command?",,False,,t5_2qo1o,False,,,True,t3_1701p0,http://www.reddit.com/r/PowerShell/comments/1701p0/evaluating_the_results_of_startvm_and_stopvm/,
1357944538.0,5,self.PowerShell,16elvr,Trying to extract a chunk of text from a captured website.,5,0,7,http://www.reddit.com/r/PowerShell/comments/16elvr/trying_to_extract_a_chunk_of_text_from_a_captured/,"I am grabbing the contents of a schedule that is being posted on a web page and dumped it to a string. I would like to grab the schedule table that is conviniently labeled with the tags: &lt;--schedule start--&gt; and &lt;--schedule end--&gt;


I have been looking at the string methods .trimStart() and .trimEnd() to see if i could trim everything up to the &lt;--schedule start--&gt; and then everything after the &lt;--schedule end--&gt;


Maybe i'm just looking to use the wrong methods, but i cant seem to figure out how to extract it. How would you guys go about extracting the text?",,False,,t5_2qo1o,False,,,True,t3_16elvr,http://www.reddit.com/r/PowerShell/comments/16elvr/trying_to_extract_a_chunk_of_text_from_a_captured/,
1357942940.0,3,self.PowerShell,16ek2j,Out-File question,4,1,9,http://www.reddit.com/r/PowerShell/comments/16ek2j/outfile_question/,"I am writing a script where I am taking the contents of a SQL query and outputting the content into a text file to be used later. 

I am using a line break to differentiate between the different values.

So for instance if I did 

Select city,state,zip,phone from AddressPhone

The content of the text file would be something like

New York
New York
10029
212-111-1111

However, in the code where the DB is actually used, it uses this table to print to an HTML page. So if a person has more than one phone number the field might be 

212-111-1111&lt;br&gt;212-222-2222

When I use Out-File, it is interpreting the &lt;br&gt; to be a line break in the actual out-file. Since I am relying on the line break to separate the different values in my code, I want it to look like

212-111-1111&lt;br&gt;212-222-2222

and not 

212-111-1111&lt;br&gt;212-222-2222

Any ideas?",,False,,t5_2qo1o,False,,,True,t3_16ek2j,http://www.reddit.com/r/PowerShell/comments/16ek2j/outfile_question/,
1357684569.0,3,pastebin.com,167kik,Need help! Script won't run through my foreach command.,4,1,14,http://www.reddit.com/r/PowerShell/comments/167kik/need_help_script_wont_run_through_my_foreach/,,,False,,t5_2qo1o,False,,,False,t3_167kik,http://pastebin.com/2TvuRbKT,
1357270061.0,5,self.PowerShell,15xgua,Exporting user logon name field,6,1,5,http://www.reddit.com/r/PowerShell/comments/15xgua/exporting_user_logon_name_field/,"Hey guys!

Sorry If I seem like one of those people who just needs someone to write some code for them really quick, I am deeply interested in working with powershell to help automate admin tasks. 

Here is my problem. I have been given a spreadsheet .xlsx file with a list of over 600 user names and information. Column A has last names, B first names, c to J are misc information that if I ran a script would just get into the way. In column K I need to export an ID number. The ID number is already on *most* everyones account and is located in the ""User logon name"" field. 

Basically, if I made a .csv or similar file how could I code it so that it either:
A) searches for each user on file and imports logon name next to it
B) pulls a list of all account information from the users account and I just remove the columns that I do not need. 

I found [this](http://www.reddit.com/r/PowerShell/related/13sgwf/looking_for_some_help_in_getting_powershell_to/) thread that matches a little about what I want to do.

I would be content with taking an export of all the users in OU x and editing out the information I need. 

Thanks again guys! 

",,False,,t5_2qo1o,False,,,True,t3_15xgua,http://www.reddit.com/r/PowerShell/comments/15xgua/exporting_user_logon_name_field/,
1356644853.0,4,self.PowerShell,15jel9,Question about working with objects,6,2,7,http://www.reddit.com/r/PowerShell/comments/15jel9/question_about_working_with_objects/,"I am in the process of creating an initialization script I can use across multiple scripts.  The current idea for the config script is to have it craft a custom object containing important directories, external executables, domain controllers, etc..

I have the object setup like so:  

     $obj   #parent object
     $obj.config  #Child Configuration object
     $obj.config.dir #Containts all relavent directories 
     $obj.config.dir.function #Contains powershell function locations (ie.AD,Exchange,Misc) 
     $obj.config.exe #Contains all external executable files (TODO: Paramaters?)
     $obj.config.dc.(parent,child1,child2)
     $obj.config.email #contain distribtion lists

This works fine so far, my current problem is verifying path's and such in each of the objects.  For instance $obj.config.exe should contain the UNC paths to programs such as psexec (don't judge).  I would like to refer to it in scripts via $obj.config.exe.psexec, so I use the following code to populate the $.exe subobject.

     function add-Exe(){
     $exe = New-Object system.Object
     $exe | Add-Member -MemberType mem -Name ""7zip"" -Value ($obj.dir.programs + ""\7zip\7z.exe"")
     $exe | Add-Member -MemberType NoteProperty -Name ""Psexec"" -Value ($obj.dir.programs + ""\sysinternals\psexec.exe"")

     return $exe
     }

     $config | Add-Member -MemberType NoteProperty -Name ""exe"" -value $(add-exe) 

So my question:  Is there a way to enumerate my $config.exe object to return all subproperties and test their UNC values? 
I am currently trying variations of:
 
      #Test external executable paths
      $config.exe | %{$exe = $_ ;#Test for executables
      if((Test-Path $exe) -eq $false){$warningObj += ""Not Found: $exe .`n""}
      Clear-Variable exe
      }
 The idea is to send an email to a group letting them know if any parts of this initialization script fail.


On the other hand, if someone knows a better way for be to do this I would love critiques.",,False,,t5_2qo1o,False,,,True,t3_15jel9,http://www.reddit.com/r/PowerShell/comments/15jel9/question_about_working_with_objects/,
1355866620.0,4,self.PowerShell,152lw2,compound switch statement,5,1,3,http://www.reddit.com/r/PowerShell/comments/152lw2/compound_switch_statement/,"I am working on a section of code to work on multiple machines, but dont want to duplicate it in multiple legs of the switch statement as it will be lengthy.  Below is what I have, but I cant seem to get the -or comparator to work within the switch statement.  Any ideas?

switch ($env:computername) {
 (""MyMachine1"" -or ""MyMachine2"") {echo ""test worked""}
 }

(in my test I should have seen the echo statement, but I got nothing.  I did validate it by reading the ComputerName env var.)",,False,,t5_2qo1o,False,,,True,t3_152lw2,http://www.reddit.com/r/PowerShell/comments/152lw2/compound_switch_statement/,
1355493456.0,2,self.PowerShell,14ubvo,Critique my Script?  First one I've written in a few years and not positive I've done it in the most correct way,4,2,12,http://www.reddit.com/r/PowerShell/comments/14ubvo/critique_my_script_first_one_ive_written_in_a_few/,"Hello fellow scripters!

I have a small script that I created which I intend to use with my Nagios monitoring system (in combination with NSClient++/check_nrpe) on a client PC end, in order to check the load times for a few specific internal web pages (we have one office that always reports very long load times).

Goals of the script:  

 * accept command line variable input for url, user, password, domain, search string, warning and crit times.
 * return some help text if any of the required variables are missing
 * load the given website, using ntlm authentication
 * grab a timestamp before and after loading the webpage, and use this as an assumed page load time (i know this won't be perfectly accurate, but when using as a comparison between computers/offices/sites it should work i think)
 * look at the returned webpage for the given text string
 * provide Nagios friendly results (ie a short sentence about the status and an exit code of 0/1/2/3/4 for OK/Warning/Critical/Unknown status)

If I get it working properly and well enough, I intend to put it up on the Nagios Exchange for others to use; but I feel like I need to provide better error handling or something..


The Script...

    &lt;#
    .SYNOPSIS
    This Powershell script was created for use with nsclient++/check_nrpe/nagios in order to check the load time of a given website. It currently only uses NTLM authentication.
    
    .DESCRIPTION
    The script accepts input parameters for URL, username, password, login domain, search string, crit and warn times. It uses .net's web client functionality in order to grab the given page.
    
    It grabs the system timestamp immediately before and after getting the page in order to calculate how long it took to execute that bit.  It then looks at the returned page and searches for the given text string.
    
    If it takes too long to load the page, or the search string isn't found it will return a nagios friendly status code. It currently accepts the password in plain text and then converts it into a more secure form.
    
    .EXAMPLE
    
    Script: 
    check_site.ps1 -url ""http://intranet.contoso.com"" -user ""tuser"" -pass ""Reset123"" -dom ""contoso"" -find ""hello"" -w 2 -c 6
    
    
    Config samples for NSClient++ and Nagios for this:
    
    Nsclient++ ini file: (with checkexternalscript, allow args and allow nasty metachars enabled
    [/settings/external scripts/scripts]
    check_site = cmd /c echo scripts\check_site.ps1 -url $ARG1$ -user $ARG2$ -pass $ARG3$ -dom $ARG4$ -find $ARG5$ -w $ARG6$ -c $ARG7$ | powershell.exe -command -
    
    [/settings/external scripts/wrappings]
    ; POWERSHELL WRAPPING - 
    ps1 = cmd /c echo scripts\\%SCRIPT% %ARGS%; exit($lastexitcode) | powershell.exe -command -
    
    Nagios:
    define command{
            command_name    check_nrpe
            command_line    $USER1$/check_nrpe -t 30 -H $HOSTADDRESS$ -c $ARG1$ -a $ARG2$
            }
    
    define service{
            use                     generic-service,srv-pnp
            host_name              user_pc
            service_description     Contoso Load Time
            check_command           check_nrpe!check_site!""http:/\/intranet.contoso.com"" $USER7$ $USER6$ ""contoso"" ""hello"" 2 6
    
            }
    .LINKS
    www.nagios.org
    www.nsclient.org
    
    #&gt;
    param (
    	[string]$url,
    	[string]$user,
    	[string]$pass,
    	[string]$find,
    	[string]$dom,
    	[int]$c = 4,
    	[int]$w = 2,
    	[Switch] $help
    	)
    
    #Nagios output variables
    $ok = 0
    $warn = 1
    $crit = 2
    $unkn = 3
    $result = $unkn
    $message = ""Status Unknown""
    $result2 = $unkn
    $message2 = ""Status Unknown""
    
    if ($h.Exist -or $help.Exist -or ($url -eq $null) -or ($user -eq $null) -or ($pass -eq $null) -or ($dom -eq $null))
    {
    	# How do I make it print out the get-help section when the script is called with the help switch??
    	Write-Host(""Variables received- URL: $url User: $user Pass: $pass Find: $find Dom: $dom C: $c W: $w"")
    	return $result
    	exit
    }
    
    # Set user agent for new webclient instance
    $webclient = New-Object System.Net.WebClient
    $webclient.Headers.Add(""user-agent"",""Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0)"")
    
    # Create credentials to use
    $credCache = new-object System.Net.CredentialCache
    $creds = new-object System.Net.NetworkCredential($user, $pass, $dom)
    $credCache.Add($URL, ""NTLM"", $creds)
    $webclient.Credentials = $credCache
    
    #Log time, get page, log time; find time difference
    try 
    {
    	$starttime = Get-Date
    	$pageresult = $webclient.DownloadString($url)
    	$endtime = Get-Date
    }
    catch [Net.WebException] 
    {
    	Write-Host ""Page load failed.""
    	return $result
    	exit
    }
    
    $totaltime = ($endtime-$starttime).TotalSeconds #calculate time taken to get page
    $perfdata = ""|'Load Time'=$totaltime""+""s;$warn;$crit;0"" #create perfdata
    
    #Status checks
    if ($pageresult -eq $null -or $pageresult.Contains(""Access Denied"") -or $pageresult.Contains(""Unauthorized"")) { 
    	$message = ""CRITICAL: Access denied for user '$user' (no site permissions).\n""
    	$result = $crit
    }
    else {
    	if($totaltime -lt $w) { # Page loaded under the warning time, OK
    		$message = ""OK: $url polled in $totaltime seconds. $perfdata\n""
    		$result = $ok
    	}
    	elseif($totaltime -gt $w -and $totaltime -lt $c) { #page loaded, but load time exceeded warning threshhold, Warning
    
    		$message = ""WARNING: $url polled in $totaltime seconds. $perfdata\n""
    		$result = $warn
    	}
    	else { # page loaded over the crit time, Critical
    		$message = ""CRITICAL: $url polled in $totaltime seconds. $perfdata\n""
    		$result = $crit
    	}
    	if($find -ne $null) 
    	{ # if user gave us a find string
    		if($pageresult.Contains($find)) 
    		{ # find string is found, OK
    			$message2 = ""OK: Search string '$find' found. $url polled in $totaltime seconds. $perfdata\n""
    			$result2 = $ok
    		}
    		else 
    		{ # find string is not found, Critical
    			$message2 = ""CRITICAL: Search string '$find' not found! Page may not have loaded properly. $url polled in $totaltime seconds. $perfdata\n""
    			$result2 = $crit
    		} 
    	}#if fid not null
    } #else pageresult exists, not denied
    
    if($result2 -gt $result)
    {
     # Comparing result codes for the time check vs search string check and going with the worst severity.
    	$message = $message2
    	$result = $result2
    } #if($result2 -gt $result)
    
    Write-Host ($message)
    return $result
    exit",,False,,t5_2qo1o,1355514529.0,,,True,t3_14ubvo,http://www.reddit.com/r/PowerShell/comments/14ubvo/critique_my_script_first_one_ive_written_in_a_few/,
1355283504.0,4,self.PowerShell,14pf3o,AD: What's the best implementation of this using the activedirectory module instead of quest?,4,0,4,http://www.reddit.com/r/PowerShell/comments/14pf3o/ad_whats_the_best_implementation_of_this_using/,"Let's assume that I have full read-only access to the local domain controller and all OUs within it. My end goal is to have a working script which spits out a list of groups where a certain user has 'Write Members' security on the group.

There is a piece of web-based software that lets users manage access to file shares without having to call the helpdesk or use AD. The list of shares a user can manage are the groups on which they have 'Write Members' security.

So far I have used the Quest tools to achieve this as they have been the most documented while researching a solution, though I would prefer to find a solution that used the activedirectory module.

---

My current working script:

    Get-QADObject -ShowProgress -SearchRoot 'full.domain.name/path/to/fileshareshare/groups' `
    -SearchScope 'OneLevel' -Type Group -SizeLimit 1500 -LdapFilter '(name=site_name_*)' `
    | Get-QADPermission -Rights 'WriteProperty' -Property 'member' `
    -Account ""username"" -WarningAction SilentlyContinue | `
    Select -Property TargetObject,Account | Export-CSV C:\Scripts\managedGroups.csv

---

This spits out a CSV:
#TYPE Selected.Quest.ActiveRoles.ArsPowerShellSnapIn.Data.ArsPermission

TargetObject|Account|
-|-
domain\site_name_share1|domain\username
domain\site_name_share2|domain\username
domain\site_name_share3|domain\username

and so on.

---

I'm going to guess that there's a far easier way of doing this, or at least a way I can instead use Get-ADGroup with Get-ACL.

All I need is the group name (preferably without the domain\ in front) and the username. I'll happily buy a drink for any geniuses (though I live in Australia)!",,False,,t5_2qo1o,False,,,True,t3_14pf3o,http://www.reddit.com/r/PowerShell/comments/14pf3o/ad_whats_the_best_implementation_of_this_using/,
1354730074.0,4,self.PowerShell,14bz7w,Script to remove registry keys in a path that contain a word for all users,4,0,10,http://www.reddit.com/r/PowerShell/comments/14bz7w/script_to_remove_registry_keys_in_a_path_that/,"2008r2 running as a TS. I have a problem where redirected printers are not clearing out of 

""hkcu:\software\microsoft\windows nt\currentversion\devices""

for users upon logoff.  I am working to get the problem addressed going forward (known 2008r2 issue), but I need to clear out the existing keys.

they show up as: 

printer (redirected 38)
printer (redirected 94)

in some cases dozens of time.

I need to clear out any key with ""redirected"" in the name, in this path, for all users...

Any ideas?
",,False,,t5_2qo1o,False,,,True,t3_14bz7w,http://www.reddit.com/r/PowerShell/comments/14bz7w/script_to_remove_registry_keys_in_a_path_that/,
1354041408.0,3,self.PowerShell,13vvrj,Help: Script to change file time stamp ,4,1,13,http://www.reddit.com/r/PowerShell/comments/13vvrj/help_script_to_change_file_time_stamp/,"Can someone help me out and write a script that - given folder path and timestamp string - changes time stamp of all files in the folder:

powershell.exe changetime.ps1 'c:\temp\blah' '12/25/2012 9:00PM'

really appreciate it !
",,False,,t5_2qo1o,False,,,True,t3_13vvrj,http://www.reddit.com/r/PowerShell/comments/13vvrj/help_script_to_change_file_time_stamp/,
1353040367.0,4,self.PowerShell,13a6wk,Script to change a users password in multiple domains.,4,0,4,http://www.reddit.com/r/PowerShell/comments/13a6wk/script_to_change_a_users_password_in_multiple/,"So I work in a rather large environment and thus have multiple accounts.  They don't all require a password change at once, but I try to change them all at the same time.  I was looking to script this, using my old password to pass though credentials to make the changes to set the new password.  I am not sure if it works, testing today I couldn't get it to make a LDAP connection to a different domain.  Anyone have any ideas how to accomplish this?

The main forest has multiple child domains that I figured won't be so hard to change.  Then there are other forest that there is not a trust between and I am not sure if I can put those accounts in the same script.

I've tried google and searching for just simply changing a password in another domain, but seem to keep coming up empty handed.   So if anyone has any ideas that could point me in the right direction that would be great. ",,False,,t5_2qo1o,False,,,True,t3_13a6wk,http://www.reddit.com/r/PowerShell/comments/13a6wk/script_to_change_a_users_password_in_multiple/,
1352466079.0,3,self.PowerShell,12wt0t,Run Copy command on remote computers at the same time,5,2,7,http://www.reddit.com/r/PowerShell/comments/12wt0t/run_copy_command_on_remote_computers_at_the_same/,"Hi 

I am wanting to do a simple copy command on X number of computers from a single file share to test throughput. How could I execute this remote copy command at the same time. Does a for each run the first command, wait til complete then onto the second machine and so on ? 

cheers
",,False,,t5_2qo1o,False,,,True,t3_12wt0t,http://www.reddit.com/r/PowerShell/comments/12wt0t/run_copy_command_on_remote_computers_at_the_same/,
1352301644.0,5,self.PowerShell,12ssv9,Quick question about excluding machines from get-QADComputer results,5,0,12,http://www.reddit.com/r/PowerShell/comments/12ssv9/quick_question_about_excluding_machines_from/,"I am learning powershell, and one of the first things I want to do is pull a list of all Windows 7 machines from AD. The problem is it also pulls in our VDIs. (I want to run it daily to see how our deployments are going)

I'm sorry if this is a noob question, but how do I exclude results based on name?

Here is what I have:



    Add-PSSnapin Quest.ActiveRoles.ADManagement -ErrorAction SilentlyContinue
    Set-QADPSSnapinSettings -DefaultSizeLimit:0
    get-QADComputer -OSName '*Windows 7*' |Select-Object -property Name, osname |  Export-Csv –Path C:\Windows7.csv

If the virtual desktops have a name of VDI001, VDI002, VDI003 for example, can I exclude them from the CSV?

Thanks!",,False,,t5_2qo1o,False,,,True,t3_12ssv9,http://www.reddit.com/r/PowerShell/comments/12ssv9/quick_question_about_excluding_machines_from/,
1352142167.0,6,self.PowerShell,12oizs,Adding to the ACL for local administrators of the machine I'm creating a folder on,6,0,2,http://www.reddit.com/r/PowerShell/comments/12oizs/adding_to_the_acl_for_local_administrators_of_the/,"I am building a script that creates user folders then adds several users and groups to the folder's ACL. I can add domain users and groups just fine, but when I try to add the local administrators of that machine (to match other folders in the directory), it does not add them. I can provide the whole script if needs be but I'm pretty sure it's down to the following snippets where I'm having the problem.

For example, this works ($folder_path gets defined earlier and is just the path to the folder the script creates):

    #Give domain admins full control of the folder
                
    $Acl = Get-Acl $folder_path   
    $Ar = New-Object system.security.accesscontrol.filesystemaccessrule(""Domain Admins"",""FullControl"",""Allow"")                              
    $Acl.SetAccessRule($Ar)
                
    Set-Acl $folder_path $Acl

But this does not:

    #Give FILESERVERNAME\admins full control of the folder
                
    $Acl = Get-Acl $folder_path   
    $Ar = New-Object system.security.accesscontrol.filesystemaccessrule(""FILESERVERNAME\Administrators"",""FullControl"",""Allow"")                              
    $Acl.SetAccessRule($Ar)
                
    Set-Acl $folder_path $Acl

Is there's something else I am missing to add users of the local computer I'm putting the file on? (If that's even possible)... thanks! I am running the Powershell IDE as an administrator and I have Domain Admin Access.",,False,,t5_2qo1o,False,,,True,t3_12oizs,http://www.reddit.com/r/PowerShell/comments/12oizs/adding_to_the_acl_for_local_administrators_of_the/,
1351818652.0,3,self.PowerShell,12hnx5,Compare-Object on CSVs return false positives,4,1,5,http://www.reddit.com/r/PowerShell/comments/12hnx5/compareobject_on_csvs_return_false_positives/,"Hey all,

  Writing a script for our HR department that pulls User's name, phone number, and cell phone number from AD to new.csv.  The script then imports old.csv and compares based on the telephone number and cell phone number. Works great, except sometimes I get false positives if user's are added or removed. I was unable to find a good number for SyncWindow.  

CSV Format ~550 Lines
Name TelephoneNumber CellPhone

    #Import listing from last run
    $Original = Import-CSV ""old.csv""
    
    import-module activedirectory
    
    #Get all users in the ""Domain"" OU not including the ""3rd Parties"" OU
    $Users = get-aduser -filter * -property TelephoneNumber,mobilephone -searchbase ""OU=xxx,DC=xxx,DC=xxx"" | Where-object {$_.DistinguishedName -notlike ""*3rd*""}
    
    #Write $Users Name, Telephone Number, and Mobile Phone Number to Current.csv
    #$Users | Select-Object Name,TelephoneNumber,MobilePhone | Sort-Object Name | Export-CSV ""new.csv"" -NoTypeInformation
    
    #Import listing from current run
    $Current = Import-CSV ""new.csv""
    
    #Compare objects within both CSVs, outputting only objects that have changed or are new 
    Compare-Object $Original $Current -property TelephoneNumber,MobilePhone -Passthru | sort-object Name | Format-Table SideIndicator,Name,TelephoneNumber,MobilePhone -AutoSize
    
    #Compare objects within both CSVs, outputting only objects that have changed or are new 
    #Compare-Object $Original $Current -property TelephoneNumber,MobilePhone -Passthru | Where-Object {$_.SideIndicator -eq ""=&gt;""} | Select-Object Name,TelephoneNumber,MobilePhone
    
    #Copy-Item ""new.csv"" ""old.csv"" -confirm
    
It's my first true script, so I'm sure it could be done better, but I'm more concerned about the false positives.

Thanks for any help

edit: formatting Go RES!",,False,,t5_2qo1o,1351822453.0,,,True,t3_12hnx5,http://www.reddit.com/r/PowerShell/comments/12hnx5/compareobject_on_csvs_return_false_positives/,
1351105249.0,4,self.PowerShell,120r77,How do I manage a PowerShell Function Library?,4,0,12,http://www.reddit.com/r/PowerShell/comments/120r77/how_do_i_manage_a_powershell_function_library/,"So I've been writing numerous functions and code snip its for years.  I keep all of them in a series of folders with the folder name being a general idea of what the scripts are doing.  For example I have an Exchange folder for all of my scripts that are mucking about in Exchange.

My problem is, I constantly lose scripts or don't remember what I called something.  I occasionally can find the script using windows search but I was hoping to hear any better suggestions for finding and managing an ever growing PowerShell library?",,False,,t5_2qo1o,False,,,True,t3_120r77,http://www.reddit.com/r/PowerShell/comments/120r77/how_do_i_manage_a_powershell_function_library/,
1351091752.0,4,self.PowerShell,120bnu,Check last email date and send email if older than a day.,4,0,5,http://www.reddit.com/r/PowerShell/comments/120bnu/check_last_email_date_and_send_email_if_older/,"I am a powershell newb.  I am trying to make a script that will check the last email in a subfolder and if it is older than 1 day then I need it to send a warning email.  So far I have put this together from stuff i have found on forums and such:

    $olFolderInbox = 6
    $outlook = new-object -com outlook.application;
    $ns = $outlook.GetNameSpace(""MAPI"");
    $inbox = $ns.GetDefaultFolder($olFolderInbox)
    $targetfolder = $inbox.Folders | where-object { $_.name -eq ""automation"" }
    $lastemail = $targetfolder.Items.GetLast
    $onedayback = (get-date).AddDays(-1)

now I need to know how to get the date of $lastemail so I can compare it to $onedayback in an if then.  Is this possible?  Am I doing this wrong?",,False,,t5_2qo1o,False,,,True,t3_120bnu,http://www.reddit.com/r/PowerShell/comments/120bnu/check_last_email_date_and_send_email_if_older/,
1350434535.0,4,self.PowerShell,11lon2,Is it possible to query Microsoft DHCP server?,6,2,12,http://www.reddit.com/r/PowerShell/comments/11lon2/is_it_possible_to_query_microsoft_dhcp_server/,"I can't believe the best way to query a Microsoft DHCP server is to parse through the output of netsh.  With all of these COM objects for every little thing, why not DHCP or am I missing something obvious?",,False,,t5_2qo1o,False,,,True,t3_11lon2,http://www.reddit.com/r/PowerShell/comments/11lon2/is_it_possible_to_query_microsoft_dhcp_server/,
1346853428.0,4,self.PowerShell,ze5fw,Issues importing a CSV for Invoke-Command in PowerShell v3,4,0,2,http://www.reddit.com/r/PowerShell/comments/ze5fw/issues_importing_a_csv_for_invokecommand_in/,"Hey guys, I'm working on a script to build hyper-v guest by reading a CSV file, and it works nice.  But I was adding a function to promote a server to a domain controller if specified in the CSV, but I am running into an issue with the Invoke-Command part.  To rule out issues I cut it down to just the part I'm having issues with to try to fix.

    $ConfigFile = import-csv .\ServerBuilds.csv
       $customIP = $ConfigFile.CustomIP.Replace(""/24"", """")
       
    Write-Host $ConfigFile.CustomDomain
    Write-Host $customIP

    Invoke-Command -ScriptBlock {Install-ADDSDomainController -Credential (get-credential) -DomainName $ConfigFile.CustomDomain -InstallDNS} –ComputerName $customIP

When I run this here is the output:

    PS C:\&gt; .\Untitled3.ps1
    DC2012.local
    192.168.10.21
    Windows PowerShell Credential Request : cmdlet Get-Credential at command pipeline position 1
    Warning: This credential is being requested by a script or application on the 192.168.10.21 remote computer. Enter your credentials only if you trust the remote computer and the application or script requesting it.

    Supply values for the following parameters:
    Cannot bind argument to parameter 'DomainName' because it is null.
    + CategoryInfo          : InvalidData: (:) [Install-ADDSDomainController], ParameterBindingValidationException
        + FullyQualifiedErrorId : ParameterArgumentValidationErrorNullNotAllowed,Microsoft.DirectoryServices.Deployment.PowerShell.Commands.Install 
       ADDSDomainControllerCommand
        + PSComputerName        : 192.168.10.21

So the write-host shows the correct domain name from the CSV, but the invoke-command is saying that it is null.

If I just do a import-csv it looks fine.

    PS C:\&gt; Import-Csv .\ServerBuilds.csv

    CustomName      : DC02
    CustomIP        : 192.168.10.21/24
    CustomDomain    : DC2012.local

I've tried to list the domain field as ""$($ConfigFile.CustomDomain)"" and then it errors saying the string is blank, but the write-host shows it correct.

I'm at a loss.",,False,,t5_2qo1o,1346853626.0,,,True,t3_ze5fw,http://www.reddit.com/r/PowerShell/comments/ze5fw/issues_importing_a_csv_for_invokecommand_in/,
1346680448.0,3,reddit.com,za2sd,/r/PowerCLI added for VMware Powershell Automation,6,3,4,http://www.reddit.com/r/PowerShell/comments/za2sd/rpowercli_added_for_vmware_powershell_automation/,,,False,,t5_2qo1o,False,,,False,t3_za2sd,http://reddit.com/r/PowerCLI,
1345881455.0,4,self.PowerShell,ysrsl,Modular dot source scripts with remote sessions,4,0,5,http://www.reddit.com/r/PowerShell/comments/ysrsl/modular_dot_source_scripts_with_remote_sessions/,"I'm working on a modular script that essentially has one parent script calling a bunch of child scripts via dot sourcing.  

When the script runs locally on my server all of the snapins are loaded and it works fine.  

However, I'm having trouble getting the logic in place to run it from a remote server. What is the best way to try and achieve this?  

Sample local logic (all working OK).  

    $Modules = Get-ChildItem -Path \\server\\share -filter ""*.ps1"" | Sort Name

    Function Get-MyReport{

        Param() 
        
        Begin{
            asnp ""SomeSnapIn""
        }
        Process{
            Foreach ($script in $Modules) { 
                . $script.Fullname
            }
        }
        
        End {
            $MyReport = $ModuleData
        }
        
    }

Sample remote logic. I can get the scripts to run, but they do not see the snapins, nor return variables back to the parent script.

    Function Get-MyReport{

        Param() 
        
        Begin{
            $Session = New-PSSession -Computername $Server -Credential $MyCredentials
            enter-pssession $Session
            asnp ""SomeSnapIn""
        }
        Process{
            Foreach ($script in $Modules) { 
                invoke-command -session $Session -filepath $script.Fullname 
            }
        }
        
        End {
            $MyReport = $ModuleData
        }
        
    }",,False,,t5_2qo1o,False,,,True,t3_ysrsl,http://www.reddit.com/r/PowerShell/comments/ysrsl/modular_dot_source_scripts_with_remote_sessions/,
1345661865.0,4,self.PowerShell,ynh3c,Get all computers in an OU and then check their uptime,5,1,7,http://www.reddit.com/r/PowerShell/comments/ynh3c/get_all_computers_in_an_ou_and_then_check_their/,"I'm trying to glue some snippets together to get a list of all the computers in an OU and then output their uptime in a nicely formated table.

I have the following snippet which use the ADSI commandlet to get a list of all the Computer objects in a an OU:

    $ou = [ADSI]""LDAP://OU=servers,OU=systems,DC=domain,DC=local""
    foreach ($child in $ou.psbase.Children) {
        if($child.ObjectCategory -like '*computer*') {        
            Write-Host $child.Name
        }
    }

There are lots of snippets on how to grab uptime (I like this one [here](http://www.petri.co.il/top-10-server-2008-tasks-done-with-powershell-part-2.htm#get-a-servers-uptime)).

How can I pipe the output of the ADSI snippet into the uptime snippet? Would it be easier to just combine the two and have the ""Get-Boot"" function run for each $child.Name?

The domain's functional level is Server 2003.",,False,,t5_2qo1o,False,,,True,t3_ynh3c,http://www.reddit.com/r/PowerShell/comments/ynh3c/get_all_computers_in_an_ou_and_then_check_their/,
1345140058.0,6,self.PowerShell,ybxpp,Looking for file extension colors for gci,8,2,2,http://www.reddit.com/r/PowerShell/comments/ybxpp/looking_for_file_extension_colors_for_gci/,"Having used 4NT/Bash my whole life, there was always an easy way to color files based on their file extension.  Linux users would agree, it makes it easier to spot what you are looking for.   

Is there anyway to do this in PS3?",,False,,t5_2qo1o,False,,,True,t3_ybxpp,http://www.reddit.com/r/PowerShell/comments/ybxpp/looking_for_file_extension_colors_for_gci/,
1345126399.0,5,self.PowerShell,ybjys,Adding users to groups fails when someone is in that group,5,0,8,http://www.reddit.com/r/PowerShell/comments/ybjys/adding_users_to_groups_fails_when_someone_is_in/,"I have a few thousand students to add into groups. This is what I am using to do it:

Get-ADUser -Filter * -SearchBase ""OU=Test,DC=domain,DC=local"" | Add-ADPrincipalGroupMembership -MemberOf ""CN=group,DC=domain,DC=local""

It works great until it hits a user already in that group, then it stops. Is there anyway to prevent this from happening?",,False,,t5_2qo1o,False,,,True,t3_ybjys,http://www.reddit.com/r/PowerShell/comments/ybjys/adding_users_to_groups_fails_when_someone_is_in/,
1344468091.0,4,self.PowerShell,xwqfo,How to modify extended schema attributes,4,0,7,http://www.reddit.com/r/PowerShell/comments/xwqfo/how_to_modify_extended_schema_attributes/,"We have extended our schema for a handful of thirdparty applications that require it over the years.

I would like to modify those attributes through powershell if possible.

I can return them with the ""get-aduser &lt;username&gt; -properties *"" 
But cannot specify them with a ""set-aduser -whateverattrib"".

I am looking to replace some old VBScript that I am using to handle these mass changes, but at a loss on how to do it through powershell at the moment.

I **think** quest's powershell add-on may be able to do it, based on this [link] (http://dmitrysotnikov.wordpress.com/2007/07/25/set-any-ad-attribute-with-powershell/), but I would prefer to stay away from the Quest add-ons if possible.  ",,False,,t5_2qo1o,False,,,True,t3_xwqfo,http://www.reddit.com/r/PowerShell/comments/xwqfo/how_to_modify_extended_schema_attributes/,
1344350967.0,3,self.PowerShell,xtplm,"My function only works when the parameter is passed through the pipeline, why??",4,1,4,http://www.reddit.com/r/PowerShell/comments/xtplm/my_function_only_works_when_the_parameter_is/,"I'm sure this is just me not fully understanding parameters and/or strings but I wrote a function that takes a string parameter and runs the ToCharArray() method on it. This is the code: 
    
    Function Create-Array {
            Param([parameter(mandatory=$true, ValueFromPipeline=$true)][string]$Input)
            $a = $Input.ToCharArray()
            $a
     }

When I run Create-Array -Input 'Test', $a comes up blank. 

When I run 'Test' | Create-Array, $a comes up with T,e,s,t as I intended it to.

Why does this work through the pipeline but not the other way?
",,False,,t5_2qo1o,False,,,True,t3_xtplm,http://www.reddit.com/r/PowerShell/comments/xtplm/my_function_only_works_when_the_parameter_is/,
1343920484.0,2,self.PowerShell,xkdvo,How to find files with specific length of characters,5,3,14,http://www.reddit.com/r/PowerShell/comments/xkdvo/how_to_find_files_with_specific_length_of/,"I'm sure there is another solution that directly addresses this issue, however I would like to use a script that would alleviate my woes for now.  

I am relatively new at my company (Net admin) and work with my Sr. Net Admin in our small, 50+ shop. Basically, our Exchange 2010 server (Win2K8 R2) has either been configured incorrectly at some point, or there is spam hitting it. 

Between he and I, we go into the mailboxdatabase\1711640118\ directory and have to manually delete all .log files (with an 11-character file name) on a daily basis, otherwise this dir fills up so quickly that we are no longer able to receive email from the outside. 

I am trying to create a script that will continuously run (once a day or so) and delete these until I can figure out where the root of the problem is coming from. As you can imagine, I have little time to devote to this.  

I'm sure some of you may have come across this problem at some point; As I mentioned, I know there is a better solution for this, but I am currently stuck having to clear out these log files manually and daily. 

**Edit**

Yes, I've searched google high and low for a script or even a real solution. All it turns up is 'locating files with long file paths' or 'large file sizes'....Not what I am looking for.",,False,,t5_2qo1o,1343921539.0,,,True,t3_xkdvo,http://www.reddit.com/r/PowerShell/comments/xkdvo/how_to_find_files_with_specific_length_of/,
1343858666.0,3,self.PowerShell,xj2pd,"Hey Powershell users, what part of IT do you specialize in?",4,1,28,http://www.reddit.com/r/PowerShell/comments/xj2pd/hey_powershell_users_what_part_of_it_do_you/,"I'm a junior network administrator and I love powershell because it allows me to easily accomplish tasks that would have been difficult and time consuming before I learned powershell. 

I realize that there are many specialties and niche occupations in IT and it got me wondering which of them are the heaviest powershell users? ",,False,,t5_2qo1o,False,,,True,t3_xj2pd,http://www.reddit.com/r/PowerShell/comments/xj2pd/hey_powershell_users_what_part_of_it_do_you/,
1343743400.0,6,self.PowerShell,xg63n,AD Module for Powershell - Which DC?,6,0,8,http://www.reddit.com/r/PowerShell/comments/xg63n/ad_module_for_powershell_which_dc/,"Which domain controller does the AD module for powershell talk to by default?  Does it randomly pick one in the site?  

How do I display which DC I'm connected to, and change it if necessary?",,False,,t5_2qo1o,False,,,True,t3_xg63n,http://www.reddit.com/r/PowerShell/comments/xg63n/ad_module_for_powershell_which_dc/,
1343500476.0,4,self.PowerShell,xb27h,q: how do I append the last line typed in a powershell terminal to a file?,4,0,8,http://www.reddit.com/r/PowerShell/comments/xb27h/q_how_do_i_append_the_last_line_typed_in_a/,"I was taking powershell notes from a youtube vid I was watching and I can't work out how to append the last line I typed into a text file, any clues please? in bash it'd be something like 

    echo !! &gt;&gt; notes.txt
cheers 
[[solved]]",,False,,t5_2qo1o,1343503971.0,,,True,t3_xb27h,http://www.reddit.com/r/PowerShell/comments/xb27h/q_how_do_i_append_the_last_line_typed_in_a/,
1343310084.0,6,self.PowerShell,x6szo,Looking to copy files to a new folder,7,1,7,http://www.reddit.com/r/PowerShell/comments/x6szo/looking_to_copy_files_to_a_new_folder/,"I'm trying to get powershell to grab the files from a folder, stop at 2GBs, copy those files to a new folder and start over until empty.  Doesn't matter what the name is, I guess a time stamp would be efficient.  I'm guessing I would have to use the Get-ChildItem cmdlet but I don't exactly know how to set it up to count the size to 2 GBs",,False,,t5_2qo1o,False,,,True,t3_x6szo,http://www.reddit.com/r/PowerShell/comments/x6szo/looking_to_copy_files_to_a_new_folder/,
1343268580.0,5,self.PowerShell,x60hp,Powershell v3 Invoke-RestMethod,5,0,2,http://www.reddit.com/r/PowerShell/comments/x60hp/powershell_v3_invokerestmethod/,"Trying to use this new cmdlet to POST a json file using REST API.  The POST works just fine, but I am curious if you can get the response headers somehow?  

Ie. the stuff that looks like this:

      * upload completely sent off: 660 out of 660 bytes
     &lt; HTTP/1.1 201 Created` 
     &lt; Date: Thu, 26 Jul 2012 01:20:06 GMT` 
     &lt; Server: Apache

     &lt; X-EM7-Implemented-methods: GET,PUT,POST
     &lt; X-Powered-By: ScienceLogic,LLC - EM7 API/Integration Server
     &lt; Location: /ticket/321750
     &lt; X-EM7-status-message: ticket /ticket/321750 added.
     &lt; X-EM7-status-code: CREATED
     &lt; Content-Length: 830
     &lt; Content-Type: application/json `

If you use cURL with the -v parameter you receive this info, but I cannot find a way to get this using the Invoke-RestMethod.

Any help is appreciated!",,False,,t5_2qo1o,1343269938.0,,,True,t3_x60hp,http://www.reddit.com/r/PowerShell/comments/x60hp/powershell_v3_invokerestmethod/,
1343006558.0,5,self.PowerShell,wzq9x,More issues with GCI and Copy-Item... ,5,0,6,http://www.reddit.com/r/PowerShell/comments/wzq9x/more_issues_with_gci_and_copyitem/,"Code here:

    $Files = gci $Src | ? {$_.LastWriteTime -ge $Date} | Select-Object Name 
    $Files = foreach ($File in $Files) { if($_.Name -like '*-no*') { copy-item -destination $ScrubPath -force -OutVariable To_Rename }
    else { copy-item -destination $FinalDest -force }}

Long story short I'm copying files from one server to another, so have -No1 appended on the end, and I need to remove that so I'm sending them into a different folder to be renamed and then copied back in.  This portion of my code is giving me the error: ""cmdlet Copy-Item at command pipeline position 1
Supply values for the following parameters:""

Any advice?",,False,,t5_2qo1o,False,,,True,t3_wzq9x,http://www.reddit.com/r/PowerShell/comments/wzq9x/more_issues_with_gci_and_copyitem/,
1342743722.0,4,self.PowerShell,wuhzy,A conundrum on date formats,5,1,3,http://www.reddit.com/r/PowerShell/comments/wuhzy/a_conundrum_on_date_formats/,"Code and sample, then I will explain:

    $nowDate = get-date -uformat %c
    foreach ($lineContent in (Get-Content $fileName)) {
        $thisLine = $lineContent -split "",""
        $nowDate
        if ([datetime]$thisLine[0] -lt [datetime]$DRGLastRun) { continue }
        $thisLine[0]
    }


Thu Jul 19 00:03:11 2012
Thu Jul 19 17:14:05 2012
Cannot convert value ""Thu Jul 19 00:03:11 2012"" to type ""System.DateTime"". Error: ""String was not recognized as a valid DateTime.""

..

..

..

The $nowDate variable is created directly from get-date. The $thisLine[0] string is grabbed from similarly formatted strings on each line of a text file. I've tried specifying format with [datetime] as above, and by using ""(Get-Date $DRGLastRun)"" (which comes from an environment variable I set, to make it accessible between runs), but always get this error. How can I ensure that it's doing a date-to-date comparison so I can only deal with lines newer than the last time this script was run and set the environment variable?

Thanks!",,False,,t5_2qo1o,False,,,True,t3_wuhzy,http://www.reddit.com/r/PowerShell/comments/wuhzy/a_conundrum_on_date_formats/,
1342471372.0,4,self.PowerShell,wnviy,Want to save text file content to a variable with proper line spacing. Help?,6,2,2,http://www.reddit.com/r/PowerShell/comments/wnviy/want_to_save_text_file_content_to_a_variable_with/,"So I'm building an UpdateFile fucntion that's basically just a find and replace function for text files. When I use the following call to obtain what's already in the file

    $fileContents = Get-Content $fileName

and then write it back to the file after replacing strings of the text, the resulting text file displays all the text as one line.

Example:
Text file before UpdateFile called (assume nothing gets replaced):

Hi I'm Jim

Hi I'm Jane

Text file after UpdateFile called:

Hi I'm JimHi I'm Jane

I did some playing around in the powershell terminal. It seems when I make a call like

    $file = get-content ""sample.txt""

$file stores the text content, and when I enter 

    $file

in the command line by itself, the text gets returned with proper line spacing, but if I say

    write-host $file

the text gets returned without proper line spacing. I am wondering how I need to adjust my calls in getting the content of the text file and/or adding content to the text file (add-content $filename $contents) so that the line spacing stays the same. Any solutions?

",,False,,t5_2qo1o,False,,,True,t3_wnviy,http://www.reddit.com/r/PowerShell/comments/wnviy/want_to_save_text_file_content_to_a_variable_with/,
1342191541.0,6,self.PowerShell,wi20z,"Converting VB scripts to Powershell. Is there an equivalent of VB's GetObject(""winmgmts://"")?",7,1,9,http://www.reddit.com/r/PowerShell/comments/wi20z/converting_vb_scripts_to_powershell_is_there_an/,"I need to iterate through the list    GetObject(""winmgmts://"").InstancesOf(""win32_process"") 
and close the processes that are running. Technet did have a conversion for the GetObject method but it involved importing functions from VB and said you can't really do anything with the object without importing other VB functions. Is there an easier way to obtain this list in Powershell?",,False,,t5_2qo1o,False,,,True,t3_wi20z,http://www.reddit.com/r/PowerShell/comments/wi20z/converting_vb_scripts_to_powershell_is_there_an/,
1341941451.0,5,self.PowerShell,wc59t,Get/Set ACL,5,0,3,http://www.reddit.com/r/PowerShell/comments/wc59t/getset_acl/,"I have a folder that I constantly have to set the permissions on; and I don't know what's resetting the permissions back. Is this as simple as grabbing the permissions on the folder with Get-ACL, piping that into a file, and reading that into Set-ACL?

A lot of the examples I see are:
$variable = Get-ACL C:\file
Set-ACL C:\file -aclobject $variable

Does this work if I have the ACL piped into a text file?
eg Get-ACL C:\Folder\File &gt; C:\temp\file.txt
Set-Acl C:\whatever\file -aclobject C:\temp\file.txt

Or am I misunderstanding these variables and pipes completely? ",,False,,t5_2qo1o,False,,,True,t3_wc59t,http://www.reddit.com/r/PowerShell/comments/wc59t/getset_acl/,
1341261898.0,5,connectppe.microsoft.com,vxxpm,Please explain how or why I cannot get PowerShell FullScreen on Windows 8/2012. Alternatives?,8,3,1,http://www.reddit.com/r/PowerShell/comments/vxxpm/please_explain_how_or_why_i_cannot_get_powershell/,,,False,,t5_2qo1o,False,,,False,t3_vxxpm,http://connectppe.microsoft.com/PowerShell/feedback/details/694058/full-screen,
1340744121.0,4,self.PowerShell,vndoh,SCCM Package Management with PowerShell,5,1,8,http://www.reddit.com/r/PowerShell/comments/vndoh/sccm_package_management_with_powershell/,"SCCM 2007 R3, one site, one Active directory domain.  Several distribution point servers, one management point server.

I'm interested in scripting a method of checking to ensure packages are distributed to all distribution points in my environment.  So far I've gotten a method of scripting a package install to a single distribution point and a method of reading a list of all distribution points to find all packages.

[I posted my work in progress here](http://blog.jf-online.com/blog/sccmpackagemanagementwithpowershell)

What I'm not sure of is how to intelligently parse my CSV export (or use a different method of storing the data than a CSV export) and how to loop and process for each package on each distribution point.",,False,,t5_2qo1o,False,,,True,t3_vndoh,http://www.reddit.com/r/PowerShell/comments/vndoh/sccm_package_management_with_powershell/,
1340648932.0,5,self.PowerShell,vl0ys,"Import csv with usernames, query AD, export to new csv with usernames and EmployeeID",5,0,5,http://www.reddit.com/r/PowerShell/comments/vl0ys/import_csv_with_usernames_query_ad_export_to_new/,"So this has been driving me all sorts of crazy the past few weeks or so.  I have a file, usernames.csv with about 100k AD valid usernames, 1 username per line.  I am trying to create an AD powershell script that will take the usernames from this file, and export the username and EmployeeID to a new CSV, usernames_employeeids.csv.  I'd like to avoid the Quest stuff if possible.

Here is what I have so far... 

import-module ActiveDirectory

Import-CSV c:\usernames.csv | ForEach-Object -Process {Get-ADUser $_.UserName -Properties | select employeeid} | Export-CSV c:\usernames_employeeids.csv

**usernames.csv** contents:

UserName

username01

username02, etc etc

Any help would be most appreciated!",,False,,t5_2qo1o,1340650464.0,,,True,t3_vl0ys,http://www.reddit.com/r/PowerShell/comments/vl0ys/import_csv_with_usernames_query_ad_export_to_new/,
1338580103.0,4,self.PowerShell,ug3fa,Catch errors and Prettify my termUsers script?,5,1,2,http://www.reddit.com/r/PowerShell/comments/ug3fa/catch_errors_and_prettify_my_termusers_script/,"Trying to disable a batch of users as minimally as I can.  Starting with [this AD Termination Script](http://gallery.technet.microsoft.com/scriptcenter/83691ca6-c564-4e45-8d44-04a08dfa90c0) I've trimmed it down to just a couple functions. 

    # Add required snap-ins
    Add-PSSnapin Quest.ActiveRoles.ADManagement
    Add-PSSnapin Microsoft.Exchange.Management.PowerShell.Admin 

    import-CSV ""c:\AD Scripts\Term\termUsers.csv"" | foreach-object { 
        $username=$_.""Network ID""

        # Move user account to the Disabled Accounts OU
        Move-QADObject -identity $username -NewParentContainer ""domain.com/Users/Disabled Accounts""
    
        # Hide mailbox from the GAL
        Set-Mailbox -Identity $username -HiddenFromAddressListsEnabled $true
    
        # Disable the user account
        Disable-QADUser $username

       Get-Mailbox $username | Format-List -property SamAccountName, DisplayName, ExchangeUserAccountControl, Identity, HiddenFromAddressListsEnabled, WhenChanged  | out-file -filepath .\test.log -append
      } 

Now I'm trying to log the verification and make it pretty.  What I'd love to get would be a logfile that verifies the account is disabled, mailbox is hidden, they're in the right OU, time disabled (can be from a get-date call) and who ran the script (current user running the script).  

Also, is there a way for the script to say ""hey, I did all this, but there's no mailbox, so I ran get-qaduser instead""?  ",,False,,t5_2qo1o,False,,,True,t3_ug3fa,http://www.reddit.com/r/PowerShell/comments/ug3fa/catch_errors_and_prettify_my_termusers_script/,
1338485375.0,5,self.PowerShell,ue5kl,Scan individual computers for installed patches,6,1,6,http://www.reddit.com/r/PowerShell/comments/ue5kl/scan_individual_computers_for_installed_patches/,"I work in a test lab, and we have to report on WSUS patches on a per machine bases.  I have been trying to use PowerShell to get a list of installed patches, but I can't seem to find a way to scan individual machines.  This WSUS server is a primary server with several downstream servers. Each downstream server is in a separate domain, and there is no trusts between each domain (They are separate test labs).  The primary WSUS server is in workgroup.  I am have looked around Google, and found a few guides on Learn Powershell, but I haven't really found a way to scan the individual systems, they mostly focus on how to approve and install patches.  Any help would be greatly appreciated.  

A comment that was made and then delete gave the answer I was looking for:  
    Get-Hotfix -ComputerName $Hostname

Also [This post] (http://www.reddit.com/r/PowerShell/comments/ue5kl/scan_individual_computers_for_installed_patches/c4uoo1b) found a really good script.  Thanks again to all who helped.",,False,,t5_2qo1o,1338506866.0,,,True,t3_ue5kl,http://www.reddit.com/r/PowerShell/comments/ue5kl/scan_individual_computers_for_installed_patches/,
1337710759.0,3,self.PowerShell,tzls7,missing modules powershell 2.0,4,1,17,http://www.reddit.com/r/PowerShell/comments/tzls7/missing_modules_powershell_20/,"I'm really confused on how to get standard MS modules.  I'm trying to work with the group policy module.  From what I'm reading it's supposed to be available if you are using powershell from a domain controller running Windows 2008 R2.  I indeed have a 2k8 r2 box and I have run dcpromo on it.  I do not have access to this module.  I don't have anything other than what comes installed with the installer found here http://support.microsoft.com/kb/968929.  

PS C:\Users\Administrator.gpotester&gt; get-module -ListAvailable

ModuleType Name                      ExportedCommands
---------- ----                      ----------------
Manifest   BitsTransfer              {}
Manifest   PSDiagnostics             {}


I would expect to see the active directory module and the group policy module but they're nowhere to be found.  I can't find these modules available for download anywhere either.  What am I doing wrong here?",,False,,t5_2qo1o,False,,,True,t3_tzls7,http://www.reddit.com/r/PowerShell/comments/tzls7/missing_modules_powershell_20/,
1337630006.0,2,self.PowerShell,txzj7,Need help suppressing an error output in a PowerShell function/script,4,2,5,http://www.reddit.com/r/PowerShell/comments/txzj7/need_help_suppressing_an_error_output_in_a/,"I want to do reverse DNS lookup and am using this:

    Invoke-Expression ""nslookup xxx.xxx.xxx.xxx""

I then parse out the system name. The problem comes from when the DC has no DNS record for the IP. I get the following from nslookup:

    *** domaincontroller.company.biz can't find xxx.xxx.xxx.xxx: Non-existent domain

I think its the three asterisks that are screwing me up. I tried using -ErrorAction and -WarningAction, but it doesn't seem to help.

I'm including the full script for reference:
    
    function Reverse-Lookup ([string]$Ip)
    
    {
    
    	$rev1 = Invoke-Expression ""nslookup $Ip"" -ErrorAction SilentlyContinue -WarningAction SilentlyContinue
        $rev2 = $rev1 | Where-Object {$_ -like ""name*""}
        if (!$rev2) {
                Write-Host ""NSLOOKUP error for"" $Ip "": Non-existent domain""
                    }
        else {
        	$rev3 = $rev2 | ForEach-Object {$_.split("":"")[1]}
        	$rev4 = $rev3.trim()
        	$rev5 = $rev4.split(""."")
        	$rev6 = $rev5[0].toupper()
            Write-Host $rev6 ""   "" $Ip
             }
    	
    }
    
    Set-Alias -Name rev -Value Reverse-Lookup
    ",,False,,t5_2qo1o,False,,,True,t3_txzj7,http://www.reddit.com/r/PowerShell/comments/txzj7/need_help_suppressing_an_error_output_in_a/,
1337314760.0,5,self.PowerShell,tstah,Dead Man Switch Using POSH,6,1,14,http://www.reddit.com/r/PowerShell/comments/tstah/dead_man_switch_using_posh/,"Is there a way to set a script so if it's not accessed or updated within a certain period it activates thereby acting as a dead man switch? 

I was thinking about creating a script to erase my browsing histories and various select folders if left unattended long enough. 

**Edit: So far I have created the switch to erase the contents if not checked within 10 days. It will clear recycle bin, internet explorer records, command history and erase certain private folders. My only sticking point is clearing Chrome's history, apparently there is no possible way to do this on my system.**",,False,,t5_2qo1o,1337395785.0,,,True,t3_tstah,http://www.reddit.com/r/PowerShell/comments/tstah/dead_man_switch_using_posh/,
1337309737.0,3,self.PowerShell,tspkr,Need help with Set-StrictMode with Switch in a Parameter Set,4,1,3,http://www.reddit.com/r/PowerShell/comments/tspkr/need_help_with_setstrictmode_with_switch_in_a/,"I'm having trouble with the following code in a script I've written for work. When I enable strict mode (Using 1, 2 or Latest as the Version) I am unable to treat $Reboot as a bool. This same code works if I move $Reboot to the ""inital"" Parameter Set, or if I remove the Parameter Sets completely.

    [CmdletBinding(DefaultParameterSetName=""inital"")]
    param(
        [Parameter(Mandatory=$true, ParameterSetName=""inital"")][string]$ComputerName,
        [Parameter(Mandatory=$true, ParameterSetName=""inital"")][string]$Username,
        [Parameter(Mandatory=$true, ParameterSetName=""inital"")][string]$Password,
        [Parameter(Mandatory=$true, ParameterSetName=""reboot"")][switch]$Reboot
        )
   
    Set-StrictMode -Version Latest
   
    if($Reboot)
    {
        Write-Host ""Reboot flag is set"" -ForegroundColor Green
    }
    else
    {
        Write-Host ""Reboot flag is not set"" -ForegroundColor Red
    }
   
I've also tried using if($Reboot.isPresent) with the same results.

I've gotten around it by replacing if($Reboot) with if(Test-Path -Path ""Variable:\Reboot""), but this seems fairly inelegant to me.

I consider myself able to navigate PowerShell fairly well, but this one has me stumped. Any help would be greatly appreciated.",,False,,t5_2qo1o,False,,,True,t3_tspkr,http://www.reddit.com/r/PowerShell/comments/tspkr/need_help_with_setstrictmode_with_switch_in_a/,
1336590560.0,3,self.PowerShell,tf4rj,Help with exporting contacts from exchange 2010 mailboxes.,4,1,5,http://www.reddit.com/r/PowerShell/comments/tf4rj/help_with_exporting_contacts_from_exchange_2010/,Well we just had our exchange engineer quit and his duties have fallen to me. We are on exchange 2010.  I just started learning power shell so i am very green. I can export group membership and mailbox size and statistics ect. Very basic stuff here. Well  today I got tasked with exporting every users(700+) contact lisst from their mailboxes. This way we don't have to do it individually. I have done my normal goole-fu and I am having no luck finding anything to get me started. Has anyone successfully done something like this? or can help me in any way .,,False,,t5_2qo1o,True,,,True,t3_tf4rj,http://www.reddit.com/r/PowerShell/comments/tf4rj/help_with_exporting_contacts_from_exchange_2010/,
1336503703.0,4,self.PowerShell,tdclk,Splitting a string into an array while intelligently handling existing quotes?,4,0,10,http://www.reddit.com/r/PowerShell/comments/tdclk/splitting_a_string_into_an_array_while/,"I have the following from a netsh dhcp dump of a DHCP server:

    Dhcp Server \\bob.domain.foo Scope 10.0.11.0 Add reservedip 10.0.11.77 001279fc8723 ""bobscomputer.domain.foo"" ""bobs description"" ""BOTH""

I'd like to split this into an array, but keep quoted strings together, so I can't just split on spaces. It seems like something Powershell should handle pretty easily, but can't seem to find an example. Anyone able to give one?

Thanks!",,False,,t5_2qo1o,False,,,True,t3_tdclk,http://www.reddit.com/r/PowerShell/comments/tdclk/splitting_a_string_into_an_array_while/,
1336146497.0,4,self.PowerShell,t6z31,Regex search on a website via PowerShell,4,0,11,http://www.reddit.com/r/PowerShell/comments/t6z31/regex_search_on_a_website_via_powershell/,"I'm working on a homework assignment, so I don't expect or want a step by step how to.

The issue I have is that I need to search a given online article using a regex. I need to save the matches to a text file.  These procedures need to be written as a script (Hence my need for PowerShell to read a webpage). The issue I'm having is that I am not able to read the text of the article (what you would see in the browser) Instead I keep reading the code behind the article.  I tried creating net.webclient object, I've also tried saving the web page to harddisk and using select-string on the file. Same result either way.

Basically, is there a way to get PowerShell to read the user-side text on a webpage?


EDIT:
Here is what I have for the net.webclient object

$w = (new-object net.webclient).DownloadString(""http://www.uis.edu/htbin/cgiwrap/bin/ojs.fm/index.php/fm/article/view/3156/2747"")

echo $w

[html code prints]

I did the echo to see what is actually in the object.",,False,,t5_2qo1o,True,,,True,t3_t6z31,http://www.reddit.com/r/PowerShell/comments/t6z31/regex_search_on_a_website_via_powershell/,
1335905552.0,2,self.PowerShell,t232e,"Clear ""forgotten"" reminders?",4,2,3,http://www.reddit.com/r/PowerShell/comments/t232e/clear_forgotten_reminders/,"I think I've found an ugly solution, but I'd love some input on an elegant one:

I'm sure other Exchange admins have those special users who don't seem to understand the purpose and value of reminders. Today I traced some of our Exchange (2007) server resource exhaustion to one user with almost 1,700 overdue reminders, with about 1,600 more than a month passed and the oldest going back over a year. Every time a reminder popped up the server had to sift through a 90GB mailstore to populate the rest of the list, stopping everything else the server was trying to do.

I went in manually behind the scenes and dismissed everything older than 5 weeks, but I can't do that once a week across my user base - we've all got better things to do.

Sounds like a job for powershell or other scripting, but I'm not finding anything.  It doesn't really have to be powershell or global, but the only alternative I'm seeing is MAPI &amp; VBA - too deep for me.",,False,,t5_2qo1o,False,,,True,t3_t232e,http://www.reddit.com/r/PowerShell/comments/t232e/clear_forgotten_reminders/,
1335683822.0,5,adicodes.com,sxxbp,Copy or Replace list items in PowerShell,10,5,4,http://www.reddit.com/r/PowerShell/comments/sxxbp/copy_or_replace_list_items_in_powershell/,,,False,,t5_2qo1o,False,,,False,t3_sxxbp,http://adicodes.com/copy-or-replace-list-items-in-powershell/,
1334878690.0,4,self.PowerShell,sioqg,Modify Trigger for a Scheduled Task,4,0,2,http://www.reddit.com/r/PowerShell/comments/sioqg/modify_trigger_for_a_scheduled_task/,"I am playing around with the automatic silent updating capabilities for Adobe Flash player. What I have found is that it works great for IE. On a few test computers though if Firefox was open when the task ran it clobbered the plugin install which required Flash to be reinstalled manually.

The way the silent update works is it runs a scheduled task as the sytem account once an hour. I need to change the trigger to be onstart (when the computer starts up). 

schtask.exe leaves much to be desired because from what I can tell the /SC (trigger) flag is not valid for schtask /change. So if I want to script this task change I will have to delete the existing scheduled task and then create a new task which doesn't have any of the adobe stuff, such as comments, etc. 

Does anyone know a command line way to modify the trigger of a scheduled task?

EDIT: Ended up not using powershell for this one. But [Here](http://pastebin.com/hqnYyWtr)
is a copy of what I did in case anyone else wants to try it out.
Thanks for your help.",,False,,t5_2qo1o,True,,,True,t3_sioqg,http://www.reddit.com/r/PowerShell/comments/sioqg/modify_trigger_for_a_scheduled_task/,
1334713319.0,3,self.PowerShell,sf923,"How to Proxy to Exchange, AD and Lync",5,2,4,http://www.reddit.com/r/PowerShell/comments/sf923/how_to_proxy_to_exchange_ad_and_lync/,"I'm currently running a 'new user' script that is working pretty well. Currently I can connect to Exchange and Lync fine using

    $exchangeSession = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri http://$exchangeserver/PowerShell/ -Authentication Kerberos -Credential $UserCredential
    Import-PsSession $exchangesession
    $lyncsession = new-pssession -connectionuri https://$Lyncserver/ocspowershell -credential $usercredential
    Import-PSSession $lyncsession

I assumed importing AD commands (i.e. new-adgroupmember) would be similar
I tried

    $adsession = new-pssession -ConfigurationName Microsoft.ServerManager -ComputerName $ADserver -Credential $UserCredential
    Import-PSSession $adsession 
This doesnt work, if i remove the -configurationName section I can proxy normal commands fine but I cant import the Active Directory commandlets.

Is this an easy task or would I be better off installing the module locally and using a -server switch in all commands?

Thanks",,False,,t5_2qo1o,False,,,True,t3_sf923,http://www.reddit.com/r/PowerShell/comments/sf923/how_to_proxy_to_exchange_ad_and_lync/,
1334698247.0,4,self.PowerShell,sev8a,Downloading VMDK file from VCenter comes back with 1kb file with Copy-DatastoreItem,4,0,7,http://www.reddit.com/r/PowerShell/comments/sev8a/downloading_vmdk_file_from_vcenter_comes_back/,"Hey guys, I'm a bit stuck on this issue.

    $ds = Get-Datastore ""Datastore""
    New-PSDrive -Name MyDS -PSProvider ViMdatastore -Root '\' -location $ds    
    Copy-DatastoreItem MyDS:\xpTest\xpTest.vmdk -Destination C:\datastoreitems -Force 

Downloading that file to C:\datastoreitems returns with a 1 kb file when it should be about 5 gb.  I can download other, smaller files.  Has anyone run into this before?",,False,,t5_2qo1o,False,,,True,t3_sev8a,http://www.reddit.com/r/PowerShell/comments/sev8a/downloading_vmdk_file_from_vcenter_comes_back/,
1334009369.0,3,self.PowerShell,s1i3z,Capture Exchange mailbox details into XML file on schedule,4,1,0,http://www.reddit.com/r/PowerShell/comments/s1i3z/capture_exchange_mailbox_details_into_xml_file_on/,"For various reasons we need to keep mailbox history as mailboxes move from one server to another, we needed a solution for our 07 environment. Here's a script that can be scheduled to run daily and will capture essential mailbox info into a set of XML files (one per server). On Mondays full capture is performed, for the rest of the week only objects that were changed during last 24 hours are captured. XML files are then compressed to save space.

		# Parameters
		# Path to the root of the archive folder
		$folderPath = 'D:\'
		# End Parameters
		$startDate = Get-Date
		# compress output files
		Function ZipThis ($zipName, $fileName) {
			if ((test-path $zipName)) { 
				Remove-Item $zipName
			} 
			$test = set-content $zipName (""PK"" + [char]5 + [char]6 + (""$([char]0)"" * 18)) 
			$ZipFile = (new-object -com shell.application).NameSpace($zipName) 
			$zipfile.CopyHere($fileName)
			While ((test-path $fileName))	{
				Sleep -Seconds 1
				Remove-Item $fileName -ErrorAction SilentlyContinue -WarningAction SilentlyContinue
			}
		}

		$dbs = Get-MailboxDatabase -IncludePreExchange2007 -ErrorAction SilentlyContinue -WarningAction SilentlyContinue | `
			Where-Object {($_.StorageGroupName) -notmatch 'Recovery'} | `
			Sort-Object -Property ServerName, StorageGroupName, Name | `
			Group-Object Server

		foreach ($groupServer in $dbs)	{
			$mbs = @()
			
			# Write progress for servers
			$prog_serv = [math]::round((([array]::IndexOf($dbs,($groupServer))+1)/($dbs.Count/100)),2)
			 write-progress -activity ""Server"" -status ($groupServer.Name) -percentcomplete $prog_serv -Id 1

			foreach ($db in ($groupServer.Group))	{
				
				#Write Progress for Stores
				$prog_dbs = [math]::round((([array]::IndexOf([array]$groupServer.Group,$db)+1)/($groupServer.Group.Count/100)),2)
				 write-progress -activity ""Store"" -status ($db.Name) -percentcomplete $prog_dbs -Id 2 -ParentId 1
				
				$outFile = $folderPath + ($startDate).ToString(""yyyyMMdd"") + '_' + $db.servername
				if (($startDate).DayOfWeek -eq 'Monday')	{
					$mbs += @(Get-Mailbox -Database $db -ResultSize Unlimited -IgnoreDefaultScope `
						-ErrorAction SilentlyContinue -WarningAction SilentlyContinue | `
						Select-Object -Property Database, ExchangeGuid, IsMailboxEnabled, `
							ProhibitSendQuota, ProhibitSendReceiveQuota, IsResource, IsLinked, `
							IsShared, SamAccountName, ServerLegacyDN, ServerName, `
							UseDatabaseQuotaDefaults, IssueWarningQuota, UserPrincipalName, `
							Alias, DisplayName, HiddenFromAddressListsEnabled, LegacyExchangeDN, `
							MaxSendSize, MaxReceiveSize, PrimarySmtpAddress, WindowsEmailAddress, `
							IsValid, OriginatingServer, Name, Identity, Guid, WhenChanged, WhenCreated )
				}
				else	{
					$mbs += @(Get-Mailbox -Database $db -ResultSize Unlimited -IgnoreDefaultScope `
						-ErrorAction SilentlyContinue -WarningAction SilentlyContinue | `
						Select-Object -Property Database, ExchangeGuid, IsMailboxEnabled, `
							ProhibitSendQuota, ProhibitSendReceiveQuota, IsResource, IsLinked, `
							IsShared, SamAccountName, ServerLegacyDN, ServerName, `
							UseDatabaseQuotaDefaults, IssueWarningQuota, UserPrincipalName, `
							Alias, DisplayName, HiddenFromAddressListsEnabled, LegacyExchangeDN, `
							MaxSendSize, MaxReceiveSize, PrimarySmtpAddress, WindowsEmailAddress, `
							IsValid, OriginatingServer, Name, Identity, Guid, WhenChanged, WhenCreated | `
						Where {$_.whenchanged -gt (($startDate).addDays(-1).ToShortDateString())})
				}
			}
			($mbs |ConvertTo-Xml).Save($outFile + '.xml')
			ZipThis ($outFile + '.zip') ($outFile + '.xml')
		}",,False,,t5_2qo1o,False,,,True,t3_s1i3z,http://www.reddit.com/r/PowerShell/comments/s1i3z/capture_exchange_mailbox_details_into_xml_file_on/,
1333594403.0,3,self.PowerShell,ru1w1,Restart a service when a process is taking a certain amount of handles?,5,2,3,http://www.reddit.com/r/PowerShell/comments/ru1w1/restart_a_service_when_a_process_is_taking_a/,"[this is me with powershell](http://sureiscute.com/images/cutepictures/I_Have_No_Idea_What_I_m_Doing.jpg). Learning is on my to-do list, but I've just inherited an account that needs some urgent attention.

Here's my situation: Exchange 2010 on 2008R2, edgetransport.exe has a steadily increasing number of handles from boot to eventual (~12 hours of uptime) complete system lockup. It's not even handling any mail yet, it's a fresh install. Mail for this organization is still being handled by a 2003 server, no boxes have even been moved over yet. AFAIK, exchange is doing absolutely nothing yet edgetransport.exe just keeps plugging along. I've limited the Exchange database cache already, about 10 minutes ago, but until I can diagnose the issue what I'd like to have is a script that will restart the Microsoft Exchange Transport Service whenever EdgeTransport.exe is using a certain number of handles.

Anyone got any pointers?",,False,,t5_2qo1o,False,,,True,t3_ru1w1,http://www.reddit.com/r/PowerShell/comments/ru1w1/restart_a_service_when_a_process_is_taking_a/,
1333572670.0,5,self.PowerShell,rti30,Difference between piping and using InputObject?,6,1,6,http://www.reddit.com/r/PowerShell/comments/rti30/difference_between_piping_and_using_inputobject/,"**EDIT:** I should qualify, I've tried adding multiple pipeline parameters in the second command and this is also for the express purpose of restarting services on remote machines since the *-Service cmdlets don't have proper remote machine control built in.

Okay, ran into something a bit confusing today. Up till now I figured using the pipeline was the most effective way of doing interesting things, but now I'm concerned. Take these 2 commands:

    Restart-Service -InputObject (Get-Service -ComputerName $RemotePC -Name ""spooler"")

    Get-Service -ComputerName $RemotePC -Name ""spooler"" | Restart-Service

Now the first one works, the second one errors out. This is in a clean Powershell v2 environment. I'm guessing there's still a lot of quirks to find but this one I thought was interesting.

I've also tried using Get-WmiObject and Invoke-Command, but GWMI is unreliable at best and Invoke-Command relies on me having powershell remoting enabled on the remote PC.

I like using the first method and it's nice and easy to do error checking on too! I just thought this was interesting.

Anybody have a neat little explanation?",,False,,t5_2qo1o,True,,,True,t3_rti30,http://www.reddit.com/r/PowerShell/comments/rti30/difference_between_piping_and_using_inputobject/,
1332994643.0,4,self.PowerShell,rirjm,Function question,4,0,9,http://www.reddit.com/r/PowerShell/comments/rirjm/function_question/,"http://pastebin.com/3svDwk3d

I'm a java programmer a couple days into learning powershell. I've taken an example from Powershell in Action 2ed but am having trouble getting it to work properly. In the linked script, function 'foo' works both with pipelines and without, but function 'Append-Poop' doesn't. Inspecting the types in PowerGUI makes it appear that they're both just lists, so I don't understand why they behave differently.

In the code, the output from line 25 is just ""-poop"". Then down on line 42, the output is
1
2
3

What am I missing?",,False,,t5_2qo1o,False,,,True,t3_rirjm,http://www.reddit.com/r/PowerShell/comments/rirjm/function_question/,
1332783504.0,4,self.PowerShell,regui,Need another set of eyes on this...,6,2,10,http://www.reddit.com/r/PowerShell/comments/regui/need_another_set_of_eyes_on_this/,"[Here is the script](http://pastebin.com/fcgNSMpj)

Essentially, when we disable users, we remove the mailbox entirely and create a distribution group for forwarding their email to managers and /or whomever else needs to get the emails. Everything works except for the piece where it adds the user's email address to the distribution group.

I'm guessing that the email address is still ""in use"" on the server so it can't assign it to the distribution group, but for the life of me I can't think of a way to make the script check and wait for the address to become available. 

Any comments/criticism are fully welcome. ",,False,,t5_2qo1o,False,,,True,t3_regui,http://www.reddit.com/r/PowerShell/comments/regui/need_another_set_of_eyes_on_this/,
1332632665.0,4,self.PowerShell,rc0m1,Edit a CSV,5,1,3,http://www.reddit.com/r/PowerShell/comments/rc0m1/edit_a_csv/,"Hello r/PowerShell,

I'm trying to create a script that imports a csv and runs it through a while loop looking for **Yes** or **No** in column poop. When it finds a **No** it changes it to a **Yes** and runs some other code. What I can't figure out is how do I write these changes back to the csv file. 

This is the code:

    # import the csv containing all the poops
    $list = import-csv .\Test.csv
    
    $Poop = $list.Poop
    
    # Step 1.
    
    $i = 0
    while ($i -le $Poop.count - 1) {
    
        if ($Poop[$i] -eq ""No"") {
           
            Write-Host ""NO becomes YES at"" $i
            $Poop[$i] = ""Yes""
            # Code HERE
            }
        $i++
    }


Any help would be appreciated.",,False,,t5_2qo1o,False,,,True,t3_rc0m1,http://www.reddit.com/r/PowerShell/comments/rc0m1/edit_a_csv/,
1332248800.0,4,self.PowerShell,r50kr,"Input file of names from AD, need to use robocopy to copy home folders. Yup, I am a n00b to PS, please tell me where I am going wrong with this",6,2,10,http://www.reddit.com/r/PowerShell/comments/r50kr/input_file_of_names_from_ad_need_to_use_robocopy/,"Where I work we have users that regularly deploy and they want to take their home folders with them. The home folders are set up on NetApp filers and broken down by folders a-z by last name using the sAMAccountName. Something like \\filer1\users$\s\john.smith\. It isn't easy to grab all of the users from one unit and ndmpcopy or robocopy them out of where they are. 

The units do provide us with a list of names (the name field from AD) and I can use it as an input file to do a Get-ADUser and return their homDirectory path and the sAMAccountName. I thought that it would be a pretty simple script to use that list and robocopy but I have done something wrong and I am not sure what.

This is what I did;



$inFile = read-host ""Please enter the complete path and file name to be used"" 

$outdest = read-host ""Please enter the detination path""  

$name = Get-Content $inFile

[array]$list = Get-ADUser -Filter {(City -like ""Fort Someplace"" -and Name -like $name)} -Property SamAccountName,HomeDirectory

for ($i=0; $i -lt $($list.Length); $i++)

{

   $path = $list[$i].HomeDirectory

   $SamAccountName = $list[$i].SamAccountName

}

foreach ($path in $path)

  {

   $source = ""$path""

   $dest= ""$outdest""'\'""$SamAccountName""

   $what = @(""/COPYALL"",""/B"",""/SEC"",""/MIR"")

   $options = @(""/R:0"",""/W:0"",""/NFL"",""/NDL"",""/MT:50"")

   $cmdArgs = @(""$source"",""$dest"",$what,$options)

   robocopy @cmdArgs

  }   



Any help would be greatly appreciated.",,False,,t5_2qo1o,True,,,True,t3_r50kr,http://www.reddit.com/r/PowerShell/comments/r50kr/input_file_of_names_from_ad_need_to_use_robocopy/,
1332245541.0,3,self.PowerShell,r4z3m,Changing default printer permissions.,4,1,5,http://www.reddit.com/r/PowerShell/comments/r4z3m/changing_default_printer_permissions/,"I created a group policy to install default printers on a domain yesterday which is working beautifully.  However, the printers are being created with the user only having the ability to print.  I would like them to be able to do things like modify (cancel) print jobs, change tray options (etc) on their printer.  Does anyone know how to do this via script or perhaps another GP that changes the default security on a printer?  This is a mixed XP/7 environment.  

Crossposted to the windows reddit also",,False,,t5_2qo1o,False,,,True,t3_r4z3m,http://www.reddit.com/r/PowerShell/comments/r4z3m/changing_default_printer_permissions/,
1332165951.0,4,ipugd.org,r3g2c,Today is International PowerShell User Group Day!,4,0,1,http://www.reddit.com/r/PowerShell/comments/r3g2c/today_is_international_powershell_user_group_day/,,,False,,t5_2qo1o,False,,,False,t3_r3g2c,http://ipugd.org/,
1331139570.0,4,csharpening.net,qlx5o,Sessions and Speakers for the PowerShell Deep Dive have been posted!,4,0,0,http://www.reddit.com/r/PowerShell/comments/qlx5o/sessions_and_speakers_for_the_powershell_deep/,,,False,,t5_2qo1o,False,,,False,t3_qlx5o,http://csharpening.net/?p=1001,
1330641969.0,4,self.PowerShell,qdl0z,Noob needs help with script to find software version,4,0,6,http://www.reddit.com/r/PowerShell/comments/qdl0z/noob_needs_help_with_script_to_find_software/,"As a project to work on from my manager to help me learn powershell, I'm supposed to find if certain computers have a certain application on it and if so the version number. I cannot use anything with VersionInfo because the software has a bug in it and displays the version number as 0. 

This is the script I have now:
&gt;$arrComputers = get-Content -Path ""C:\pcs.txt""
&gt;
&gt;foreach ($strComputer in $arrComputers) 
&gt;{
&gt;$objcollection = Get-wmiObject Win32_Product | Where-Object {$_.Name -eq ""Remote Deposit Capture""}
&gt;   
&gt;foreach ($objItem in $objcollection)
&gt;    {
&gt;  Write-Host “Computer Name:” $strComputer
&gt;  Write-Host ""Name:"" $objItem.Name
&gt;   Write-Host ""Version:"" $objItem.Version
&gt;    }
&gt;}

The problem I'm having is that the script will not run all of the computers, it will only run on the host machine. If I run the command on one remote machine it works fine. I'm using PowerShell v1. Any suggestions? Thanks.",,False,,t5_2qo1o,False,,,True,t3_qdl0z,http://www.reddit.com/r/PowerShell/comments/qdl0z/noob_needs_help_with_script_to_find_software/,
1330106918.0,4,self.PowerShell,q4bv0,Please help a noob with powershell - Finding Shares + Permissions,4,0,5,http://www.reddit.com/r/PowerShell/comments/q4bv0/please_help_a_noob_with_powershell_finding_shares/,"**EDIT**
Here is the fully working script. Thanks a lot /r/powershell ;D

    param ([string[]]$computername = $(throw ""Computer Name(s) required""))
    function Get-AllSharePermissions
    {
    param (
    [parameter(Mandatory=$true,ValueFromPipeline=$true)]
    [string]$computername
    )

    $ShareSec = Get-WmiObject -Class Win32_LogicalShareSecuritySetting -ComputerName $computername
    $myCol = @()
    foreach ($ShareS in $ShareSec)
    {
    $SecurityDescriptor = $ShareS.GetSecurityDescriptor()
    ForEach ($DACL in $SecurityDescriptor.Descriptor.DACL)
    {
    $myObj = “” | select Computername, Name, Domain, ID, AccessMask, AceType
    $myObj.Computername = $Computername
    $myObj.Name = $ShareS.Name
    $myObj.Domain = $DACL.Trustee.Domain
    $myObj.ID = $DACL.Trustee.Name
    Switch ($DACL.AccessMask)
    {
    2032127 {$AccessMask = “FullControl”}
    1179785 {$AccessMask = “Read”}
    1180063 {$AccessMask = “Read, Write”}
    1179817 {$AccessMask = “ReadAndExecute”}
    -1610612736 {$AccessMask = “ReadAndExecuteExtended”}
    1245631 {$AccessMask = “ReadAndExecute, Modify, Write”}
    1180095 {$AccessMask = “ReadAndExecute, Write”}
    268435456 {$AccessMask = “FullControl (Sub Only)”}
    default {$AccessMask = $DACL.AccessMask}
    }
    $myObj.AccessMask = $AccessMask
    Switch ($DACL.AceType)
    {
    0 {$AceType = “Allow”}
    1 {$AceType = “Deny”}
    2 {$AceType = “Audit”}
    }
    $myObj.AceType = $AceType
    Clear-Variable AccessMask -ErrorAction SilentlyContinue
    Clear-Variable AceType -ErrorAction SilentlyContinue
    $myCol += $myObj
    }
    }
    Return $myCol
    }
    return ($computername | % { Get-AllSharePermissions $_ })

Use this command : c:\pwr\Get-AllSharePermissions.ps1 (Get-Content ""c:\pwr\computers.txt"") | Export-CSV ""C:\pwr\shares.csv""

You'll need a computers.txt file in c:\pwr with ALL the computer name you want query, one by line.

ENJOY, FELLOWS!

",,False,,t5_2qo1o,True,,,True,t3_q4bv0,http://www.reddit.com/r/PowerShell/comments/q4bv0/please_help_a_noob_with_powershell_finding_shares/,
1328653965.0,4,self.PowerShell,pfb7b,Noob Question - Monitor Directory =&gt; Perform Action,5,1,1,http://www.reddit.com/r/PowerShell/comments/pfb7b/noob_question_monitor_directory_perform_action/,"I found a sample script online that deals with monitoring a directory based on whether files have been created recently.

Based on this script, I'm trying to so something similar, but call an outside program to execute, and provide it variable based arguments.

    function imagefilecreated {

    $folder = 'c:\images_wifi'
    $filter = '*.*'                             # &lt;-- set this according to your requirements
    $fsw = New-Object IO.FileSystemWatcher $folder, $filter -Property @{
    IncludeSubdirectories = $true              # &lt;-- set this according to your requirements
     NotifyFilter = [IO.NotifyFilters]'FileName, LastWrite'
    }


    $onCreated = Register-ObjectEvent $fsw Created -SourceIdentifier FileCreated -Action {
    $folder = 'c:\images_wifi'
    $path = $Event.SourceEventArgs.FullPath
    $name = $Event.SourceEventArgs.Name
    $arg = $path+=$name
    $changeType = $Event.SourceEventArgs.ChangeType
    $timeStamp = $Event.TimeGenerated
    #Write-Host ""The file '$name' was $changeType at $timeStamp""
    &amp;$exe -p ""script=C:\Program Files (x86)\IrfanView&gt;i_view32.exe"" $arg
    }
    }
    imagefilecreated


In my head this should work. I've used a similar script to copy files out when they land in this directory, and I'm pretty sure I'm calling i_view_32 properly. The only arguments I need to pass to it (arg) are the file path / name, and ideally a 3rd printer related variable.

I'm sure most of you have better things to do than troubleshoot my script, but I'm not very good at this and can't seem to find where I'm failing.

",,False,,t5_2qo1o,False,,,True,t3_pfb7b,http://www.reddit.com/r/PowerShell/comments/pfb7b/noob_question_monitor_directory_perform_action/,
1328425383.0,4,self.PowerShell,pbmc8,Question/help with if statement,4,0,4,http://www.reddit.com/r/PowerShell/comments/pbmc8/questionhelp_with_if_statement/,"Hey,

I am brand new to PowerShell and scripting in general. I am trying to automate checking that shares on a server are operational. I only want shares manually created, not the default shares, so I was thinking I wanted to omit results that have the $ at the end of them like C$. So this is what I have, but when I run it through ISE, I am still getting results like C$, E$, etc. included. Maybe ya'll can tell me whats wrong:

    $s1 = Get-WmiObject -Class Win32_Share -computer computername
    
    foreach ($i in $s1)
    
    {if ($i.name -notcontains ""$"")
    
    {Write-Host $i.name}}


This is only the beginning, I'll be taking out the write-host and putting the shares through test-path, but I'm not there yet. Any assistance or info ya'll can provide would be greatly appreciated. ",,False,,t5_2qo1o,False,,,True,t3_pbmc8,http://www.reddit.com/r/PowerShell/comments/pbmc8/questionhelp_with_if_statement/,
1327678985.0,4,blogs.msdn.com,oz7k3,It’s Time For Another PowerShell Deep Dive!,4,0,1,http://www.reddit.com/r/PowerShell/comments/oz7k3/its_time_for_another_powershell_deep_dive/,,,False,,t5_2qo1o,False,,,False,t3_oz7k3,http://blogs.msdn.com/b/powershell/archive/2012/01/27/it-s-time-for-another-powershell-deep-dive.aspx,
1327610283.0,4,self.PowerShell,oy2jw,Move-Item Access Denied,4,0,7,http://www.reddit.com/r/PowerShell/comments/oy2jw/moveitem_access_denied/,"When I save the script I am running to a network share and execute it (uses move-item against other network directories) it results in an access denied error on the directories being moved.  When I copied the script to my local machine and run it against the same network directories it works fine.

Why is this happening?  I cannot find any information on the difference between running a local script vs. one on a network share online, all the articles I'm finding are talking about the directories being moved.

The powershell console is set to run as administrator with execution policy set to unrestricted.

Thanks!

**EDIT - Added example**

\\\\fileserver\share\MyScript.ps1 '\\\\anotherserver\share\sourcepath' '\\\\anotherserver\share\destinationpath' [**access denied**]

vs

c:\temp\MyScript.ps1 '\\\\anotherserver\share\sourcepath' '\\\\anotherserver\share\destinationpath' [**works**]
",,False,,t5_2qo1o,True,,,True,t3_oy2jw,http://www.reddit.com/r/PowerShell/comments/oy2jw/moveitem_access_denied/,
1327090965.0,3,self.PowerShell,opa5e,Prompting for Administrator access,5,2,4,http://www.reddit.com/r/PowerShell/comments/opa5e/prompting_for_administrator_access/,"I have a script that requires being run as an Administrator. I'd like a simple check to see if it has Administrator access, and if not prompt for credentials and then continuing executing. Any pointers? TIA!",,False,,t5_2qo1o,False,,,True,t3_opa5e,http://www.reddit.com/r/PowerShell/comments/opa5e/prompting_for_administrator_access/,
1326763906.0,3,self.PowerShell,ok56c,advice on error trapping,4,1,2,http://www.reddit.com/r/PowerShell/comments/ok56c/advice_on_error_trapping/,"I am working on the following function to update ad attributes and looking for the best way 
to trap possible errors.      Thoughts?


Function Write-AdAttribute   
{   
 param ([string]$Username,[string]$attribute,[string]$attributeValue)  
[string]$strDelim= ""`t""  
 If (CheckUser $Username)  
 {  
	 $Write_Attribute_User = Get-ADUser $Username -properties $attribute  
	 If ($Write_Attribute_User.$attribute -ne $attributeValue)  
	  {  
	   $Write_Attribute_User.$attribute = $attributeValue  
	   Set-ADUser -Instance $Write_Attribute_User  
	   Log ($Username +$strDelim+ $attribute + "" updated""  +$strDelim+ $attributeValue)  
	  }   
 }	    
 Else   
 {  
  Log($Username +$strDelim+ $attribute + "" not updated. User does not exist.""  +$strDelim+ $attributeValue)  
 }  
}  ",,False,,t5_2qo1o,True,,,True,t3_ok56c,http://www.reddit.com/r/PowerShell/comments/ok56c/advice_on_error_trapping/,
1326658310.0,4,madposh.wordpress.com,oialx,February 7th – Richard Siddaway presents PowerShell – Admin tools for free « Madison PowerShell Users Group,4,0,0,http://www.reddit.com/r/PowerShell/comments/oialx/february_7th_richard_siddaway_presents_powershell/,,,False,,t5_2qo1o,False,,,False,t3_oialx,http://madposh.wordpress.com/2012/01/15/february-7th-richard-siddaway-presents-powershell-admin-tools-for-free/,
1325877659.0,5,self.PowerShell,o5r9v,Hash help please,5,0,1,http://www.reddit.com/r/PowerShell/comments/o5r9v/hash_help_please/,"I'm pulling information from a csv file and AD then storing the data in a hash.  I have several users that I need this same data. To me it makes sense if it was stored where it could be arranged like so:

    Users hash
        user1 employee ID
            user1 displayname
            user1 email
        user2 employee ID
            user2 displayname
            user2 email

I believe I'm only having a problem with the syntax...

    $TermedUsers= get-content $inputpath
    Foreach ($i in $TermedUsers){
        $a=$i.Split("":"") 	#split into an array
        $AD		=	Get-AD $a[0] $a[5]
        $empID	=	$a[0]
        $user = @{
            EmpID		=	$a[0]
            DisplayName	=	$a[1]+"", ""+$a[2]
            AD			=	$AD.AD
            Email			=	$AD.Email
            Manager		=	$AD.Manager
            Desc			=	$AD.Desc
            Termed		=	$a[3]
        }
        $users= $users + @{""$empID""=$user}
    }

This code appears to store the information correctly (from what I see in an IDE) however I'm able to access it by this syntax:  

    $users.$empID.displayname

Am I storing the information wrong or trying to access it wrong?",,False,,t5_2qo1o,True,,,True,t3_o5r9v,http://www.reddit.com/r/PowerShell/comments/o5r9v/hash_help_please/,
1324428892.0,5,self.PowerShell,nkm2c,Book recommendation ,5,0,4,http://www.reddit.com/r/PowerShell/comments/nkm2c/book_recommendation/,"hi please recommend a book or web resource, preferably free. I have programming experience. I would like the book to be succinct and to-the-point.",,False,,t5_2qo1o,False,,,True,t3_nkm2c,http://www.reddit.com/r/PowerShell/comments/nkm2c/book_recommendation/,
1324282128.0,3,self.PowerShell,niarr,Any way to get output of get-help not to wrap at all?,4,1,3,http://www.reddit.com/r/PowerShell/comments/niarr/any_way_to_get_output_of_gethelp_not_to_wrap_at/,"I tend to pipe the output to gvim, which is more than capable of much cleaner, more dynamic line wrapping. I’m sick of line breaks in the middle of words. Any way to do this? ",,False,,t5_2qo1o,False,,,True,t3_niarr,http://www.reddit.com/r/PowerShell/comments/niarr/any_way_to_get_output_of_gethelp_not_to_wrap_at/,
1322037647.0,4,self.PowerShell,mmjpo,Find public folder actual size,4,0,4,http://www.reddit.com/r/PowerShell/comments/mmjpo/find_public_folder_actual_size/,"Greetings PowerShell People of the World!

I've been banging my head against a wall trying to find a method to show the actual used space of a public folder database and have run out of ideas. I've managed this with the mail stores on my Exch07 box pretty easily but there doesn't seem to be a correlation for the public folders.

Has anyone run across any solutions to this headache?",,False,,t5_2qo1o,False,,,True,t3_mmjpo,http://www.reddit.com/r/PowerShell/comments/mmjpo/find_public_folder_actual_size/,
1319849249.0,5,self.PowerShell,lsssk,Powershell Events and New-MailboxExportRequest,5,0,8,http://www.reddit.com/r/PowerShell/comments/lsssk/powershell_events_and_newmailboxexportrequest/,"From what I can tell, New-MailboxExportRequest and Get-MailboxExportRequest(Statistics) do not expose any Event properties. Can anyone think of a way to use the neat new asynchronous events in PS2.0 to trigger an action on completion of these requests?

All I have so far is this crap while loop:
    while ((Get-MailboxExportRequest -BatchName $BatchName | Where {$_.Status -eq ""Queued"" -or $_.Status -eq ""InProgress""}))
  {

    sleep 60
  }

Wouldn't it make so much more sense for a 
    Register-ObjectEvent $export -Action {Do-StuffTriggeredByCompletionOfMailboxExport}


If not, why the hell would Microsoft put all this work into (a)adding these async cmdlets and (b) this async event framework and then NOT LET THEM DO ANYTHING WITH EACHOTHER


Arg, sorry, long day of slamming my head into a wall scripting.   ",,False,,t5_2qo1o,True,,,True,t3_lsssk,http://www.reddit.com/r/PowerShell/comments/lsssk/powershell_events_and_newmailboxexportrequest/,
1319302415.0,2,powerguivsx.codeplex.com,ll4fb,PowerGUI VSX 1.5.1 - Beta 2,5,3,2,http://www.reddit.com/r/PowerShell/comments/ll4fb/powergui_vsx_151_beta_2/,,,False,,t5_2qo1o,False,,,False,t3_ll4fb,http://powerguivsx.codeplex.com/releases/view/75538,
1317947350.0,4,self.PowerShell,l3lla,Using Aero Snap with (or in) powershell,5,1,2,http://www.reddit.com/r/PowerShell/comments/l3lla/using_aero_snap_with_or_in_powershell/,"Is there a way to use aero-snap-events (key combinations like Win+up, Win+left, Win+right) as triggers to functions in one's $profile?

By default, these events dynamically modify the UI.RawUI.WindowSize values of the console - I would like to these events to dynamically modify my UI.RawUI.BufferSize as well.",,False,,t5_2qo1o,False,,,True,t3_l3lla,http://www.reddit.com/r/PowerShell/comments/l3lla/using_aero_snap_with_or_in_powershell/,
1317890279.0,4,devinfra-us.blogspot.com,l2tug,Using PowerShell 2.0 from ASP.NET Part 1 ,4,0,9,http://www.reddit.com/r/PowerShell/comments/l2tug/using_powershell_20_from_aspnet_part_1/,,,False,,t5_2qo1o,False,,,False,t3_l2tug,http://devinfra-us.blogspot.com/2011/02/using-powershell-20-from-aspnet-part-1.html,
1314162245.0,3,adminnation.com,jsk6y,Page File and PowerShell - Together at last!,4,1,1,http://www.reddit.com/r/PowerShell/comments/jsk6y/page_file_and_powershell_together_at_last/,,,False,,t5_2qo1o,False,,,False,t3_jsk6y,http://www.adminnation.com/tutorials/page-file-and-powershell-together-at-last/,
1314150168.0,3,self.PowerShell,jsdzh,Pulling remote process state,4,1,3,http://www.reddit.com/r/PowerShell/comments/jsdzh/pulling_remote_process_state/,"So I've learned the basics of Get-WmiObject and now I'm trying to run a powershell command to get a process state on a group of servers in an exchange environment.

    $server = Get-MailboxServer
    Get-wmiobject win32_service -computername $server -filter ""Name='RemoteAccess'""

Now when I pipe that to anything else the one problem is I don't have the server name so I'm unable to figure out which of the servers may be having the process problem without any careful detective work. Is there a way I could pipe this to say a table and have it work correctly? Maybe something like this

     Format-table @{Expression={???};Label=""Server""}, @{Expression={$_.name};Label=""Process Name""}, @{Expression={$_.state};Label=""State""}

As you can see I put ??? where I'm not sure what to do",,False,,t5_2qo1o,False,,,True,t3_jsdzh,http://www.reddit.com/r/PowerShell/comments/jsdzh/pulling_remote_process_state/,
1312933671.0,5,self.PowerShell,je13t,Scripting Against a Sharepoint 2010 List,5,0,4,http://www.reddit.com/r/PowerShell/comments/je13t/scripting_against_a_sharepoint_2010_list/,"So I've got a list with about 2300 items in it, maybe 40 columns.  Recently, someone showed up at my desk and said ""I have just been given a list of about 150 items that are wrong""
The list is a spreadsheet, and the names of the items are wrong.  The spreadsheet contains two columns:  ""Find this"" and ""Replace with this""  
What I'm trying to do is along the lines of:

    foreach($item in $list)  
    {find the item named for cell A2 and rename it to the contents of cell B2}

Any advice or tips?  Can anyone recommend a good resource for learning powershell automation of Sharepoint lists?
 ",,False,,t5_2qo1o,False,,,True,t3_je13t,http://www.reddit.com/r/PowerShell/comments/je13t/scripting_against_a_sharepoint_2010_list/,
1312225105.0,3,self.PowerShell,j5xdm,How long did it take you to get good at powershell and what did you do to get there? ,4,1,10,http://www.reddit.com/r/PowerShell/comments/j5xdm/how_long_did_it_take_you_to_get_good_at/,I try spend some time with it everyday learning new things but I still got a long way to go. ,,False,,t5_2qo1o,False,,,True,t3_j5xdm,http://www.reddit.com/r/PowerShell/comments/j5xdm/how_long_did_it_take_you_to_get_good_at/,
1310398539.0,3,self.PowerShell,imh7k,Trouble with a startup script and mapped drives.,4,1,6,http://www.reddit.com/r/PowerShell/comments/imh7k/trouble_with_a_startup_script_and_mapped_drives/,"I have a script that is pushed out via Group Policy logon script.

I am trying to get it to check if their home drive and department shares are mapped, but it is always returning false. 

 I know that the script is running in the user context because I have a whoami command to output the security groups the user is a member of.



Is there something different about running DOS commands in a script (whoami.exe) vs calling a cmdlet (test-path)?  

Edit Here is the [script](http://pastebin.com/X9xfBvUT) that I am working on.
",,False,,t5_2qo1o,True,,,True,t3_imh7k,http://www.reddit.com/r/PowerShell/comments/imh7k/trouble_with_a_startup_script_and_mapped_drives/,
1310144079.0,4,self.PowerShell,ik5ij,"Lastlogondate, why can some users query AD and get it to show but for others it shows up as empty.",4,0,22,http://www.reddit.com/r/PowerShell/comments/ik5ij/lastlogondate_why_can_some_users_query_ad_and_get/,"I have created a PS script that finds all inactive user and computer accounts in a certain container and disables them. Everything was working perfectly until I tried to have it run as a schedule as a different user. With that user the lastlogondate variable in AD is always blank.

This is the code

    Search-ADAccount -accountinactive -timespan 90 -searchbase ""OU=xxxxx,DC=xxxxx,DC=xxx"" | where {$_.SamAccountNAme -eq ""a username""}


So with my account I get 

    LastLogonDate         : 3.12.2009 13:23:29

But with my schedule account I get

    LastLogonDate         : 

I'm stumped, I just dont get it why. The schedule account has full domain admin rights even.

___________

Edit,
Here is the actual script I made (my second powershell script, wohoooo :D

http://pastebin.com/enuMK9Ui

___________

Second edit,
creepyMaintenanceGuy (awesome name) was correct, the information I'm querying from AD is not replicated between servers. Total bummer.
___________

Third edit for the record,
I was having an AD replication issues, nothing wrong with the script itself.

http://pastebin.com/zUx0PHTs

Here is an updated version, feel free to use.",,False,,t5_2qo1o,True,,,True,t3_ik5ij,http://www.reddit.com/r/PowerShell/comments/ik5ij/lastlogondate_why_can_some_users_query_ad_and_get/,
1308590488.0,2,self.PowerShell,i4h0m,Wondering if Powershell would be the best choice for this task.,5,3,2,http://www.reddit.com/r/PowerShell/comments/i4h0m/wondering_if_powershell_would_be_the_best_choice/,"I have not used powershell before, so I want to know if it would be the best choice. My goal is to make a script to automate disabling, deleting, and re enabling the page file, across windows xp/vista/7. There are a few other things, but I will just start there. 

I have looked at the script repository, but many of the scripts are only verified on one of the systems. It says they should work on others, do they tend to work across platforms, with minor tweaks? Thanks.",,False,,t5_2qo1o,False,,,True,t3_i4h0m,http://www.reddit.com/r/PowerShell/comments/i4h0m/wondering_if_powershell_would_be_the_best_choice/,
1307290736.0,5,self.PowerShell,hs65s,"Euler #2: Find the sum of all even Fibonacci sequence numbers below 4,000,000",6,1,3,http://www.reddit.com/r/PowerShell/comments/hs65s/euler_2_find_the_sum_of_all_even_fibonacci/,"Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:

1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...

By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.

From http://projecteuler.net/index.php?section=problems",,False,,t5_2qo1o,False,,,True,t3_hs65s,http://www.reddit.com/r/PowerShell/comments/hs65s/euler_2_find_the_sum_of_all_even_fibonacci/,
1306369267.0,4,self.PowerShell,hk8hu,Non-modal dialogs in Powershell without threading,4,0,6,http://www.reddit.com/r/PowerShell/comments/hk8hu/nonmodal_dialogs_in_powershell_without_threading/,"OK, so I'm working on this enormous monolithic script to manage a post-OS build. This script manages to install LOADS of stuff, but there's one little thing I'd like to add....

A nice fat splashscreen that displays on the screen while it's doing its work which shows the current component being installed.

While modal dialogs are cake to add with System.Windows.Forms via showdialog(), it seems within powershell there's an issue with modeless/non-modal dialogs because of how text is pumped to the dialog itself when using show(). 

Has anyone ever run into this and found an ""easy"" workaround? ",,False,,t5_2qo1o,False,,,True,t3_hk8hu,http://www.reddit.com/r/PowerShell/comments/hk8hu/nonmodal_dialogs_in_powershell_without_threading/,
1284142728.0,4,youtu.be,dc6m5,Preview of PowerWF v2.3; a ridiculously good visual PowerShell tool.,4,0,2,http://www.reddit.com/r/PowerShell/comments/dc6m5/preview_of_powerwf_v23_a_ridiculously_good_visual/,,,False,,t5_2qo1o,False,,,False,t3_dc6m5,http://youtu.be/DCnKRKD3FyQ,
1248751005.0,5,get-powershell.com,955nr,"Blend –&gt; XAML –&gt; PowerShell.  Or, how to quickly build GUI apps with Powershell.",6,1,0,http://www.reddit.com/r/PowerShell/comments/955nr/blend_xaml_powershell_or_how_to_quickly_build_gui/,,,False,,t5_2qo1o,False,,,False,t3_955nr,http://get-powershell.com/2009/05/19/blend-xaml-powershell/,
1376682909.0,3,self.PowerShell,1kiawt,Help with arrays,3,0,5,http://www.reddit.com/r/PowerShell/comments/1kiawt/help_with_arrays/,"I have what I feel like is a dumb question. I've been working with PowerShell for about a year now. I've gotten pretty good with it, but I'm far from an expert. I've read the Don Jones ""Month of Lunches"" book, and I've also worked through several online training videos, including the first Virtual Academy session from a few weeks ago.

My question has to do with arrays. I understand the concept, but I'm not entirely clear on why someone would need to use one in a script. Please explain to me like I'm 5, what purpose an empty array serves? How is it different from doing something like n={xyz ; l={$_.something}}. I see @() all the time in scripts, and I can sort of get what it's doing, but I can never seem to wrap my head around why it was done that way. Thanks!",,False,,t5_2qo1o,False,,,True,t3_1kiawt,http://www.reddit.com/r/PowerShell/comments/1kiawt/help_with_arrays/,
1376621414.0,3,gallery.technet.microsoft.com,1kgpji,Background Runspaces PowerShell Snippet,4,1,1,http://www.reddit.com/r/PowerShell/comments/1kgpji/background_runspaces_powershell_snippet/,,,False,,t5_2qo1o,False,,,False,t3_1kgpji,http://gallery.technet.microsoft.com/scriptcenter/Background-Runspaces-042f235d,
1376596480.0,3,self.PowerShell,1kfu7s,Invalid Parameter using Icacls to set AppPool permission,3,0,2,http://www.reddit.com/r/PowerShell/comments/1kfu7s/invalid_parameter_using_icacls_to_set_apppool/,"I'm trying to write a quick and dirty script to automate some of the web administration taks using IIS. Due to the simple nature of the command I want to include icacls in the script versus the powershell method.

Essentially, prompt the user for site name, extension and combine it with the already known path. Application pool gets the sitename-extension as it's own name, which is to be added to the web directories permission. 

Now I have a script partially written getting input from the user and launching an icacls command which I have verified to work with Cmd prompt... However powershell gives me an invalid parameter IIS AppPool error.

Any ideas? 
Script below with directory paths changed

clear
$sitename = Read-Host 'What is the websites name?'
$siteextension = Read-Host 'What is the sites extension? (.com, .mb.ca, .ca, etc)'

$site = $sitename+""$siteextension""
$sitepath = ""c:\wwwroot\""+$site

icacls.exe $sitepath /grant """"IIS AppPool\$site"":F""

",,False,,t5_2qo1o,False,,,True,t3_1kfu7s,http://www.reddit.com/r/PowerShell/comments/1kfu7s/invalid_parameter_using_icacls_to_set_apppool/,
1376327827.0,3,self.PowerShell,1k7ud4,Remotely uninstall Office 2010,3,0,36,http://www.reddit.com/r/PowerShell/comments/1k7ud4/remotely_uninstall_office_2010/,"Here I am again, at your mercy, /r/powershell. After trying numerous ways to tackle this, I filtered my method down to 'Invoke-Expression' and 'Invoke-Command'. The uninstall string comes from the remote host, which has 2010 installed. 

My code below runs, however it seems to kick off msiexec.exe on my local host, rather than the remote host. Any suggestions? 

    $script = iex ""MsiExec.exe /X '{90140000-0012-0000-0000-0000000FF1CE}' ""
    
    $comp = ""*computername*""
    
    Invoke-Command -computername $comp -scriptblock ({$script})
    Write-Host ""Done""",,False,,t5_2qo1o,False,,,True,t3_1k7ud4,http://www.reddit.com/r/PowerShell/comments/1k7ud4/remotely_uninstall_office_2010/,
1375821535.0,2,self.PowerShell,1ju3nr,Powershell to grab system log files and copy for a range of computers,3,1,4,http://www.reddit.com/r/PowerShell/comments/1ju3nr/powershell_to_grab_system_log_files_and_copy_for/,"Anyone had to do anything like this?

",[Core],False,,t5_2qo1o,False,,,True,t3_1ju3nr,http://www.reddit.com/r/PowerShell/comments/1ju3nr/powershell_to_grab_system_log_files_and_copy_for/,
1375732125.0,3,self.PowerShell,1jrecn,Generating URL Rewrite Configurations,3,0,0,http://www.reddit.com/r/PowerShell/comments/1jrecn/generating_url_rewrite_configurations/,"We were in the middle of some web site transitions, and we needed to redirect a very large amount of content to updated paths. There were over 200 redirects that needed to be put in place across multiple sites to help ease the transition over to the new site hierarchy. 

After receiving all the redirects we needed, I was able to script a URL Re-Write generator to dump the new configs into the web.config of each site that needed it within seconds!

    &lt;#======================================================================== 
        This script is used to generate a set of rules for the IIS Add-On
        URL Re-Write. Run the script in the directory rule-list.txt resides in.
        rule-list.txt should be formatted in the following way:
        dir/whatever/.default.aspx?querystring=value,http://redirecturl.com
        Output will be placed in ./rules-output.txt
    ========================================================================#&gt;
    $ErrorActionPreference = ""Stop""
    $ruleList = Get-Content .\rule-list.txt
    $count = 0
    try
    {
       foreach ($rule in $ruleList)
       {
          &lt;#Run some formatting against the strings in the array,
          and generate the variables needed for processing#&gt;
          $ruleSplit = $rule.Split("","")
          $ruleName = $count++
          $matchURL = $ruleSplit[0]
          $redirectURL = $ruleSplit[1]
          &lt;#Check to see if the URL has a query string,
          as it will be formatted differently if so.#&gt;
          if ($matchURL.Contains(""?""))
          {
             &lt;#Split the query string for formatting#&gt;
             $queryStringURL = $matchURL.Split(""?"")
             $queryStringURLPath = $queryStringURL[0]
             $queryStringURLQuery = $queryStringURL[1]
             &lt;#Generate the rule with the appropriate conditions
             for dealing with a query string#&gt;
             Add-Content -Path rules-output.txt -Value ""&lt;rule name=`""Redirect Rule $ruleName`"" stopProcessing=`""true`""&gt;""
             Add-Content -Path rules-output.txt -Value ""    &lt;match url=`""$queryStringURLPath`""/&gt;""
             Add-Content -Path rules-output.txt -Value ""    &lt;action type=`""Redirect`""  url=`""$redirectURL`"" appendQueryString=`""false`""/&gt;""
             Add-Content -Path rules-output.txt -Value ""    &lt;conditions&gt;""
             Add-Content -Path rules-output.txt -Value ""        &lt;add input=`""{QUERY_STRING}`"" pattern=`""$queryStringURLQuery`"" /&gt;""
       	     Add-Content -Path rules-output.txt -Value ""    &lt;/conditions&gt;""
             Add-Content -Path rules-output.txt -Value ""&lt;/rule&gt;""
          }
          else
          {
             &lt;#Generate the base rule without the query string condition
             being needed#&gt;
             Add-Content -Path rules-output.txt -Value ""&lt;rule name=`""Redirect Rule $ruleName`"" stopProcessing=`""true`""&gt;""
             Add-Content -Path rules-output.txt -Value ""    &lt;match url=`""`^$matchURL`$`|`^$matchURL`/`$`"" /&gt;""
             Add-Content -Path rules-output.txt -Value ""    &lt;action type=`""Redirect`"" url=`""$redirectURL`"" /&gt;""
             Add-Content -Path rules-output.txt -Value ""&lt;/rule&gt;""
          }
       }
    }
    catch
    {
       [system.exception] ""Exception: Unable to process rule list.""
       $Error | Format-List -Property * -Force
    }",,False,,t5_2qo1o,False,,,True,t3_1jrecn,http://www.reddit.com/r/PowerShell/comments/1jrecn/generating_url_rewrite_configurations/,
1375383901.0,2,self.PowerShell,1jigr9,Read CSV for first and last name and get email?,4,2,5,http://www.reddit.com/r/PowerShell/comments/1jigr9/read_csv_for_first_and_last_name_and_get_email/,"I dont know how I have messed this up so many times. I have written a few scripts before and usually get them to work but i have hit a wall. I have a csv document with users First name and last name. I need to get a list of the email addresses that correspond to the names but im having export problems. I run the below script but all my CSV files come out blank.


Import-CSV ""C:\Scripts\test.csv"" | ForEach-Object {

$LN = $_.LN
$FN = $_.FN

Get-ADUser -Properties mail -Filter {Surname -eq $LN -and givenname -eq $FN } | Select-Object mail | Export-Csv c:\Scripts\final.csv



 }



PS if anyone knows how to just get it add the email addresses to the 3rd column of the csv that would rock.  ",,False,,t5_2qo1o,False,,,True,t3_1jigr9,http://www.reddit.com/r/PowerShell/comments/1jigr9/read_csv_for_first_and_last_name_and_get_email/,
1375372652.0,2,self.PowerShell,1ji17e,Anyone else having trouble getting logged in to the MVA Advanced Powershell course?,4,2,4,http://www.reddit.com/r/PowerShell/comments/1ji17e/anyone_else_having_trouble_getting_logged_in_to/,,,False,,t5_2qo1o,False,,,True,t3_1ji17e,http://www.reddit.com/r/PowerShell/comments/1ji17e/anyone_else_having_trouble_getting_logged_in_to/,
1375146405.0,2,self.PowerShell,1jbfea,Terrible with powershell and need help with double variable script,5,3,11,http://www.reddit.com/r/PowerShell/comments/1jbfea/terrible_with_powershell_and_need_help_with/,"My extent of PS so far is google something and 99% of the time i'll find a script. 


I have two CSVs. I have the PC name and user name. I need to copy each users mydocs, desktop, favorites to a server share with each usernames variable. So C:\documents and settigns\jsmith is going to \\server\users\jsmith


I need something like 



$PC = Import-Csv ""c:\scripts\PCLIST.csv""


$PATH = Import-CSV ""C:\scripts\username.csv""
 
ForEach ($PC) { 
 
copy ""\\$PC\C$\Documents and settings\$PATH\Desktop"" \\server\share\$PATH\

copy ""\\$PC\C$\Documents and settings\$PATH\Favorties""  \\server\share\$PATH\

copy ""\\$PC\C$\Documents and settings\$PATH\My Documents"" \\server\share\$PATH\
} 


What am I missing?


Missing 'in' after variable in foreach loop.
At C:\Scripts\filemove.ps1:3 char:13
+ ForEach ($PC &lt;&lt;&lt;&lt; )
    + CategoryInfo          : ParserError: (InToken:TokenId) [], ParseException
    + FullyQualifiedErrorId : MissingInInForeach
",,False,,t5_2qo1o,1375146970.0,,,True,t3_1jbfea,http://www.reddit.com/r/PowerShell/comments/1jbfea/terrible_with_powershell_and_need_help_with/,
1374767705.0,3,self.PowerShell,1j181f,Move LanmanWorkstation to the top if the ProviderOrder list,6,3,5,http://www.reddit.com/r/PowerShell/comments/1j181f/move_lanmanworkstation_to_the_top_if_the/,"My boss wanted me to goto each Laptop and move the MS Windows Network to the top of the Provider Order list.
I said fuck that, too much clicking of the mouse.

After much googling I only found vbscripts and other crap explanations. Nothing having to do with powershell. I wrote this beauty.

So.. here is a script that will take LanmanWorkstation and move it to the top of the Network Provider Order list.

Note: It does need to run as admin or a user that has access to needed registry string.

Any critique is welcome!

Set-NetworkOrder.ps1:

    $remote = 0
    $computer = ""localhost""
    
    if($remote -eq 1){
        $cred = Get-Credential #Domain\User
        Enter-PSSession $computer -Credential $cred
    }
    
    Push-Location
    Set-Location hklm:\SYSTEM\CurrentControlSet\Control\NetworkProvider\Order\
    
    Write-Host ""Reg Before: "" (Get-ItemProperty '.\' -Name ProviderOrder).ProviderOrder
    # Variables
    $order = (Get-ItemProperty '.\' -Name ProviderOrder).ProviderOrder
    $topItem = “LanmanWorkstation”
    $strNewProvs = $topItem
    $i = 1
    
    #Split and check if LanmanWorkstation is at the top
    $order.Split("","") | ForEach {
        #Check if we are at the start
        if($i -eq 1){
            #Check if LanmanWorkstation is first in the list
            if($_ -eq $topItem){
                Write-Host ""Exiting: $_ is at the top""
                #Exit the script, someone else did our job
                Exit
            }
        }
        #Skip LanmanWorkstation
        if($_ -ne $topItem){
            $i= $i + 1
            $strNewProvs = $strNewProvs + “,” + $_
            #Debug
            #Write-Host ""$_ is a token""
        }
    }
    
    Write-Host ""Attempting to apply to registry: "" $strNewProvs
    
    # Write the new string back to the registry
    # Note the user running this script needs the needed access to the registry, ie Administrator
    Set-ItemProperty '.\' -Name ProviderOrder -Value $strNewProvs
    
    
    Write-Host ""Reg After: "" (Get-ItemProperty '.\' -Name ProviderOrder).ProviderOrder
    
    if($remote -eq 1){
    Pop-Location
    Exit-PSSession
    }

Edit: Added Powershell remoting and some checks that you can modify to help in the automation. And with the standard Powershell calls, no need for OpenRemoteBaseKey! Yay!

Edit2: Here is the second half of this script that will also set the Interface order to the Nic card for the domain that you wish to be in the top most of the list. [Set-InterfaceOrder.ps1](http://pastebin.com/nBvzmUZf)

Edit3: Last one I Swear. Combined both functions into one. [Set-InterfaceOrderAndNetworkOrder.ps1](http://pastebin.com/H4yMcaF4)",,False,,t5_2qo1o,1374791474.0,,,True,t3_1j181f,http://www.reddit.com/r/PowerShell/comments/1j181f/move_lanmanworkstation_to_the_top_if_the/,
1374584748.0,2,self.PowerShell,1ivr0m,[Script Help] A variable contains / This variable is used to create a filename and thus fails.,4,2,2,http://www.reddit.com/r/PowerShell/comments/1ivr0m/script_help_a_variable_contains_this_variable_is/,"Here is the code:

if($newname){$eventcategory | New-ItemProperty -Name File -Type String -Value $newname -force | out-null }

The problem is that some of the eventlog folders we go through has / in their name. And thus the $newname variable contains a /. So when the script tries to create a file with / in the name it fails.

My question is, is there a good way to detect the / in the variable and change it for a -  ?",,False,,t5_2qo1o,False,,,True,t3_1ivr0m,http://www.reddit.com/r/PowerShell/comments/1ivr0m/script_help_a_variable_contains_this_variable_is/,
1374264457.0,3,self.PowerShell,1inj5h,Server to Server OAuth 2.0 examples for access to Google APIs?,4,1,2,http://www.reddit.com/r/PowerShell/comments/1inj5h/server_to_server_oauth_20_examples_for_access_to/,"I want to update my various scripts that are using the deprecated ClientLogin methods, but for some reason my brain is just blocking on how to pull it together with OAuth 2.0.

Anyone have an example that logs in with OAuth 2.0 and does something (anything, really)?",,False,,t5_2qo1o,False,,,True,t3_1inj5h,http://www.reddit.com/r/PowerShell/comments/1inj5h/server_to_server_oauth_20_examples_for_access_to/,
1374249442.0,2,self.PowerShell,1imyo6,Edit ADSI Attributes,6,4,1,http://www.reddit.com/r/PowerShell/comments/1imyo6/edit_adsi_attributes/,"I am having some trouble editing certain fields in ADSI for a newly created account.  We have our own AD and it syncs with office 365.  So when we create an account, we run a dirsync and it syncs with Office 365.

When the account is created it leaves a lot of important fields blank.  I was able to figure out how to set the proxyAddress field for QAD, but can't seem to figure out the right command to update some other fields.  The fields are:

mailNickname
msExchPoliciesIncluded
msExchUserAccountControl
showInAddressBook
targetAddress

I have a script that creates the account, and then have a separate one to edit the attributes once the user is created.

Add-PSSnapin Quest.ActiveRoles.ADManagement
Set-QADUser -Identity ""abc\$args"" -Email ""$args@eng.com"" -WebPage ""http://www.xxx.com"" -PhoneNumber ""34543"" | Add-QADProxyAddress -Address ""smtp:$args@.microsoftonline.com"" | Add-QADProxyAddress -Type SMTP -Address ""$args@.com"" -Primary
Set-QADUser -Identity ""abc\$args"" -mailNickname ""$args""",,False,,t5_2qo1o,False,,,True,t3_1imyo6,http://www.reddit.com/r/PowerShell/comments/1imyo6/edit_adsi_attributes/,
1374149521.0,4,self.PowerShell,1ijygr,Progressbar for childitem,5,1,8,http://www.reddit.com/r/PowerShell/comments/1ijygr/progressbar_for_childitem/,"Hey there folks!

I have an issue where I'd like to have a progress bar for the progress of a get-childitem command. Get-childitem itself doesn't seem to hold any such variables unless you store the result in a variable, but by the time that variable is assigned it's too late. It's finished by then. So as I wanted to recurse folders and just sitting there waiting for the variable to be set isn't good enough, I figured I'd make my own recursive function to try and get an estimate.

Since I can't predict the total number of folders I will be traversing I cant set percentages immediately, but will have to go with some kind of median where I keep adding to a global variable the number of folders/subfolders seen so far during the traversal. But I've found a funny behaviour that I don't think is appropriate for a global variable. 
Here's a short example

    $global:numfolders
    Function MyOwnRecurse($folder) {
        Get-ChildItem $folder | Where  { $_.PSIsContainer } | ForEach-Object {
            $numfolders += (Get-ChildItem $folder | Where  { $_.PSIsContainer }).Length
            $numfolders
            MyOwnRecurse $_.FullName
        }
    }

    MyOwnRecurse X:\Folder\SubFolder


The output from the $numfolders is the following

    3
    7
    12
    17
    22
    27
    32
    11
    15
    24
    33
    42
    51
    60
    69
    78
    87
    96
    19
    6
    9
    12
    15
    18

Since I'm not passing the variable through to the function, which would give this kind of behaviour, but simply adding to the global variable, why is it Rolling back to a lower value as if it had been passed through to the function during it's iteration?

Anyone else tried to do an estimated progressbar based on a largely unknown number of folders/files? The iteration should become more and more ""accurate"" as it progresses.",,False,,t5_2qo1o,False,,,True,t3_1ijygr,http://www.reddit.com/r/PowerShell/comments/1ijygr/progressbar_for_childitem/,
1374126784.0,3,self.PowerShell,1ijjfu,Simple script yet it's not working.,3,0,8,http://www.reddit.com/r/PowerShell/comments/1ijjfu/simple_script_yet_its_not_working/,"Hi there,
I'm writing a script to search for items created between specific dates but starting off I can't even seem to be able to check if a value equals another. The below code returns CreationTime  for one .exe file.

    PS H:\&gt; gci -path H:\ -r -filter *exe | select- object{$_.CreationTime}
    ----------------------------
    18/07/2013 4:25:40 p.m.

Now if I run the following code it works:

    gci -path H:\ -r -filter *exe | where-object{$_.CreationTime -ge ""07/18/2013 16:25:40""}

The above piece of code works but this is where I get stuck. Now If I replace “-ge” with “-eq” it returns nothing. No matter how accurately I add the parameter for createTime it does not return a value if check for equality.

    gci -path H:\ -r -filter *exe | where-object{$_.CreationTime -eq ""07/18/2013 16:25:40""} - Returns nothing

Another very confusing  aspect is that it displays the date as dd/mm/yy when I call get-date or creationTime but only takes mm/dd/yy as input.
As you can see below although calling CreateTime (as seen inabove) returns 18/07/2013 4:25:40 p.m. it wants 07/18/2013 16:25:40 as input.
    
    PS H:\&gt; gci -path H:\ -r -filter *exe | where-object{$_.CreationTime -ge ""18/07/2013""}
    Could not compare ""07/18/2013 16:25:40"" to ""18/07/2013"". Error:   ""Cannot convert value ""18/07/2013"" to type
All my script has to do is this:

    Get-ChildItem 'PATH' -recurse 'filter' | 
        Where-Object { $_.CreationTime -eq ""18/07/2013"" }

Any help would be appreciated.

Thanks
",,False,,t5_2qo1o,1374127228.0,,,True,t3_1ijjfu,http://www.reddit.com/r/PowerShell/comments/1ijjfu/simple_script_yet_its_not_working/,
1373642179.0,4,blogs.technet.com,1i5npc,How to track Message in Exchange 2003/2007/2010,5,1,2,http://www.reddit.com/r/PowerShell/comments/1i5npc/how_to_track_message_in_exchange_200320072010/,,,False,,t5_2qo1o,False,,,False,t3_1i5npc,http://blogs.technet.com/b/messaging_with_communications/archive/2011/04/22/how-to-track-message-in-exchange-2003-2007-2010.aspx,
1373403123.0,3,self.PowerShell,1hykig,Strange Behavior Adding Print Queue Over WMI,3,0,0,http://www.reddit.com/r/PowerShell/comments/1hykig/strange_behavior_adding_print_queue_over_wmi/,"I'm writing a script that will deploy print objects to remote servers. We've got a few print servers due to some wonky requirements by some of our software vendors, so eventually this script will keep print queues in sync with each other across different servers. Idea being, instead of setting up a printer 4 times on 4 different servers, plug properties into a .csv and fire off to all 4 servers at once.

Here's the code I'm using:

    $print = ([WMICLASS]""\\$server\ROOT\cimv2:Win32_Printer"").createInstance() 
    $print.ServerName = $server
    $print.DriverName = $printer.DriverName
    $print.PortName = $printer.PortName
    $print.DeviceID = $printer.DeviceID 

It seemed pretty straight forward until I ran it and got

     Exception calling ""Put"" with ""0"" argument(s): ""Generic failure ""
    At line:1 char:1
    + $print.put()
    + ~~~~~~~~~~~~
        + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
        + FullyQualifiedErrorId : DotNetMethodException

This is a pretty generic error that basically means ""I don't like one of your parameters"". I looked it up and see tons of people having the same problem, but it always ends up being a driver that's not installed on the server or a port that doesn't exist on the server, neither of which apply in my situation. So I did some troubleshooting and found that if I first assigned the ""Generic / Text Only"" driver, it would create the print object. Furthermore, once the print object was created, I could change it to whatever driver I wanted and it seemed to work fine. Here's what I'm using now.

    $print = ([WMICLASS]""\\$server\ROOT\cimv2:Win32_Printer"").createInstance() 
    $print.ServerName = $server
    $print.DriverName =  ""Generic / Text Only""
    $print.PortName = $printer.PortName
    $print.DeviceID = $printer.DeviceID 
    $print.Put()
    $print.DriverName = $printer.DriverName
    $print.put()

This works fine, but feels really sloppy. Does anyone have any idea why it would prevent me from creating the object with the correct driver to begin with, but then later allow me to assign the same driver it complained about to an existing object?",,False,,t5_2qo1o,False,,,True,t3_1hykig,http://www.reddit.com/r/PowerShell/comments/1hykig/strange_behavior_adding_print_queue_over_wmi/,
1372709088.0,3,self.PowerShell,1hg4hp,"Remove-Profile - Remove profiles based on age and profile name, with exclusions",4,1,3,http://www.reddit.com/r/PowerShell/comments/1hg4hp/removeprofile_remove_profiles_based_on_age_and/,"Hi all,

We often find situations where it would be helpful to clean up profiles.  Tools like [delprof](http://www.microsoft.com/en-us/download/details.aspx?id=5405) and [delprof2](http://helgeklein.com/free-tools/delprof2-user-profile-deletion-tool/) make this handy, but there are times you might not want to depend on these, or licensing may not permit their use.

[Remove-Profile](http://gallery.technet.microsoft.com/scriptcenter/Remove-Profile-787d9188) will remove profiles based on profile age, specified profile names, and with specified exclusions.  The profile names and exclusions are inserted into a regex ""^ username$"" (no space between ^ and the username, Reddit formatting issue); you can thus use regexes within these, keeping in mind they will have a ^ and $ added to them.  For example, I could specify -profiles JohnDoe, Mary.*, JeffDoe; JohnDoe, JeffDoe, and any profile starting with Mary would be removed.

Given that local profiles may contain important data (note: you should fix this!), this command supports -whatif and -confirm.  I would recommend running get-help \\path\to\remove-profile.ps1 -full to take a look at the available parameters, and some notes I included in the Description section.

We use this to regularly clean up profiles on a few servers where mandatory profiles or other solutions present application compatibility issues, and our support team uses them to clean out old profiles on workstations on an ad hoc basis.

Please let me know if you have any suggestions or run into any issues!",,False,,t5_2qo1o,False,,,True,t3_1hg4hp,http://www.reddit.com/r/PowerShell/comments/1hg4hp/removeprofile_remove_profiles_based_on_age_and/,
1372707644.0,3,gist.github.com,1hg2g9,Convert Markdown to HTML with Powershell and GitHub's API,3,0,0,http://www.reddit.com/r/PowerShell/comments/1hg2g9/convert_markdown_to_html_with_powershell_and/,,,False,,t5_2qo1o,False,,,False,t3_1hg2g9,https://gist.github.com/pohatu/5903868,
1372382555.0,3,self.PowerShell,1h7w4e,"Get-UserSession - Get users, idle times, session ids by parsing query user",4,1,4,http://www.reddit.com/r/PowerShell/comments/1h7w4e/getusersession_get_users_idle_times_session_ids/,"[Get-UserSessions](http://gallery.technet.microsoft.com/scriptcenter/Get-UserSessions-Parse-b4c97837)

Recently ran across an issue where a certain application can chew up an entire core on a XenApp server.  Not something you want happening for a business critical application with thousands of users.  The real solution, an update from the vendor, isn't in the cards any time soon.  So we set out to automate the task of finding users with a certain idle time and a process with high CPU.  The first part turned out much trickier than I expected.

Boe Prox provided a [helpful post](http://learn-powershell.net/2010/11/01/quick-hit-find-currently-logged-on-users/) on the topic covering the drawbacks of WMI, a cool function that parses query session (note: no idle time in this), and the [PSTerminalServices module](http://psterminalservices.codeplex.com/releases/view/65937) by Shay Levy.  PSTerminalServices is a fantastic module by the way, and if I could get away with dependencies I would have stuck with that.

So!  It looks like the best way to pull this data is query user.  Boe already provided code for parsing query session, figured I would take the same approach.  The only problem here is that query user has variable output; if the Idle Time is something like '24692+13:29', that line will get pushed out a few characters and mess with out parsing.  Okay, let's split each line into strings!  This won't work either.  Certain fields will occasionally contain no data.  Fortunately, a combination of the two methods does the trick (according to my initial testing).  We parse by substrings if the line length is 82.  If the line length is greater than this, we parse by arrays.

The result is a quick query for the following info on one or more computers: ComputerName, Username, SessionName, Id, State, IdleTime, LogonTime

Please note that you may need to configure your environment for this to work.  You will need query.exe (you probably have this already), permissions to the remote system, and the remote system will need to be configured for [Remote RPC](http://technet.microsoft.com/en-us/library/ff710472.aspx).  You can run the script as is, or wrap it up in a function for a module, profile, or script you run.

Side note:  Does anyone know what the format is for Idle Time?  . means less than a minute.  Most values are readable... But I get a number of sessions with cryptic idle times like '24692+13:29' or '1+08:31'.  Anyone know what these mean?",,False,,t5_2qo1o,False,,,True,t3_1h7w4e,http://www.reddit.com/r/PowerShell/comments/1h7w4e/getusersession_get_users_idle_times_session_ids/,
1372337760.0,3,self.PowerShell,1h6blh,Converting two strings into arrays,3,0,22,http://www.reddit.com/r/PowerShell/comments/1h6blh/converting_two_strings_into_arrays/,"I have the following items that are getting populated by two select-string commands:  

String 1:
Harddisk 1 Harddisk 2 Harddisk 3 Harddisk 4 Harddisk 5 (and so on to 100)

String 2:
LDEV#[11108(0x2B64) LDEV#[11108(0x2B65) LDEV#[11108(0x2B66) LDEV#[11108(0x2B67) LDEV#[11108(0x2B68) (and so on till 100)

I need these two strings to line up to each other like so...
Harddisk 1 LDEV#[11108(0x2B64)
Harddisk 2 LDEV#[11108(0x2B65)
Harddisk 3 LDEV#[11108(0x2B66)
Harddisk 4 LDEV#[11108(0x2B67)

Here is the code so far...


     $output = Get-Content ""C:\dload\sample.txt""
     function cleanupData {
     $hardDisk = $output | select-string -pattern ""Harddisk.([\d]{1,3})""  |  %{ $_ -split '\.' -split ""  ""| Select-Object -first 1} 
     $LDEV = $output | Select-String -Pattern ""LDEV#\[([\w]{5,5})\(([\w]{6})\)\]""  |  %{ $_ -split ' ' | Select-Object -last 1} 
     write-host $HardDisk
     write-host $LDEV
     }

     $run = cleanupData 


Any help would be greatly appreciated!",,False,,t5_2qo1o,False,,,True,t3_1h6blh,http://www.reddit.com/r/PowerShell/comments/1h6blh/converting_two_strings_into_arrays/,
1372176195.0,3,self.PowerShell,1h1lj5,Passing Corporate Proxy settings to New-WebServiceProxy,3,0,2,http://www.reddit.com/r/PowerShell/comments/1h1lj5/passing_corporate_proxy_settings_to/,"I am trying to create a script that will pull data from a web service, and if I use the New-WebServiceProxy I receive a proxy authentication error connecting. It seems pretty weird to me that this is not built into the cmdlet but has anyone found an effective way around this without having to use the .net framework? ",,False,,t5_2qo1o,False,,,True,t3_1h1lj5,http://www.reddit.com/r/PowerShell/comments/1h1lj5/passing_corporate_proxy_settings_to/,
1371958177.0,4,self.PowerShell,1gw38r,dot net and get-member,5,1,2,http://www.reddit.com/r/PowerShell/comments/1gw38r/dot_net_and_getmember/,"I am using get-aduser to pull each user to check the last login time,  I have to use the dot net class [datetime] to convert that date to a readable format like so [DateTime]::FromFileTime($user.lastLogonTimestamp)

I like to be able to work within the cli using the help files and get-member to discover most of the methods and properties i need

The question i have is when i run 

[datetime] | gm 

why do i not see FromFileTime as one of the methods?  AM I missing something here?",,False,,t5_2qo1o,1371962642.0,,,True,t3_1gw38r,http://www.reddit.com/r/PowerShell/comments/1gw38r/dot_net_and_getmember/,
1371822210.0,3,self.PowerShell,1gskh1,MSERT run,3,0,1,http://www.reddit.com/r/PowerShell/comments/1gskh1/msert_run/,"My first attempt at a powershell script.  Just wanted to share it with the community since trying to find something similar was difficult.  There was a script out there, but it wasn't complete.  If you have any suggestion feel free to throw them out there.

for best results run as
powershell.exe -executionpolicy bypass msertscript.ps1

&lt;script&gt;
$computername = gc env:computername
if($env:Processor_Architecture -eq ""x86""){$url = ""http://definitionupdates.microsoft.com/download/definitionupdates/safetyscanner/x86/msert.exe""}else{$url = ""http://definitionupdates.microsoft.com/download/definitionupdates/safetyscanner/amd64/msert.exe""}
 
$storageDir = $pwd
$webclient = New-Object System.Net.WebClient
$WebProxy = New-Object System.Net.WebProxy(""YOUR PROXY"",$true) #your proxy if you need it
$WebProxy.Credentials = New-Object Net.NetworkCredential('msert','') #credentials if you need it
$WebClient.Proxy = $WebProxy
New-Item -ItemType directory -Path C:\msert
$file = ""C:\msert\msert.exe""
$webclient.DownloadFile($url,$file)
 
$arglist = ""/F /Q""
start-process -FilePath $file -ArgumentList $arglist -PassThru -Wait
 
#Mail Results
$smtpServer = ""YOUR SMTP SERVER""  #add your smtp server
$file = ""C:\Windows\debug\msert.log""
$attach = new-object Net.Mail.Attachment($file)
$msg = new-object Net.Mail.MailMessage
$smtp = new-object Net.Mail.SmtpClient($smtpServer)
$msg.From = ""msertcleanup-noresponse@YOURDOMAIN.com"" #fix the from address
$msg.To.Add(""Your.Email@yourdomain.com"") #put in your email address

 
$msg.Subject = ""MSERT results for $computername""
$msg.Body = ""The results from your MSERT instance on $computername""
$msg.Attachments.Add($attach)
$smtp.Send($msg)
$attach.Dispose()

&lt;/script&gt;
",,False,,t5_2qo1o,False,,,True,t3_1gskh1,http://www.reddit.com/r/PowerShell/comments/1gskh1/msert_run/,
1371657754.0,3,self.PowerShell,1gnubv,Dos question,3,0,3,http://www.reddit.com/r/PowerShell/comments/1gnubv/dos_question/,"So this is what I'm trying to do: 

* Take input from the clipboard

* Convert it

* Output to the clipboard

Now, within powershell, it works. I separate lines using semicolons, put powershell in front, and try to call it from command line, and it fails. I can't enable scripts on the machine, but would like to accomplish this. Is it possible? Is there a good reference for how to use powershell from the command line?

Thanks for any help.",,False,,t5_2qo1o,False,,,True,t3_1gnubv,http://www.reddit.com/r/PowerShell/comments/1gnubv/dos_question/,
1370983811.0,3,self.PowerShell,1g5c77,Invoke-Command param,5,2,3,http://www.reddit.com/r/PowerShell/comments/1g5c77/invokecommand_param/,"I'm trying to run the following command, but it appears that the local variable is not being past in to the Invoke-Command.  I have done this in the past using this method with out any issues.  

$OLDNAME = Read-Host ""Enter Current Computer Name""

$NEWNAME = Read-Host ""Enter New Computer Name""

Invoke-Command -ComputerName 
$OLDNAME -ScriptBlock {param($NEWNAME)

    $credential = Get-Credential

    Get-WmiObject Win32_ComputerSystem -ComputerName localhost -Authentication 6 | 
    ForEach-Object {$_.Rename(""$NEWNAME"",$credential.GetNetworkCredential().Password,$credential.Username)}

    #Get-WmiObject Win32_OperatingSystem -ComputerName localhost |
    #ForEach-Object {$_.Win32Shutdown(6)}
}

Can anyone see any reason why the variable is not being past through?  The reason why I don't think its being past through is because if I set the variable within the Invoke-Command it works just fine, if I set the variable locally and try to pass it through, it doesn't work.

There is more going on in the script which needs to have the variable set locally, which is why I don't have it set in the Invoke-Command.  And I don't want to have it ask for the same thing 2 times.

Thanks,

Edit:  This is used to change the host name of a domain computer remotely.  ",,False,,t5_2qo1o,False,,,True,t3_1g5c77,http://www.reddit.com/r/PowerShell/comments/1g5c77/invokecommand_param/,
1370292285.0,3,self.PowerShell,1flsip,Need some help with a simple script to get system boot/shutdown time,4,1,6,http://www.reddit.com/r/PowerShell/comments/1flsip/need_some_help_with_a_simple_script_to_get_system/,"This is the first powershell script I've ever created, but I do have some experience coding.  I am trying to get the  last boot up time and shut down time of my machine from the event log.  I am able to do this pretty easily, but the results come back in milliseconds.  So, now I want to store the numbers in variables and manipulate them into minutes and seconds format.  Once they're in that format, I want to output the new values to a file.  

This is what I have so far:

    $bootevents = Get-WinEvent -FilterHashtable @{logname=""Microsoft-Windows-Diagnostics-Performance/Operational""; id=100}
    $bootevent = [xml]$bootevents[0].ToXml()
    $bootevent.Event.EventData.Data | Where-Object {$_.name -eq ""BootTime"" -or $_.name -eq ""BootStartTime""} | Out-File c:\users\me\desktop\bootlog.txt -Append

    $shutdownevents = Get-WinEvent -FilterHashtable @{logname=""Microsoft-Windows-Diagnostics-Performance/Operational""; id=200}
    $shutdownevent = [xml]$shutdownevents[0].ToXml()
    $shutdownevent.Event.EventData.Data | Where-Object {$_.name -eq ""ShutdownTime"" -or $_.name -eq ""ShutdownStartTime""} | Out-File c:\users\me\desktop\bootlog.txt -append

And the output looks like:


Name                                                                   #text                                                                
----                                                                   -----                                                                
BootStartTime                                                          2013-06-03T12:10:49.671600300Z                                       
BootTime                                                               106308                                                               



Name                                                                   #text                                                                
----                                                                   -----                                                                
ShutdownStartTime                                                      2013-05-31T20:34:59.798716500Z                                       
ShutdownTime                                                           20236      


How can I save the values returned in a variable so I can play with them?  I've tried various ways to create a variable and store the information I need.  However, when I do ""Write-Host $var"", it either gives me an error or the value is output as the word ""Data"", not 106308 or 20236.  ",,False,,t5_2qo1o,1370292651.0,,,True,t3_1flsip,http://www.reddit.com/r/PowerShell/comments/1flsip/need_some_help_with_a_simple_script_to_get_system/,
1369937679.0,3,self.PowerShell,1fcn1s,Query installed programs and launch with admin credentials,3,0,9,http://www.reddit.com/r/PowerShell/comments/1fcn1s/query_installed_programs_and_launch_with_admin/,"So I just want to pose this as a question if this makes the most sense to use powershell to try to solve this problem.

I keep my end users locked out of admin so they don't break things. One of our clients pushes update to our server that then has to update individual computers next time the program runs. This fails because the end users are not admin.

They give me &lt;4 hours notice every update (every other month).  So I don't feel bad about the client breaking their own system everytime they push an update and communicate poorly. But I am getting tired of manually making the program run as local admin after they push a surprise update. So I decided to throw together a quick command line to run it remotely with admin creds. While I was putting it together I thought, Why don't I explore if there is a way to use powershell to check installed programs, see if the computer has the program and if it does start it up as admin.

So I was thinking since I am complete novice to powershell, I would ask a couple questions.

A: Is this a good way to use power shell.
B: Is this how someone else might approach it.


As far as getting it together I see it as 2 parts.

Get a csv of the computers I want to have this run against (and it is a mix of ~200 machines ~50% have the program and 50% don't)

Run powershell against that CSV doing a get WMIobject to find installed programs [link](http://blogs.technet.com/b/heyscriptingguy/archive/2011/11/13/use-powershell-to-quickly-find-installed-software.aspx)

Take the output of that and pass down computers that have specific installed program.

Launch program using credentials for local admin.

The program will then fire up on all machines listed in the CSV that met requirements.

Write results back to CSV.


The only other way I am thinking to get this working is maybe read directly from OU instead of bothering with a CSV.

Is this a good way to utilize PowerShell or would I be better off falling back on VBS or just going with a command line. 

Is there a better way to do what I am thinking about doing then how I outlined it?


Thanks for your help.",,False,,t5_2qo1o,False,,,True,t3_1fcn1s,http://www.reddit.com/r/PowerShell/comments/1fcn1s/query_installed_programs_and_launch_with_admin/,
1369669190.0,2,self.PowerShell,1f53i6,Query sqlserver database and output csv file,4,2,4,http://www.reddit.com/r/PowerShell/comments/1f53i6/query_sqlserver_database_and_output_csv_file/,"Hello powershell subreddit, I'm a struggling to do (what I think are) some basic tasks in powershell. I hope someone can help me with this. 

I'm trying to query a sql server database and output the csv in a file. I can achieve this with the following:

sqlps -Command Invoke-Sqlcmd -ServerInstance ""xxx.xx.xxx.xxx"" -Database ""xxxx"" -InputFile ""xxx"" |out-file -filepath""xxxx""

My problem is that the output from the query doesn't come in rows and columns, instead it groups each row together as a list. For example:

column a: 1  
column b: 2  
column c: 3  

column a: 4  
column b: 5  
column c: 6  

I'm wondering how I can group this into columns for a csv file? Hope this is clear, thanks!",,False,,t5_2qo1o,False,,,True,t3_1f53i6,http://www.reddit.com/r/PowerShell/comments/1f53i6/query_sqlserver_database_and_output_csv_file/,
1369159590.0,3,self.PowerShell,1es04c,Making hidden Excel files visible,5,2,2,http://www.reddit.com/r/PowerShell/comments/1es04c/making_hidden_excel_files_visible/,"I have some VBA code that is creating an Excel file.  However, the new file is not visible and I'd like to be able to see what is happening as I step through the code.  Wondering how I can do this w/ PowerShell.  I came up with the following script:

    $XLs = Get-Process -name Excel
    Foreach ($xl in $XLs) {
        Write-Host $xl.Id
        $xl.visible = True
    } 

It correctly write's the Excel files Id but does not make the file visible.  I had found this [script](http://technet.microsoft.com/en-us/library/ff730962.aspx)
 for setting a newly created Excel object visible but that is not what I want:


Any idea?

Thanks,
",,False,,t5_2qo1o,False,,,True,t3_1es04c,http://www.reddit.com/r/PowerShell/comments/1es04c/making_hidden_excel_files_visible/,
1368046541.0,3,self.PowerShell,1dyfbz,Pulling Message property info into separate cells when exporting event logs?,3,0,3,http://www.reddit.com/r/PowerShell/comments/1dyfbz/pulling_message_property_info_into_separate_cells/,"I have the following Command: 


    Get-EventLog -LogName Security -EntryType FailureAudit -Newest 100 -ComputerName *SERVER* | Select-Object EventID,EntryType,Message,TimeGenerated | Export-Csv -Path ""C:\Security_Audit_Log.csv""

The problem is I'd like to parse the Message property info to separate cells.  e.g. Logon Account to a seperate field instead of being in one massive cell. 

Any Ideas? ?  ",,False,,t5_2qo1o,False,,,True,t3_1dyfbz,http://www.reddit.com/r/PowerShell/comments/1dyfbz/pulling_message_property_info_into_separate_cells/,
1367707495.0,3,self.PowerShell,1dpaek,I need to remove group membership based on non-existence in a csv file.,3,0,26,http://www.reddit.com/r/PowerShell/comments/1dpaek/i_need_to_remove_group_membership_based_on/,"Hello r/Powershell! 

I'm new to PS and trying to build my very first heavy duty script and have run into a road block. This isn't really a PS specific problem but I'm having trouble coming up with how to do it at all. Any help or advice is appreciated.

Essentially, I'm going to have a large list with group membership associations and while checking for the existence of the groups and adding memberships aren't terribly difficult, I'd like to remove any groups that do not exist in the CSV File. The only way I can think about doing it is deleting all memberships and building them from scratch but there has got to be a cleaner way.

What am I looking for when I search?

EDIT: Let me clarify what I'm trying to do so it makes much more sense. 

I work for a school and I'm trying to build a Course-&gt;Room relationship in active directory and have it updated and populated automatically. Courses I will be pulling in as a CSV (or pulling SQL and creating the CSV then reading it) and they have assigned campus and room for each course. So from the CSV I'll be able to pull variables like Course=""APPS101"" and Campus=""Downtown"" and Room=""540"" to build groups like APPS101 and DOWNTOWN_540 and I'll add the DOWNTOWN_540 group to APPS101. If ""APPS101"" is also at Campus=""Uptown"" and Room=""300"" then I'll add the UPTOWN_300 group to APPS101 as well.

I'd like to run this every night but if for some reason the APPS101 course is moved to UPTOWN_301, and is no longer in UPTOWN_300, the only groups in APPS101 should be DOWNTOWN_540 and UPTOWN_301.

I believe if I use a hashtable to build what I put into APPS101 during this run, check memberships of APPS101 and remove any value that exists in AD but not in the hashtable I can get where I'm going.",,False,,t5_2qo1o,1367710556.0,,,True,t3_1dpaek,http://www.reddit.com/r/PowerShell/comments/1dpaek/i_need_to_remove_group_membership_based_on/,
1366142965.0,3,self.PowerShell,1chees,Question about formatting contents of an out-file,3,0,5,http://www.reddit.com/r/PowerShell/comments/1chees/question_about_formatting_contents_of_an_outfile/,"Currently, I have 2 lines in my script that basically read in a text file and then split each line based on a ""+"" delimiter.
The only issue, is that the log file that I am reading from, has the date and the end and is only filled with numbers and user ID's and I'd like to place in the out-file what each number means and a userID section.

For example:

* Date (which needs to be moved from the end of the parsed line to the top)
* First Number means:
* Second Number means:
* Third Number means:
* User ID:

**Edit**: The lines of code that I am using to currently split the file are:

        $SourceFile = (Get-Content Desktop\_historical_data_lotsOfUsage.txt | foreach-Object {$_.split(""+"")})
        Out-File Desktop\results.txt -inputObject $SourceFile
The result.txt shows up like this:

    75  
    7    
    0
    mc30488,mc30090,mc29180,mc28992,mc28881,mc28336,mc28152,mc27737,mc27671,mc26246,mc25717,mc25712,mc25706,mc25506,mc25228,mc25168,mc24567,mc24557,mc24432,mc23960,mc23498,mc22022,mc08663,mc02301
    10/24/2012
    
**BUT I would like it to look like this:**

    Date
    Number of Licenses: 75
    Max Users: 7
    Random Number: 0
    UserIDs: mc######, ...",,False,,t5_2qo1o,1366173980.0,,,True,t3_1chees,http://www.reddit.com/r/PowerShell/comments/1chees/question_about_formatting_contents_of_an_outfile/,
1366130170.0,3,self.PowerShell,1cgwyu,Fix Services with unquoted binary paths (Registry),3,0,0,http://www.reddit.com/r/PowerShell/comments/1cgwyu/fix_services_with_unquoted_binary_paths_registry/,"Our security scans indicates a vulnerability with ""unquoted paths"" in services, (e.g.  `C:\FOO BAR\file.exe` instead of `""C:\FOO BAR\file.exe""` which could lead to some nastiness. We had to fix this on every (windows) machine in our entire network. Oh, and everytime NVIDIA installs updates it likes to add another bad path (yay).

This script was written when first got into powershell, so nowadays I just pipe the stdin/stderr into a file using a .BAT file and the [stdin/stderr fix](http://www.leeholmes.com/blog/2008/07/30/workaround-the-os-handles-position-is-not-what-filestream-expected/)

e.g.

	$bindingFlags = [Reflection.BindingFlags] “Instance,NonPublic,GetField”
	$objectRef = $host.GetType().GetField(“externalHostRef”, $bindingFlags).GetValue($host)

	$bindingFlags = [Reflection.BindingFlags] “Instance,NonPublic,GetProperty”
	$consoleHost = $objectRef.GetType().GetProperty(“Value”, $bindingFlags).GetValue($objectRef, @())

	[void] $consoleHost.GetType().GetProperty(“IsStandardOutputRedirected”, $bindingFlags).GetValue($consoleHost, @())
	$bindingFlags = [Reflection.BindingFlags] “Instance,NonPublic,GetField”
	$field = $consoleHost.GetType().GetField(“standardOutputWriter”, $bindingFlags)
	$field.SetValue($consoleHost, [Console]::Out)
	$field2 = $consoleHost.GetType().GetField(“standardErrorWriter”, $bindingFlags)
	$field2.SetValue($consoleHost, [Console]::Out)

I'm sure you can CTRL+H all the `w`s to `write-output`

But I figure the Fix-Quotes function is still useful to those that may have to fix this issue on a wide scale.

http://pastebin.com/xnB4QapG



",,False,,t5_2qo1o,False,,,True,t3_1cgwyu,http://www.reddit.com/r/PowerShell/comments/1cgwyu/fix_services_with_unquoted_binary_paths_registry/,
1366111529.0,3,self.PowerShell,1cge70,Dial-In settings in AD,4,1,1,http://www.reddit.com/r/PowerShell/comments/1cge70/dialin_settings_in_ad/,"Good Morning,
I need a way to change the dial-in settings for users in AD to Control Access Through NPS Network Policy. So far my searching has only turned up ways to set it to Allow or Deny. Does anyone have any suggestions on how to set this? 

Thanks!",,False,,t5_2qo1o,False,,,True,t3_1cge70,http://www.reddit.com/r/PowerShell/comments/1cge70/dialin_settings_in_ad/,
1365622376.0,3,self.PowerShell,1c301o,"Powershell newbie: Scripting help with QuestAD, and user creation scripts",3,0,12,http://www.reddit.com/r/PowerShell/comments/1c301o/powershell_newbie_scripting_help_with_questad_and/,"Hi there,  

I've been trying to create a decent script which can make new users based on a csv file with pre-defined values and I'm getting stuck just because I don't know enough yet. 

Since Reddit is an open forum, I'd rather discuss this with a powershell guru in private, so I don't need to blank out my script in places that might reveal sensitive information.  

Some info, so I can find the right person -  questAD because my org has some custom attributes that need to be filled.   

Multiple departments, dialogue boxes, and commands. 

If anyone has some time to take a look, let me know =) ",,False,,t5_2qo1o,False,,,True,t3_1c301o,http://www.reddit.com/r/PowerShell/comments/1c301o/powershell_newbie_scripting_help_with_questad_and/,
1365608595.0,3,self.PowerShell,1c2h3t,"How can I ""literalize"" a array element to an object property?",4,1,12,http://www.reddit.com/r/PowerShell/comments/1c2h3t/how_can_i_literalize_a_array_element_to_an_object/,"Example:
    
    $strFilter = ""(&amp;(objectCategory=User))""
    
    $objDomain = New-Object System.DirectoryServices.DirectoryEntry
    
    $objSearcher = New-Object System.DirectoryServices.DirectorySearcher
    $objSearcher.SearchRoot = $objDomain
    $objSearcher.PageSize = 1000
    $objSearcher.Filter = $strFilter
    $objSearcher.SearchScope = ""Subtree""

            #### THIS ####    
    $colProplist = 'dn','cn','displayName','description','givenName','homeDrive','name','ObjectClass','objectCategory','physcialDeliveryOfficeName', `
    'profilePath','sAMAccountName','sn','useraccountcontrol','userprinciplename','mail','c','company','department','homephone','l', `
    'manager','mobile','ou','postalcode','st','streetaddress','telephonenumber','dnshostname','rID','url','uSNCreate','uSNChanged','tokenGroups'
            #### THIS ####

    
    foreach ($i in $colPropList) {
        $objSearcher.PropertiesToLoad.Add($i)
    }
    
    $colResults = $objSearcher.FindAll()
    
    foreach ($objResult in $colResults) {
        $objItem = $objResult.Properties
        foreach ($s in $colPropList) {
            #### THIS ####
            $objItem.$s
            #### THIS ####
        }
        Write-Host
    }

Rephrased...I want to define a specific set of attributes in $colPropList and use those attributes in a foreach to print the values.

Normally, I'd be thrilled to do this query simply with the ActiveDirectory module. Unfortunately, this is a an old domain that we are in the process of converting and I can't make any real changes.

Of course, I could manually iterate these fields ($objItem.dn, $objItem.cn .........) but I'd rather not.

Thanks!",,False,,t5_2qo1o,False,,,True,t3_1c2h3t,http://www.reddit.com/r/PowerShell/comments/1c2h3t/how_can_i_literalize_a_array_element_to_an_object/,
1365518289.0,3,self.PowerShell,1bzoob,Removing write permissions from all users on a single file,4,1,4,http://www.reddit.com/r/PowerShell/comments/1bzoob/removing_write_permissions_from_all_users_on_a/,"Hi - I am trying to set a file to read only for around 60 users who each have individual access granted to a specific file (yes, I know that is stupid... not my doing!). There is a mix of users who have different permissions levels. I need to set them all to have read only. Anyone tackled this before? Been playing around with get-acl | set-acl but I'm having problems.",,False,,t5_2qo1o,False,,,True,t3_1bzoob,http://www.reddit.com/r/PowerShell/comments/1bzoob/removing_write_permissions_from_all_users_on_a/,
1364862660.0,3,nivot.org,1bh92k,The Bourne-Again PowerShell AWK-WARD Module,3,0,2,http://www.reddit.com/r/PowerShell/comments/1bh92k/the_bourneagain_powershell_awkward_module/,,,False,,t5_2qo1o,False,,,False,t3_1bh92k,http://nivot.org/blog/post/2013/04/01/Introducing-the-Bourne-Again-PowerShell-(BAPS)-AWK-WARD-Module,
1363570620.0,3,self.PowerShell,1ahy69,Using CSV for Group/User creation?,5,2,10,http://www.reddit.com/r/PowerShell/comments/1ahy69/using_csv_for_groupuser_creation/,"As apart of a homework assignment, I was asked to submit a csv file by email that created an OU and populated Users within it all within the forest root domain. It has me really stumped as I am not at all proficient with powershell command lines. Any help or hints would be appreciated.



for simplicity's sake. I will copy paste the exact problem being asked.

""Submit a csv file via email to create an OU named lastname-xyz (where xyz = your initials) and to create five users that will be salespeople and will work in the sales department for a company named Stuff. The users are named yourFirstNameX yourLastNameX (where X is a number from 1 to 5 inclusive). These will be created in the forest root domain in your forest. The properties must include DN, job title, first name, last name, upn, company name and any other items that are necessary to make it work.
Please also submit a printout of your file (format it in Excel so that the text in each column prints in full).""

**EDIT1** I figured out the answer to my question. For those wondering. it is a two part deal. part 1 is the creation of the oU which can be done using CSVDE. using the cmd csvde -i -f ""filename"" will inject the OU to the root domain.

the syntax within the csv file you just ran would be:
    DN,instanceType,distinguishedName,objectCategory,objectClass,ou,name,
""OU=Woodward-JMW,DC=morris,DC=lab"",4,""OU=Woodward-JMW,DC=morris,DC=lab"",""CN=Organizational-
Unit,CN=Schema,CN=Configuration,DC=morris,DC=lab"",organizationalUnit,Woodward-JMW,Woodward-JMW

the second part of the answer is to inject the users, using the same cmd line method the syntax of the second file would then be:

    DN,objectClass,sn,givenName,SAMAccountName,userPrincipalName,company,deprtment,title
    ""CN=Jason1 Woodward1,OU=Woodward-JMW,DC=Stuff,DC=com"",user,Woodward1,Jason1,Jason1.Woodward1,Jason1.Woodward1@Stuff.com,Stuff,Sales,Salesperson
    ""CN=Jason2 Woodward2,OU=Woodward-JMW,DC=Stuff,DC=com"",user,Woodward2,Jason2,Jason2.Woodward2,Jason2.Woodward2@Stuff.com,Stuff,Sales,Salesperson
    ""CN=Jason3 Woodward3,OU=Woodward-JMW,DC=Stuff,DC=com"",user,Woodward3,Jason3,Jason3.Woodward3,Jason3.Woodward3@Stuff.com,Stuff,Sales,Salesperson
    ""CN=Jason4 Woodward4,OU=Woodward-JMW,DC=Stuff,DC=com"",user,Woodward4,Jason4,Jason4.Woodward4,Jason4.Woodward4@Stuff.com,Stuff,Sales,Salesperson
    ""CN=Jason5 Woodward5,OU=Woodward-JMW,DC=Stuff,DC=com"",user,Woodward5,Jason5,Jason5.Woodward5,Jason5.Woodward5@Stuff.com,Stuff,Sales,Salesperson",,False,,t5_2qo1o,1363580069.0,,,True,t3_1ahy69,http://www.reddit.com/r/PowerShell/comments/1ahy69/using_csv_for_groupuser_creation/,
1363292617.0,3,self.PowerShell,1ab0hz,Is there an alternative to New-WebServiceProxy that provides more options?,3,0,5,http://www.reddit.com/r/PowerShell/comments/1ab0hz/is_there_an_alternative_to_newwebserviceproxy/,"I had a script that used a wsdl URI like the one below:

    http://servername:4321/ServiceName/?wsdl

A new cache was added, that is available from one of the two following URIs:

    http://servername:4321/ServiceName/htmlEndPoint
    net.tcp://servername:4321/ServiceName/

I cannot connect to these using New-WebServiceProxy because they don't seem to use a wsdl link. Is there an alternate way to connect to this using powershell? I know someone was able to do it in Python using suds (a SOAP client). They just needed to use the old URI and specify the service port:

    suds.client.Client('http://servername:4321/ServiceName/?wsdl',port='htmlEndPoint')

If there isn't another cmdlet, is there a lower level way that I can do this and specify this ""service port""? It is just a basic SOAP service, so I would imagine there has to be another way to connect to it. Any help/advice would be greatly appriciated!",,False,,t5_2qo1o,False,,,True,t3_1ab0hz,http://www.reddit.com/r/PowerShell/comments/1ab0hz/is_there_an_alternative_to_newwebserviceproxy/,
1363192921.0,2,self.PowerShell,1a81ur,"I have a script that invokes the Enable-MailUser cmdlet. The script runs under Exchange Management Shell, but errors when run with 'powershell.exe c:\script.ps1'",4,2,6,http://www.reddit.com/r/PowerShell/comments/1a81ur/i_have_a_script_that_invokes_the_enablemailuser/,"The error is: 

      "" The term 'Enable-MailUser' is not recognized as the name of a cmdlet, function, script file, 
      or operable program. Check the spelling of the name, or if a path was included, verify that 
      the path is correct and try again.  ""


When I run Get-Command in a command prompt after running powershell.exe I do not see the Enable-MailUser cmdlet/function.  Get-Command run in the Exchange Management Shell shows Enable-MailUser.

What do I need to do to get Enable-MailUser enabled when I load up just plain-jane Powershell.exe?",,False,,t5_2qo1o,False,,,True,t3_1a81ur,http://www.reddit.com/r/PowerShell/comments/1a81ur/i_have_a_script_that_invokes_the_enablemailuser/,
1362752620.0,3,thoughts.stuart-edwards.info,19wuek,Installing and configuring the NetApp Data OnTap Powershell Toolkit,3,0,2,http://www.reddit.com/r/PowerShell/comments/19wuek/installing_and_configuring_the_netapp_data_ontap/,,,False,,t5_2qo1o,False,,,False,t3_19wuek,http://thoughts.stuart-edwards.info/index.php/programming/powershell/installing-and-configuring-the-netapp-data-ontap-powershell-toolkit,
1362496294.0,3,self.PowerShell,19pjfg,Converting an object into a string - Noob question...,3,0,7,http://www.reddit.com/r/PowerShell/comments/19pjfg/converting_an_object_into_a_string_noob_question/,"I'm trying to do something more as a learning exercise than anything else. What I want to do is pull out the OracleService into a variable and then remove the words OracleService from the Name property so that I am left with just the ORACLE_SID. 

I can get the OracleService&lt;ORACLE_SID&gt; object into a variable but can't think where to go next:

    $var_obj = Get-Service | ? {$_.Name -like ""OracleService*""}

If I create a new variable (defined as a string) and just try and put the name in like this:

    [string]$var_name = $var_obj | select -Property Name 

The output of $var_name is this:

    @{Name=OracleServiceXE}

What I would like the $var_name to contain is just ""OracleServiceXE"" and then once I have that I would like to remove the ""OracleService"" and just be left with XE for the ORACLE_SID.",,False,,t5_2qo1o,False,,,True,t3_19pjfg,http://www.reddit.com/r/PowerShell/comments/19pjfg/converting_an_object_into_a_string_noob_question/,
1361648571.0,3,triteblog.com,193cic,I created a library for triggering PS code via global hotkeys (also just started a blog). Thought I'd share in case anyone likes the concept.,3,0,0,http://www.reddit.com/r/PowerShell/comments/193cic/i_created_a_library_for_triggering_ps_code_via/,,,False,,t5_2qo1o,False,,,False,t3_193cic,http://triteblog.com/BE/default.aspx,
1361427793.0,3,self.PowerShell,18xvln,"Running into problems with my Archive script, maybe a fresh set of eyes can help me figure it out.",5,2,9,http://www.reddit.com/r/PowerShell/comments/18xvln/running_into_problems_with_my_archive_script/,"I put together an archive script but I'm running into a problem.

The script is supposed to:

* Search all physical drives(excluding C:\ &amp; Z:\) for files older than 18 months.
* Move those files to a zip file on Z:\ and leave a log of all moved files on the original physical drive.

At this point I'm able to:

* Enumerate all drives besides C:\ (OS Installed here) &amp; Z:\ (All Drives) 
* For each drive remaining I use robocopy to ""move"" the files to a scratch folder on the Z:\.
* Zip up the files and then delete the scratch folder.

\* the reason I say ""move"" is because that's exactly where I'm running into a problem.   The script runs and does pretty much everything I want except that it doesn't remove the original files from the share it just copies them and leaves the original in place.

The script is available here:

http://pastebin.com/c75q7y3L

Any feedback, input, comments, etc would be greatly appreciated.",,False,,t5_2qo1o,False,,,True,t3_18xvln,http://www.reddit.com/r/PowerShell/comments/18xvln/running_into_problems_with_my_archive_script/,
1361395101.0,3,self.PowerShell,18wr9a,Powershell and Chomebooks?,3,0,11,http://www.reddit.com/r/PowerShell/comments/18wr9a/powershell_and_chomebooks/,"Hey folks,

Did a search and I didn't see anything jumping out so I wanted to ask. Does anyone know if there is a way to do powershell on the chromebook? Wonder if there's an app I just don't see that works or so, as I'm trying to do some work off the laptop, rather than my main PC on occasion.

Does anyone have any experience, or suggestions/comments?

Thanks. Have a great day folks.",,False,,t5_2qo1o,False,,,True,t3_18wr9a,http://www.reddit.com/r/PowerShell/comments/18wr9a/powershell_and_chomebooks/,
1361320909.0,3,self.PowerShell,18ur2h,Runs in ISE no problem. Task scheduler will not insert a variable into Send-MailMessage body. Show me the error of my ways,4,1,7,http://www.reddit.com/r/PowerShell/comments/18ur2h/runs_in_ise_no_problem_task_scheduler_will_not/,"As the title says. When I run the code below in ISE it inserts the variable into the email body. When I run the same script with the task scheduler (win2k8R2) everything works except the variable in the email body is omitted. 

In the task actions tab I specify powershell.exe in the program/script and put the fill path to this script in the Add arguments. I tried using -Noninteractive, -Noprofile, -Command and -File in the Add arguments to no avail.

I am really stumped as to why it works if I load it up in ISE but that variable will not insert into the email when run with the task scheduler. 

Thanks in advance.

Edit: The code below now works. Thanks to a little help with the use of scopes from spikeyfreak. Thanks again! 




    &lt;################################
    Assign variables and import modules
    ################################&gt;
    $global:filedate = (get-date).ToString(""MM_dd_yyyy"")
    $global:path = ""\\filepath\for\temp\files\""
    Import-Module DataOntap

    &lt;################################
    Setup/check for daily use file
    ################################&gt;
    If   ((Test-Path $path\Storage_Usage_$filedate.csv) -ne $true) {
         $global:datafile = New-Item -type file -force ""$path\Lenel_Storage_Usage_$filedate.csv""
     
         # Put headers in the CSV
         ""Path""+"",""+""Camera""+"",""+""Folder Size in GB""+"",""+""Date Time"" | Out-File $global:datafile -Encoding ascii -Append
         }

    Else {
         $global:datafile = ""$path\Storage_Usage_$filedate.csv""
         }


    &lt;################################
    Function for folder size
    ################################&gt;
    function FolderSize
    {
        [array]$List = GCI '\\storage\location\' | Select-Object fullname,name
            for ($i=0; $i -lt $($List.Length); $i++){
    
                $Path = $List[$i].fullname
                $camera = $List[$i].name

                $subFolderitems = (GCI $Path -Recurse | Measure-Object -Property length -Sum)
                $sum = $subFolderitems.sum/1gb
                $FolderSize = [math]::Round($sum, 3)
                $Time = Get-Date 
                $Path+"",""+$camera+"",""+$FolderSize+"",""+$Time | Out-File $global:datafile -Encoding ascii -Append
                }
    }

    &lt;################################
    Function for Filer Free Space
    ################################&gt;
    function FilerFreeSpace
    {

    $Filer = ""Filername""
    $aggr = ""aggr0""
    $vol = ""vol1""
    $narootpasswd = ""password""
    $password = ConvertTo-SecureString $narootpasswd -AsPlainText -Force
    $cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList ""root"",$password

    Connect-NaController $Filer -Credential $cred

        $volfs = (Get-NaVol $vol | Select-Object SizeAvailable)
        $freespace = $volfs.SizeAvailable/1gb
        $Global:filerfree = [math]::Round($freespace, 3)
    
    }

    &lt;################################
    Function to email users
    ################################&gt;
    function Send_Email
    {
        $EFrom = ""StorageAudit@myjob.org""
        $ESubject = ""Daily Storage Usage by Camera""  
   
        $EBody = $EBody + ""Please see the attached file for each cameras usage.  `r`n""
        $EBody = $EBody + ""There is currently $filerfree GB free on the filer.  `r`n"" 
        $EBody = $EBody + ""  `r`n""
        $EBody = $EBody + ""  `r`n""
        $EBody = $EBody + ""  `r`n""
        $EBody = $EBody + ""  `r`n""
        $EBody = $EBody + ""  `r`n""
        $EBody = $EBody + ""Thanks,  `r`n""
        $EBody = $EBody + ""Your Storage Team""

        $SMTPServer = ""xxx.xxx.xxx.xxx""
        $ETo = ""some.email.addresses@myjob.org""
        foreach ($addr in $ETo)
        {
          $addr = $addr.trim()
        }
          $Attachments = @($global:datafile)

    send-mailmessage -SmtpServer $SMTPServer -From $EFrom -to $ETo -Subject $ESubject -Body $EBody -Attachments $Attachments
   
    }

    &lt;################################
    Run the script
    ################################&gt;
    FolderSize
    FilerFreeSpace 
    Send_EMail 
",,False,,t5_2qo1o,1361397109.0,,,True,t3_18ur2h,http://www.reddit.com/r/PowerShell/comments/18ur2h/runs_in_ise_no_problem_task_scheduler_will_not/,
1361076676.0,3,self.PowerShell,18oejl,Newbie Q: Can I chain functions ?,3,0,8,http://www.reddit.com/r/PowerShell/comments/18oejl/newbie_q_can_i_chain_functions/,"in my profile.ps1  I have

    function foo { ----snip--- }
    function bar { ---snip---- }

How can I chain these 2 functions so I don't have to type in foo, then bar separately ?

thanks
",,False,,t5_2qo1o,False,,,True,t3_18oejl,http://www.reddit.com/r/PowerShell/comments/18oejl/newbie_q_can_i_chain_functions/,
1360961082.0,3,self.PowerShell,18llxs,Is it possible to make some parameters required if one parameter isn't called?,4,1,2,http://www.reddit.com/r/PowerShell/comments/18llxs/is_it_possible_to_make_some_parameters_required/,"I have a script that will list a few options with one parameter (profiletasks). If that same parameter is called, I don't want the others to be required; but I'm not sure if this is possible:

    param(
    	[Alias('p')]
    	[switch]$profiletasks,
    	[Alias('t')]
    	[string[]]$tasks,
    	[Parameter(Mandatory=$true,ValueFromPipeline=$true,ValueFromPipelineByPropertyName=$true)]
    	[Alias('s')]
    	[string]$summary,
    	[Parameter(Mandatory=$true,ValueFromPipeline=$true,ValueFromPipelineByPropertyName=$true)]
    	[Alias('d')]
    	[string]$description,
    	[Parameter(Mandatory=$true,ValueFromPipeline=$true,ValueFromPipelineByPropertyName=$true)]
    	[Alias('a')]
    	[string]$assignee
    )
",,False,,t5_2qo1o,False,,,True,t3_18llxs,http://www.reddit.com/r/PowerShell/comments/18llxs/is_it_possible_to_make_some_parameters_required/,
1360917617.0,3,tomorrow.uspeoples.org,18kmzh,Clean &amp; Manage Music Files (gets rid of brackets/makes organized folders),5,2,0,http://www.reddit.com/r/PowerShell/comments/18kmzh/clean_manage_music_files_gets_rid_of/,,,False,,t5_2qo1o,False,,,False,t3_18kmzh,http://tomorrow.uspeoples.org/2013/02/powershell-clean-manage-music-files.html,
1359383255.0,3,self.PowerShell,17fgmo,IIS handling from a remote computer?  Is this even possible,4,1,2,http://www.reddit.com/r/PowerShell/comments/17fgmo/iis_handling_from_a_remote_computer_is_this_even/,"Is it possible to manage my IIS settings from a remote machine?  I downloaded the [IIS PowerShell Snapin](http://www.iis.net/downloads/microsoft/powershell) onto my machine, but I'm unsure of the proper syntax to manipulate the settings I need to.",,False,,t5_2qo1o,False,,,True,t3_17fgmo,http://www.reddit.com/r/PowerShell/comments/17fgmo/iis_handling_from_a_remote_computer_is_this_even/,
1359088303.0,3,csharpening.net,178l7q,Getting system handles with PowerShell,4,1,1,http://www.reddit.com/r/PowerShell/comments/178l7q/getting_system_handles_with_powershell/,,,False,,t5_2qo1o,False,,,False,t3_178l7q,http://csharpening.net/?p=1495,
1359043888.0,3,self.PowerShell,1770uq,How do I omit certain file extensions/types from a copy directory command?,4,1,4,http://www.reddit.com/r/PowerShell/comments/1770uq/how_do_i_omit_certain_file_extensionstypes_from_a/,"I'm currently doing: **cp $sourceDirectory $destinationDirectory -recurse**

I'd like to omit files ending with **.config** from the copy if possible.

Does anyone know of a way to do this?",,False,,t5_2qo1o,False,,,True,t3_1770uq,http://www.reddit.com/r/PowerShell/comments/1770uq/how_do_i_omit_certain_file_extensionstypes_from_a/,
1359040716.0,3,self.PowerShell,176xf5,Converting HH:MM:SS to an integer and unit,4,1,4,http://www.reddit.com/r/PowerShell/comments/176xf5/converting_hhmmss_to_an_integer_and_unit/,"Okay, so I have a script currently that is outputting durations of phone calls. As of right now the script will output data like this:

Duration:

00:14:16.3250

Now what I would like to do is take any of the output and convert it to an integer and give the unit.. So for the output above I would like it to output ""14 minutes"". I am having a difficult time as to how to go about doing this so any assistance would be beautiful!",,False,,t5_2qo1o,False,,,True,t3_176xf5,http://www.reddit.com/r/PowerShell/comments/176xf5/converting_hhmmss_to_an_integer_and_unit/,
1358423712.0,3,self.PowerShell,16qxdo,Any way to use the OU a user is in as the input for the next command?,3,0,6,http://www.reddit.com/r/PowerShell/comments/16qxdo/any_way_to_use_the_ou_a_user_is_in_as_the_input/,"Hi,

Basically users are put into OU's by departments, I want to use that OU name and put it into the department field for all users.  I can do it manually easy with some cleanup, however the only way I know to get the OU includes the full tree of where the user is LDAP style (dc=department,dc=blah,dc=local) and I cant see an easy way to clean that up by a script, any ideas?",,False,,t5_2qo1o,False,,,True,t3_16qxdo,http://www.reddit.com/r/PowerShell/comments/16qxdo/any_way_to_use_the_ou_a_user_is_in_as_the_input/,
1357793198.0,3,self.PowerShell,16aoxy,Help to make my first powershell script running quicker.,5,2,7,http://www.reddit.com/r/PowerShell/comments/16aoxy/help_to_make_my_first_powershell_script_running/,"Hello r/powershell.

This is my first post and my first powershell script. I don't really have much experience with this language, but I had fun with this. Basically this script is getting hostnames from files on some other server, gets number of event 6005 (The Event log service was started) in 1 month to check how many restarts the host had.

I'm sure this script has a lot of room for improvements to be ran quicker, since it is kind of slow right now. Thanks in advance for all tips.

	# Variables 
	[string]$store = """"
	[int]$maxRunningJobs=20
	[int]$pauseTime=15
	$stores = @()
	$concepts = ""CON1"",""CON2"",""CON3"",""CON4"",""CON5"",""CON6"",""CON7"",""CON8""
	$startTime = Get-Date
	
	# Secured password to server1, server2.
	$userName = ""domain\user""
	$securePassword = Get-Content servPass  | ConvertTo-SecureString 
	$BSTR = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($securePassword)
	$plainPassword = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($BSTR)
	# Making sure there won't be any issues connecting to servers to get hostnames.
	$net = new-object -ComObject WScript.Network
	$net.RemoveNetworkDrive(""v:"")
	$net.MapNetworkDrive(""v:"", ""\\server1\c$"", $false, $userName, $plainPassword)
	$net.RemoveNetworkDrive(""w:"")
	$net.MapNetworkDrive(""w:"", ""\\server2\c$"", $false, $userName, $plainPassword)
	
	# Scriptblock to get the data from eventlog from 1 month back in time.
	$GetInfoJob = {
		param($store)
		Get-EventLog -LogName System -After ((Get-Date).AddMonths(-1)) -computername $store -ErrorAction SilentlyContinue `
		| Where { $_.EventId -like ""6005"" } | Measure-Object | Select-Object Count
	}
	
	# Function to limit running jobs
	Function LimitRunningJobs {    		
		Param([int]$maxConcurrent,[int]$pauseTime)     	
		# Getting number of jobs running
		$jobs = (Get-Job -state running | Measure-Object).Count      
		$runningJobs = 0       		
		# Assigning variable runningJobs if there are running jobs.
		if($jobs -ne $null)	{ $runningJobs = $jobs }     	
		# Loop making sure there won't be to many jobs running.
		while($runningJobs -ge $maxConcurrent) {		
			$jobs = (get-job -state running | Measure-Object).count      
			$runningJobs = 0       			
			if($jobs -ne $null) { $runningJobs = $jobs }   
			Write-Warning ""Current running jobs: $RunningJobs/$MaxRunningJobs. Waiting $PauseTime seconds."" 
			start-sleep -seconds  $pauseTime 		
		}
	}
	
	# Staring jobs.
	Function StartJobs {
		ForEach ($line in $file) {
			# Splitting lines with delimiter "";"" 
			$lineData = @($line.Split("";""))
			$store = $lineData[0]
			if($store.StartsWith($concept) -and $store.EndsWith(""B0"")) {		
				# Starting a new process for each host in the file, limiting to $maxRunningJobs jobs.
				LimitRunningJobs -MaxConcurrent $maxRunningJobs -PauseTime $pauseTime
				Start-Job -Name $store -ScriptBlock $GetInfoJob -ArgumentList $store							
				$stores += $store
			}
		}
		
		# Wait till all jobs are done and then write information to file.
		Wait-Job *
		
		# Receive information from each job and output to file.
		ForEach ($store in $stores) {	
			$storeData = Receive-Job -Name $store		
			if ($storeData -eq $null) {
				WriteOutput ""$store is offline.""
			} else { 
				Write-Output ""$store has been restarted: $storeData.count times since $((Get-Date).AddMonths(-1))"" &gt;&gt; ""$(Get-Date -uformat %Y%m%d)-$concept-Restarts.csv""
			}
			Get-Job -Name $store | where { $_.State -eq ""Completed"" -and -not $_.HasMoreData} | Remove-Job
		}
		# Empty the stores array.
		$stores = @()
	}
	
	# Pretty much starting all the stuff here.
	ForEach ($concept in $concepts) {
		if ($concept -eq ""CON1"" -or ""CON2"") {
			$file = Get-Content -path \\server1\c$\current\FileTran.csv 
			StartJobs
		} 
		if ($concept -eq ""CON3"" -or ""CON4"") {
			$file = Get-Content -path \\server2\c$\current\FileTran.csv 
			StartJobs
		}
		if ($concept -eq ""CON5"" -or ""CON6"" -or ""CON7"") {
			$file = Get-Content \\server3\c$\current\FileTran.csv
			StartJobs
		}
		
		# Cleanup
		$net.RemoveNetworkDrive(""v:"")
		$net.RemoveNetworkDrive(""w:"")
		
		# Checking script run time.
		$timeEnd = Get-Date
		Write-Output ""$(Get-Date -uformat %d/%m/%Y) - Elapsed Time: $(($timeEnd-$timeStart).totalseconds) seconds"" &gt;&gt; RunTime.txt
	}",,False,,t5_2qo1o,False,,,True,t3_16aoxy,http://www.reddit.com/r/PowerShell/comments/16aoxy/help_to_make_my_first_powershell_script_running/,
1357661022.0,3,self.PowerShell,166sg1,PowerShell ISE v3 block highlighting color,4,1,2,http://www.reddit.com/r/PowerShell/comments/166sg1/powershell_ise_v3_block_highlighting_color/,"As much as I love v3's ISE, the one thing that bugs me is that I normally like to use a darker theme.  Every time I move my mouse over a foreach block, for example, to collapse it I get slapped in the face with [white](http://i.imgur.com/4Y2xi.png).  It seems to me that the color (white) that used for this isn't customizable.  Is this true?  If not could someone point me in the right direction to change it?

Thanks!

EDIT:  I've sort of found a way around this by disabling outlining (View --&gt; Show Outlinging).  This is unfortunate because now I can't collapse things, but at least I can work with ISE and get all the other benefits.  It would be nice if we could change the color of the outlining though (and also improve bracket\ parenthesis pair highlighting.  Give Notepad++ a try to see what I'm talking about.  They have handled that problem pretty well.",,False,,t5_2qo1o,1358353972.0,,,True,t3_166sg1,http://www.reddit.com/r/PowerShell/comments/166sg1/powershell_ise_v3_block_highlighting_color/,
1355438397.0,3,self.PowerShell,14t61q,I'm totally stumped by trying to time out a command properly. Help?,5,2,7,http://www.reddit.com/r/PowerShell/comments/14t61q/im_totally_stumped_by_trying_to_time_out_a/,"Context: I'm in a foreach loop, working through a supplied list of VMs, stopping them, locating and copying their VHDs, and restarting them -- I'm running several servers which support integration drivers, but don't support VSS, so they can't be copied successfully without shutting down first (or so I'm told?).

One of my problems is that some of these VMs occasionally encounter a problem where the Stop-VM command hangs due to something going on within the VM -- I've had this happen on a Windows XP VM I've been testing with, for instance, where a prompt which appears at boot which actually prevent shutdown... but it doesn't throw an error, so I can't rely on errors to tell me what's going on.

As such, I want to put a five-minute timeout on my Stop-VM commands. After looking around, I believe running something as a background job is my best bet, here: I can use Start-Job, put my stop-vm command in a script block, and add a Wait-Job/Stop-Job, then evaluate whether or not the job was completed or if it was stopped prematurely. This works great -- in test cases.

Trouble is, Start-Job creates an independent runtime, and in that runtime I have no access to my profile or any variables created outside of this runtime... which means that the name of the VM (passed in as an argument to the script via schtasks, theoretically) is not accessible by the job.

Here's the snippet of code I was trying :

    Start-Job -name stop -ScriptBlock {
        if(Stop-VM -Name $vmname) {
            Write-EventLog -LogName Scripts -Source VMBackup -EntryType Information -EventId 2201 -Message ""$vmName stopped successfully."";
        } else {
            Write-EventLog -LogName Scripts -Source VMBackup -EntryType Error -EventId 2215 -Message ""$vmName failed to stop: `n`n $error[0]"";
        }
    }
    Wait-Job -name stop -Timeout 300; #if stopping the VM takes longer than five minutes, exit the job with the following
    Stop-Job -name stop;


What I want to do is then evaluate whether or not the command within the job was successful, and, if not, skip the current VM and move to the next (a continue in my foreach). I can accomplish that easily enough, even without passing data back out of the job -- just check my most recent event log entry, or check $error[0], or something. No problem.

But since I can't pass variables into my job, that doesn't work. I've tried the -InputObject arugment on Start-Job, i.e.:

    Start-Job -name stop -InputObject $vmname -ScriptBlock { whatever }

And I know that, when I do this, I need to reference $input within my script block, not $vmname. But this results in $input being empty, it seems -- my event log gets this entry in it: "" failed to stop: ...""

I've also tried $($input) instead of just $input, thinking maybe I had to cast it as a string, because it was being interpreted as an object.

Soooo... how the hell do I get this damned Stop-VM cmdlet to time out? :(",,False,,t5_2qo1o,False,,,True,t3_14t61q,http://www.reddit.com/r/PowerShell/comments/14t61q/im_totally_stumped_by_trying_to_time_out_a/,
1355433370.0,3,self.PowerShell,14t07x,Windows version agnostic method of obtaining User directory,4,1,3,http://www.reddit.com/r/PowerShell/comments/14t07x/windows_version_agnostic_method_of_obtaining_user/,"Hello all,  
  Nothing I love more than a bit of unnecessary complexity.  I had a task today where I needed to find the second most recent user of a PC (as we'll be logging on and doing some work to their system, and need to divine their user account name).

  I decided I could do this by listing the folders in the C:\Users profile, sorting then selecting the second object in the list.  But I wanted to run the same script on both XP and windows 7.  

 So, I came up with this method.  Let me know what you think.  

    get-aduser (Gci ($Env:USERPROFILE.Split('\')[0]+'\'+$Env:USERPROFILE.Split('\')[1]) | sort LastWriteTime -Decending)[1]  ",,False,,t5_2qo1o,False,,,True,t3_14t07x,http://www.reddit.com/r/PowerShell/comments/14t07x/windows_version_agnostic_method_of_obtaining_user/,
1355430067.0,3,self.PowerShell,14swdi,Replacing certain files in multiple directories with files from a single directory with the same name.,5,2,3,http://www.reddit.com/r/PowerShell/comments/14swdi/replacing_certain_files_in_multiple_directories/,"I have a directory of image files laid out like:

* Images/1/*.tiff
* Images/2/*.tiff
* etc.  

About 40 sub-directories in total, each with a few thousand files named something like 19746501.tiff.  Names are unique, even across sub-folders.

Some of those files are corrupt.  I have another folder of about 1200 files that are the non-corrupt versions of only the corrupt files with the same name.

I need to replace the files in the various sub-directories with the non-corrupt files from my folder.

If I was going from one folder to one folder, this would be easy, but I can't seem to figure out how to place them in the correct sub-folder.

Any help would be appreciated.",,False,,t5_2qo1o,False,,,True,t3_14swdi,http://www.reddit.com/r/PowerShell/comments/14swdi/replacing_certain_files_in_multiple_directories/,
1355309991.0,3,self.PowerShell,14py3j,Performance Monitoring Multiple Servers Simultaneously,3,0,7,http://www.reddit.com/r/PowerShell/comments/14py3j/performance_monitoring_multiple_servers/,"I've been tasked with collecting basic performance statistics for around 70 servers and figured it would be a good chance to learn some Powershell and (hopefully) simplify the process!!

I've managed to cobble together a script that will synchronously collect CPU usage data for each server over a given collection period then display it in a table but i'm struggling to find a way to run it asynchronously to monitor all of (or batches of) the servers at once. I'm assuming the Start-Job method is what I need but it doesn't seem keen to accept the variables I need to pass into it. Anyone have any advice? Basic code below:

    $ServerArray = ""server1"",""server"",""server3""

    $TableName = ""CPUUsage""

    $table = New-Object system.Data.DataTable “$TableName”

    $col1 = New-Object system.Data.DataColumn Name,([string])

    $col2 = New-Object system.Data.DataColumn AverageCPU,([decimal])

    $col3 = New-Object system.Data.DataColumn MaximumCPU,([decimal])

    $table.columns.add($col1)

    $table.columns.add($col2)

    $table.columns.add($col3)

    foreach ($ServerName in $ServerArray){

    $cpu = Get-Counter  ""\Processor(_total)\% Processor Time"" -SampleInterval 1 -MaxSamples 10 -ComputerName $ServerName
    $cpu | Foreach-object {$_.CounterSamples} | Measure-Object -Property CookedValue -ave -max |`

    % {$row = $table.NewRow();$row.Name = $ServerName ; $row.AverageCPU = “{0:F2}” -f($_.Average) ; $row.MaximumCPU = “{0:F2}” -f ($_.Maximum);$table.Rows.Add($row) }

    } 

    $table| format-table -AutoSize

    $table.WriteXml(“c:\PS\CPUInfo.xml”)

    $table.WriteXmlSchema(“c:\PS\CPUInfo.xsd”)",,False,,t5_2qo1o,1355310248.0,,,True,t3_14py3j,http://www.reddit.com/r/PowerShell/comments/14py3j/performance_monitoring_multiple_servers/,
1354816647.0,3,self.PowerShell,14e6lv,Question - Catching User Input Errors and ReAsking,3,0,4,http://www.reddit.com/r/PowerShell/comments/14e6lv/question_catching_user_input_errors_and_reasking/,"I am rewriting a lot of my powershell scripts and for a part of one I can not think of an easy way to get around this. I am asking for a computer name. I then check if what is entered is either null or doesn't begin with certain letters. If it does run the certain part of the script, if it doesn't basically re-ask for the computer name. In batch days I would just do a simple goto, it appears a year ago my answer was to do an assload of nested ifs. Any ideas on how to accomplish this?

    $CurrentComputerName = $Env:ComputerName
    Write-Host ""The current computer name is: $CurrentComputerName""
    Write-Host """"
    $NewComputerName = Read-Host 'Enter the new computer name and press enter: '
    if ($NewComputer -eq """") -or ($NewComputer -notlike ""NFD*"") {
    	Write-Host ""Error: You need to enter a computer name""
    	$NewComputerName = Read-Host 'Enter the new computer name and press enter: '
    	#So on and so forth
    }
    $HideOut = (Get-WmiObject win32_computersystem).rename($NewComputerName)
    Write-Host """"
    Write-host ""Press any key to restart..""
    $x = $host.UI.RawUI.ReadKey(""NoEcho,IncludeKeyDown"") # Wait for a keypress to continue.
    Restart-Computer",,False,,t5_2qo1o,False,,,True,t3_14e6lv,http://www.reddit.com/r/PowerShell/comments/14e6lv/question_catching_user_input_errors_and_reasking/,
1354600240.0,3,self.PowerShell,148ynf,Is there a way to get 256 colors in powershell and friends?,3,0,4,http://www.reddit.com/r/PowerShell/comments/148ynf/is_there_a_way_to_get_256_colors_in_powershell/,"I'm playing around with [this](https://github.com/spf13/spf13-vim) Vim setup, but the colors are looking very rough in Powershell. I believe it's coming down to whether or not the terminal can support/emulate something called xterm-256 colors.

I've also tried Console2 and ConEmu64 in an attempt to find a Windows solution with little luck. Anyone have suggestions? Thanks!",,False,,t5_2qo1o,False,,,True,t3_148ynf,http://www.reddit.com/r/PowerShell/comments/148ynf/is_there_a_way_to_get_256_colors_in_powershell/,
1354305260.0,5,self.PowerShell,142f3n,Help: Trying to figure out if script is possible.,7,2,11,http://www.reddit.com/r/PowerShell/comments/142f3n/help_trying_to_figure_out_if_script_is_possible/,"I co-run a lab where we record our event logs on every machine and then copy them to the in house servers. we have 41 end user machines that are networked and 32 stand alone machines that are not able to connect to any network. As you can imagine this gets incredibly time consuming. 

I'm wondering is there a possibility of creating a script to pull the event logs in a save file on each machine, at a set point in time, and then send it to the mapped drive on the server? 

If so how complicated is this going to be to create, I'm new to power shell and I'm trying to learn as fast as possible.",,False,,t5_2qo1o,False,,,True,t3_142f3n,http://www.reddit.com/r/PowerShell/comments/142f3n/help_trying_to_figure_out_if_script_is_possible/,
1353818344.0,3,self.PowerShell,13qw5w,Converting DER encoded certificate to ssh-rsa,4,1,3,http://www.reddit.com/r/PowerShell/comments/13qw5w/converting_der_encoded_certificate_to_sshrsa/,"I am trying to automate a process of exporting a public certificate from a users personal store and converting it to ssh-rsa to be used in an authorized_keys file on a Linux server.

Basically I can export the certificate to a .cer file. Run an openssl command to convert the certificate to a .pub file. Then from there I can use ssh-keygen to generate the proper key. 

My hope though was to be able to publish the ssh-rsa public key to an AD attribute and I haven't been able to find anything in the powershell or vbs world that can convert a certificate to the needed format. 

Does anyone have any experience that could help point me in the right direction?

Thanks!

EDIT: I decided to go a different route. I am going to simply publish the DER encoded certificate to the AD user attribute and have puppet query AD for the der encoded cert so can manipulate as needed in unix land.",,False,,t5_2qo1o,1354032110.0,,,True,t3_13qw5w,http://www.reddit.com/r/PowerShell/comments/13qw5w/converting_der_encoded_certificate_to_sshrsa/,
1353086065.0,3,self.PowerShell,13b1gq,"Write-Zip is including folder\files, not just files..Any ideas?",3,0,2,http://www.reddit.com/r/PowerShell/comments/13b1gq/writezip_is_including_folderfiles_not_just/,"I've got a small script to clean-up archived event logs by zipping them, then moving them, and finally removing the unarchived files.  Everything is working great with the exception of how write-zip is executing.  

How can write-zip just zip the files up, not the parent folder with files?  Right now when it executes, the zip contains folder\files.log.  How can I get it the zip to just have files?

#Get time in month-year format
$timestamp = Get-Date -Format 'MM-yyyy'

#get archived event log files and store them in memory
$files = Get-ChildItem -path c:\test -Recurse | Where-Object { $_.Name -like ""comp*"" }

#creates empty archive to append to
$ArchiveFile = ""C:\Weekly_Security_Archives_$timestamp.zip""

#tests if the zip is present, if not create it, if present, append
If (!(Test-Path $ArchiveFile)) { Set-Content $ArchiveFile (""PK"" + [char]5 + [char]6 + (""$([char]0)"" * 18)) }      
write-zip $files ""c:\Weekly_Security_Archives_$timestamp.zip"" -level 9 -append -includeemptydirectories

#remove uncompressed files that have just been zipped
Remove-Item c:\test\comp*.log",,False,,t5_2qo1o,False,,,True,t3_13b1gq,http://www.reddit.com/r/PowerShell/comments/13b1gq/writezip_is_including_folderfiles_not_just/,
1352981896.0,3,self.PowerShell,138imx,"Having trouble with a large file transfer, would like some help.",6,3,12,http://www.reddit.com/r/PowerShell/comments/138imx/having_trouble_with_a_large_file_transfer_would/,"We use remote powershell and a script called send-file.ps1 to transfer file from our build server to our windows environments. Send-file is an open source script that just chunks out a file and sends it from point A to B over a session. [http://poshcode.org/2216](http://poshcode.org/2216) 

Yesterday we ran into an issue where our zip file has became too large. Now our session has exceeded the 50MB default Cap. Does anybody have any good examples of what to do when you run into a problem such as this? 

I keep finding things about BITS but can't find a tutorial that is clicking. Is this even the right path to go down?

Any help would be great.",,False,,t5_2qo1o,False,,,True,t3_138imx,http://www.reddit.com/r/PowerShell/comments/138imx/having_trouble_with_a_large_file_transfer_would/,
1352769412.0,3,self.PowerShell,133h1f,EWS no longer wants to connect.,4,1,4,http://www.reddit.com/r/PowerShell/comments/133h1f/ews_no_longer_wants_to_connect/,"Hello r/powershell! Long time lurker, first time poster (hopefully I didn't completely foul up the formatting...)

Several months ago I wrote a script to connect to Exchange 2007 (SP1) and monitor my mailbox. It's been working perfectly until a couple of days ago. After spending the best part of 12 hours on it, I'm admitting defeat, and asking if anyone has any ideas.

The problem: Upon connection to Exchange, I am receiving the error
` Exception calling ""Bind"" with ""2"" argument(s): ""The request failed. The underlying connection was closed: An unexpected error occurred on a send.""

And this is what I have. WebServices.dll is version 14.3.67.1 (originally was 14.3.32.0). Remember that it worked fine for months, and just suddenly stopped working. (Which makes me wonder if IT did something they haven't made public.):

    Add-Type -Path ""C:\Program Files\Microsoft\Exchange\Web Services\1.2\Microsoft.Exchange.WebServices.Dll"" -ErrorAction Stop
    $service = New-Object Microsoft.Exchange.WebServices.Data.ExchangeService([Microsoft.Exchange.WebServices.Data.ExchangeVersion]::Exchange2007_SP1)
    $service.Credentials = New-Object Net.NetworkCredential($userAccount, $userPassword, $userDomain)
    $service.Url = New-Object Uri(""https://my-exchange-server/EWS/Exchange.asmx"")
    $inbox = [Microsoft.Exchange.WebServices.Data.Folder]::Bind($service, [Microsoft.Exchange.WebServices.Data.WellKnownFolderName]::Inbox)


As soon as the Bind method is called I get the error. Much Googling led me to references to:

    $Provider=New-Object Microsoft.CSharp.CSharpCodeProvider
    $Compiler=$Provider.CreateCompiler()
    $Params=New-Object System.CodeDom.Compiler.CompilerParameters
    $Params.GenerateExecutable=$False
    $Params.GenerateInMemory=$True
    $Params.IncludeDebugInformation=$False
    $Params.ReferencedAssemblies.Add(""System.DLL"") | Out-Null

    $TASource=@'
      namespace Local.ToolkitExtensions.Net.CertificatePolicy{
        public class TrustAll : System.Net.ICertificatePolicy {
          public TrustAll() { 
          }
          public bool CheckValidationResult(System.Net.ServicePoint sp,
            System.Security.Cryptography.X509Certificates.X509Certificate cert, 
            System.Net.WebRequest req, int problem) {
            return true;
          }
        }
      }
    '@ 
    $TAResults=$Provider.CompileAssemblyFromSource($Params,$TASource)
    $TAAssembly=$TAResults.CompiledAssembly

    ## We now create an instance of the TrustAll and attach it to the ServicePointManager
    $TrustAll=$TAAssembly.CreateInstance(""Local.ToolkitExtensions.Net.CertificatePolicy.TrustAll"")
    [System.Net.ServicePointManager]::CertificatePolicy=$TrustAll

All of which makes no difference at all. (I had been experiencing certificate errors earlier on, but switched to using the host identified in the certificate, and those errors went away. I double-checked that the host was fine by using http://ewseditor.codeplex.com and that returns the data I'm expecting to see.)

At this point, Google seems to be returning all the same stuff back to me that I've tried. Anyone out there have any ideas?

[Edit: Included original DLL version as well as current. Minor formatting mod.]",,False,,t5_2qo1o,False,,,True,t3_133h1f,http://www.reddit.com/r/PowerShell/comments/133h1f/ews_no_longer_wants_to_connect/,
1351741736.0,3,self.PowerShell,12fvpx,High level overview of a script to monitor AD for changes.,4,1,9,http://www.reddit.com/r/PowerShell/comments/12fvpx/high_level_overview_of_a_script_to_monitor_ad_for/,"By the time I actually get to implement these ideas I will no longer be high/drunk and my time spend implementing this will make it impossible for me to share the low level details, DLP and what not..

So anyhoo,  

XML files containing formatted objects:   

     Core_SecGouprs.xml, Core_LocalGroups.xml,etc..xml

Txt files distinguished names(DN):

    Core_SecGroups.txt, Core_LocalGROups.txt etc...txt

function convert-DNtoObject

param(dn,type)

#return a formatted object

type=Group :

     [string]GroupNAme, [array]MEmbers{name,objectclass},[string]location,[string]changeMgmt

type=computer :
     
      [string]Compname, [array]Groups{[array]membernames}, [string]location, [string]changeManagment,[string]notes

type=User : 
 
     [string]Name,[string]Location,[string]Notes,[string]changemanagment

    function  compare-SecurityObjectsArrays{
     param(objOld,ObjNew,Type)

     #This should be ran at the level of and array of group member names

      #Three functions for parsing each type object
     
      type=GroupMembers, alert if additions or removal
     
      type=LocalSecuritygroups object, enumerate each security group and compare additions or removal
     
      type= user object alert if new or removed

     return [string]status of change
     }

     Main()

     #Here is our interaction with xml ""gold"" files containing known good object types (Group,User,Computer
  
     #and the txt files containing,DN (core manually created, others automatically)

     #Script will run daily and upon certian contidions read a txt file of dns's
     
      gc txt file to create $NewObj 
     
      input associated xml ""gold"" file to create $oldOj
     
      use compare functions per item 
Alert once a day via email if conditions are met, based on location/ou/whatever a distribution list can be alerted

Script will only alert for certian contitions like addition to core sec groups


Core server file can be parsed once a day 

core SEcGroup file can be parsed hourly


     function generate-DNfiles

     (param type)

     #For all the non core groups txt files will be generated automatically
     
     #They will query the base of a domain , OU, *name*, etc..

    $obj  | export-xml
 
     }

     function master-GoldUpdate{

     param(type)
     #The master core xml files should never be updated manually, only with this script

     #This script will call the info gatherer and write the current state of core groups
     }
*I'll update general formatting, high level info if I change, some of this shit is probably half baked.
 ",,False,,t5_2qo1o,1351743090.0,,,True,t3_12fvpx,http://www.reddit.com/r/PowerShell/comments/12fvpx/high_level_overview_of_a_script_to_monitor_ad_for/,
1351727335.0,3,ramblingcookiemonster.wordpress.com,12fg98,New-RemoteProcess: Run processes on remote systems,6,3,1,http://www.reddit.com/r/PowerShell/comments/12fg98/newremoteprocess_run_processes_on_remote_systems/,,,False,,t5_2qo1o,False,,,False,t3_12fg98,http://ramblingcookiemonster.wordpress.com/2012/10/31/new-remoteprocess/,
1351720829.0,3,self.PowerShell,12f8ov,Hashtable to CSV,4,1,3,http://www.reddit.com/r/PowerShell/comments/12f8ov/hashtable_to_csv/,"Hi! I can't find a way to convert a hashtable to a CSV file. Basically I have a few variables with strings that i'm using for values in a hashtable, as follows:

    $OMReport = @{}
    $OMReport.Add(""BIOS Version"",$BIOSVersion)
    $OMReport.Add(""DRAC Version"",$DRACVersion)

So when I print the table I get something like this:

    Name                           Value
    ----                           -----
    DRAC Version                   4.07
    BIOS Version                   1.0.43


I want to export that same format to a csv having ""Name"" as the name of the first column, and ""Value"" for the second one. I tried simple stuff like ConvertTo-CSV combined with Export-CSV, but didn't work. It seems I'm missing some knowledge on how to do it. Any thoughts?

Thanks in advance!


&gt;EDIT: Ok, I did it on my own quicker than I thought. Here's how I did it:

    $report = @()
    $OMReport.GetEnumerator() | ForEach-Object {
    	$row = """" | Select ""Name"",""Version""
    	$row.""Name"" = $_.Key
    	$row.""Version"" = $_.Value
    	$report += $row
    }
    $report | Export-Csv C:\Test\OMSA.csv",,False,,t5_2qo1o,1351782195.0,,,True,t3_12f8ov,http://www.reddit.com/r/PowerShell/comments/12f8ov/hashtable_to_csv/,
1351520812.0,3,self.PowerShell,129xsu,Is it possible to search for a file (the path will always be random) and run a command that uses that path and file?,4,1,16,http://www.reddit.com/r/PowerShell/comments/129xsu/is_it_possible_to_search_for_a_file_the_path_will/,New to powershell.  Basically I'm looking to run CorFlags.exe on a file but the path of the file is always different computer to computer.,,False,,t5_2qo1o,False,,,True,t3_129xsu,http://www.reddit.com/r/PowerShell/comments/129xsu/is_it_possible_to_search_for_a_file_the_path_will/,
1351483414.0,3,self.PowerShell,129aqy,Automating Get-TroubleshootingPack | Invoke-TroubleshootingPack? ,3,0,5,http://www.reddit.com/r/PowerShell/comments/129aqy/automating_gettroubleshootingpack/,"I've been trying to figure out how to automate Get-TroubleshootingPack and/or Invoke-TroubleshootingPack. I have a friend has a network bridge setup on his machine, and for some reason needs the network bridge reset each time when he reboots his machine. I'm sure there's an easy way with Powershell or netsh. I know his fix is to just right click on the aforementioned drive, and click ""Diagnose""

I thought it would be straight forward to automate this but seems to be a pain. I thought I had the right answer file, but I'm unsure where to put that. It seems like it goes along with Get-TroubleshootingPack AND/Or Invoke-TroubleshootingPack. Am I missing something here, or am I doing something wrong? 

",,False,,t5_2qo1o,False,,,True,t3_129aqy,http://www.reddit.com/r/PowerShell/comments/129aqy/automating_gettroubleshootingpack/,
1351461914.0,3,self.PowerShell,128n67,"New to PowerShell, using PowerShell to rename photos based on EXIF?",4,1,5,http://www.reddit.com/r/PowerShell/comments/128n67/new_to_powershell_using_powershell_to_rename/,I want to point PowerShell at a folder of images and have it rename them based on date and time taken from the files EXIF.,,False,,t5_2qo1o,False,,,True,t3_128n67,http://www.reddit.com/r/PowerShell/comments/128n67/new_to_powershell_using_powershell_to_rename/,
1351110113.0,3,self.PowerShell,120wvz,"Powershell for multiple orgs or consultants, can it work?",4,1,4,http://www.reddit.com/r/PowerShell/comments/120wvz/powershell_for_multiple_orgs_or_consultants_can/,"Scenario: laptop with all my powershell apps, my custom profile that takes a full minute or two to load, and all my script files that are as generic or as specific as I want.

Goal: apply these scripts as needed to a number of organizations over time, such that I have valid permissions for each organization in the for of user accounts

In other words, pretend I am a consultant who visits 4 different clients a month.  They each have their own AD org and my pimp powershell laptop isn't a member of any of their domains.  Is there a solution for remoting from a workgroup or forest to an untrusted forest so long as you have the proper credentials to access the untrusted forest?",,False,,t5_2qo1o,False,,,True,t3_120wvz,http://www.reddit.com/r/PowerShell/comments/120wvz/powershell_for_multiple_orgs_or_consultants_can/,
1350491887.0,3,self.PowerShell,11mxpm,Combine XML Files,3,0,3,http://www.reddit.com/r/PowerShell/comments/11mxpm/combine_xml_files/,"I'm looking for a way to combine XML files. I found something [this on stack overflow.](http://stackoverflow.com/questions/2972264/merge-multiple-xml-files-into-one-using-powershell-2-0) However it's not working for me.

From my last post [here](http://www.reddit.com/r/PowerShell/comments/116zee/creating_a_custom_log/c6jwr79) I'm using [sylver_dragon's](http://www.reddit.com/user/sylver_dragon) XML method to create a log file per user. I'd like to combine these into a master log. I could do it via CSV but XML is much more flexible for what I'm doing.",,False,,t5_2qo1o,False,,,True,t3_11mxpm,http://www.reddit.com/r/PowerShell/comments/11mxpm/combine_xml_files/,
1350425072.0,3,self.PowerShell,11le3s,Health reporting on scripts that are scheduled as tasks.,3,0,16,http://www.reddit.com/r/PowerShell/comments/11le3s/health_reporting_on_scripts_that_are_scheduled_as/,"I have a bunch of AD processes automated, onboarding/offloading, various other changes that are driven by HR.  Currently I don't know if some of these scripts are running because if they don't get input they don't report anything as emails from every process would get overwhelming. 

So my idea is to add a line to all my scripts to output a friendly name for the script, along with a date to a central file.  This file will be read by another process and can email me the current contents of the file and delete/move the old one.",,False,,t5_2qo1o,False,,,True,t3_11le3s,http://www.reddit.com/r/PowerShell/comments/11le3s/health_reporting_on_scripts_that_are_scheduled_as/,
1348847860.0,3,self.PowerShell,10mg2t,Help with PSFTP inside powershell?,6,3,7,http://www.reddit.com/r/PowerShell/comments/10mg2t/help_with_psftp_inside_powershell/,"Hi all, as an update to the need help with SQL formatting post I made a few days ago, I'm on to the next step and running into a little bit of a problem.  I need to upload the file that is formatted to the bank via SFTP.  I can connect in using PSFTP fine using the command line interface, but scripting it is proving to be a task.

Code:

    $user = ""user""
    $PW = ""pw""
    $Uploadfile = ""C:\Staging\Test.txt""
    $ftp = C:\Staging\psftp.exe  -l $user -pw $pass      sftp.bank.com
    ""cd To_directory
    ""put $Uploadfile""

I'm not sure what to do from here, I've spend all morning banging my head against the wall with this though.  Any tips on how I can send a file out via SFTP using PSFTP?
""put $outfilefile bye"" ",,False,,t5_2qo1o,False,,,True,t3_10mg2t,http://www.reddit.com/r/PowerShell/comments/10mg2t/help_with_psftp_inside_powershell/,
1348760641.0,3,self.PowerShell,10kfek,Trouble w/ out-file,3,0,9,http://www.reddit.com/r/PowerShell/comments/10kfek/trouble_w_outfile/,"It seemed like a simple task when I started and I'm not sure what I'm doing wrong. I wanted to export the full help for the F5 iControl cmdlets to a file.

I gathered all the names into a variable:

`$name = (get-command -module iControlSnapIn).name`

Created a count variable:

`$count = $name.count`

And iterated through to output the help onto the screen:


`for ($i=0; $i -lt $count; $i++){man $name[$i] -full}`

All the help files output to the screen. So far, so good.

Then I tried to pipe all the output to a file:

`for ($i=0; $i -lt $count; $i++){man $name[$i] -full} | ``

`out-file -path $my_dir\icontrols.man`

And this is where the wheels come off the wagon. I get an error telling that ""An empty pipe element is not allowed.""

I tried outputting via a transcript, but that didn't work either. I got no error, but when I look at the transcript, the output isn't there. I see the line to iterate through help then I see the stop-transcript line. 

`**********************`

`Transcript started, output file is C:\Users\hluna_admin\Documents\PowerShell_transcript.20120927082433.txt`
 `CC:\&gt; for ($i=0; $i -lt $count; $i++){man $name[$i] -full}`

` CC:\&gt;  stop-transcript`

`**********************`

`Windows PowerShell transcript end`

`End time: 20120927082525`


`**********************`

Any thoughts?",,False,,t5_2qo1o,False,,,True,t3_10kfek,http://www.reddit.com/r/PowerShell/comments/10kfek/trouble_w_outfile/,
1348671539.0,3,self.PowerShell,10ibqf,Why does this not work?,3,0,11,http://www.reddit.com/r/PowerShell/comments/10ibqf/why_does_this_not_work/,"So about a year ago, I discovered [this](http://gallery.technet.microsoft.com/scriptcenter/cfbc642e-9a1e-4739-9ac5-9f462343a2f7).

I cannot get it working. I get all kinds of weird errors. It starts with errors about not being able to find the terminating ""@, and once I get that fixed it starts throwing errors in the TaskScheduler module, specifically that it cannot load the type [__ComObject] (which is used in a couple of the TaskScheduler scripts, and I can't find any documentation on it).

I am trying to get this working in PowerShell v2.

Anyone got any ideas?",,False,,t5_2qo1o,False,,,True,t3_10ibqf,http://www.reddit.com/r/PowerShell/comments/10ibqf/why_does_this_not_work/,
1348602533.0,3,self.PowerShell,10gt3u,variable/static text separation,3,0,4,http://www.reddit.com/r/PowerShell/comments/10gt3u/variablestatic_text_separation/,"How can I separate the a variable and static sections of a string?

I have 
[code]
out-file -FilePath ""$env:userprofile\desktop\$dateTermLog.log"" -append
[/code]

The final filename is "".log' because it is thinking I am looking for $dateTermLog when what I am wanting is the $date variable with TermLog appended.",,False,,t5_2qo1o,False,,,True,t3_10gt3u,http://www.reddit.com/r/PowerShell/comments/10gt3u/variablestatic_text_separation/,
1348505797.0,3,self.PowerShell,10eej2,Formatting the output of a SQL query?,7,4,9,http://www.reddit.com/r/PowerShell/comments/10eej2/formatting_the_output_of_a_sql_query/,"I'm trying to execute a SQL query and I need to format the results to a specific format that will be accepted by our PosPay vendor (our Bank, more specifically..).

In the SQL query I have to insert some text into the front of the record, etc.. but when I execute the query through Powershell any of that formatting is dropped off and it becomes a flat txt or csv, depending on what I output as.

Any tips?

Here's the only really relevant code:

    cd SQLSERVER:\sql\masked\default\databases\masked
    Invoke-sqlcmd -ServerInstance $SQLServ -Database $Instance -InputFile $Query 

I've tried variations of |'ing to format-table and out-file, none of them keep the formatting I specify in the query.",,False,,t5_2qo1o,False,,,True,t3_10eej2,http://www.reddit.com/r/PowerShell/comments/10eej2/formatting_the_output_of_a_sql_query/,
1347042080.0,3,self.PowerShell,zimk4,Missing something?,3,0,3,http://www.reddit.com/r/PowerShell/comments/zimk4/missing_something/,"I am trying to make a script to disable users, remove AD groups and reset the password of users when they reside in a specific OU.  But I seem to be missing something.  The script doesn't throw any errors but it isn't completing the piped commands either.  Any help would be much appreciated.

Import-Module activedirectory

$users= get-aduser -Filter * -SearchBase ""OU=Disabled Users,DC=Contoso,DC=local""
Function RemoveMemberships
 {
 param([string]$SAMAccountName)  
 
 $user = Get-ADUser $SAMAccountName -properties memberof
 
 $userGroups = $user.memberof
 $userGroups | %{get-adgroup $_ | Remove-ADGroupMember -confirm:$false -member $SAMAccountName}
 $userGroups = $null
 }

$users | %{RemoveMemberships $_.SAMAccountName |Set-ADAccountPassword -Identity ""$_"" -Reset -NewPassword (ConvertTo-SecureString -AsPlainText ""Dis@bledUser"" -Force)|Set-ADUser -Identity ""$_"" -Description ""Disabled User"" -Enabled:$false }",,False,,t5_2qo1o,False,,,True,t3_zimk4,http://www.reddit.com/r/PowerShell/comments/zimk4/missing_something/,
1346905878.0,3,self.PowerShell,zfnbf,Add Primary SMTP address script,6,3,9,http://www.reddit.com/r/PowerShell/comments/zfnbf/add_primary_smtp_address_script/,"I have just recently had a script job dumped on me. I have never made one before and was wondering if someone could help getting me started. I need a script to add a SMTP Primary address to all user's in Active Directory using the sAMAccountName Attribute. The one thing though, is I am not supposed to affect any current user's that may have a Primary Address.

Now like I said, I have never done anything like this before, but I have been reading and searching. I tried used ADModify, which worked, however the only way to prevent anything from being overwritten is by not setting as Primary. I have looked through the script repository with no luck finding something similar to what I require.

The reason I came here is cause I know PowerShell should be able to do what I'm asking. And as I was told, it ""should be easy and only take a few minutes"", but I have been at this for quite a few hours now.

Also a note: I wasn't told any of the specifics when it came to the AD environment, all I can guarantee is that its Server 2003. Maybe what I'm looking for can be done in a .vbs script, I don't know I'm kind of lost.

Any help is really appreciated.",,False,,t5_2qo1o,False,,,True,t3_zfnbf,http://www.reddit.com/r/PowerShell/comments/zfnbf/add_primary_smtp_address_script/,
1346452918.0,3,self.PowerShell,z5r22,problem creating a function,4,1,5,http://www.reddit.com/r/PowerShell/comments/z5r22/problem_creating_a_function/,"I am trying to create a function to abstract my log writes.  Below is the code I am trying 



function WriteLog ($string = ""Writelog Called with no data to write to log"", $filename = ""genericlog"")
{
    Out-File -FilePath $env:userprofile\desktop\$date$filename.log -Append -InputObject $string
    echo $string
}




When I call it with the code listed below 



WriteLog (""removeing mailbox for $targetuser"",""TermLog"")


The function then utilizes the default for the Filename (instead of ""TermLog"") and includes the string ""TermLog"" in the actual file data and echos it to the screen.  Basicly it acts as if the ""TermLog"" is included in the first parameter.

Why would this happen and what can I do to correct it?",,False,,t5_2qo1o,False,,,True,t3_z5r22,http://www.reddit.com/r/PowerShell/comments/z5r22/problem_creating_a_function/,
1345449640.0,3,self.PowerShell,yij05,Decimal Rounding?,3,0,3,http://www.reddit.com/r/PowerShell/comments/yij05/decimal_rounding/,"I wrote a script that finds find new files and their sizes and displays them in a list. This works well, However I don't want/need so many decimal places. How can I truncate them or keep it low to 1 or 2 decimal places? 

    gci j: -recurse -Exclude *.nfo, *.txt, *.png, *.jpg | ? {$_.CreationTime -ge (get-date).adddays(-4)} | FL  Name, Directory, @{Name=""Size (MB)"";Expression={$_.Length / 1mb}}

",,False,,t5_2qo1o,False,,,True,t3_yij05,http://www.reddit.com/r/PowerShell/comments/yij05/decimal_rounding/,
1345089880.0,3,self.PowerShell,yawoj,Creating unique username with incrementing number,4,1,5,http://www.reddit.com/r/PowerShell/comments/yawoj/creating_unique_username_with_incrementing_number/,"Domain and Forest functional level 2008.
ActiveRoles Management Shell 1.5.1, a part of Quest ActiveRoles Server 6.7

I've been tasked to import a large number of new users into a domain with several thousand existing users.  Usernames use first initial+middle initial+last name (jtdoe).  If the account already exists then a number is added at the end (jtdoe1, jtdoe2, ...).

I'm using a function from [here](http://dmitrysotnikov.wordpress.com/2010/03/22/test-if-ad-object-path-exists/) to test for an existing account.  This part has worked in the past and it works when I use it alone in the command line.

My Username creation is here ($Username is created from the name before this point):
&gt;$Account = $Username

&gt;if (Test-QADObject $Account) {

&gt;$count = 0

&gt;do {

&gt;$count++

&gt;$Account = $Username + $count

&gt;}

&gt;while (Test-QADObject $Account)

&gt;}

&gt;$Username = $Account


When I run the script and it cycles through a couple of test names, it throws an error that the account already exists at the point of creation.  I feel like I'm overlooking something simple...

**Edit: The problem was not with the $Username field, but with the Display name that I was assigning.  I did not realize that it had to be unique as well.**",,False,,t5_2qo1o,1345133137.0,,,True,t3_yawoj,http://www.reddit.com/r/PowerShell/comments/yawoj/creating_unique_username_with_incrementing_number/,
1344526044.0,3,self.PowerShell,xxy4a,Powershell - Pull certain values from Windows Event Logs,3,0,10,http://www.reddit.com/r/PowerShell/comments/xxy4a/powershell_pull_certain_values_from_windows_event/,"I'm setting up an email alert script to email through our SMTP server and outwards to administration to let us know when an account is locked out.

Here is what I have now:

    $smtpServer = ""192.168.192.91""  
    $MailFrom = ""user1@ourdomain.com"" 
    $mailto = ""user2@ourdomain.com"" 
    $msg = new-object Net.Mail.MailMessage  
    $smtp = new-object Net.Mail.SmtpClient($smtpServer)  
    $msg.From = $MailFrom 
    $msg.To.Add($Mailto)   
    $msg.Subject = ""Report-Test."" 
    $30MinutesAgo = [DateTime]::Now.AddMinutes(-30)
    $msg.Body = Get-EventLog ""Security"" | Where {$30MinutesAgo -le $_.TimeWritten -and $_.eventid -eq 4740} | Format-List | Out-String
    $smtp.Send($msg)

Now it works, but here's the output I'm getting:

    Index              : 19859468
    EntryType          : SuccessAudit
    InstanceId         : 4740 
    Message            : A user account was locked out.

    Subject:
    Security ID:        S-1-5-18
    Account Name:        SEA-ASA-AD1$
    Account Domain:        ASA
    Logon ID:        0x3e7

    Account That Was Locked Out:
    Security ID:        S-1-5-21-359401657-2533411870-3585958800-1216
    Account Name:        Josh.Test

    Additional Information:
    Caller Computer Name:    JOSH-DESKTOP
    Category           : (13824)
    CategoryNumber     : 13824
    ReplacementStrings : {Josh.Test, JOSH-DESKTOP, S-1-5-21-359401657-2533411870-      3585958800-1216, S-1-5-18...}
    Source             : Microsoft-Windows-Security-Auditing
    TimeGenerated      : 8/8/2012 8:34:42 PM
    TimeWritten        : 8/8/2012 8:34:42 PM
    UserName           :


What I'd LIKE to do is have Powershell pull only a few variables from the output, namely the Account Name value from under Account That Was Locked Out and also the TimeGenerated value. Then organize it around to pretty up the body of the email.


EDIT:

I ended up getting the emails to pop through when this event pops up, but not through this script.  Being new to Windows Administration, there's a lot of shit I never knew about.  For example, I didn't know you could hop into the Event Log, filter out an Event ID, click the event ID, and do exactly what I was trying to do without all the manual scripting.  I guess the only way to really learn is to ask questions and fiddle around.

The only issue I've run into now is that whenever the email sends out, the Log output comes in a text file attached to the email.  This is obnoxious because now I have to click the attachment in Outlook to see the output.  This is really just a minor inconvenience and more a personal preference kind of thing, but I'd much prefer the output to come through in the body of the email and I can't quite figure out how to get that working.  Going to continue fiddling with it over time and hopefully get it working.

I want to thank everyone for the pointers and help.  I'm also new to scripting (new to everything, really) and am anxious to find time to learn it proper.  You'll probably see much more of me around here.

Thanks again!",,False,,t5_2qo1o,1345004895.0,,,True,t3_xxy4a,http://www.reddit.com/r/PowerShell/comments/xxy4a/powershell_pull_certain_values_from_windows_event/,
1344458582.0,3,self.PowerShell,xwg4t,Trouble with shared folders,3,0,9,http://www.reddit.com/r/PowerShell/comments/xwg4t/trouble_with_shared_folders/,"I'm an intern for an IT department and they have me making scripts for PowerShell on Windows7 regularly. My most recent task involves creating a directory for a user on our server with their name, giving them modify permissions to the directory, and setting it as their home drive in active directory. The end goal is to create a script that will set up home drives by reading employee names from a .csv.

The below script provides me with most of the results I'm looking for. The only problem arises when I go into the GUI to look at the shared properties of the directory. The Network Path is listed but when I go into ""Advanced Sharing"" the ""Share this folder"" box is unchecked. The folder is not shared and it can not be accessed from other machines. Checking the box fixes the issue, obviously.

Is there an error in my code below? I'm relatively new to programming and I've been working out of PowerShell for less than a month at this point. I'm also self-taught, so I apologize for poor PowerShell formatting.

(For the sake of security, the server is $server and the domain is $domain)

EDIT: Could it be due to a lack of setting share permissions?

EDIT2: Finally fixed it. Changed home directory to ""\\$server\users\$user""

    $user = Read-Host ""`nPlease type in the first.last name of the user you wish to make a directory for""
    $directory = ""\\$server\d$\users\$user""

    mkdir $directory

    $share = [WMICLASS]""\\$server\root\cimv2:Win32_Share""
    $share.Create($directory, ""$user$"", 0)

    $GetACL = Get-Acl $directory

    $Allinherit = [system.security.accesscontrol.InheritanceFlags]""ContainerInherit, ObjectInherit""
    $Allpropagation = [system.security.accesscontrol.PropagationFlags]""None""
    $AccessRule = New-Object system.security.AccessControl.FileSystemAccessRule(""$domain\$user"", ""Modify"", $AllInherit, $Allpropagation, ""Allow"")

    $GetACL.AddAccessRule($AccessRule)
    Set-Acl $directory -aclobject $GetACL

    Set-AdUser $user -HomeDrive 'U' -HomeDirectory ""\\$server\$user$""",,False,,t5_2qo1o,1344957941.0,,,True,t3_xwg4t,http://www.reddit.com/r/PowerShell/comments/xwg4t/trouble_with_shared_folders/,
1344442324.0,3,self.PowerShell,xvxgd,Adding AD info from CSV. Problem with blank fields.,3,0,4,http://www.reddit.com/r/PowerShell/comments/xvxgd/adding_ad_info_from_csv_problem_with_blank_fields/,"I have a question about errors with importing AD info from a CSV where some of the CSV fields may be blank.
Here is a shorter version of what I am running. 

foreach ($line in (import-csv file.csv)) {Set-ADUser $line.samaccountname -title $line.title -department $line.department}

This works fine if all of the fields are populated in the CSV, but errors out if any one is blank.

Can anyone point me in the right direction?


EDIT:
Found this after a while http://dmitrysotnikov.wordpress.com/2008/10/07/skip-empty-csv-fields/

Works for me.
",,False,,t5_2qo1o,1344454526.0,,,True,t3_xvxgd,http://www.reddit.com/r/PowerShell/comments/xvxgd/adding_ad_info_from_csv_problem_with_blank_fields/,
1340658402.0,3,self.PowerShell,vlbu5,Best way to UNIQUELY identify a unit?,4,1,12,http://www.reddit.com/r/PowerShell/comments/vlbu5/best_way_to_uniquely_identify_a_unit/,"I have a script that connects to a web server and I need to be able to identify each machine uniquely by location.  IP doesn't work, as some facilities have multiple computers.  MAC address kind of works, but it's not always predictable.  Serial number of board works sometimes, but some boards don't report that back.  

Does anyone have recommendations on some sort of completely unique and generally static variable I can provide that is based on a computer's configuration?",,False,,t5_2qo1o,False,,,True,t3_vlbu5,http://www.reddit.com/r/PowerShell/comments/vlbu5/best_way_to_uniquely_identify_a_unit/,
1340358395.0,3,self.PowerShell,vfh3n,A question regarding parsing and using results from a SQL query,3,0,5,http://www.reddit.com/r/PowerShell/comments/vfh3n/a_question_regarding_parsing_and_using_results/,"So I managed to get the data out of Oracle using the following:

    [Reflection.Assembly]::LoadFile(""C:\oracle\product\10.2.0\client_1\odp.net\bin\2.x\Oracle.DataAccess.dll"")
    $constr = ""User Id=&lt;id&gt;;Password=&lt;pw&gt;;Data Source=&lt;DBNAME&gt;""
    $conn = New-Object Oracle.DataAccess.Client.OracleConnection($constr)
    $conn.Open()
    $sSQL = ""select BII_SSERVICENAME,BII_SMACHINENAME from tserviceinstances where BII_SSERVICENAME is not null ORDER BY BII_SMACHINENAME""
    $command = New-Object Oracle.DataAccess.Client.OracleCommand( $ssql,$conn)
    $reader=$command.ExecuteReader()

So, as you can see, pretty simple query bringing back two columns of string results. So. The results are in memory and I can print them if necessary using Write-Host, but I don't want to do this. What I need is to Stop-Service of each of the BII_SSERVICENAMES on the BII_SMACHINENAMEs. Each command would be constructed thus:

    $service = Get-WmiObject -ComputerName ""BII_SMACHINENAME"" -class win32_service -filter ""Name='BII_SSERVICENAME'""
    $service.StopService()

So I'd need to create a loop of all the results in the query run previously. How do??

I have a working VBScript which does this (which I didn't write, and as you might imagine is bloated and unwieldy), so while this is more of an educational exercise than anything it would be great to get working to learn about loops and queries etc. Anyone have any ideas? Many thanks in advance.",,False,,t5_2qo1o,1340362143.0,,,True,t3_vfh3n,http://www.reddit.com/r/PowerShell/comments/vfh3n/a_question_regarding_parsing_and_using_results/,
1340079418.0,2,self.PowerShell,v9eon,"Why did they remove Get-Help (help, man) from PowerShell 3?",4,2,10,http://www.reddit.com/r/PowerShell/comments/v9eon/why_did_they_remove_gethelp_help_man_from/,,,False,,t5_2qo1o,False,,,True,t3_v9eon,http://www.reddit.com/r/PowerShell/comments/v9eon/why_did_they_remove_gethelp_help_man_from/,
1339711076.0,3,self.PowerShell,v2du9,Is there a best practice when it comes to importing all modules? ,3,0,6,http://www.reddit.com/r/PowerShell/comments/v2du9/is_there_a_best_practice_when_it_comes_to/,"I have a very poor profile.ps1 that I'm working on to get just right. 

Is there a cleaner way to do this; or is it better to just have my start-transcript run, and use Powershell Import System Modules ?

Show me what you got fellow Powershell folks! 

I have the following:


	$host.PrivateData.ErrorForeGroundColor = ""Green""
	$host.PrivateData.ErrorBackgroundColor = ""Black""
	$host.UI.RawUI.BackgroundColor =  ""Black""

	function Get-CHM
	 {
 	   (invoke-item $env:windir\help\mui\0409\WindowsPowerShellHelp.chm)
	 }

	$transcript = Get-Date -format D
	$dnt = (Get-Date).ToLongTimeString()
	$dnt2 = $dnt.replace("":"",""-"")
	$tlog = ""C:\Powershell-Transcripts\"" + $transcript + "" "" + $dnt2 + "".txt""
	Start-Transcript -Path $tlog
	Import-Module ActiveDirectory
	Import-Module GroupPolicy
	Import-Module BitsTransfer
	Import-Module TroubleshootingPack
	Add-PSSnapin Microsoft.Exchange.Management.PowerShell.E2010
	Add-PSSnapin Microsoft.Exchange.Management.Powershell.Support
	Set-alias ssh Enter-PSSession
	Set-alias sshkill Exit-PSSession

	Get-CHM

	cls",,False,,t5_2qo1o,False,,,True,t3_v2du9,http://www.reddit.com/r/PowerShell/comments/v2du9/is_there_a_best_practice_when_it_comes_to/,
1339543560.0,3,self.PowerShell,uytpe,"Help with the AD Module -  ""The server was unable to process the request due to an internal error""",3,0,4,http://www.reddit.com/r/PowerShell/comments/uytpe/help_with_the_ad_module_the_server_was_unable_to/,"Note: This worked yesterday, and no longer works today. Does not work eitherin ISE or CLI; does not work when launching ""Launch powershell active directory module."" No windows updates have gone through, nor has any software been installed. All I've done between the two periods of time was saved and closed the .ps1 then re-opened it.  
  
  So when I attempt to import the active directory module I receive the following error:   
  
  
        *PS C:\&gt; import-module activedirectory
        The server was unable to process the request due to an internal error.  For more information about the error, either turn on IncludeExceptionDetailInFaults
         (either from ServiceBehaviorAttribute  or from the  serviceDebug&gt; configuration behavior) on the server in order to send the exception information back to the client, or turn on tracing as per the Microsoft .NET  
        Framework 3.0 SDK umentation and inspect the server trace logs.*
  
  

I've tried uninstalling/reinstalling the RSAT tools, running windows update, and rebooting my laptop. Error still present. Googling the error brings me a lot of .asp coding pages that suggest running traces on my webserver, which obviously doesnt make sense here. The account I'm running this on has domain admin rights and full local rights.
  
  
Any Thoughts? Last night I was able to import the AD module and run commands like Get-ADUser without issue.
",,False,,t5_2qo1o,False,,,True,t3_uytpe,http://www.reddit.com/r/PowerShell/comments/uytpe/help_with_the_ad_module_the_server_was_unable_to/,
1339093110.0,3,self.PowerShell,uq541,Sanity check as to why this isn't working for me? (Active Directory password notification),5,2,12,http://www.reddit.com/r/PowerShell/comments/uq541/sanity_check_as_to_why_this_isnt_working_for_me/,"    import-module ActiveDirectory;

    $maxPasswordAgeTimeSpan =       (Get-ADDefaultDomainPasswordPolicy).MaxPasswordAge
 
    Get-ADUser -filter * -properties PasswordLastSet, PasswordExpired, PasswordNeverExpires, EmailAddress, GivenName | foreach {
 
     $today=get-date
     $UserName=$_.GivenName
 
    if (!$_.PasswordExpired -and !$_.PasswordNeverExpires) {
 
        $ExpiryDate=$_.PasswordLastSet + $maxPasswordAgeTimeSpan
        $DaysLeft=($ExpiryDate-$today).days
 
        if ($DaysLeft -lt 7 -and $DaysLeft -gt 0){
 
        $WarnMsg = ""
Hi $UserName,
 
Your Windows login password will expire in $DaysLeft days, please press CTRL-ALT-DEL and change your password.  

For any assistance, visit the http://helpdesk.
 
-Technology Services
 
""
 
    send-mailmessage -to $_.EmailAddress -from NoReply@DOMAIN.com -Subject ""Password Reminder: Your password will expire in $DaysLeft days"" -body $WarnMsg  -smtpserver SMTPServerIP
 
        }
 
    }
}

To elaborate - the email message won't send when I have the $_.EmailAddress variable in play.  If I have my own e-mail address,  I get spammed with e-mails about users who need to change their password!",,False,,t5_2qo1o,1339098288.0,,,True,t3_uq541,http://www.reddit.com/r/PowerShell/comments/uq541/sanity_check_as_to_why_this_isnt_working_for_me/,
1338871456.0,2,self.PowerShell,ull5m,"This should be much simpler than this; running a exe on remote machine, exe resides on dfs",6,4,8,http://www.reddit.com/r/PowerShell/comments/ull5m/this_should_be_much_simpler_than_this_running_a/,"Took me a while to find that I have to precede my command with an &amp;.

I have:

&amp; ""\\domain.local\path\to\exe\whatever.exe""

This is via a PSSession. There are no spaces in the path, I'm thinking I'd be able to remove the quotes. Am I doing something wrong, or is this not supported/am I making a mistake somewhere?

Edit: even on my local machine when I do that command and point it to the exe I want to execute, I get errors. Am I missing something? I thought in a previous thread you need some sort of GRANT permission; do I need that? :o",,False,,t5_2qo1o,1338910781.0,,,True,t3_ull5m,http://www.reddit.com/r/PowerShell/comments/ull5m/this_should_be_much_simpler_than_this_running_a/,
1338788329.0,3,self.PowerShell,ujsci,What updates do I approve in WSUS to get powershell on all my servers? ,3,0,3,http://www.reddit.com/r/PowerShell/comments/ujsci/what_updates_do_i_approve_in_wsus_to_get/,"Windows Servers 2003 SP2. 
dot net framework 3.5 is already installed on all of them. ",,False,,t5_2qo1o,False,,,True,t3_ujsci,http://www.reddit.com/r/PowerShell/comments/ujsci/what_updates_do_i_approve_in_wsus_to_get/,
1337781579.0,3,self.PowerShell,u0zt7,Export-CSV data is wrong,3,0,3,http://www.reddit.com/r/PowerShell/comments/u0zt7/exportcsv_data_is_wrong/,"Haven't had this before, but I'm running a simple query to verify that there aren't any VM's in SCVMM that don't have snapshots but have differencing disks.

    get-vm | select-OBJECT vmresource,vmcheckpoints,VirtualHardDisks | export-csv file.csv

But what I end up getting for the last 2 fields are

    Microsoft.SystemCenter.VirtualMachineManager.VMCheckpoint[]	Microsoft.SystemCenter.VirtualMachineManager.StandaloneVirtualHardDisk[]

Has anyone seen something like this before?
",,False,,t5_2qo1o,False,,,True,t3_u0zt7,http://www.reddit.com/r/PowerShell/comments/u0zt7/exportcsv_data_is_wrong/,
1337022062.0,3,self.PowerShell,tmuq0,Having some issues appending to a csv,5,2,9,http://www.reddit.com/r/PowerShell/comments/tmuq0/having_some_issues_appending_to_a_csv/,"I have this little statement running in a number of jobs.  I'm creating a new one, but for some reason I'm having some issues.  I'm cycling through a number of servers, executing a query and trying to append the results to a csv

    function process-server
    {
    $last = import-csv -path $file
    $Temp = SubmitSQLStatement $Server 'master' $tempQuery 
    $out = $Temp + $last | export-csv -NoTypeInformation -path $file
    
    }

I'm getting a lot of:
&gt;Method invocation failed because [System.Data.DataRow] doesn't contain a method named 'op_Addition'.

Edit: Adding SubmitSQLStatement:


    function SubmitSQLStatement
    {
        param([string]$serverName=$(throw 'serverName is required.'), [string]$databaseName=$(throw 'databaseName is required.'),
              [string]$query=$(throw 'query is required.'))

        Write-Verbose ""Get-SqlData serverName:$serverName databaseName:$databaseName query:$query""

        $connString = ""Server=tcp:$serverName;Database=$databaseName;Integrated Security=SSPI;""
        $da = New-Object ""System.Data.SqlClient.SqlDataAdapter"" ($query,$connString)
        $dt = New-Object ""System.Data.DataTable""
        $da.fill($dt) &gt; $null
        $dt

    }
Any ideas?

**Edit 2: I think I have it.  The exact sql query being executed was using the exec MSForEachdb proc.  That was causing some issues with the output.  I reworked the query to work for each db without the proc and it appears to be working correctly.**",,False,,t5_2qo1o,1337094030.0,,,True,t3_tmuq0,http://www.reddit.com/r/PowerShell/comments/tmuq0/having_some_issues_appending_to_a_csv/,
1336743208.0,3,self.PowerShell,ti4lu,Exchange Mailbox Move Script,4,1,4,http://www.reddit.com/r/PowerShell/comments/ti4lu/exchange_mailbox_move_script/,"Hey all,

I'm trying to move ~100 users from one mail store to another in stages with the biggest first but have run into an issue scripting it.

So far I've got a list of users like this:


*[PS] C:\&gt;Get-MailboxStatistics -database ""Store02"" | Sort-Object TotalItemSize -descending | Select-Object DisplayName -first 5*


But if I try to pipe this into New-MoveRequest it reports 


*""The input object cannot be bound to any parameters for the command either because the command does not take pipeline input or the input and its properties do not match any of the parameters that take pipeline input.
    + CategoryInfo          : InvalidArgument: (@{DisplayName=User One}:PSObject) [New-MoveRequest], ParameterBindi
   ngException
    + FullyQualifiedErrorId : InputObjectNotBound,New-MoveRequest""*  


I *think* this is because it's outputting the display name that has spaces in it.


My current approach is one command to output the top 5 mailbox guids for that store to a text file, remove the first three lines and then run a new-moverequest against that txt file.


Does anyone have any suggestions on how to make this simpler? :)
",,False,,t5_2qo1o,True,,,True,t3_ti4lu,http://www.reddit.com/r/PowerShell/comments/ti4lu/exchange_mailbox_move_script/,
1336150885.0,3,self.PowerShell,t72s7,Copying files via remote session,4,1,12,http://www.reddit.com/r/PowerShell/comments/t72s7/copying_files_via_remote_session/,"My intent is to run a command on a remote computer that copies files from a software share to the remote computer's local drive.

So I have done this:

    Enter-PSSession $computername -credential $domainadmincrds
Then
    
    copy-item .\test.txt \\remotelocation1\test

The result?

    Copy-Item : Access to the path '\\remotelocation1\test' is denied.
    + CategoryInfo          : PermissionDenied: (C:\test.txt:FileInfo) [Copy-Item], UnauthorizedAccessException
    + FullyQualifiedErrorId : CopyFileInfoItemUnauthorizedAccessError,Microsoft.PowerShell.Commands.CopyItemCommand


I am a domain admin and have rights to everything in question, why aren't the creds passing, or is there an alternative?

Thanks for the help.",,False,,t5_2qo1o,False,,,True,t3_t72s7,http://www.reddit.com/r/PowerShell/comments/t72s7/copying_files_via_remote_session/,
1336124569.0,3,self.PowerShell,t6ms1,"powershell sharing folders, advenced sharing, share name option.",4,1,4,http://www.reddit.com/r/PowerShell/comments/t6ms1/powershell_sharing_folders_advenced_sharing_share/,"Hi, I have adjusted a script I found online for adding the correct permissions to some shared folders.

Here is a part of the code I use.

    # users rights for SYSTEM
    $colRights = [System.Security.AccessControl.FileSystemRights]""FullControl""
    $InheritanceFlag = [System.Security.AccessControl.InheritanceFlags]""ContainerInherit,ObjectInherit""
    $PropagationFlag = [System.Security.AccessControl.PropagationFlags]::None
    $objType =[System.Security.AccessControl.AccessControlType]::Allow
    $objUser = New-Object System.Security.Principal.NTAccount(""SYSTEM"")
    $objACE = New-Object System.Security.AccessControl.FileSystemAccessRule `
    ($objUser, $colRights, $InheritanceFlag, $PropagationFlag, $objType)
    $objACL = Get-ACL ""C:\shared\users""
    $objACL.AddAccessRule($objACE)
    ###$objACL.SetAccessRuleProtection($True,$False)
    Set-ACL ""C:\shared\users"" $objACL

Now this folder ""users"" should not be visible on the client PC's. So in advanced sharing I normaly adjust the share name to ""users$"".

I can't find the solution for how to do this in my script online. Does anyone here maybe have an idea?

Thx in advance!",,False,,t5_2qo1o,False,,,True,t3_t6ms1,http://www.reddit.com/r/PowerShell/comments/t6ms1/powershell_sharing_folders_advenced_sharing_share/,
1335735975.0,3,self.PowerShell,syp3d,Help me make a mastodont of a script more efficient,5,2,8,http://www.reddit.com/r/PowerShell/comments/syp3d/help_me_make_a_mastodont_of_a_script_more/,"http://pastebin.com/XUUHdSfj

This script works on two directories. Both contain emails as text-files (headers included). My script has to delete all the mails from the second directory that exist in the first directory.

My solution is ridiculously complex yet it is the only way I could get it to work. Can someone figure out a faster way to do this?

Right now I am running it on a directory that has 160.000 mails in diretory \gfi and 120.000 mails in directory \archive. The script has been running for over 15 hours and will probably take another 8 hours to complete.",,False,,t5_2qo1o,False,,,True,t3_syp3d,http://www.reddit.com/r/PowerShell/comments/syp3d/help_me_make_a_mastodont_of_a_script_more/,
1335708328.0,3,self.PowerShell,sy5by,output formatting help in powershell using PrimalForms2011,3,0,3,http://www.reddit.com/r/PowerShell/comments/sy5by/output_formatting_help_in_powershell_using/,"I am trying to learn primal forms to make gui for some of the script. I am having trouble with formatting output. Here is the example. 
when i use the following command in windows powershell, i get correct formatting, "" Get-Process | ft processName, handles, PagedMemorySize -auto""
 http://i.imgur.com/ju7MF.jpg
but when i use primal form, i get this output...http://i.imgur.com/XoUt7.jpg

here is the code in primalform




function OnApplicationLoad {
	#Note: This function is not called in Projects
	#Note: This function runs before the form is created
	#Note: To get the script directory in the Packager use: Split-Path $hostinvocation.MyCommand.path
	#Note: To get the console output in the Packager (Windows Mode) use: $ConsoleOutput (Type: System.Collections.ArrayList)
	#Important: Form controls cannot be accessed in this function
	#TODO: Add snapins and custom code to validate the application load
	
	return $true #return true for success or false for failure
}


function OnApplicationExit {
	#Note: This function is not called in Projects
	#Note: This function runs after the form is closed
	#TODO: Add custom code to clean up and unload snapins when the application exits
	
	$script:ExitCode = 0 #Set the exit code for the Packager
}

$form1_Load={
	#TODO: Initialize Form Controls here
	
}

$button1_Click={
	#TODO: Place custom script here
	$tasks = Get-Process | ft  -auto
	$textbox1.Text = $tasks | Out-String
}

$textbox1_TextChanged={
	#TODO: Place custom script here
	
}


please help....",,False,,t5_2qo1o,False,,,True,t3_sy5by,http://www.reddit.com/r/PowerShell/comments/sy5by/output_formatting_help_in_powershell_using/,
1335550859.0,3,adicodes.com,svmsh,Logging in Powershell in SharePoint 2010,8,5,1,http://www.reddit.com/r/PowerShell/comments/svmsh/logging_in_powershell_in_sharepoint_2010/,,,False,,t5_2qo1o,False,,,False,t3_svmsh,http://adicodes.com/logging-in-powershell-in-sharepoint-2010/,
1335444982.0,3,self.PowerShell,sthc8,Is there any way to limit findstr to only return the first exact match?,4,1,4,http://www.reddit.com/r/PowerShell/comments/sthc8/is_there_any_way_to_limit_findstr_to_only_return/,"I am working on a small script that will query the Security log on my domain controller looking for computers that have been added to the domain in the past 24 hours.  Here is what I have so far:

     $yesterday = (get-date) - (new-timespan -day 1)
     $LogonTypes=Get-WinEvent -computername $dc -FilterHashtable @{Logname='security';Id=4741;StartTime=$yesterday}
     foreach ($item in $LogonTypes) {($item | Select Message | fl * | findstr ""Account Name:"")}

The results returned look like this:
    Account Name:        zeunasc
    Account Name:        TESTADD1$
    SAM Account Name:    TESTADD1$

I only need the first Account name that is being returned by this.  Since the lines are identical, I cannot figure out any way to get just the very first Account Name added to a variable, or an array if there are multiple computer adds over the course of the day.

Ultimately, I would like to get this included in the script that theseb created [HERE](http://www.reddit.com/r/PowerShell/comments/so2jz/help_tweaking_script_reporting/c4fwfoe).

THANKS!",,False,,t5_2qo1o,False,,,True,t3_sthc8,http://www.reddit.com/r/PowerShell/comments/sthc8/is_there_any_way_to_limit_findstr_to_only_return/,
1334765547.0,2,self.PowerShell,sg6qs,Testing file deletion,4,2,8,http://www.reddit.com/r/PowerShell/comments/sg6qs/testing_file_deletion/,"Hey PS redditors, got a question for ya'll. I'm still new to PowerShell, and was hoping it can maybe help me with a problem.


Is there a way in PS to ""test"" if a file can be deleted? I was hoping the -whatif parameter for Remove-item would actually tell me if a file can actually be deleted or not, but it doesn't. Anyone know of a way to do this in PS? Any info would be appreciated. Thanks


Edit - I'm looking to test if security permissions on files to see if they can be deleted. I wanted to do this without actually deleting the files at first. This came about from finding files where Administrators group had full control but still couldn't delete a file. ",,False,,t5_2qo1o,True,,,True,t3_sg6qs,http://www.reddit.com/r/PowerShell/comments/sg6qs/testing_file_deletion/,
1334497345.0,3,self.PowerShell,sargj,Using Directory Object Picker in a Powershell UI,4,1,3,http://www.reddit.com/r/PowerShell/comments/sargj/using_directory_object_picker_in_a_powershell_ui/,"I'm trying to create a UI where there's a field for an AD for user account and I'd like to use [this dialog](http://i.imgur.com/8g56f.png) to return a valid user account from AD.

How would I go about implementing this?  There's an MSDN article [here](http://msdn.microsoft.com/en-us/library/ms675899\(v=vs.85\).aspx) which seems a good starting point but I'm completely clueless as to how to use it!

Any advice would be very much appreciated.",,False,,t5_2qo1o,False,,,True,t3_sargj,http://www.reddit.com/r/PowerShell/comments/sargj/using_directory_object_picker_in_a_powershell_ui/,
1334037912.0,3,techo.luefher.com,s26d9,How to Schedule Scrips in PowerShell By Using A Timer Object,5,2,1,http://www.reddit.com/r/PowerShell/comments/s26d9/how_to_schedule_scrips_in_powershell_by_using_a/,,,False,,t5_2qo1o,False,,,False,t3_s26d9,http://techo.luefher.com/windows/powershell/how-to-schedule-scrips-in-powershell-by-using-a-timer-object/,
1333295636.0,3,csharpening.net,ro1jl,Introducing AlmightyShell,6,3,0,http://www.reddit.com/r/PowerShell/comments/ro1jl/introducing_almightyshell/,,,False,,t5_2qo1o,False,,,False,t3_ro1jl,http://csharpening.net/?p=1068,
1332645804.0,3,self.PowerShell,rc9b1,Get-DBStats: script to help with mail store balancing,4,1,4,http://www.reddit.com/r/PowerShell/comments/rc9b1/getdbstats_script_to_help_with_mail_store/,"This script will help with a tedious task of rebalancing mail stores. Script collects statistics from each store, then displays a report showing which stores are under/over utilized. Script should work in any environment, it requires one parameter, which is a server mask in the ""-like"" format: Get-DBStats 'vancrmsg[a-d][1-4]*'. Script makes an assumption that all mail stores in one quota bracket have the same maximum allowed size (size that the store was JetStressed with).   

Here's a [link to Imgur album](http://imgur.com/a/f3eiR) showing example output.  



Param( 
  [Parameter(Mandatory=$false,ValueFromPipeline=$true)] 
  [string] 
  $SiteMask
) 
$ErrorActionPreference = 'Stop'

try {
	If ($SiteMask -eq '')	{
		throw ""Must specify site mask: Get-DBStats 'vancrmsg[a-d][1-4]*'""
	}

	$i=0
	$dbs = Get-ExchangeServer | where {$_.Name -like $siteMask} | `
		Get-MailboxDatabase -IncludePreExchange2007 | where {!$_.Recovery} | `
		Sort ServerName, StorageGroupName, Name
	foreach ($db in $dbs)	{
		++$i
		$db | Add-Member -Name EDBSize -MemberType NoteProperty -Value $null
		$db | Add-Member -Name MBCount -MemberType NoteProperty -Value $null
		$db.MBCount = [double]@($db| Get-Mailbox -ResultSize unlimited -WarningAction SilentlyContinue).count
		$db.EDBSize = [double](gwmi -Query (""Select FileSize From CIM_DataFile Where Name ='""  + ($db.EdbFilePath.PathName.Replace('\','\\')) + ""'"") `
			-ComputerName ( $db.ServerName) -ErrorAction SilentlyContinue).FileSize
		write-progress -activity ""Collecting Data"" -status ""Percent Complete:"" -percentcomplete ($i / (@($dbs).Count/100))
	}
	Write-Progress -Completed -activity ""Collecting Data"" -Status ""Finished""
	foreach ($excVer in ($dbs | group ExchangeVersion))	{
		Write-host -BackgroundColor DarkRed -ForegroundColor White ((""Version "" + $excVer.Name.ToString()).PadLeft(40,'-')).PadRight(60,'-')
		foreach ($quotaGroup in ($excVer.Group | group Prohibitsendquota))	{
			$quotaGroupStats = ($quotaGroup.Group | Measure-Object -Property EDBSize, MBCount -Sum -Average -Maximum -Minimum)
			$sizeStat = ($quotaGroupStats | where {$_.Property -eq 'EDBSize'})	
			$countStat = ($quotaGroupStats | where {$_.Property -eq 'MBCount'})
			Write-host -BackgroundColor DarkBlue -ForegroundColor White `
				(""Quota bracket ""+ $quotaGroup.Name.ToString().ToUpper()).PadRight(60)
			$quotagroup.Group | select Name, @{N='User Count';E={[double]$_.MBCount}}, `
				@{N='Size (GB)';E={[double][System.Math]::Round(($_.EDBSize/1GB), 0)}}, `
				@{N='Size +/-';E={[double][System.Math]::Round((($sizeStat.Average) - $_.EDBSize)/1GB*-1,0)}}, `
				@{N='Count +/-';E={[double][System.Math]::Round((($countstat.Count) - $_.MBCount)*-1,0)}} | `
				Sort 'Size (GB)', 'User Count' -Descending | ft -AutoSize
			Write-host -BackgroundColor DarkBlue -ForegroundColor White `
				(""Quota bracket "" + ($quotaGroup.Name.ToString().ToUpper() + "" summary"").PadRight(46) )
			""Number of mail stores"".PadRight(30,' ') + ' : ' + $sizeStat.Count
			""Target mail store size (GB)"".PadRight(30,' ') + ' : ' + [double][System.Math]::Round(($sizeStat.Average/1GB), 2)
			""Max mail store size (GB)"".PadRight(30,' ') + ' : ' + [double][System.Math]::Round(($sizeStat.Maximum/1GB), 2)			
			""Min mail store size (GB)"".PadRight(30,' ') + ' : ' + [double][System.Math]::Round(($sizeStat.Minimum/1GB), 2)
			""Total space used (TB)"".PadRight(30,' ') + ' : ' + [double][System.Math]::Round(($sizeStat.Sum/1TB), 2)
			""Number of mailboxes"".PadRight(30,' ') + ' : ' + ($countStat.Sum)
			""Target mailbox count"".PadRight(30,' ') + ' : ' + [double][System.Math]::Round(($countStat.Average), 0)
			""Max mailbox count"".PadRight(30,' ') + ' : ' + $countStat.Maximum
			""Min mailbox count"".PadRight(30,' ') + ' : ' + $countStat.Minimum
		}
	}
}

catch	{
	$_
}
finally {
}

",,False,,t5_2qo1o,False,,,True,t3_rc9b1,http://www.reddit.com/r/PowerShell/comments/rc9b1/getdbstats_script_to_help_with_mail_store/,
1331304949.0,3,self.PowerShell,qox8l,Number of members in a group?,3,0,4,http://www.reddit.com/r/PowerShell/comments/qox8l/number_of_members_in_a_group/,"Is there a way to get the number of users in a group through powershell? I do no need names, but just a count. If someone can point me in the proper direction I would really appreciate it.",,False,,t5_2qo1o,False,,,True,t3_qox8l,http://www.reddit.com/r/PowerShell/comments/qox8l/number_of_members_in_a_group/,
1330305551.0,3,self.PowerShell,q7f8q,Exporting of Exchange 2010 Mailboxes Help,5,2,4,http://www.reddit.com/r/PowerShell/comments/q7f8q/exporting_of_exchange_2010_mailboxes_help/,"We have recently upgraded from Exchange 2003 to 2010. In 03 we had a script that would look at a user's account and if it was disabled 90+ days, then it was marked and moved to a share via ExMerge so the .pdf could be archived. Then it was safe to delete the user's account.

I know ExMerge is gone and the export procedure is done through PowerShell. I have exported single mailboxes and multiple mailboxes via a .csv file.

What I need is a script that can run once a week, find all user's that have been disabled more than 90 days, export their mailbox to a share and send an e-mail upon completion with the users that can be deleted from AD.

The requirements:

1 - Enumerate all accounts older than 90 days

2 - Export those mailboxes to a central location

3 - Send notification of what accounts are now ready for deletion.

Can anyone help with this? Thanks guys.",,False,,t5_2qo1o,False,,,True,t3_q7f8q,http://www.reddit.com/r/PowerShell/comments/q7f8q/exporting_of_exchange_2010_mailboxes_help/,
1330279968.0,3,csharpening.net,q6w6x,Windows 8 Server and Hyper-V 3.0 Resource Metering in PowerShell,3,0,9,http://www.reddit.com/r/PowerShell/comments/q6w6x/windows_8_server_and_hyperv_30_resource_metering/,,,False,,t5_2qo1o,False,,,False,t3_q6w6x,http://csharpening.net/?p=967,
1330121033.0,3,self.PowerShell,q4n9h,Exchange Powershell script to watch for subject lines,3,0,13,http://www.reddit.com/r/PowerShell/comments/q4n9h/exchange_powershell_script_to_watch_for_subject/,"I'd like to find a way to have powershell search an Inbox for specific subject line, and if result = true, then delete all messages in the inbox.

I've been putzing around with Search-Mailbox which seems like it would be a good starting point, just not sure how to incorporate If Then logic into powershell.

-Thanks!",,False,,t5_2qo1o,False,,,True,t3_q4n9h,http://www.reddit.com/r/PowerShell/comments/q4n9h/exchange_powershell_script_to_watch_for_subject/,
1330018519.0,3,self.PowerShell,q2qix,"Check for file, copy if needed, log output.",5,2,4,http://www.reddit.com/r/PowerShell/comments/q2qix/check_for_file_copy_if_needed_log_output/,"I was brought an issue we were having with a company wide screensaver. We have a GPO in place to install a screensaver and make it default for all computers at HQ. The only problem was that the GPO would fail if the .scr file was not in the /System32/ folder. I created a script (after much time banging my head against a wall) that would first check to see if the box was online, and if the c$ admin share was accessible. It does this by checking for the existence of the win.ini file. If it can reach it, and the .scr file was not in place, it copies it to the directory. All of these actions have a log output. This is my first attempt at PS. Be gentle. Please feel free to use if you'd like.

http://pastebin.com/DS6YZT6Y",,False,,t5_2qo1o,True,,,True,t3_q2qix,http://www.reddit.com/r/PowerShell/comments/q2qix/check_for_file_copy_if_needed_log_output/,
1329767376.0,3,self.PowerShell,py6kn,Compare group memberships / compare-object very slow,3,0,9,http://www.reddit.com/r/PowerShell/comments/py6kn/compare_group_memberships_compareobject_very_slow/,"I am working on a process to update an adgroup via a custom ad attribute.    

&lt;snip&gt;  
$NewUsers = Get-QADUser -LdapFilter '(SomeCustomADattribute=somevaluehere)'  
$CurrentUsers = Get-QADGroupMember SomeUserGroup  
$UsersToRemove = Compare-Object $CurrentUsers $NewUsers |where {$_.SideIndicator -eq ""&lt;=""}  
$UsersToAdd = Compare-Object $CurrentUsers $NewUsers |where {$_.SideIndicator -eq ""=&gt;""}  
  
#Add some code here to remove/trim old users  
#Add some code here to add new users  

&lt;/snip&gt;
------------------

This bit of code actually works,   but is verrrry slow.    Getting the actual user lists and group members is fairly quick.   This is slowing down 
on each compare object.     I suppose I could just compare these objects via a few loops,  but it seems like this should be more efficient and
the old way just seems clumsy when compared.   This and these objects are really not that large....maybe a few hundred entries for each.

Also...the reason I have a ToBeRemoved and a UserstoAdd group is so I can report back with users that were added and removed each day.

Any thoughts ?",,False,,t5_2qo1o,True,,,True,t3_py6kn,http://www.reddit.com/r/PowerShell/comments/py6kn/compare_group_memberships_compareobject_very_slow/,
1329234005.0,3,self.PowerShell,pp6qy,Downloading complete websites,5,2,7,http://www.reddit.com/r/PowerShell/comments/pp6qy/downloading_complete_websites/,"Hello,

I have a list of website pages that my boss wants me to print for him. Is there a way to do this in powershell? I have zero exposure to powershell but my IT department said it would work, but they didn't give me any code. Any help would be greatly appreciated.

",,False,,t5_2qo1o,False,,,True,t3_pp6qy,http://www.reddit.com/r/PowerShell/comments/pp6qy/downloading_complete_websites/,
1329193977.0,3,self.PowerShell,pomq8,PS version of a mail merge with attachments and inline images,3,0,3,http://www.reddit.com/r/PowerShell/comments/pomq8/ps_version_of_a_mail_merge_with_attachments_and/,"I was recently tasked with doing a 'mail merge' with an attachment and inline images. Previous solutions (not handled by me) were not good enough anymore, so I thought, ""Surely powershell can do this!""

I was right! [This script](http://community.spiceworks.com/scripts/show/1037-send-html-emails-via-powershell) served as the basis (so most of the credit goes to him), and with a few modifications, I was able to achieve a great solution.

The modifications I made to the above linked script:

* Added an extra inline image
* Added a normal attachment
* Edited the XSL file to add the extra inline image and change the body of the email
* Added code to loop through a CSV and run the function on each iteration

[Here](http://plonq.org/up/powershellmailmerge.zip) are my modified versions of the ps1 and xsl files for anyone that wants them.",,False,,t5_2qo1o,False,,,True,t3_pomq8,http://www.reddit.com/r/PowerShell/comments/pomq8/ps_version_of_a_mail_merge_with_attachments_and/,
1328723129.0,3,self.PowerShell,pghr5,server 2008R2 schedule powershell task,5,2,22,http://www.reddit.com/r/PowerShell/comments/pghr5/server_2008r2_schedule_powershell_task/,"Im having a bear of a time getting a scheduled task to run a powershell script.

I can manually run the PS script no problem.

I have it set to run as the local administrator and run whether user is logged on or not.

I have tried all kinds of different actions to trigger it.  This is what I have currently:

program/script
C:\windows\system32\WindowsPowerShell\v1.0\powershell.exe

add arguments
-File D:\LightSpeedBackup.ps1

the task succeeds but seemingly does nothing.  Is there something I am missing?",,False,,t5_2qo1o,False,,,True,t3_pghr5,http://www.reddit.com/r/PowerShell/comments/pghr5/server_2008r2_schedule_powershell_task/,
1328397143.0,3,csharpening.net,pb5up,Upcoming PowerShell events,3,0,0,http://www.reddit.com/r/PowerShell/comments/pb5up/upcoming_powershell_events/,,,False,,t5_2qo1o,False,,,False,t3_pb5up,http://csharpening.net/?p=886,
1328128259.0,3,self.PowerShell,p6ll6,Gathering source code from a web page,5,2,2,http://www.reddit.com/r/PowerShell/comments/p6ll6/gathering_source_code_from_a_web_page/,"Hello all,  I was wondering if anyone had any experience in getting the source code of a web page?  I need to write a script that can do so (and then search through the source code for a specific string), however, I've run into an issue.  I can get the source code of a site easily enough with the following:

     $site = new-object Net.WebClient
     $site.DownloadString(""http://www.google.com"")

However, the issue I have with the particular website I need the source code for, is that it requires a cookie to get to the actual page.  If the cookie is not present, it will direct you to a page that requires you to accept some terms &amp; conditions.  Is it possible for powershell to recognize when the cookie is present, and thus bypass the terms &amp; conditions page?

Thanks for your help",,False,,t5_2qo1o,False,,,True,t3_p6ll6,http://www.reddit.com/r/PowerShell/comments/p6ll6/gathering_source_code_from_a_web_page/,
1327682407.0,3,self.PowerShell,oz9zu,Exchange Powershell - Advanced user list,3,0,7,http://www.reddit.com/r/PowerShell/comments/oz9zu/exchange_powershell_advanced_user_list/,"I normally use this to get mailbox statistics: 

get-mailboxdatabase | Get-MailboxStatistics | Sort @{expression= ""totalitemsize"";descending=$true} | select DisplayName, @{expression={$_.totalitemsize.value.ToMB()};label=”Size(MB)”}, itemcount, lastlogontime, lastlogofftime,lastloggedonuseraccount | Export-csv c:\mbreport.csv

My account management team now wants the primary smtp address and/or the Distinguished name of the user so they can track them down easier.   I know you have to combine this with get-mailbox to get the output I need but I'm running in to a wall.  I've tried a bunch of things and I can't get it going. 

This is for Exchange 2010 in this instance, but if it would work on 2007 also that would be awesome.  Anyone have some tips ?  Thank you !",,False,,t5_2qo1o,False,,,True,t3_oz9zu,http://www.reddit.com/r/PowerShell/comments/oz9zu/exchange_powershell_advanced_user_list/,
1325197012.0,3,self.PowerShell,nverg,Powershell - Hashtable Sorting Help - If someone would be so kind :),3,0,6,http://www.reddit.com/r/PowerShell/comments/nverg/powershell_hashtable_sorting_help_if_someone/,"Okay, so the purpose of this script is to return the top 5 most unsuccessful user logins on a computer in a readable format, with the username and how many times they unsuccessfully logged in.

What I've done so far:

Script:

    #Top 5 most unsuccessful user logins with usernames and how many times they unsuccessfully logged in

    [void][reflection.assembly]::`
    LoadWithPartialName(""Microsoft.VisualBasic"")

    $computername = [microsoft.VisualBasic.Interaction]::InputBox(""Computer Connecting To:"", 
    ""Prompt Window"", ""Enter here"")
    $textpath = ""D:\Logs\Computer-$computername-Date{0:yyyyMMdd-HHmm}.txt"" -f (Get-Date)
    $date = (Get-Date)
    $folderlist = Get-ChildItem -path ""\\$computername\c$\Documents and Settings\"" -name
    $a = 0
    $b = 0
    $hashtable = @{}

    foreach ($test2 in $folderlist)
    {$test = $folderlist[$a]
    if ((Get-EventLog -log security -ComputerName $computername -InstanceId 529 
    -Message ""*$test*"").count -ne $null)
        {$hashtable[$b] = @{$test = (Get-EventLog -log security -ComputerName $computername 
    -InstanceId 529 -Message ""*$test*"").count}
        $a = $a + 1
        $b = $b + 1}
    elseif ((Get-EventLog -log security -ComputerName $computername -InstanceId 529 
    -Message ""*$test*"").count -eq $null)
        {$a = $a + 1}}

    $hashtable[0..$hashtable.Count] |
    Sort -Property value -Descending |
    Out-File $textpath

    Invoke-Item $textpath

Now at the moment, everything works fine *except* the sorting of the $hashtable variable at the end of the script. My current text file output shows:

&gt;Name              -              Value                                                                                         
                                                                                                               
&gt;username1       -                2                                                                                             
&gt;username2       -                4

&gt;Administrator    -                3                                                                                             
&gt;username3        -               3      


I've Googled myself to death and the main suggestion when sorting hashtables is to use the .GetEnumerator() at the end of the $hashtable variable. However, when I add that, the following output comes out:

&gt;Name    -                       Value                                                                                         
                                                                                                              
&gt;1           -                   {username1}

&gt;0            -                  {Administrator}                                                                               
&gt;3            -                  {username2}                                                                              
&gt;2            -                  {username3}    

I'd really appreciate any help that could be given :)

EDIT: I'm using PowerGUI Script Editor, using version 2.0 of Powershell, and I'm not sure what else to say.
",,False,,t5_2qo1o,True,,,True,t3_nverg,http://www.reddit.com/r/PowerShell/comments/nverg/powershell_hashtable_sorting_help_if_someone/,
1325101635.0,3,self.PowerShell,ntxhv,Powershell via the web to create users,4,1,3,http://www.reddit.com/r/PowerShell/comments/ntxhv/powershell_via_the_web_to_create_users/,"Is there a way to run PowerShell in a browser -- i mean the entire thing?  I tried PowerShellASP and remote power shell, all those things seem to be limited in commands.  I have a PowerShell commandlet file for creating users that basically want to make available via browser.... The thing is, my ps commandlet does many things like truncate user names, setup groups, and modify attributes...",,False,,t5_2qo1o,False,,,True,t3_ntxhv,http://www.reddit.com/r/PowerShell/comments/ntxhv/powershell_via_the_web_to_create_users/,
1324658036.0,3,self.PowerShell,no1gt,Disable-ComputerRestore doesn't turn off system protection,3,0,2,http://www.reddit.com/r/PowerShell/comments/no1gt/disablecomputerrestore_doesnt_turn_off_system/,"Hey guys, as I posted [here](http://stackoverflow.com/questions/8612654/disable-computerrestore-doesnt-turn-off-system-protection) on StackOverflow, I'm having issues with the powershell ""Disable-ComputerRestore"" command not turning off system restore completely. I'm on Windows 7 Pro 64-bit, if that makes a difference.

Before I run Disable-ComputerRestore (system restore on): [http://i.imgur.com/UmrpY.png](http://i.imgur.com/UmrpY.png)

After Disable-ComputerRestore is run: [http://i.imgur.com/pV9j4.png](http://i.imgur.com/pV9j4.png)

I am running shell as Administrator and it's being done locally, so I'm not sure why it doesn't set it to ""Turn off system protection"". Anyone know what could be going on? Thanks!",,False,,t5_2qo1o,False,,,True,t3_no1gt,http://www.reddit.com/r/PowerShell/comments/no1gt/disablecomputerrestore_doesnt_turn_off_system/,
1324517073.0,3,self.PowerShell,nm02f,(PowerCLI) Anyone have any idea how to create a New-Template and put it in a specific datastore?,3,0,6,http://www.reddit.com/r/PowerShell/comments/nm02f/powercli_anyone_have_any_idea_how_to_create_a/,"I've been beating my head against a wall trying to figure out why New-Template won't let me save my template to a specific datastore. 

    [The code was here but it didn't look good, so I moved it to the comments]


What on earth does new-template want for the -datastore paramter?!",,False,,t5_2qo1o,True,,,True,t3_nm02f,http://www.reddit.com/r/PowerShell/comments/nm02f/powercli_anyone_have_any_idea_how_to_create_a/,
1324439772.0,3,self.PowerShell,nktdg,Domain Users Rights On Multiple Files,3,0,4,http://www.reddit.com/r/PowerShell/comments/nktdg/domain_users_rights_on_multiple_files/,"Hi, I'm trying to write a powershell script that will let me give the ""Domain Users"" permission to multiple files right after a machine has been joined to a domain. I've tried doing some googling on this and only seem to find information on the Get-Acl and Set-Acl commands, which tends to only be helpful if you already have a file with those permissions. This will be run on Windows 7 machines running Powershell 2.0. Any help or leads would be much appreciated, thanks.",,False,,t5_2qo1o,False,,,True,t3_nktdg,http://www.reddit.com/r/PowerShell/comments/nktdg/domain_users_rights_on_multiple_files/,
1324371895.0,3,self.PowerShell,njo5i,Long-running program I/O,3,0,1,http://www.reddit.com/r/PowerShell/comments/njo5i/longrunning_program_io/,"Hi,

I'm building a Powershell script that manages a long-running program. I have a GUI set up with ShowUI, and I'd like to know of a way to run a command, and (possibly?) have a callback fired whenever it produces output, so I can process said output and/or copy it into a read-only textbox in my UI. Is there any way to do this?

Thanks!",,False,,t5_2qo1o,True,,,True,t3_njo5i,http://www.reddit.com/r/PowerShell/comments/njo5i/longrunning_program_io/,
1322697889.0,3,self.PowerShell,mveet,"Powershell running external commands w/ variables, brackets and inverted commands",3,0,12,http://www.reddit.com/r/PowerShell/comments/mveet/powershell_running_external_commands_w_variables/,"Sorry for the poor title but didnt know how to do it.  OK for setting certain stuff, like IIS, uses inverted commas and brackets that powershell also uses, so to do certain commands powershell is trying to interpret what Im putting through as commands for itself, not to basically pipe to the command.

EG:
&gt;$IIS1 = 'Set-ItemProperty IIS:\AppPools\'

&gt;$IIS2 = $SitePoolName + ' -name processModel -value @{userName=""'

&gt;$IIS3 = $SiteUser + '"";password=""' + $SitePassword + '"";identitytype=3}'

&gt;$IIS4 = $IIS1 + $IIS2 + $IIS3

&gt;invoke-expression $IIS4

Will run the command: (With the variables just set as the same name, however Im actually using this in a for loop)

&gt;Set-ItemProperty IIS:\AppPools\sitepoolname -name processModel -value @{userName=""siteuser"";password=""sitepassword"";ide
ntitytype=3}

That works exactly as expected because I use the symbol ' to stop the inverted commas and brackets from messing it over, while also using variables.  So how would I do that with, say, one line?  It should be possible, its almost guaranteed its just a syntax thing that I dont know...  I know I could use a few |'s in there too to simplfy it a bit, but I presume that isnt the easiest way either?",,False,,t5_2qo1o,False,,,True,t3_mveet,http://www.reddit.com/r/PowerShell/comments/mveet/powershell_running_external_commands_w_variables/,
1321414043.0,3,self.PowerShell,mdxt9,Simple question about $elements (I hope),5,2,5,http://www.reddit.com/r/PowerShell/comments/mdxt9/simple_question_about_elements_i_hope/,"How can I find a list of attributes and what they are for?

For instance if I do a Get-Process and sort the results(elements) by certain attributes. $Element.PagedMemorySize  or $Element.MainWindowTitle

Is there way to find a comprehensive list of those attributes ?

",,False,,t5_2qo1o,False,,,True,t3_mdxt9,http://www.reddit.com/r/PowerShell/comments/mdxt9/simple_question_about_elements_i_hope/,
1320946395.0,3,reddit.com,m7m2g,Cross Post from MadisonWI: Madison PowerShell Users Group,3,0,0,http://www.reddit.com/r/PowerShell/comments/m7m2g/cross_post_from_madisonwi_madison_powershell/,,,False,,t5_2qo1o,False,,,False,t3_m7m2g,http://www.reddit.com/r/madisonwi/comments/m7m1d/madison_powershell_users_group/,
1319909772.0,3,self.PowerShell,ltcce,Programatically setting breakpoints,3,0,2,http://www.reddit.com/r/PowerShell/comments/ltcce/programatically_setting_breakpoints/,"I saw this in the powertip of the day and thought it was pretty cool:

Most sophisticated PowerShell editors have built-in debugging support. PowerShell can handle breakpoints natively, too, though. To make PowerShell stop execution in a script, here is how:

Set-PSBreakpoint -Script c:\scripts\somescript.ps1 -Line 4

Next time you run this script from within your PowerShell session, it will stop at line 4, and you find yourself in a debugging mode where you can access (and change) all variables. To make the script continue, use the command ""continue"". To remove all breakpoints, use this line:

Get-PSBreakpoint | Remove-PSBreakpoint",,False,,t5_2qo1o,False,,,True,t3_ltcce,http://www.reddit.com/r/PowerShell/comments/ltcce/programatically_setting_breakpoints/,
1318967833.0,3,self.PowerShell,lgmv5,enabling psremoting,6,3,1,http://www.reddit.com/r/PowerShell/comments/lgmv5/enabling_psremoting/,"hello

i am very new to powershell.  i am trying to enable psremoting and set the trustedhosts on all the machines in my environment without manually connecting to them and running the script i have written which will do the job.  does anyone have any suggestions on how i might do this? ",,False,,t5_2qo1o,False,,,True,t3_lgmv5,http://www.reddit.com/r/PowerShell/comments/lgmv5/enabling_psremoting/,
1317058671.0,3,cmdlethelpeditor.codeplex.com,ks0et,Create your own Get-Help documentation with the Cmdlet Help Editor,4,1,0,http://www.reddit.com/r/PowerShell/comments/ks0et/create_your_own_gethelp_documentation_with_the/,,,False,,t5_2qo1o,False,,,False,t3_ks0et,http://cmdlethelpeditor.codeplex.com/,
1316495280.0,3,self.PowerShell,klaod,Need to extract text between HTML tags. ,3,0,4,http://www.reddit.com/r/PowerShell/comments/klaod/need_to_extract_text_between_html_tags/,"I'm working on a project where I've got multiple HTML documents with custom tags in it.  There's like 3 of them per document and I need to figure out a way of pulling out the inner text from them.

It will be something like this:

&lt;ecm_content&gt;I need all of this text extracted&lt;/ecm_content&gt;


Since there's 3 sets of these tags I was hoping there'd be some trick where I could pull them out into a collection that I can iterate through later when I need to process the text.

Does anyone have any good tricks on how to pull this off? I was beating my head against a wall for 5 hours today trying to work it out.

",,False,,t5_2qo1o,False,,,True,t3_klaod,http://www.reddit.com/r/PowerShell/comments/klaod/need_to_extract_text_between_html_tags/,
1316036495.0,3,adminnation.com,kfsyi,Quick Config - Send email with PowerShell,3,0,4,http://www.reddit.com/r/PowerShell/comments/kfsyi/quick_config_send_email_with_powershell/,,,False,,t5_2qo1o,False,,,False,t3_kfsyi,http://www.adminnation.com/blog/2011/09/14/quick-config-send-email-with-powershell/,
1314254413.0,3,self.PowerShell,jtsip,Problem with SANS ps hosts update script,3,0,5,http://www.reddit.com/r/PowerShell/comments/jtsip/problem_with_sans_ps_hosts_update_script/,"I have created a task to run the script, found [here](http://www.sans.org/windows-security/2010/09/14/hosts-file-block-domains). Using following parameters the script only downloads and updates hosts file from the first url provided:

.\Update-HostsFile.ps1 -FilePathOrURL ""http://winhelp2002.mvps.org/hosts.txt http://www.malwaredomainlist.com/hostslist/hosts.txt http://www.malware.com.br/cgi/submit?action=list_hosts_win_0000"" -BlackHoleIP ""0.0.0.0"" &gt;&gt; C:\Users\&lt;admin&gt;\Desktop\H.log

Checking the piped log file confirms that.

When passing argument in the task scheduler as following confirms that the actual problem is in the space character used for separating multiple file inputs:

.\Update-HostsFile.ps1 -FilePathOrURL ""http://winhelp2002.mvps.org/hosts.txt http://www.malwaredomainlist.com/hostslist/hosts.txt http://www.malware.com.br/cgi/submit?action=list_hosts_win_0000"" &gt;&gt; C:\Users\&lt;admin&gt;\Desktop\H.log

The host file created has next url (http://www.malwaredomainlist.com/hostslist/hosts.txt) written instead default IP address 0.0.0.0

When script is executed from Powershell, it completes fine.


Is there any way to fix this? Thank you for your time and input.",,False,,t5_2qo1o,False,,,True,t3_jtsip,http://www.reddit.com/r/PowerShell/comments/jtsip/problem_with_sans_ps_hosts_update_script/,
1313074708.0,3,self.PowerShell,jfqfm,Select string to display only a certain part of a returned line?,3,0,7,http://www.reddit.com/r/PowerShell/comments/jfqfm/select_string_to_display_only_a_certain_part_of_a/,"Trying to get piped select-string commands in Powershell to return only what I'm searching for, plus some extra information at the end. Here is what I have so far:

    PS H:\&gt; gwmi win32_LoggedOnUser -computer server | select-string -pattern ""domain"" | select-string -pattern ""Admin"" -NotMatch

    \\server\root\cimv2:Win32_LoggedOnUser.Antecedent=""\\\\.\\root\\cimv2:Win32_Account.Domain=\""domain\"",Name=\""user1\"""",Dependent=""\\\\.\\root\\cimv2:Win32_LogonSession.LogonId=\""44946387\""""
    \\server\root\cimv2:Win32_LoggedOnUser.Antecedent=""\\\\.\\root\\cimv2:Win32_Account.Domain=\""domain\"",Name=\""user2\"""",Dependent=""\\\\.\\root\\cimv2:Win32_LogonSession.LogonId=\""41485153\""""
    \\server\root\cimv2:Win32_LoggedOnUser.Antecedent=""\\\\.\\root\\cimv2:Win32_Account.Domain=\""domain\"",Name=\""user3\"""",Dependent=""\\\\.\\root\\cimv2:Win32_LogonSession.LogonId=\""46401036\""""
    \\server\root\cimv2:Win32_LoggedOnUser.Antecedent=""\\\\.\\root\\cimv2:Win32_Account.Domain=\""domain\"",Name=\""user4\"""",Dependent=""\\\\.\\root\\cimv2:Win32_LogonSession.LogonId=\""40161073\""""
    \\server\root\cimv2:Win32_LoggedOnUser.Antecedent=""\\\\.\\root\\cimv2:Win32_Account.Domain=\""domain\"",Name=\""user5\"""",Dependent=""\\\\.\\root\\cimv2:Win32_LogonSession.LogonId=\""46557830\""""

So I've got what I'm looking for but I want to shorten up what the command actually shows me. Preferably  I would like to see only:

    Domain\user1
    Domain\user2

But I do not know how to do this. The closest I have come is by piping another command 'Select Matches' onto the end. I have read that regex may be the answer to my troubles.

Thanks in advance for any help.",,False,,t5_2qo1o,False,,,True,t3_jfqfm,http://www.reddit.com/r/PowerShell/comments/jfqfm/select_string_to_display_only_a_certain_part_of_a/,
1312381392.0,3,self.PowerShell,j7qv4,Question about extracting server name from get-eventlog data.,3,0,6,http://www.reddit.com/r/PowerShell/comments/j7qv4/question_about_extracting_server_name_from/,"I have get-eventlog objects who message property contains text such as:

     The replica of System Protection on Server1.contoso.com is inconsistent... 

     The replica of Backup Using Saved State\2008StdTemplate on server2.contoso.com is inconsistent...

and need to extract the name of the server contained in each message.  Is this when I finally have to tackle regex?",,False,,t5_2qo1o,True,,,True,t3_j7qv4,http://www.reddit.com/r/PowerShell/comments/j7qv4/question_about_extracting_server_name_from/,
1312325194.0,3,self.PowerShell,j75ec,"Poshboard?  Who's using it, and what do you think?",3,0,5,http://www.reddit.com/r/PowerShell/comments/j75ec/poshboard_whos_using_it_and_what_do_you_think/,Just what the title says.  Anybody got any good experiences or input they'd like to share?,,False,,t5_2qo1o,False,,,True,t3_j75ec,http://www.reddit.com/r/PowerShell/comments/j75ec/poshboard_whos_using_it_and_what_do_you_think/,
1310585488.0,3,self.PowerShell,iopsa,PowerShell + Login Script,3,0,5,http://www.reddit.com/r/PowerShell/comments/iopsa/powershell_login_script/,I'm trying to convert our aging WinNT era bat files to powershell. I've been looking around and I found [this.](http://poweradmin.se/blog/2010/01/28/powershell-login-script/) Would anyone know how to create something like that? I see it was done using Primalforums/script. I can't afford to buy software like that so I'm hoping someone has some kind of template source that I can follow. It would be nice to make something like that.,,False,,t5_2qo1o,False,,,True,t3_iopsa,http://www.reddit.com/r/PowerShell/comments/iopsa/powershell_login_script/,
1308009368.0,3,self.PowerShell,hyy7w,Need help Dumping MySQL DBs,3,0,4,http://www.reddit.com/r/PowerShell/comments/hyy7w/need_help_dumping_mysql_dbs/,"I've just started with Powershell and would like to dump all databases from a remote host to the localhost.

I've figured most of the stuff out and can run the script without errors...
BUT when it starts to dump it just stands still (like it's still executing) and nothing happens.

Here's my script so far:
    # Connect to MySQL database 'information_schema'  
    [system.reflection.assembly]::LoadWithPartialName(""MySql.Data"")  
    $cn = New-Object -TypeName MySql.Data.MySqlClient.MySqlConnection  
    $cn.ConnectionString = ""SERVER=$mysql_server;DATABASE=information_schema;UID=$mysql_user;PWD=$mysql_password""  
    $cn.Open()


    # Query MySQL  
    $cm = New-Object -TypeName MySql.Data.MySqlClient.MySqlCommand  
    $sql = ""SELECT DISTINCT CONVERT(SCHEMA_NAME USING UTF8) AS dbName, CONVERT(NOW() USING UTF8) AS dtStamp FROM SCHEMATA ORDER BY dbName ASC""  
    $cm.Connection = $cn  
    $cm.CommandText = $sql  
    $dr = $cm.ExecuteReader()  
    # Loop through MySQL Records  
    while ($dr.Read())  
    {  
    $dbname = [string]$dr.GetString(0)  
    if(  
	#We don't want to backup those databases  
	($dbname -ne ""reportservertempdb""))  
	{  
		# Set backup filename  
		$backupfilename = $datetimeNow + ""_"" + $dbname + "".sql""  
		$backuppathandfile = $BackupDir + ""\"" + $backupfilename  
		$dbname = ""dbmaster""  
		[Array]$arguments = ""-h"",$mysql_server, ""-u"",$mysql_user, ""-p"",$mysql_password, $dbname, "" &gt; $backuppathandfile""  
		# Invoke backup Command. /c forces the system to wait to do the backup  
		write-host ""Start Backup of "" $dbname  
		&amp; $pathToExe $arguments  
		write-host ""End Backup of "" $dbname  
	}		
    }  
    $cn.Close()

Does anyone have an idea what could be wrong? Is it even possible?

Thanks in advance!

Edit: formatting
",,False,,t5_2qo1o,True,,,True,t3_hyy7w,http://www.reddit.com/r/PowerShell/comments/hyy7w/need_help_dumping_mysql_dbs/,
1307207988.0,3,self.PowerShell,hrlb1,Find the sum of all the multiples of 3 or 5 below 1000.,3,0,6,http://www.reddit.com/r/PowerShell/comments/hrlb1/find_the_sum_of_all_the_multiples_of_3_or_5_below/,"I read the Atlantic article posted in the Programming subreddit and found Project Euler Problem #1 inside:

    If we list all the natural numbers below 10 that are multiples of 3 or 5, we get 3, 5, 6 and 9. The sum of these multiples is 23.

    Find the sum of all the multiples of 3 or 5 below 1000.

XPost on /r/programming: http://www.reddit.com/r/programming/comments/hrimi/how_i_failed_failed_and_finally_succeeded_at/
",,False,,t5_2qo1o,False,,,True,t3_hrlb1,http://www.reddit.com/r/PowerShell/comments/hrlb1/find_the_sum_of_all_the_multiples_of_3_or_5_below/,
1284574896.0,3,blog.powerwf.com,deas0,PowerWF Studio v2.3 Released; the aforementioned ridiculously good PowerShell IDE,6,3,2,http://www.reddit.com/r/PowerShell/comments/deas0/powerwf_studio_v23_released_the_aforementioned/,,,False,,t5_2qo1o,False,,,False,t3_deas0,http://blog.powerwf.com/post/1126930189/powerwf-studio-v2-3-released,
1269110215.0,3,powershell.labs.oreilly.com,bfym5,Windows PowerShell Cookbook v2 online WIP,3,0,0,http://www.reddit.com/r/PowerShell/comments/bfym5/windows_powershell_cookbook_v2_online_wip/,,,False,,t5_2qo1o,False,,,False,t3_bfym5,http://powershell.labs.oreilly.com/,
1252975190.0,3,thepowershellguy.com,9kkpp,Small PowerShell exercise taken from the Programming Praxis: Russian Peasant Multiplication Solution,5,2,0,http://www.reddit.com/r/PowerShell/comments/9kkpp/small_powershell_exercise_taken_from_the/,,,False,,t5_2qo1o,False,,,False,t3_9kkpp,http://thepowershellguy.com/blogs/posh/archive/2009/07/23/russian-peasant-multiplication.aspx,
1252973372.0,3,thepowershellguy.com,9kkec,PowerShell V2: Get-Weather function using a Web service,6,3,0,http://www.reddit.com/r/PowerShell/comments/9kkec/powershell_v2_getweather_function_using_a_web/,,,False,,t5_2qo1o,False,,,False,t3_9kkec,http://thepowershellguy.com/blogs/posh/archive/2009/05/15/powershell-v2-get-weather-function-using-a-web-service.aspx,
1376500637.0,2,self.PowerShell,1kcy5f,Mailbox Size Script - can't add SMTP address to report,3,1,6,http://www.reddit.com/r/PowerShell/comments/1kcy5f/mailbox_size_script_cant_add_smtp_address_to/,"[SOLVED] Thanks go to SchwartzBR for being awesome!

Hi!

I have been using the following script to generate a report and mail it every Monday:

    Get-MailboxStatistics -Server SERVERNAME | Sort-Object TotalItemSize -Descending | Select-Object DisplayName,@{label=""TotalItemSize(mb)"";expression={$_.TotalItemSize.Value.Tomb()}},ItemCount | Export-csv c:\mailboxes.csv -noTypeInformation
    
I need to include the Primary SMTP Address now. I have tried shoehorning in the PrimarySMTPAddress attribute right after the DisplayName attribute to have it display along side the mailbox name in the report, but for some reason it just leaves the field blank in the csv. 

I can run a script that just says:

    get-mailbox -ResultSize Unlimited | Select-Object DisplayName, PrimarySMTPAddress

and it outputs like you would expect.

Can anybody help point out what I am leaving out here?

Thanks!

edit: Sorry, btw, if my terminology is way off, I am still a noob to powershell. However, I think I am understanding why it doesn't work that way now. I'm guessing PrimarySMTPAddress is not a attribute of the objects that Get-MailboxStatistics creates? Is this a correct assumption?",,False,,t5_2qo1o,1376510451.0,,,True,t3_1kcy5f,http://www.reddit.com/r/PowerShell/comments/1kcy5f/mailbox_size_script_cant_add_smtp_address_to/,
1376451545.0,2,self.PowerShell,1kbrh6,Monitor Sleep Script - monitors wake back up immediatly,3,1,1,http://www.reddit.com/r/PowerShell/comments/1kbrh6/monitor_sleep_script_monitors_wake_back_up/,"Trying to write a script to sleep my monitors which I will call from a keyboard shortcut instead of sleeping the whole computer.  The script works, but the monitors dim out and then immediately wake back up.  I am calling the script below from a .bat file which I am activating via keyboard shortcut.

    $HWND = -1
    $WM_SYSCOMMAND = 0x0112
    $SC_MONITORPOWER = 0xF170
    $MONITOR_ON = -1
    $MONITOR_OFF = 2
    $signature = @""
    [DllImport(""user32.dll"")]
    public static extern int SendMessage(int hWnd, int hMsg, int wParam, int lParam);
    ""@
    $SendMessage = Add-Type -MemberDefinition $signature -Name ""Win32SendMessage"" -Namespace Win32Functions -PassThru
    $SendMessage::SendMessage($HWND, $WM_SYSCOMMAND, $SC_MONITORPOWER, $MONITOR_OFF)",[Core],False,,t5_2qo1o,False,,,True,t3_1kbrh6,http://www.reddit.com/r/PowerShell/comments/1kbrh6/monitor_sleep_script_monitors_wake_back_up/,
1376375876.0,2,vimeo.com,1k9i8r,Powershell for developers [vimeo],2,0,1,http://www.reddit.com/r/PowerShell/comments/1k9i8r/powershell_for_developers_vimeo/,,,False,,t5_2qo1o,False,,,False,t3_1k9i8r,http://vimeo.com/68215601,
1376066963.0,2,self.PowerShell,1k19nt,Script to automatically print all pdf's in a folder and move them - Scheduled task issues,3,1,9,http://www.reddit.com/r/PowerShell/comments/1k19nt/script_to_automatically_print_all_pdfs_in_a/,"I have the following script

    $processed = ""\\prhs5\groups\birthplace\redsageorders\Processed""
    $orders = ""\\prhs5\groups\birthplace\redsageorders""


    $items = Get-ChildItem -Path ""\\prhs5\groups\birthplace\redsageorders\"" -Filter ""*.pdf""


    foreach ($item in $items) { Start-Process –FilePath $orders\$item –Verb Print -PassThru | %{sleep 5;$_} | kill     }


    foreach ($item in $items) { Move-Item -Path $orders\$item $processed }

This script works great when I right click and run in powershell. However, this is going to be a scheduled task. I have a service account set up (domain admin) to run this scheduled task. When I set this up everything runs...except the Start-Process to print the document. The item gets moved just fine but never prints. Has anyone experienced this or have any suggestions?

Edit - Formatting

Update- I ended up setting this up on a server that is always logged in and just ran it as that user(who is not a domain admin)--Since this user is only a local user for the machine and has no domain access other than read access to the network folder needed this should work for now. Not a perfect solution but it works for now.",,False,,t5_2qo1o,1376501882.0,,,True,t3_1k19nt,http://www.reddit.com/r/PowerShell/comments/1k19nt/script_to_automatically_print_all_pdfs_in_a/,
1375992746.0,2,self.PowerShell,1jz8qx,Pull words out of a line in a text file by word count?,4,2,8,http://www.reddit.com/r/PowerShell/comments/1jz8qx/pull_words_out_of_a_line_in_a_text_file_by_word/,"I have a file I am using to set up a lab of computers. I call this file the machine_list.

What I'm trying to do is, base on this machine_list, have powershell run a cmdkey command to add all of the hostnames to the windows vault.

The way I currently do it, is hardcoded within my script:

	Function vault {
    cmdkey /add:$item /user:name /pass:pass
    }
    $items = ""$host"",""local"",""ground"",""flightdata"",""monitor1"",""monitor2"",""monitor3"",""ig1"",""ig2"",""ig3"",""ig4"",""ig5"",""ig6"",""ig7"",""ig8"",""ig9""
    foreach ($item in $items){
    vault}



What I would like to do, is use my machine_list, which I already use to augment other functions in my main script to formulate the host-list which will then be used to create my credentials manager entries.

here is a short example of my list format: 

HOST cpu0 192.168.20.60 server

HOST cpu1 192.168.20.61 cwp

HOST cpu2 192.168.20.62 cwp

HOST cpu3 192.168.20.63 cwp

There is other content in the file, but I pick this stuff out with:

$items = (get-content machine_list.txt | select-string ""host"")

And I would like to simply run something like

foreach ($item in $items) {cmdkey /add:$item[2] /user:name /pass:pass}

But this [2] pulls the second letter, not the second word from each line.


I am not a network admin, nor do I have any real experience in comp sci or engineering, I'm simply trying to stream line a process.

Can anyone tell me how to pick the second whole word out of each line to use in a command?

Much appreciated!

",[Core],False,,t5_2qo1o,False,,,True,t3_1jz8qx,http://www.reddit.com/r/PowerShell/comments/1jz8qx/pull_words_out_of_a_line_in_a_text_file_by_word/,
1374804280.0,2,tomorrow.uspeoples.org,1j2jru,Downloading CSV's from SCCM-SMS 2007 Reporting Websites,2,0,0,http://www.reddit.com/r/PowerShell/comments/1j2jru/downloading_csvs_from_sccmsms_2007_reporting/,,,False,,t5_2qo1o,False,,,False,t3_1j2jru,http://tomorrow.uspeoples.org/2013/07/downloading-csvs-from-sccm-sms-2007.html,
1374277727.0,2,self.PowerShell,1inz8x,Commands to find and remove software. Need help with Parameters,2,0,2,http://www.reddit.com/r/PowerShell/comments/1inz8x/commands_to_find_and_remove_software_need_help/,"i'm starting to learn powershell.  i made two commands.  one to search for software and another to remove software.  i'm trying to make a script that passes arguments.  however, i see unexpected attribute on cmdletbinding in ise.  I'm not sure how to fix this.  Also, you could help me out by letting me know how to restrict the action parameter to only two strings; ""find"" and ""remove"".


script:

#function Find-Remove-Software{

[CmdletBinding()]


param{

   [Parameter(Mandatory=$True,Position=1)]
    [string]$software,

   [Parameter(Mandatory=$True)]
    [string]$action
}



Get-WmiObject -Class win32_Product | where {$PSItem.Name -like $software}

Invoke-WmiMethod -name Uninstall -inputobject (Get-WmiObject -Class win32_Product | where {$PSItem.Name -match $software})

Get-WmiObject -Class win32_Product | where {$PSItem.Name -match $software}

#}",,False,,t5_2qo1o,False,,,True,t3_1inz8x,http://www.reddit.com/r/PowerShell/comments/1inz8x/commands_to_find_and_remove_software_need_help/,
1374180624.0,2,self.PowerShell,1il2ym,Noob question: Requesting a cert from w2k3 CA.,2,0,3,http://www.reddit.com/r/PowerShell/comments/1il2ym/noob_question_requesting_a_cert_from_w2k3_ca/,"I am trying to request a computer cert from a W2k3 CA which also is the Domain Controller. I am doing the following and executing it from a w2k8 machine:

    certreq -new request.inf certreq.txt
    certreq -submit -config “http://ftltestdc4.ftltest.eng.citrite.net/certsrv/” request.req certnew.cer

I get the following error:
    Certificate Request Processor: The RPC server is unavailable. 0x800706ba (WIN32:
 1722)

My guess is that the issue is with the powershell on the W2k3 machine. As it does not allow RPC. I can't make any changes to the CA machine as it is belongs to a company wide domain. I am not sure if I can get this done using powershell. Is there anyway other than using powershell to do this?
",,False,,t5_2qo1o,False,,,True,t3_1il2ym,http://www.reddit.com/r/PowerShell/comments/1il2ym/noob_question_requesting_a_cert_from_w2k3_ca/,
1374093441.0,2,self.PowerShell,1iiek7,Selecting an OU for User Creation Script,2,0,9,http://www.reddit.com/r/PowerShell/comments/1iiek7/selecting_an_ou_for_user_creation_script/,"Here is the deal. As a sysadmin I have helpdesk guys whom I am trying to make a user creation script for. I hit a brick wall because we have so many OUs here I dont know a good way to get the script to put the new user in the proper place. My only work around right now ( and im open to other ideas) is to have the Helpdesk guys punch in a user profile to copy. The Script copies the Parent OU for the other user and then uses it in the new-ADUser -path command.  Here is a sum up of how I did it.

####

$sourceOU = Get-ADUser $sourceuser | select @{l='Parent';e={([adsi]""LDAP://$($_.DistinguishedName)"").Parent}}
$sourceOU -replace ""@{Parent=LDAP://"",""""
$sourceOU -replace ""}"","""" 

new-aduser $newuser -path $sourceou

####

My questions are
 
1. It there a cleaner way to write this? I have to add 2 lines just to change the formatting of the output

2. I am limited in my powershell knowledge but is there ANY way to get an AD window to pop up and just have the HD guys click where they want the user, then have that OU piped into the script? 


Thanks guys. This subreddit rocks and has help me tremendously.",,False,,t5_2qo1o,False,,,True,t3_1iiek7,http://www.reddit.com/r/PowerShell/comments/1iiek7/selecting_an_ou_for_user_creation_script/,
1373613245.0,2,self.PowerShell,1i51nx,Copying question,3,1,8,http://www.reddit.com/r/PowerShell/comments/1i51nx/copying_question/,"I need to copy a folder (we'll say it's d:\test\windows) to multiple user profiles (we'll call them d:\test\users\$username) so that the final result is that every user profile has the \windows folder in it.

Is there a way to do this? I'm searching around and coming up with nothing.",,False,,t5_2qo1o,False,,,True,t3_1i51nx,http://www.reddit.com/r/PowerShell/comments/1i51nx/copying_question/,
1373323680.0,2,self.PowerShell,1hw99p,Running into a problem with $_,3,1,12,http://www.reddit.com/r/PowerShell/comments/1hw99p/running_into_a_problem_with/,"So I'm trying to be able to enter a a string and come up with a list of software installed on the machine or machines that match the string (either in computer name or OU). 

    $b = get-adcomputer -Filter 'ObjectClass -eq ""Computer""'
    $c = ($b | ? {$_.DistinguishedName -like ""*$room*""} | select name)
    $c | %{
    $parallel = {Get-WMIObject -computer $_.name.tostring -credential     $cred win32_product}
    start-job $parallel
    }

So this grabs a list of machines just fine, but when I try to pass $_ to the Get-WMIobject it returns as ""null or empty""",,False,,t5_2qo1o,False,,,True,t3_1hw99p,http://www.reddit.com/r/PowerShell/comments/1hw99p/running_into_a_problem_with/,
1372863607.0,2,self.PowerShell,1hkixd,Cant figure out how to use Powershell to change a system's language/regional settings...,2,0,2,http://www.reddit.com/r/PowerShell/comments/1hkixd/cant_figure_out_how_to_use_powershell_to_change_a/,"Anyone have any experience with this? Apparently my google fu is pretty weak. 
The root of the the problem is that in Canada, with Canadian language settings, all a user has to do is miskey Lshift and Lctrl at the same time and suddenly half the keyboard is spitting out french language keystrokes. I originally looked for a way to prevent this through GPO, but right now I'd settle for an easy command I could run. 
Just to be clear, I dont want to change the language that the Powershell window is running in, nor do I want to change the language of my personal system. I want to be able to change the regional/language settings of the remote system.

Thanks in advance for any help you can provide. ",,False,,t5_2qo1o,False,,,True,t3_1hkixd,http://www.reddit.com/r/PowerShell/comments/1hkixd/cant_figure_out_how_to_use_powershell_to_change_a/,
1372335977.0,2,self.PowerShell,1h6a7k,"WOL script initiated remotely, but run on local computer?",3,1,2,http://www.reddit.com/r/PowerShell/comments/1h6a7k/wol_script_initiated_remotely_but_run_on_local/,"I'm looking to do wake on lan in my environment, but the way our network is configured, I would need a server on the same subnet to send the WOL packet. I'm just curious at the moment if this idea below is even possible.

End user has a script to execute on their home computer (connected to VPN) that starts a script that points to the WOL server and starts a script that runs on that server. The script that runs on the server fires out the WOL packet.",,False,,t5_2qo1o,False,,,True,t3_1h6a7k,http://www.reddit.com/r/PowerShell/comments/1h6a7k/wol_script_initiated_remotely_but_run_on_local/,
1372261057.0,2,self.PowerShell,1h4339,help with a hashtable,4,2,6,http://www.reddit.com/r/PowerShell/comments/1h4339/help_with_a_hashtable/,"Hi guys,

I'm having a bit of a mare today and could use a bit of a point in the right direction.  (Google has not been my friend!)

I have the following hash table.

    $services = @{
    	""vapp01"" = ""FileMaker Server"",""SQL""
    	""vapp02"" = ""SQL""
    	""vapp03"" = ""ISS""
    	""vfs01"" = ""FTP Server""
    	""vps01"" = ""Papercut""
    	""vdc01"" = ""DNS"",""DHCP""
    }


I'm trying to do the following (in psudo code)

    foreach line in the hash table
    foreach hash value (get-service -name &lt;hash value&gt; -computer &lt;hash key&gt; | where name -eq hash value)
    check that service is running, if running return ""hash value OK""

I've tried the following

    foreach ($service in $services) {
    	$service.Name #should return vapp01,vapp02,vapp03 etc...
    	foreach ($value in $service.Value) { #obviously wrong
    		$value
    	}
    }



I'm having a hard time returning the hash key and can't seem to find an answer and its starting to do me in.. (its going to be simple....)

Any help would be really appreciated :)",,False,,t5_2qo1o,False,,,True,t3_1h4339,http://www.reddit.com/r/PowerShell/comments/1h4339/help_with_a_hashtable/,
1371676051.0,2,self.PowerShell,1gojwz,Issue in logging Hashtable contents,2,0,11,http://www.reddit.com/r/PowerShell/comments/1gojwz/issue_in_logging_hashtable_contents/,"I have a hashtable that prints out the default nice table format at the PS prompt:

    PS&gt;$myHashTable
    Name    Value
    1            One
    2            Two


But when I run the same on the hashtable variable like below:

    PS&gt;""$(get-date) `n$myHashTable""

I get the output as

    06/19/2013 17:03:10
    System.Collections.Hashtable

How do I get back the table format output? Obviously this line is within a function and the $myHashTable is provided as a parameter for logging.

**SOLUTION**
    ==================================================

Sorry, nobody could really help out completely, but I think I may have figured this one out.
The command needs to be like this:

    PS C:\temp&gt; $x
    
    Name                           Value
    ----                           -----
    1                              One
    2                              two
    
    
    PS C:\temp&gt; $(get-date).ToString(); ($x | ft)
    6/20/2013 1:02:30 PM
    
    Name                           Value
    ----                           -----
    1                              One
    2                              two
    
",,False,,t5_2qo1o,1371747890.0,,,True,t3_1gojwz,http://www.reddit.com/r/PowerShell/comments/1gojwz/issue_in_logging_hashtable_contents/,
1370645133.0,2,self.PowerShell,1fw6jy,Difference between declaring a variable and importing it from XML,2,0,3,http://www.reddit.com/r/PowerShell/comments/1fw6jy/difference_between_declaring_a_variable_and/,"I'm running into an issue where if I declare a variable as a specific command I'd like to run (using invoke-expression) I can do this with ease, and the variables which are in the string are replaced with the correct values.

However, when I put this command in a xml file, import it and try to execute it, I get the following error. It's choking on a plus which is meant for the program getting this command.

    Invoke-Expression : You must provide a value expression on the right-hand side of the '+' operator.

It seems that it's treated differently depending on how the variable is declared. Any ideas?   ",,False,,t5_2qo1o,False,,,True,t3_1fw6jy,http://www.reddit.com/r/PowerShell/comments/1fw6jy/difference_between_declaring_a_variable_and/,
1370634744.0,2,self.PowerShell,1fvt1d,Simple question on Get-WMIObject,2,0,4,http://www.reddit.com/r/PowerShell/comments/1fvt1d/simple_question_on_getwmiobject/,"I often find myself using Get-WMIObject to pull data from local or remote systems.  While I can get what I want, I am trying to find a more elegant way to do it.  For example, if I use:

    Get-WMIObject `
            -Class 'Win32_LogicalDisk' `
            -ComputerName 'MyComputer' `
            -Filter ""DriveType=3"" `
            -Property 'DeviceID' 

I get back a collection of ManagementObjects when what I usually need is a list of drive letters.  I can use:

    Get-WMIObject `
            -Class 'Win32_LogicalDisk' `
            -ComputerName 'MyComputer' `
            -Filter ""DriveType=3"" `
            -Property 'DeviceID' | %{$_.DeviceID}

Which gets me what I want; but, I was wondering if anyone knew a switch I could include in the Get-WMIObject command which will eliminate the need to pipe it into the ForEach-Object.",,False,,t5_2qo1o,False,,,True,t3_1fvt1d,http://www.reddit.com/r/PowerShell/comments/1fvt1d/simple_question_on_getwmiobject/,
1370473585.0,2,self.PowerShell,1fr5hq,Searching DNS for old resource records,2,0,1,http://www.reddit.com/r/PowerShell/comments/1fr5hq/searching_dns_for_old_resource_records/,"Just wanted to share another recent PowerShell victory...

It turns out my domain is not properly scavenging our DNS records, and there are some old entries that occasionally pop up and cause problems.  I'm getting ready to turn on scavenging following the tips in [this article](http://blogs.technet.com/b/networking/archive/2008/03/19/don-t-be-afraid-of-dns-scavenging-just-be-patient.aspx), and one step says ""Sift through your DNS records looking for any records older than the Refresh + No-Refresh interval.""  Sounds easy, except for the fact that there are hundreds of them spread across hundreds of DNS zones.

You can [query your DNS servers using WMI](http://msdn.microsoft.com/en-us/library/windows/desktop/ms682125%28v=vs.85%29.aspx), but I couldn't find an obvious way to query for resource records with old timestamps.  This is complicated by the fact that each DNS zone can have its own scavenging intervals.

Here's what I've come up with.  (WARNING: this may blow up your server, your network, and/or your domain.  I'm not responsible for that.)

    # change this to your DNS server
    $dnsserver = 'dc01'

    # don't change these
    $now = get-date
    $epoch = get-date '01/01/1601'

    # figuring out the default scavenge interval in hours, default is 7 days
    # ...not really sure if this is needed because zones have their own
    # ...but it's there anyway
    $defaultNoRefreshInterval = $defaultRefreshInterval = 7 * 24
    gwmi -computername $dnsserver -namespace 'root\MicrosoftDNS' -class 'MicrosoftDNS_Server' -filter ""Name like '%$dnsserver%'"" |
        % {
            $defaultNoRefreshInterval = $_.DefaultNoRefreshInterval
            $defaultRefreshInterval = $_.DefaultRefreshInterval
        }
    $defaultScavengeInterval = $defaultNoRefreshInterval + $defaultRefreshInterval

    # collecting zone info
    $zones = @{}
    gwmi -computername $dnsserver -namespace 'root\MicrosoftDNS' -class 'MicrosoftDNS_Zone' |
        # each zone has its own scavenge intervals in hours
        % { add-member -inputobject $_ NoteProperty 'ScavengeInterval' ($_.norefreshinterval + $_.refreshinterval) -passthru } |
        % { $zones[$_.name] = $_ }

    # collecting resource records...
    # ...include only ""IN"" (Internet) class records
    # ...filter out static records (i.e. no timestamp)
    $records = gwmi -computername $dnsserver -namespace 'root\MicrosoftDNS' -class 'MicrosoftDNS_ResourceRecord' -filter 'RecordClass=1 and Timestamp&lt;&gt;0' | 
        # adding attributes useful to human beings
        % { add-member -inputobject $_ NoteProperty 'WhenChanged' $epoch.addhours($_.timestamp).tolocaltime() -passthru } |
        % { add-member -inputobject $_ NoteProperty 'Class' ($_.__CLASS -replace '^.+_([^_]+)Type$', '$1') -passthru } | 
        # filter out records not yet old enough to scavenge
        ? { 
            if ($zones.containskey($_.containername)) {
                $zone = $zones[$_.containername]
                ($zone.aging) -and (($now - $_.whenchanged).totalhours -gt $zone.ScavengeInterval)
            } else {
                ($now - $_.whenchanged).totalhours -gt $defaultScavengeInterval
            }
        }

You can dump these records into the console using Format-Table:

    $records | sort Class, OwnerName | ft -auto OwnerName, RecordData, WhenChanged -group Class

Export to a CSV (e.g. for Excel):

    $records | select Class, OwnerName, RecordData, WhenChanged | sort Class, OwnerName | Export-Csv -NoTypeInformation u:\ExpiringDNSRecords.csv

I don't know if this will actually help or cause other problems, but you can tell all the computers listed in the A Records to re-register their DNS:

    $records | ? {$_.class -eq 'A'} | select -exp recorddata | % { psexec.exe ""\\$_"" ipconfig /registerdns }

",,False,,t5_2qo1o,1370474144.0,,,True,t3_1fr5hq,http://www.reddit.com/r/PowerShell/comments/1fr5hq/searching_dns_for_old_resource_records/,
1367941820.0,1,self.PowerShell,1dv8fr,"latest SharePoint update broke my script, need to fix it",2,1,3,http://www.reddit.com/r/PowerShell/comments/1dv8fr/latest_sharepoint_update_broke_my_script_need_to/,"So I have a script that takes the photo our employees upload to mysites and imports the photo to the GAL.  Users without a picture get the default blank user jpg applied.

After the latest update, any user who uploads their photo won't get the photo pulled into AD/Exchange/Lync but it shows fine on SP.  Looking in the _w folder I see that the naming convention has changed so the file is now named ""[siteURL stuff]first_last_MThumb_Jpg.jpg"" where before it was named ""[siteURL stuff]alias_Mthumb_Jpg.jpg""

Really, it boils down to my script expecting a filename syntax of first.last (alias) and instead SP has started spitting out the syntax of first_last.  The script doesn't find the file so it kicks to a catch and imports my default photo instead.

I'm trying to edit the script so that I can use a logical OR operator or nested IF statement to define my variable, or use multiple variables when it attempts to download the file.  Any ideas?

    foreach ($Recipient in $Recipients)
{

	$photopath = $mysiteurl + ""/User%20Photos/Profile%20Pictures/_w/"" + $domain + ""_"" + $Recipient.SamAccountName + ""_MThumb_jpg.jpg""
	$file = ""C:\Scripts\tmp\"" + $Recipient.SamAccountName + "".jpg""

	try
    {
		# download the file
		$clnt.DownloadFile($photopath,$file)
	}
	catch [Net.WebException]
	{
		# if we cant download a file, import a default photo (for people who have removed their picture)
        $photopath = $mysiteurl+""/_layouts/images/nopic.jpg""
		$clnt.DownloadFile($photopath,$file)
	}
	
    write-host 'Downloaded from:' $photopath ' to:' $file ' import to:' $Recipient.SamAccountName

	# import the photo into the gal (stream the photo from the file)
	Import-RecipientDataProperty -Identity $Recipient.Identity -Picture -FileData ([Byte[]]$(Get-Content -Path $file -Encoding Byte -ReadCount 0)) -WarningAction SilentlyContinue
	
	# clean up the file when you're done
    del $file

}",,False,,t5_2qo1o,False,,,True,t3_1dv8fr,http://www.reddit.com/r/PowerShell/comments/1dv8fr/latest_sharepoint_update_broke_my_script_need_to/,
1366730997.0,2,self.PowerShell,1cxv2f,Auditing Security Event log for administrator account login,4,2,10,http://www.reddit.com/r/PowerShell/comments/1cxv2f/auditing_security_event_log_for_administrator/,"Hi all,

Working on a script to monitor the security log for event id 4624 for one specific account. We have some admins who are using the admin account and we want them to stop, just asking hasn't helped. I want to be able to run this script and find out what time the administrator account logged in so I can narrow down who was in the office and what they were doing. Here's my code so far:

    Get-EventLog -logname Security -cn  | ?{$_.eventid -eq ""4624"" -and $_.username -like ""*administrator*""} | format-list

When filtering on $_.username I don't actually pull any results back... I realize it's not pulling the actual username of the logon now, I had my fingers crossed. Anyone have any ideas for how I can filter on the actual account logging in? Ideally I could also pull back the IP address from the event details...

Thanks!",,False,,t5_2qo1o,False,,,True,t3_1cxv2f,http://www.reddit.com/r/PowerShell/comments/1cxv2f/auditing_security_event_log_for_administrator/,
1366073868.0,2,self.PowerShell,1cfgvl,Trying to replace forward slash with back slash in folder paths... not sure what went wrong.,2,0,8,http://www.reddit.com/r/PowerShell/comments/1cfgvl/trying_to_replace_forward_slash_with_back_slash/,"I am trying to replace '/' with '\' but the variable returns an odd result. The first line works fine but it has forward slashes. When I run the replace code it doesn't return just text. What am I missing?


    $allfolders = Get-MailboxFolderStatistics name@domain.com | select folderpath

    $allfolders = $allfolders | Foreach-Object {$_ -replace '/','\'}

    $allfolders

    @{FolderPath=\Top of Information Store}
    @{FolderPath=\Calendar}
    @{FolderPath=\Contacts}
    @{FolderPath=\Conversation Action Settings}
    @{FolderPath=\Conversation History}
    @{FolderPath=\Deleted Items}
    @{FolderPath=\Drafts}
    @{FolderPath=\Inbox}
    @{FolderPath=\Journal}
    @{FolderPath=\Junk E-Mail}
    @{FolderPath=\Notes}
    @{FolderPath=\Outbox}
    @{FolderPath=\RSS Feeds}
    @{FolderPath=\Sent Items}
    @{FolderPath=\Sync Issues}
    @{FolderPath=\Sync Issues\Conflicts}
    @{FolderPath=\Sync Issues\Local Failures}
    @{FolderPath=\Sync Issues\Server Failures}
    @{FolderPath=\Tasks}
    @{FolderPath=\Team Share Issues}
    @{FolderPath=\Recoverable Items}
    @{FolderPath=\Calendar Logging}
    @{FolderPath=\Deletions}
    @{FolderPath=\Purges}
    @{FolderPath=\Versions}",,False,,t5_2qo1o,False,,,True,t3_1cfgvl,http://www.reddit.com/r/PowerShell/comments/1cfgvl/trying_to_replace_forward_slash_with_back_slash/,
1366047649.0,2,self.PowerShell,1cegaf,Remote server time and daylight savings check?,2,0,1,http://www.reddit.com/r/PowerShell/comments/1cegaf/remote_server_time_and_daylight_savings_check/,"I need to confirm the time-zone, time, and if daylights savings time is selected on a list of servers. I've Google'd a bunch of sites, but haven't found a script that successfuly combines all those needs.

Any suggestions? I can post what I've found thus far if need be. Thanks in advance.",,False,,t5_2qo1o,False,,,True,t3_1cegaf,http://www.reddit.com/r/PowerShell/comments/1cegaf/remote_server_time_and_daylight_savings_check/,
1365620231.0,2,self.PowerShell,1c2wz9,"piping to Get-Wmi to filter computers by arch, then run rest of script",3,1,14,http://www.reddit.com/r/PowerShell/comments/1c2wz9/piping_to_getwmi_to_filter_computers_by_arch_then/,"This is only part of my script, but if I can't get this right, I can't get it at all (or I'm doing this in the wrong order ...) 

    Get-ADComputer -filter * -searchBase ""ou=Computers,ou=blah,dc=herp,dc=local"" | Where-Object {(Get-WmiObject Win32_OperatingSystem).OSArchitecture -eq '64-bit'}

Yet when I do this ... the list that gets returned are all the computers in that OU. Should I not be using where-object and be using select-object? 

the other thing I thought about while doing this is: 

    $computers  = Get-ADComputer ...

then

    Get-WmiObject -computername $computers ... 

but that just gave me a RPC unavailable error. It also took a long time to error out. I hope this makes sense what I""m trying to do. The rest of my script relies on certain paths depending on the architecture. 
",,False,,t5_2qo1o,False,,,True,t3_1c2wz9,http://www.reddit.com/r/PowerShell/comments/1c2wz9/piping_to_getwmi_to_filter_computers_by_arch_then/,
1365104934.0,2,self.PowerShell,1bokhr,"Attempting to return the value of a registry key, having issues",2,0,4,http://www.reddit.com/r/PowerShell/comments/1bokhr/attempting_to_return_the_value_of_a_registry_key/,"This is what I have right now:

current path:

HKLM\Software\Wow6432Node\Malwarebytes' Anti-Malware

Get-ItemProperty .

It lists all the keys and their values. The specific key I want is ""dbdate"" which has a value of (whatever date it is).

Why can't I do ""Get-ItemProperty . | *dbdate*""

Or ""Get-ItemProperty . | Select-String dbdate""

Is this because these are properties of the object/folder ""MalwareBytes' Anti-Malware? 

I feel like I'm misunderstanding something, and I feel like this should be simple. ",,False,,t5_2qo1o,False,,,True,t3_1bokhr,http://www.reddit.com/r/PowerShell/comments/1bokhr/attempting_to_return_the_value_of_a_registry_key/,
1363872202.0,2,self.PowerShell,1aqavd,Active Directory description search,2,0,4,http://www.reddit.com/r/PowerShell/comments/1aqavd/active_directory_description_search/,"Hello,

This morning I was tasked with writing a script to search AD computer objects for strings contained in the description for the purpose of asset retrieval. I wrote the following one line command which returns the correct values:

    Get-ADComputer -Filter 'description -like ""*TESTPC1*""'

My next step is to move through a list of strings in a text file. I developed the following script to do so, but it does not return any values:

    $strings = Get-Content -Path C:\DescriptionStrings.txt
    foreach ($string in $strings)
    {
    Get-ADComputer -Filter 'description -like ""*$string*""'
    }

I added a write-host above my get-adcomputer command to verify that the script was moving through the text file as expected, which it was. Hoping someone here can help me realize the error in my ways. I assume it has something to do with my use of the $string variable between the wildcards. Thanks!",,False,,t5_2qo1o,False,,,True,t3_1aqavd,http://www.reddit.com/r/PowerShell/comments/1aqavd/active_directory_description_search/,
1363653393.0,2,self.PowerShell,1ak7ub,Recycle Bin Script Question,2,0,1,http://www.reddit.com/r/PowerShell/comments/1ak7ub/recycle_bin_script_question/,"x/post from /r/Sysadmin but you guys might be able to provide some insight as well.

Is there a way to navigate into another user's recycle bin and view when items have been deleted through say powershell?

I'm able to get the relevant information for the user who's running the script however, I'm trying to avoid running this through a GP logon/logoff script.

From what I've found by forcing my way into the folder through ""Get-ChildItem"" it doesn't provide the ""Deleted"" attribute and ""LastWriteTime"" and ""LastAccessTime"" are not an accurate enough indicator.

What I've got thus far is:

  $Shell = New-Object -ComObject Shell.Application 
  $RecBin = $Shell.Namespace(0xA) 

  for($i = 0; $i -le $RecBin.Items().Count - 1; $i++)
  {
  $FI = $RecBin.Items().Item($i)
  $DelDate = $RecBin.GetDetailsOf($FI,2)

  #Date Handling

  if($DelDate -lt $30Days)
  {
     $RecBin.Items().Item($i) | %{ Remove-Item $_.path -force -recurse -Confirm:$false }
  }
  }

",,False,,t5_2qo1o,False,,,True,t3_1ak7ub,http://www.reddit.com/r/PowerShell/comments/1ak7ub/recycle_bin_script_question/,
1362599466.0,2,self.PowerShell,19sla6,Exclude folder from Get-ChildItem,4,2,5,http://www.reddit.com/r/PowerShell/comments/19sla6/exclude_folder_from_getchilditem/,"I'm trying to use Get-ChildItem to display the names of folders that are inside of another folder.  There is always a folder name ""ErrorFolder"" which I just want to exclude from the output.  Here's what I have:

    $Ignore=@('ErrorFolder';)
    $conQs = @(Get-ChildItem ""C:\test1\test2"" -Exclude $Ignore | where {$_.PSIsContainer})
    
    foreach ($conQ in $conQs)
    {Write-Host $conQ ""`r`n""}      

This outputs the fulle path of each folder on its own line and correctly excludes the ""ErrorFolder"" folder.  Unfortunately, I only want to display a list of folder names and not the full folder path.

If I change my code just a bit and omit the $Ignore the list of folder names appears perfect but includes (obviously) the folder I want to not see int he list.

EDIT: Corrected code snippet typo",,False,,t5_2qo1o,False,,,True,t3_19sla6,http://www.reddit.com/r/PowerShell/comments/19sla6/exclude_folder_from_getchilditem/,
1362438011.0,2,self.PowerShell,19o1qf,Super noob question.,3,1,8,http://www.reddit.com/r/PowerShell/comments/19o1qf/super_noob_question/,"I am playing around with powershell, whenever I do a multiline command my prompt turns into 
    '&gt;&gt;'

And I don't know how to escape this but let the command run.

TLDR; I am stupid.",,False,,t5_2qo1o,False,,,True,t3_19o1qf,http://www.reddit.com/r/PowerShell/comments/19o1qf/super_noob_question/,
1361869710.0,2,self.PowerShell,1991sq,"Add smtp address for distibution group, getting info from ad",2,0,7,http://www.reddit.com/r/PowerShell/comments/1991sq/add_smtp_address_for_distibution_group_getting/,"So, i have a distribution gruop in AD. The email field is filled with the correct address, but the smtp address is not set when i open the group in Exchange 2010. 

I have this command so far, and it works. 

    get-distributiongroup ""Groupname"" | set-DistributionGroup -PrimarySMTPAddress test@test.no -EmailAddressPolicyEnabled $false

What i want now, is to replace the smtp emailaddress with the one registered in the emailfield in AD. How do i get this? Any takers?


ps. when I get that to work, i will use this to do the job on many groups in a OU.

    get-distributiongroup -OrganizationalUnit OUname
",,False,,t5_2qo1o,False,,,True,t3_1991sq,http://www.reddit.com/r/PowerShell/comments/1991sq/add_smtp_address_for_distibution_group_getting/,
1361548173.0,2,self.PowerShell,190x2f,Trying to suppress a non-zero exit code for use in a STAF/STAX environment.,2,0,3,http://www.reddit.com/r/PowerShell/comments/190x2f/trying_to_suppress_a_nonzero_exit_code_for_use_in/,"Hi there, I currently have a script that does some copying of some files in a VM to a network location. The files themselves copy fine, but I'm still getting a ""Guest program exited with non-zero exit code: 1"" event after the copy completes. If I run the script manually it's fine, and carries on with no issue. But when I try to run it via STAF/STAX the non-zero exit code causes the job to halt and the script fails. I've tried using '-ErrorAction SilentlyContinue', but to no avail. Anyone have any ideas on how to stop the non-zero exit code?

Code: vmrun -T ws -gu admin -gp test runProgramInGuest $VM_Image -interactive -activeWindow cmd.exe /c powershell.exe ""Copy-Item '$Extract_Result' '$Extract_Archive' –Verbose -Force -ErrorAction SilentlyContinue""",,False,,t5_2qo1o,False,,,True,t3_190x2f,http://www.reddit.com/r/PowerShell/comments/190x2f/trying_to_suppress_a_nonzero_exit_code_for_use_in/,
1361307265.0,2,self.PowerShell,18u8pp,Link startup script to GPO via POSH,4,2,1,http://www.reddit.com/r/PowerShell/comments/18u8pp/link_startup_script_to_gpo_via_posh/,"A bit of background. I work for a MSP and we install an agent on each machine. Since we have dozens of clients I am creating a POSH script to make a GPO that runs startup script on each client's Domain Controller which will install said agent.

I have the script and all the files in the necessary locations. The only problem is I cannot find anything in the GroupPolicy module for linking a startup script to the GPO. Is there a setting for this? If so is there a way to pass parameters to the startup script as well?

I found a workaround, but it involves backing up a generalized startup GPO script and then restoring that to a different domain. Then modifying the startup script with the proper settings.",,False,,t5_2qo1o,False,,,True,t3_18u8pp,http://www.reddit.com/r/PowerShell/comments/18u8pp/link_startup_script_to_gpo_via_posh/,
1361215553.0,2,self.PowerShell,18rmfl,"Capturing all standard output from a script, without individual statements?",3,1,3,http://www.reddit.com/r/PowerShell/comments/18rmfl/capturing_all_standard_output_from_a_script/,"I'm not sure if this exists, but I hope it does (and it should!).

I would like to put something at the start of the script that says to redirect all standard output to a variable, rather than have to append output from individual lines to a variable.

So, at the start of the script, something like:

    ...PSInfo.STDOUT &gt; $out
    ""first info""
    ""second info""
    ""third info""

instead of 

    $out = ""first info""
    $out += ""second info""
    $out += ""third info""

There's probably a way to do this that I've missed somewhere along the line.

Thanks!",,False,,t5_2qo1o,False,,,True,t3_18rmfl,http://www.reddit.com/r/PowerShell/comments/18rmfl/capturing_all_standard_output_from_a_script/,
1361207395.0,2,self.PowerShell,18rbvi,Question about creating a GPO and startup script with powershell,3,1,4,http://www.reddit.com/r/PowerShell/comments/18rbvi/question_about_creating_a_gpo_and_startup_script/,"I am very new to Powershell, but am pretty familiar with scripting in general. I am creating a PS script to create a GPO to set a .bat startup script. The problem I am currently having is navigating to the correct folder to download the startup script.

I know I need to put the .bat script in %SystemRoot%\sysvol\sysvol\&lt;domain&gt;\Policies\{GUID}\Machine\Scripts\Startup

If $gpo has the created GPO object, I can't seem to format `$gpo.id.guid` to output to match {GUID} because it just returns the numbers, not the brackets. And apparently I'm not smart enough to find out how to correctly concatenate the brackets around it.

Is there an easier way?",,False,,t5_2qo1o,False,,,True,t3_18rbvi,http://www.reddit.com/r/PowerShell/comments/18rbvi/question_about_creating_a_gpo_and_startup_script/,
1360785407.0,2,self.PowerShell,18gpc2,Anyone else ever see Get-ADComputer return an array of $nulls?,2,0,3,http://www.reddit.com/r/PowerShell/comments/18gpc2/anyone_else_ever_see_getadcomputer_return_an/,"I'm using the AD cmdlets on Server 2008 R2 to implement shadow groups.  I've used the Get-ADComputer cmdlet many times before, and I'm accustomed to it returning an empty set when there are no results.

However, this time around I'm seeing something different.  When there are no results, I'm getting back a collection of 3 $null objects.

    $ou = 'ou=foo,ou=bar,dc=example,dc=com'
    $group = 'cn=RODCGroup,ou=bar,dc=example,dc=com'
    $missingMembers = get-adcomputer -searchbase $ou -searchscope subtree -ldapfilter ""(!memberOf=$group)""
    $missingMembers | % {
        # BOOM!  $_ should never be $null... but it is now
        write-host $_.distinguishedName
    }

When there are results, the Get-ADComputer cmdlet works fine.  It's only when there are no computers that match the filter.

I'm flummoxed.  Has anyone else seen this?",,False,,t5_2qo1o,False,,,True,t3_18gpc2,http://www.reddit.com/r/PowerShell/comments/18gpc2/anyone_else_ever_see_getadcomputer_return_an/,
1359998039.0,2,self.PowerShell,17vi28,Should PowerShell suspend long-running tasks if left unattended?,3,1,5,http://www.reddit.com/r/PowerShell/comments/17vi28/should_powershell_suspend_longrunning_tasks_if/,"Hi,

I've been experiencing a strange thing with some long-running tasks I've been experimenting with. One task is to run robocopy to copy some large files. The other task is to use 7za.exe to encrypt said large files.

I've noticed that if I leave the tasks running in the background (by that I mean switch to a different RDP session or to my desktop) they will stop: network activity during the copy will drop to zero and CPU usage will return to normal during the encryption process.

I can get things started again by clicking in the PowerShell window and pressing enter.

Anyone experienced this before or know what the heck is going on?",,False,,t5_2qo1o,False,,,True,t3_17vi28,http://www.reddit.com/r/PowerShell/comments/17vi28/should_powershell_suspend_longrunning_tasks_if/,
1358440297.0,2,self.PowerShell,16rapa,Need help finding creator/editor of files and folders,4,2,5,http://www.reddit.com/r/PowerShell/comments/16rapa/need_help_finding_creatoreditor_of_files_and/,"Hi all, I'm trying to find a way of determining the creator/last editor of files and folders on our servers. They are not necessarily the file/folder owners. I can't seem to find a way to get this information via GCI or Get-ACL. It would also be nice to enumerate the various file details such as those in Windows Explorer's folder option list such as ""Due Date"", ""Duration"", ""Date Taken"", ""Album"", ""Album Artist"", and etc. Lastly, is there a way to add properties to files and folders for file retention schedule purposes? Thanks in advance for helping.",,False,,t5_2qo1o,False,,,True,t3_16rapa,http://www.reddit.com/r/PowerShell/comments/16rapa/need_help_finding_creatoreditor_of_files_and/,
1357703100.0,2,stackoverflow.com,1687ou,How do you export objects with a varying amount of properties?,2,0,0,http://www.reddit.com/r/PowerShell/comments/1687ou/how_do_you_export_objects_with_a_varying_amount/,,,False,,t5_2qo1o,False,,,False,t3_1687ou,http://stackoverflow.com/questions/14227943/how-do-you-export-objects-with-a-varying-amount-of-properties,
1356030400.0,2,self.PowerShell,156iua,Need Help with Back Up Script Script,2,0,5,http://www.reddit.com/r/PowerShell/comments/156iua/need_help_with_back_up_script_script/,"Hey all, 

This is my first attempt at a Powershell script. It was an interview question (sort of like homework) and I have no idea what the 'grading scale' was. I already submitted my work to the manager but wanted to see how y'all thought I did. Here was the prompt:

Scenario:
There is a critical file that needs to be backed up throughout the day to protect against possible corruption.  Build a PowerShell script to copy a file from one folder to another and implement a required file retention policy.  The source file data will change over time.

Setup:
-	Create a folder c:\PowerShell
-	Create a folder c:\PowerShell\Source
-	Create a folder c:\PowerShell\Backup
-	Create a source text file with a few lines of random text within as c:\PowerShell\Source\Source.txt

Requirements:

-	The script will run on the same computer the source file and destination files are located on.
-	The script will be run manually from PowerShell.
-	Each time the script is run, it will get the current time, round down to the nearest 15 minutes and copy c:\PowerShell\Source\Source.txt to c:\PowerShell\Backup\SourceHHMM.txt (where HHMM is the time rounded down to the nearest 15 minutes in 24 hour time format including leading zeros).
-	Over time, this script will end up overwriting files.  If the file to be overwritten is not older than 23 hours, the script should not overwrite the file.
-	The script should only create files If run between the hours of 6 AM and Midnight.
-	Implement a logging function to write your script’s activity to c:\PowerShell\Backup\Log.txt

Deliverables:

-	Phase 1:

o	Sketch out a flowchart showing the proposed logic of your script.  Use “pseudo code” to describe processes that occur (you don’t have to know syntax).
o	Create test cases to use for the following phases.
o	Review with me before continuing.

-	Phase 2:

o	Create the folders and files in the setup section.
o	Begin to code your script.  At this phase, it only needs to be able to get the time and copy the file to the Backup folder using the correct rounding and naming convention.  It will always overwrite at this point.
o	Show me that this runs and meets your test cases created for this phase.

-	Phase 3:

o	Implement the time restrictions in your script (6AM to Midnight)
o	Implement the file overwrite logic in your script (do not overwrite if file is less than 23 hours old)

-	Phase 4:

o	Implement the logging function.
o	Log the following to c:\PowerShell\Backup\Log.txt, a file your script creates.
	The date and time the script starts
	The file it will attempt to generate
	If the file exists in the backup directory
	Whether or not the file will be overwritten, created, or skipped
o	The log file should only maintain information for the current calendar day.

Examples (Phase 3 Complete):

-	Script is run at 1:48 PM, no files exist in Backup folder
o	Script copies file as Source1345.txt
-	Script is run at 8:48 AM, file Source0845.txt exists in the Backup folder and was created at 8:47 AM yesterday
o	Script overwrites file Source0845.txt with data currently in source.txt
-	Script is run at 11:32 AM, file Source1130.txt exists in the Backup folder and was created at 11:31 AM today
o	Script does not copy the file
-	Script is run at 4:15 AM, file Source0415.txt does not exist in the Backup folder
o	Script does not copy the file

$start = get-date ""6:00:00 AM""

$stop = get-date ""11:59:59 PM""


while((get-date) -ge $start -and (get-date) -le $stop)
{
	Sleep -Seconds 0
}

do {


$LastDay = (Get-Date).Addhours(-23)

$date = (Get-Date).addminutes(-($dt.minute % 15)) | Get-Date -Format %H%M

$path = ""c:\PowerShell\Backup""
if (Test-Path $path -NewerThan $LastDay) 

{
    Copy-Item $path c:\PowerShell\Source\Source.txt c:\PowerShell\Backup\""$date""
    (Get-Item $path).LastWriteTime = $date

}

$(Test-Path C:\Scripts\Archive).Status -eq ""False"" 
{   
	LogInfo(""Source.txt back up commenced"")

} 

Else{
	Write-Host ""Source.txt could not be copied""
	LogError(""Source.txt could not be copied"")

	Exit

function LogError($message)
{
     $outContent = ""[$date] Back Up Failed""
     Add-Content ""Log\$Script:logFile"" $outContent

     if((Test-Path Log) -eq $false)
     {
           $LogFolderCreationObj=New-Item -Name Log -type directory
     }
     
     $Script:logFile=""$date.log""
     Add-Content ""Log\$logFile"" ""$Date""

while ($Exit -ne $True)

{
EXIT

}",,False,,t5_2qo1o,False,,,True,t3_156iua,http://www.reddit.com/r/PowerShell/comments/156iua/need_help_with_back_up_script_script/,
1355425890.0,2,self.PowerShell,14srpy,machine portable zip function,2,0,4,http://www.reddit.com/r/PowerShell/comments/14srpy/machine_portable_zip_function/,"I am looking to create a machine portable zip function.  Due to the portability I do not want to have to install an application.  Obviously I am only looking at machines that support powershell.  So, I am thinking  I can rely on the OS's built in zip functionality.

My problem is that I can not seem to find any command examples for the the OS zip function.  All a google tends to show for me is people who installed a 3rd party util and call it from powershell.

Can someone point me to a link that shows the use of one?  Maybe a using the search term ""powershell zip"" is my problem?

Any pointers?

TIA",,False,,t5_2qo1o,False,,,True,t3_14srpy,http://www.reddit.com/r/PowerShell/comments/14srpy/machine_portable_zip_function/,
1354312800.0,2,self.PowerShell,142n8g,*Power Shell v3.0* Install Problem,3,1,2,http://www.reddit.com/r/PowerShell/comments/142n8g/power_shell_v30_install_problem/,"I'm currently trying to install PS v3.0 on Windows Server 2008 R2 x64. The problem I keep getting is The update is not applicable to your computer and I've tried installing all versions of .Net Framework, and nothing as been going my way.

Anyone know what the problem is?",,False,,t5_2qo1o,False,,,True,t3_142n8g,http://www.reddit.com/r/PowerShell/comments/142n8g/power_shell_v30_install_problem/,
1353095066.0,2,self.PowerShell,13bbja,Question about $global,3,1,2,http://www.reddit.com/r/PowerShell/comments/13bbja/question_about_global/,"I am using $global:variable in some functions to reference variables that were defined outside the function. I noticed when I run the script within PowerGUI it works fine no problem. When I run it from the powershell command window the $global:variable doesn't seem to have any value.

Can anyone explain why this would be happening?

*edit* I think I figured it out, should I be using $script:variable instead?",,False,,t5_2qo1o,1353095475.0,,,True,t3_13bbja,http://www.reddit.com/r/PowerShell/comments/13bbja/question_about_global/,
1353080583.0,2,self.PowerShell,13avoh,"Script not returning correct values on remote/other computers, but running it line by line does....weird",4,2,4,http://www.reddit.com/r/PowerShell/comments/13avoh/script_not_returning_correct_values_on/,"So i have a simple script that I wrote (not done, just debugging at the moment) to check the battery health of my users computers that works perfectly on my machine.  But when i copy the script to another machine and execute via remote powershell (yes i have the execution policy set to 'unrestricted') I get false values, i.e. battery reports 100% health when in reality it's not anywhere near that.  If I run the script line by line it returns the proper values and works, but not as a whole script.  Here is the code below, any help would be great, thanks!



    $actualcapacity=gwmi 'batteryfullchargedcapacity' -Namespace 'root\wmi'
    $designedcap=gwmi 'batterystaticdata' -Namespace 'root\wmi'

    $health=($actualcapacity.FullChargedCapacity)/($designedcap.DesignedCapacity)

    if ($health -ne 1)
     {
    write-host ""`nBattery health: 100%""
     }
    else 
    {
    Write-Host ""`nBattery health:$health"" 
     }


EDIT: Fixed, I found the bug...apparently assigning values to variables instead of checking values kind of makes your script break,  hopefully someone dumber than me can possibly find this useful.

",,False,,t5_2qo1o,1353294080.0,,,True,t3_13avoh,http://www.reddit.com/r/PowerShell/comments/13avoh/script_not_returning_correct_values_on/,
1352738240.0,2,self.PowerShell,132gxj,Extracting Text/Integers From (Text) File For Use As A Variable,3,1,10,http://www.reddit.com/r/PowerShell/comments/132gxj/extracting_textintegers_from_text_file_for_use_as/,"Hi r/Powershell! So, I've been working on a script that is parsing error logs. That's not important: what I have is a txt file that contains the Log text, a couple of integers and a text string I need to extract. I need to take all four of these things as variables and pass them off to either a SQL query or the body of an email. The latter aspect of the problem is all sorted, but getting the right content from the files is causing me a great deal of suffering!

I've been using Regex. Sigh. 

My regex can pull matches from the text, but I only need a part of that match. For example, this is (a small part of) the string I'll be using: 

     InstanceId         : 34202
     Message            : Error in Query :
               MBS_LKEY : 13375
               AGR_LKEY : 71501
               Query    : 

The regex (at present) is: ""AGR_LKEY : ([0-9]{4,})""

This brings back AGR_LKEY : 71501, which is fine, but I only need the number. Given my knowledge of Regex is extremely narrow, I can't work out - even with a lot of Googling - if it is even possible to use Regex to use ""AGR_LKEY : "" as a ""anchor"" in the text, and to give me the number that comes *after* that, and assign it as a variable. Is such a thing even possible?

Any help is much appreciated!",,False,,t5_2qo1o,False,,,True,t3_132gxj,http://www.reddit.com/r/PowerShell/comments/132gxj/extracting_textintegers_from_text_file_for_use_as/,
1351693618.0,2,self.PowerShell,12edwi,"Two noob questions, sorry",2,0,6,http://www.reddit.com/r/PowerShell/comments/12edwi/two_noob_questions_sorry/,"Why does $shit | Get-Member work but Get-Member $shit doesn't?

What is the equivalent of in average programming languages, say, Python, saying function().function().function()? For exampe Get-Date.Year doesn't work, neither does Get-Date().Year, do I always need to go $d = Get-Date, then $d.Year, it doesn't work in one step?",,False,,t5_2qo1o,False,,,True,t3_12edwi,http://www.reddit.com/r/PowerShell/comments/12edwi/two_noob_questions_sorry/,
1350587002.0,2,self.PowerShell,11pck6,SharePoint Powershell issues,5,3,1,http://www.reddit.com/r/PowerShell/comments/11pck6/sharepoint_powershell_issues/,"I've got this script that I wrote (and it's half commented up, sorry) that pulls site names, site title, collection owners, and then admins and users with full control as well as the dates that they were last modified, since we are going through cleaning up old sites. It works perfect in our test environment (other than random red for blank lines, but I can fix that later). However in production, it dies after hitting the third site in the list with this error:

    D:\PS-Script\last-modified\last-modified.ps1 : Exception has been thrown by the target of an invocation.
    At line:1 char:20
    + .\last-modified.ps1 &lt;&lt;&lt;&lt;
        + CategoryInfo          : NotSpecified: (:) [last-modified.ps1], TargetInvocationExce
       ption
        + FullyQualifiedErrorId : System.Reflection.TargetInvocationException,last-modified.p
       s1

Line 1 in the actual code is part of a comment block, and removing it does nothing. I've tried this with my admin account, and the farm admin account, same results. Any thoughts?

Code below:


        # define Site URL
    $url=""http://siteurlhere""
    $site = New-Object Microsoft.SharePoint.SPSite($url)
    $spWebApp = $site.WebApplication
    
    # define export path 
    $fileName = ""d:\ps-script\last-modified\last-modified.csv""
    # label headers of each column
    ""Site Name`tURL`tLast Modified`tSiteAdministrators`tSecondary Owners`tUsers with Full Control"" &gt; $fileName
    
    # Start loop 
    foreach ( $spSite in $spWebApp.Sites )
        {
        foreach ($spWeb in $spSite.AllWebs)
            {
            if ($spWeb.IsRootWeb)
                {
                # Identify Site Title
                $siteName = $spWeb.Title +"" - Root"";
                }
            else
                {
                $siteName = $spSite.RootWeb.Title + "" - "" + $spWeb.Title;
                }
            # Determines Site Collection Administrators
            $admins = $null
            $admins = @()
            Foreach ($admin in $spWeb.SiteAdministrators)
                {
                $admins += $admin.UserLogin
                }
            # Remove ENT\ from each userid and join each userid with a semicolon
            $adminOut = $([string]::Join("";"",$admins)).Replace(""domain\"","""")
            }        
        $SOGArray = @()
        foreach ($SOG in $spWeb.AssociatedOwnerGroup.Users)
            {
            $SOGArray += $SOG.Name
            }
        $SOGArray = $SOGArray | where {($_ -notmatch ""domain\\admin_username"")}
        $SOGOut = $([string]::Join("";"",$SOGArray))
        $SFCArray = @()
        foreach ($SFC in $spWeb.Roles[""Full Control""].Users)
            {
            $SFCArray += $SFC.Name
            }
        $SFCArray = $SFCArray | where {($_ -notmatch ""domain, admin"")}
        $SFCOut = $([string]::Join("";"",$SFCArray))    
        $siteName + ""`t"" + $spWeb.Url + ""`t"" + $spWeb.LastItemModifiedDate + ""`t"" + $adminOut + ""`t"" + $SOGOut + ""`t"" + $SFCOut &gt;&gt; $fileName
        $spWeb.Dispose() 
        }
     $spSite.Dispose()",,False,,t5_2qo1o,False,,,True,t3_11pck6,http://www.reddit.com/r/PowerShell/comments/11pck6/sharepoint_powershell_issues/,
1348772959.0,2,self.PowerShell,10ksfb,emulating tracert round trip information,2,0,4,http://www.reddit.com/r/PowerShell/comments/10ksfb/emulating_tracert_round_trip_information/,I have been trying to get tracert style round trip times from network hardware in powershell with individual data points in their own variables. In following this line I found Trevor Sullivans Trace-route (http://trevorsullivan.net/2012/07/23/powershell-tracert-or-trace-route/). However his design utilizes pings to each hop of the trace. I need to be able to get the round trip times from devices that do not respond to pings. Any suggestions as to how I can modify this to allow retrieval of round trip times for all devices between a source and destination ip?,,False,,t5_2qo1o,False,,,True,t3_10ksfb,http://www.reddit.com/r/PowerShell/comments/10ksfb/emulating_tracert_round_trip_information/,
1348697671.0,2,self.PowerShell,10j3xs,Remove direct permissions from a folder,3,1,1,http://www.reddit.com/r/PowerShell/comments/10j3xs/remove_direct_permissions_from_a_folder/,"Hello Everyone,

I'm trying to get a script working that will remove users that have direct permission to a folder (non-inherited). The users and directories will be imported via csv file.

    #import users and paths
    $userlist = import-csv C:\01.csv
    $userlist | foreach-object {
        #declare variables
        $filertemp=$_.File_Server
        $pathtemp=$_.Access_Path
        $user=$_.User_Name
        $pathmod=$pathtemp.Substring(3)
        #need to format the path a bit. Output looks like \\hostname\share\folder
        $folders=""\\""+$filertemp+""\""+$pathmod
  
             Foreach($acl in $acls) { 
                 $user = $_.User_Name 
                 $acls = Get-Acl -path $folders 
                 $outputObject = @() 
                 $folder = (convert-path $acl.pspath) 
                        Foreach($access in $acl.access) { 
                             Foreach($value in $access.identityReference.Value) {  
                             if ($value -eq $user) { 
                                $acl.RemoveAccessRule($access) | Out-Null 
                                } 
                             } #end foreach value 
                        } # end foreach access 
                 Set-Acl -path $folder -aclObject $acl 
            ""user ""+$user+"" removed from ""+$folder 
            } #end Foreach acl
       }


A major portion came from [here](http://blogs.technet.com/b/heyscriptingguy/archive/2009/09/17/hey-scripting-guy-september-17-2009.aspx), but I'm trying to manipulate it so that it will interate through the initial for-each that parses the csv file.

",,False,,t5_2qo1o,1348748653.0,,,True,t3_10j3xs,http://www.reddit.com/r/PowerShell/comments/10j3xs/remove_direct_permissions_from_a_folder/,
1348630600.0,2,self.PowerShell,10hmnw,New-Datacenter?,3,1,10,http://www.reddit.com/r/PowerShell/comments/10hmnw/newdatacenter/,"Given a bunch of Powershell scripts that build components of a virtualized datacenter, how would you go about tying them all together to a nearly one-touch solution? I've gone through some thought processes on my blog ([shameless](http://thereluctanttecchie.blogspot.com/2012/09/new-datacenter.html)), but I feel like I'm really over-thinking this one.

How do the grown ups auto-create datacenters? And what do they use for sustainment? SCCM? Puppet? Chef? ",,False,,t5_2qo1o,False,,,True,t3_10hmnw,http://www.reddit.com/r/PowerShell/comments/10hmnw/newdatacenter/,
1348084942.0,2,self.PowerShell,105ilr,Problems with new-aduser when using -instance,3,1,4,http://www.reddit.com/r/PowerShell/comments/105ilr/problems_with_newaduser_when_using_instance/,"I'm working on a user provisioning script using the Active Directory AD modules.

I played around with a few different approaches, and the most flexible seeming to me was to use an AD account (one for each department) as the template, and use the new-aduser -instance to copy over the account properties. I like this because I can let the less technical staff make updates to default settings easily, and the ADUC console is one they are already familiar with. Here's what I have:

    	$template = get-aduser -identity $depts[$userinfo.department].template -properties city,country,company,department,description,Fax,HomePage,Manager,MemberOf,Organization,PostalCode,ScriptPath,State,StreetAddress,telephoneNumber,wWWHomePage
    	            
    	New-ADUser -instance $template `
    		-ChangePasswordAtLogon $true `
    		-name $userinfo.samAccountName `
    		-DisplayName $userinfo.displayName `
    		–GivenName 	$userinfo.givenName `
    		-Surname 	$userinfo.sn `
    		-Initials 	($userinfo.givenName.substring(0,1) + $userinfo.mi.substring(0,1) + $userinfo.sn.substring(0,1)) `
    		-OfficePhone $userinfo.phone `
    		-HomeDirectory ($userinfo.homeDirectory) `
    		-HomeDrive U: `
    		-Title $userinfo.title `
    		-department $userinfo.department `
    		-enabled $true `
    		-emailaddress  $userinfo.emailAddress`
    		-UserPrincipalName ($userinfo.samAccountName + ""@gbls.local"") `
    		-path $userinfo.ou `
    		-Manager $userinfo.Manager `
    		-AccountPassword $securePassphrase

However, when I run this I get an error ""New-ADUser : The name provided is not a properly formed account name"" if the -name parameter has a comma in it. Without -instance, it works fine with or without the comma. I did find [this](http://social.technet.microsoft.com/Forums/en/winserverpowershell/thread/0f7a28e0-e2c9-4fd7-ad2c-639631722710) forum post that seems to indicate it's a bug.

Is there another, equally simple method to copy a ""template"" account to a new account? I don't want to have to think through all of the possible options that might be set in template unless it's really necessary...just copy over as many as possible to the new account. Alternatively--anyone run into this bug and find a way around it?

EDIT: in case anybody else finds this helpful--using rename-adobject is a simple way to get around this problem.",,False,,t5_2qo1o,1348241581.0,,,True,t3_105ilr,http://www.reddit.com/r/PowerShell/comments/105ilr/problems_with_newaduser_when_using_instance/,
1346768200.0,2,self.PowerShell,zc405,Disable DNS Registration via WMI - What am I doing wrong?,3,1,2,http://www.reddit.com/r/PowerShell/comments/zc405/disable_dns_registration_via_wmi_what_am_i_doing/,"I've never used WMI to actually set something, always just use it for data gathering.

Definition for the SetDynamicDNSRegistration method of the Win32_NetworkAdapterConfiguration class:

    uint32 SetDynamicDNSRegistration(
      [in]  boolean FullDNSRegistrationEnabled,
      [in]  boolean DomainDNSRegistrationEnabled
    )

My stuff:

    PS C:\Windows\system32&gt; $nics[1] | Get-Member

       TypeName: System.Management.ManagementObject#root\cimv2\Win32_NetworkAdapterConfiguration

    PS C:\Windows\system32&gt; $nics[1].SetDynamicDNSRegistration($false,$false)

    __GENUS          : 2
    __CLASS          : __PARAMETERS
    __SUPERCLASS     :
    __DYNASTY        : __PARAMETERS
    __RELPATH        :
    __PROPERTY_COUNT : 1
    __DERIVATION     : {}
    __SERVER         :
    __NAMESPACE      :
    __PATH           :
    ReturnValue      : 0
    PSComputerName   :
    
    PS C:\Windows\system32&gt; $nics[1].fullDNSRegistrationenabled
    True

The return value of 0 means Successful completion, no reboot required.

**Edit:**
Okay, nevermind, I guess it worked.  So, anyone know why it returns true for $nics[1].fullDNSRegistrationenabled
even though the setting actually changed from the SetDynamicDNSRegistration method?",,False,,t5_2qo1o,1346768454.0,,,True,t3_zc405,http://www.reddit.com/r/PowerShell/comments/zc405/disable_dns_registration_via_wmi_what_am_i_doing/,
1346609049.0,2,codepyre.com,z8ljq,Prototypal Inheritance Using PowerShel: Mixins,5,3,0,http://www.reddit.com/r/PowerShell/comments/z8ljq/prototypal_inheritance_using_powershel_mixins/,,,False,,t5_2qo1o,False,,,False,t3_z8ljq,http://codepyre.com/2012/08/prototypal-inheritance-using-powershell-part-three-mixins/,
1346369388.0,2,self.PowerShell,z3t1n,[Requesting Help] Need to install an Exe on multiple computers but not on ones that may already have it,3,1,17,http://www.reddit.com/r/PowerShell/comments/z3t1n/requesting_help_need_to_install_an_exe_on/,"Hello and thanks for looking! Sorry if this is the wrong place to ask this but I'm really new to powershell and was hoping to get some advice.

I was hoping I could use it to potentially roll out a new anti-virus program we're installing soon. I wrote the script below and it works as far the installation goes but I'm having issues getting it to not do anything if it detects the text file. 
So basically it starts up on logon via Group Policy, then it checks c:\ for a text file named sophos.txt. If it's there it should quit immediately, if not then it should reach out to a network share and run the executable and after that make the sophos.txt file so it doesn't run again. 

My problem is that it seems like on some machines it makes the text file very quickly and then never runs the exe. Or it just runs the exe regardless of the text file being there. It's been very frustrating and I would greatly appreciate any help or advice. Please find my script below: 

--------
$checkfile = ""C:\Program Files\Sophos\AutoUpdate""
if (! (Test-Path $checkfile)) 
    {    
    invoke-item \\servernamehere\public\sophos\sophosendpoint.exe
    New-Item c:\Sophos.txt -type file
    }    
--------",,False,,t5_2qo1o,False,,,True,t3_z3t1n,http://www.reddit.com/r/PowerShell/comments/z3t1n/requesting_help_need_to_install_an_exe_on/,
1346164662.0,2,self.PowerShell,yyo26,Migrating some powershell code..what is [0..15]?,2,0,7,http://www.reddit.com/r/PowerShell/comments/yyo26/migrating_some_powershell_codewhat_is_015/,"I have been playing around trying to move an encrypt and decrypt routine into C# from powershell, but I am coming up something i havent seen in powershell before

        
    $r.IV = (new-Object Security.Cryptography.SHA1Managed).ComputeHash( [Text.Encoding]::UTF8.GetBytes($init) )[0..15]


I have never seen the [0..15] part at the end. Trying to google something like this has turned up difficult. Thanks for any help.    ",,False,,t5_2qo1o,False,,,True,t3_yyo26,http://www.reddit.com/r/PowerShell/comments/yyo26/migrating_some_powershell_codewhat_is_015/,
1345827288.0,2,self.PowerShell,yrfwj,Question about using args[n] for command line input.,2,0,10,http://www.reddit.com/r/PowerShell/comments/yrfwj/question_about_using_argsn_for_command_line_input/,"Hi. I am a novice powershell scripting person. 

I've written a script to query the services of a remote server using command line input and change the state with the switch funtion, ie., args[0], args[1], args[2] as server IP address, service name, action. I am only able to use the service short name since I cannot figure out how to allow args[1] to accept input with more than one word. My DEFAULT switch behavior is to print a usage message.

I've tried placing single quotes around args[1] and single quotes around the command line input to no avail. 

Thank you.",,False,,t5_2qo1o,False,,,True,t3_yrfwj,http://www.reddit.com/r/PowerShell/comments/yrfwj/question_about_using_argsn_for_command_line_input/,
1345215396.0,2,self.PowerShell,ydngf,Help request:  Trying to remove users located on a child domain from groups located in the parent domain.,2,0,1,http://www.reddit.com/r/PowerShell/comments/ydngf/help_request_trying_to_remove_users_located_on_a/,"Working on a script to automate our termination process for AD accounts and mailboxes.  I have almost everything working right now except when it comes to terming users in a child domain.  

I am running as an enterprise admin so permissions shouldn't be an issue.  In the past I have had no issues adding the users in the child domain to the parent domain groups, but removing seems to be an entirely different thing.

I have tried two commands: Remove-ADGroupMember and Remove-ADPrincipalGroupMembership.

At the point where I am trying to remove the groups I have a list of the distinguished names of the groups and the user's AD account (from Get-ADuser) in an object. I am running the groups through a foreach loop like this:  
  
       $MemberOf | % {
           if($_ -match ""DC=Child""){
             Remove-ADGroupMember -Identity $_ -Members $User -Confirm:$false -Server $ChildDC}
           else{Remove-ADGroupMember -Identity $_ -Members $User -Confirm:$false -Server $ParentDC}

So, when I try to remove Child User from Parent domain this way I get the following error:
   ""The specified account name is not a member of the group"", (It is in the group, have verified that)
If I try to change the server to point to a DC in the Child domain I get
   ""Cannot find an object with identity: 'CN=Group,OU...etc' User &lt;DN of Child domain&gt;""

So I try
      Remove-ADPrincipalGroupMembership -Identity $User -MemberOf $_ -Server $ChildDC
I get """"Cannot find an object with identity: 'CN=Group,OU...etc' User &lt;DN of Child domain&gt;"" again

If I point it back to the parent domain I get ""A referral was returned from the server.

Am I missing something?  Any other commands to remove the user from the groups?

Thanks for any help.

     ",,False,,t5_2qo1o,False,,,True,t3_ydngf,http://www.reddit.com/r/PowerShell/comments/ydngf/help_request_trying_to_remove_users_located_on_a/,
1345135562.0,2,self.PowerShell,ybsx4,Array reference hell,2,0,2,http://www.reddit.com/r/PowerShell/comments/ybsx4/array_reference_hell/,"So I've got a function that returns two arrays of hashes.  I need to combine those two arrays into one array, then copy it into two new arrays to perform functions on (god that's hard to explain coherently).

    #$errors is a simple array
    #$rawdiff1/$rawdiff2 are arrays of hashes
    	($errors1,$rawdiff1) = GetDiffOutput1 $version $prev $head
    	($errors2,$rawdiff2) = GetDiffOutput2 $version $prev $head
	
	$errors =  $($errors1+$errors2)
	
	$diff1 = $($rawdiff1+$rawdiff2)
	$diff2 = $($rawdiff1+$rawdiff2)



	for($i=0; $i -lt $diff2 .length; $i++){
		#Random number 1-3 
		switch ($(Get-Random -Minimum 1 -Maximum 4)){
			1 {$diff2 [$i][""product""] = ""a""}
			2 {$diff2 [$i][""product""] = ""b""}
			3 {$diff2 [$i][""product""] = ""c""}
		}
	}
    for($i=0; $i -lt $diff1 .length; $i++){
		$diff1 [$i][""product""] = ""xyz""
	}

The problem I'm facing is that when I change anything in $diff2[$index][""product""], it ALSO changes $diff1[$index][""product""] (and vice versa).   I.E. when this finishes running, $diff2[$index][""product""] are all equal to ""xyz"" when $diff2's ""product"" should be either ""a"",""b"", or ""c"".


It looks like $diff1 and $diff2 are just pointers and they're pointing to the same place in memory. Is there any way to dereference the array in powershell?  This is incredibly frustrating...",,False,,t5_2qo1o,False,,,True,t3_ybsx4,http://www.reddit.com/r/PowerShell/comments/ybsx4/array_reference_hell/,
1344522878.0,2,self.PowerShell,xxv45,How to count computers in a child domain?,2,0,3,http://www.reddit.com/r/PowerShell/comments/xxv45/how_to_count_computers_in_a_child_domain/,"so I have this script that will count in a top level domain. How would I go about searching within a child domain?

    import-module activedirectory
    foreach ($ou in  Get-ADOrganizationalUnit  -filter * -SearchScope 1){
    $computers = (get-adcomputer -filter * -searchbase $ou.distinguishedname).count
    $ou | add-member -membertype noteproperty -name Computers -value $computers -force
    $ou | select name,computers
    }",,False,,t5_2qo1o,False,,,True,t3_xxv45,http://www.reddit.com/r/PowerShell/comments/xxv45/how_to_count_computers_in_a_child_domain/,
1343839306.0,2,self.PowerShell,xigyi,Heartache with Server 2003 and Active Directory,4,2,11,http://www.reddit.com/r/PowerShell/comments/xigyi/heartache_with_server_2003_and_active_directory/,"I've spent weeks working and testing a PowerShell script I created to work with our Admin computers side is.  It works great and accomplishes what I need it to do.  Today I went to test it on our student side only to discover that there are no Active Directory cmdlets?!  This as much of a let down as the series finale of LOST.  

From what I have read is that Active Directory cmdlets with Sever 2008 and not Server 2003.  Are there any easy workarounds for this?  Can I use Windows RSAT on a computer that is on our student domain to utilize AD cmdlets or will that not work because the AD is on Server 2003?

Thanks",,False,,t5_2qo1o,False,,,True,t3_xigyi,http://www.reddit.com/r/PowerShell/comments/xigyi/heartache_with_server_2003_and_active_directory/,
1343431828.0,2,self.PowerShell,x9v6h,"Total noob, seeking advice and help with AD thumbnail script.",3,1,1,http://www.reddit.com/r/PowerShell/comments/x9v6h/total_noob_seeking_advice_and_help_with_ad/,"    $user = Get-ADUser Topaz.Sparrow -Properties thumbnailphoto
    $user.thumbnailphoto | Set-Content c:\topazsparrow.jpg -Encoding byte

This is the basic foundation for what I'm trying to do. Essentially a lot of our AD thumbnail photo's are too large in file size (&gt;16kb) and we don't have a lot of the originals.

We need to grab the photo's for every user in AD and have them dumped into a folder. I can edit them easily in batches to reduce the file size from there.

What's the best way to tackle this?
",,False,,t5_2qo1o,False,,,True,t3_x9v6h,http://www.reddit.com/r/PowerShell/comments/x9v6h/total_noob_seeking_advice_and_help_with_ad/,
1342193179.0,1,social.technet.microsoft.com,wi3k3,How to get public folder path,4,3,0,http://www.reddit.com/r/PowerShell/comments/wi3k3/how_to_get_public_folder_path/,,,False,,t5_2qo1o,False,,,False,t3_wi3k3,http://social.technet.microsoft.com/Forums/da/exchangesvrdevelopment/thread/b39ed0bf-031b-4c93-ba16-b0b00c9c9fd1,
1341535272.0,2,self.PowerShell,w3rxk,Reading content of a table in MS Word. But the order is messed up. Help please!,2,0,4,http://www.reddit.com/r/PowerShell/comments/w3rxk/reading_content_of_a_table_in_ms_word_but_the/,"Below is the code:


    
    $objWord = New-Object -Com Word.Application
    
    $filename = 'C:\Chicago_NewUser.doc'
    $objDocument = $objWord.Documents.Open($filename)
    
    $LETable = $objDocument.Tables.Item(1)
    $LETableCols = $LETable.Columns.Count
    $LETableRows = $LETable.Rows.Count
    
    
    Write-output ""Starting to write... ""
    
    for($r=0; $r -le $LETableRows; $r++) {
        for($c=0; $c -le $LETableCols; $c++) {
            Write-host $r ""x"" $c
            $content = $LETable.Cell($r,$c).Range.Text
            Write-host $content
        }
    }
    $objDocument.Close()
    $objWord.Quit()
    

The document is a 2003 Word document with a table - 2 cols and 3 rows. But the output as printed starts with the text in the 3rd row and 1st column. Am I doing something really stupid. I am an absolute newbie. Any help will be much appreciated.

The word document is available here: https://docs.google.com/document/d/1W0usG4ASsvd3PqQ20l7P8rq0hWBsYlrI0iM1S5ZcumU/edit",,False,,t5_2qo1o,1341540788.0,,,True,t3_w3rxk,http://www.reddit.com/r/PowerShell/comments/w3rxk/reading_content_of_a_table_in_ms_word_but_the/,
1341348673.0,2,self.PowerShell,vzx9h,Displaying multiple string values in a CSV,3,1,4,http://www.reddit.com/r/PowerShell/comments/vzx9h/displaying_multiple_string_values_in_a_csv/,"So I'm trying to query AD to find all users that do not have an Email Address Policy being applied and what their Proxy Addresses are.  But I need just the SMTP values.  Do not need the x400 &amp; x500 addresses.

PS C:\Windows&gt; Get-QADUser -SizeLimit 0 | where {$_.EmailAddressPolicyEnabled -eq $false -and $_.PrimarySMTPAddress -ne $null} | select Name,Description,Account
isDisabled,AccountisExpired,PasswordisExpired,PrimarySMTPAddress,lastlogontimestamp | Export-Csv C:\test\policy.csv
The above will give me a list of the users.  But I would like a list of the users and all the ProxyAddresses.

Now I know I can do:
(get-qaduser boots).ProxyAddresses | select-string -NotMatch x400,x500

But how do I do all this to all users found in the first line?  This is Exchange 2003 if that helps at all.

I appreciate your help.  Thanks :D",,False,,t5_2qo1o,False,,,True,t3_vzx9h,http://www.reddit.com/r/PowerShell/comments/vzx9h/displaying_multiple_string_values_in_a_csv/,
1341280686.0,2,self.PowerShell,vygbq,Manage SharePoint without snap-in?,3,1,3,http://www.reddit.com/r/PowerShell/comments/vygbq/manage_sharepoint_without_snapin/,"I work for a massive corporation.  We recently stood up a huge SharePoint instance that is being managed by its own group on behalf of the rest of the company.

For my team, I'm able to have a site and manage it, however I do not h e server access or central administration access.  As such, I have no way of loading the SharePoint add-in.

Are there other means that I can use in order to administer my SharePoint site with PowerShell?

I'd like to manage group and user permissions, cross-reference lists with non-SharePoint network shares, and other similar list/user type things.

Thanks!",,False,,t5_2qo1o,False,,,True,t3_vygbq,http://www.reddit.com/r/PowerShell/comments/vygbq/manage_sharepoint_without_snapin/,
1341247219.0,2,self.PowerShell,vxhx2,Why doesn't 'command | more' work in the ISE?,4,2,3,http://www.reddit.com/r/PowerShell/comments/vxhx2/why_doesnt_command_more_work_in_the_ise/,"Picked up the pre-order of 'Learn Windows PowerShell in a Month of Lunches 2nd Edition' and playing with the ISE for the first time.  Found this little caveat in here:

&gt;NOTE The More command won’t work in the ISE, so even if you use Help or Man, the help content will display all at once rather than a page at a time.

Using my Google-Fu, I found these:
http://thepursuitofalife.com/powershell-2-0-more-command-in-the-ise/
http://stackoverflow.com/questions/1078920/equivalent-of-more-command-in-powershell#comment8994471_1083771

Which show the 'command | out-host -paging' doesn't work in the ISE either.

Nor does the 'less' command in the PowerShell Community Extensions, listed here:
http://stackoverflow.com/questions/1078920/equivalent-of-more-command-in-powershell/1080103#1080103

So, in the ISE, how does one get the 'more' functionality?  What did they DO to the ISE to break such an important function?",,False,,t5_2qo1o,False,,,True,t3_vxhx2,http://www.reddit.com/r/PowerShell/comments/vxhx2/why_doesnt_command_more_work_in_the_ise/,
1340918451.0,2,self.PowerShell,vrfi7,Locate Folders and copy Items from location,2,0,2,http://www.reddit.com/r/PowerShell/comments/vrfi7/locate_folders_and_copy_items_from_location/,"#-Here is what I am trying to do
#-run a gci on a unc path search for a specific folder name
#-copy files out of those specific filtered folder names
#-robocopy to a location 

#-Here is my code i am working with.

*gci -re ""\\source\"" -Filter ""*Folder Name*"" | ForEach-Object {robocopy /mir ""\\source\$_"" *.pdf Z:\dest\}*

#-The problem is i need it to copy the full folder path because some of the PDF file names are the same.

#-TIA",,False,,t5_2qo1o,False,,,True,t3_vrfi7,http://www.reddit.com/r/PowerShell/comments/vrfi7/locate_folders_and_copy_items_from_location/,
1340797190.0,2,self.PowerShell,voifw,"Web page (or windows form) examples for GUI input, with validation.",3,1,4,http://www.reddit.com/r/PowerShell/comments/voifw/web_page_or_windows_form_examples_for_gui_input/,"Does anyone have any powershell script examples where (ideally) a web page or alternatively a windows form is launched as a GUI for data input. Where the field data is then extracted as variables in the remainder of the script.

I currently have a number of scripts that invoke a csv file, pauses for the user to add data (like a username, location, phone number etc), then takes that data to use as variables in the main body of the script (eg creating a new user in AD). I'm looking for examples where I can substitute a web page for the csv file?  

Secondly, in my current scripts I have some verification logic where if a field is blank for example I do something like $a = read-host ""you must enter data in field x"". So also looking for examples where this can be applied in the web form.",,False,,t5_2qo1o,False,,,True,t3_voifw,http://www.reddit.com/r/PowerShell/comments/voifw/web_page_or_windows_form_examples_for_gui_input/,
1340710075.0,2,self.PowerShell,vmhu4,Hyper-V Snapshot Scripting Question.,2,0,8,http://www.reddit.com/r/PowerShell/comments/vmhu4/hyperv_snapshot_scripting_question/,"Ok, so I have been investigating scripting for getting our snapshots automatically taken with the old checkpoints being removed:

    # Load the VMM CmdLets
    Add-PSSnapIn Microsoft.SystemCenter.VirtualMachineManager

    # Create a new snapshot for all VMs on VMM001
    $VMMServer = ""VMM001""
    Get-VM -VMMServer $VMMServer | New-VMCheckpoint

    # Remove all checkpoints that are older than 14 days
    Get-VMCheckpoint | ForEach-Object {
	    if ($_.AddedTime -lt (Get-Date).AddDays(-14)) {
	    	Remove-VMCheckpoint -VMCheckpoint $_
	    }
    }

Turns out that this only works if you are using Microsoft System Centre with the relevant add-ins (which we do not have). The other option is to use the following: 


    $VMManagementService = Get-WmiObject -ComputerName ""&lt;HyperVHostName&gt;"" -Namespace root\virtualization -Class Msvm_VirtualSystemManagementService 
    $SourceVm = Get-WmiObject -ComputerName ""&lt;HyperVHostName&gt;"" -Namespace root\virtualization -Query ""Select * From Msvm_ComputerSystem Where ElementName='VmToSnapshot'"" 
    $result = $VMManagementService.CreateVirtualSystemSnapshot($SourceVm) 

This doesn't work as the Virtualization namespace does not exist on the machine that I want to run the script from (and the CreateVirtualSystemSnapshot method also). It only exists on machines where HyperV is installed, and can only be installed on Server 2008. I cannot run from the Hyper-V host as it is a ""bare metal"" install, so that's a no go (although ultimately I can add it to the scheduled tasks roster on this box, if need be). 

Is there a way of using a remote machine's namespace and methods? If not, what might be a potential solution? I'm a bit of a PS newbie, so apologies if any of this is unclear or has a glaringly obvious solution.

Thanks",,False,,t5_2qo1o,False,,,True,t3_vmhu4,http://www.reddit.com/r/PowerShell/comments/vmhu4/hyperv_snapshot_scripting_question/,
1340653203.0,2,self.PowerShell,vl5rw,GCI / Move-Item help??,2,0,5,http://www.reddit.com/r/PowerShell/comments/vl5rw/gci_moveitem_help/,"    $Files = GCI C:\Staging | Where-object {$_.name -ne ""Image.tif""}
    Move-item $Files C:\staging\Move

I'm trying to write a script to move files to a network directory after they're scanned locally, and this is what I had planned out but it isn't working.  I keep getting the error that Move-Item cannot find the path C:\Staging\%Filename%....

Any advice on what I need to add in or take out?

Thanks!

EDIT: Final version of the script that is working:

    $filepath = ""Original path""
    $filedest = ""Destination path""
    $exclude = ""ExclusionName""
    CD $filepath
    $Files = GCI -path $filepath | Where-object {$_.name -ne $exclude} 
    foreach ($file in $files){move-item -path $file -destination $filedest}",,False,,t5_2qo1o,1340677469.0,,,True,t3_vl5rw,http://www.reddit.com/r/PowerShell/comments/vl5rw/gci_moveitem_help/,
1340388058.0,2,self.PowerShell,vg1ux,Check patch applicability,2,0,2,http://www.reddit.com/r/PowerShell/comments/vg1ux/check_patch_applicability/,"Here is a little about my environment.  We do testing for several different network setups.  Each environment is a separate domain with their own WSUS server. We have a main WSUS server that can talk to each of the child WSUS servers.  There is no inter-connectivity between domains.  Patch approval comes from another entity, and we have no access to them, other than the approved list they send out.  They also control the upstream WSUS server to our main WSUS server.

What I have configured so far:
Scan each server in all domains for their currently installed patches.
Compared this output to the approved patch list, sorted what patches are not installed.

What I need: 
Is there a way to find out if a certain patch is applicable to a certain system.  

For example:  Patch KB20123 is approved.  I have SERVER1, SERVER2, and SERVER3.  I run what I have and find that KB20123 is not installed on SERVER3.  Is there a way to check if KB20123 is applicable to SERVER3.  

I have looked in POSHwsus, but I didn't really see anything that matched what I wanted to do.  I'm not opposed to using another method, I just need to be able to automate whatever method is used.  In the end, we will be scanning 16-20 domains with 20-40 servers each.

Any help would be greatly appreciated.",,False,,t5_2qo1o,False,,,True,t3_vg1ux,http://www.reddit.com/r/PowerShell/comments/vg1ux/check_patch_applicability/,
1340384072.0,2,self.PowerShell,vfxuo,Remove all text after string?,2,0,5,http://www.reddit.com/r/PowerShell/comments/vfxuo/remove_all_text_after_string/,"I am doing a lot of manipulating of several files that import into our system. Within the files there are markers which tell it to start task 3, 4, etc. The system generates these files with some unneeded tasks. What would be the best way to remove ALL text after (including) the line: [Task.9]

It could be blank after that point or it may consist of about 200 lines of comma separated tasks. I want to remove it all, starting with [Task.9]. Any ideas? Thanks! 

EDIT: Forgot to mention, the text following the task will always be different, however the task will always be [Task.9]. ",,False,,t5_2qo1o,False,,,True,t3_vfxuo,http://www.reddit.com/r/PowerShell/comments/vfxuo/remove_all_text_after_string/,
1339776810.0,2,self.PowerShell,v3lou,Powershell export xlsm,4,2,4,http://www.reddit.com/r/PowerShell/comments/v3lou/powershell_export_xlsm/,"Is there a way to do this? I can export as xlsx just fine..

    $wb.SaveAs(""test.xlsm"")

Doesn't seem to work, gives 


     Exception calling ""SaveAs"" with ""1"" argument(s): ""This extension can not be used with the selected file type. Change the file extension in the File name text box or select a different file type by changing the Save as type.""


Edit: I will be opening a xlsm in the future as well, it looks like a simple

     $wb = $app.Workbooks.Open(""Test.xlsm"")

will do the trick?",,False,,t5_2qo1o,1339777293.0,,,True,t3_v3lou,http://www.reddit.com/r/PowerShell/comments/v3lou/powershell_export_xlsm/,
1339526749.0,2,self.PowerShell,uyd8r,adding data to an array one cell at a time.,2,0,5,http://www.reddit.com/r/PowerShell/comments/uyd8r/adding_data_to_an_array_one_cell_at_a_time/,"Is there any way to add data to a multidimentional array one cell at a time? I have a script that parses a text file line by line and each element is on a different line. Every guide I have looked at suggests I should go one row at a time but in this case I can't. 

Thanks in advance.",,False,,t5_2qo1o,False,,,True,t3_uyd8r,http://www.reddit.com/r/PowerShell/comments/uyd8r/adding_data_to_an_array_one_cell_at_a_time/,
1337951061.0,2,self.PowerShell,u4eh9,Adding day to date if it does not equal X or is Blank?,3,1,2,http://www.reddit.com/r/PowerShell/comments/u4eh9/adding_day_to_date_if_it_does_not_equal_x_or_is/,"So totally new to PS Scripting, i'm working to enhance one that's currently in use in the office.  

Right now, the script pulls info from a .csv file and sets a variable based on that info.  Here's the pertinent snippits:

      $expire = $_.ExpirationDate		# in format m/dd/yyyy
And later in the script:

      	## set the expiration date
        Write-Host $date
        $expirationDate = [datetime] $expire
        $newuser.psbase.InvokeSet('AccountExpirationDate', $expirationDate)
        $newuser.psbase.CommitChanges()

What I'm trying to accomplish is for the $expirationDate variable to be set based off of the following criteria:

IF 12/31/9999 - $expirationDate should end up being 12/31/9999
IF blank - $exiprationDate should be blank (ends up calling itself out elsewhere)
IF any other date - $expirationDate should be ""date + 1 day""

I can't seem to figure out where or how to set that.  ",,False,,t5_2qo1o,False,,,True,t3_u4eh9,http://www.reddit.com/r/PowerShell/comments/u4eh9/adding_day_to_date_if_it_does_not_equal_x_or_is/,
1337870200.0,2,self.PowerShell,u2sm1,help converting share permissions to ntfs,4,2,8,http://www.reddit.com/r/PowerShell/comments/u2sm1/help_converting_share_permissions_to_ntfs/,We are currently moving the way users access there home drives to dfs and the ntfs permissions give everybody full control.  The share permissions are the way that we want them.  I was wondering if there was an easy way to do this with powershell?  Thanks for any help.,,False,,t5_2qo1o,False,,,True,t3_u2sm1,http://www.reddit.com/r/PowerShell/comments/u2sm1/help_converting_share_permissions_to_ntfs/,
1337243639.0,2,self.PowerShell,tre3c,Help with bulk email from a csv file,2,0,1,http://www.reddit.com/r/PowerShell/comments/tre3c/help_with_bulk_email_from_a_csv_file/,"Hi Guys, total powershell newb here, but thought you might be able to help. Basically our email system was down yesterday for 4 hours and all the mail in that time was lost, I however was able to get a list of the mail  that was deleted and it has  SENT TO   SUBJECT   FROM

So my problem is I need to send out a mail to each user containing the from and subject fields, Is their a way powershell can help with this?  


thanks for any advice ",,False,,t5_2qo1o,False,,,True,t3_tre3c,http://www.reddit.com/r/PowerShell/comments/tre3c/help_with_bulk_email_from_a_csv_file/,
1336977951.0,2,self.PowerShell,tm4ov,Schoolwork Help (Scanning Files for Changes),2,0,1,http://www.reddit.com/r/PowerShell/comments/tm4ov/schoolwork_help_scanning_files_for_changes/,"So I'm currently taking a Powershell course that has been fairly easy until now. I'm working on multiple lessons but am having trouble with just this particular one.

This script should do the following: 

1.Create a new Windows log called Activity13_1 and assign a provider

2.Create a new file named ""c:\temp\mytarget.txt""

3.Add a few lines of text to it

4.Assign the value ""NO"" to a variable called $trigger

5.Assign an empty string to a variable called $old_len

6.Assign an empty string to a variable called $old_writetime

7.Create a while loop that will loop until $trigger is equal to ""YES""

8.Write a log entry stating that your script is starting up

9.Inside of the loop:
Check to see if the file exists; if it does not, write a log entry to your new log stating that the script is terminating with error, set $trigger equal to ""YES"", and then continue the loop
Get file information for your file using Get-ChildItem
If $old_len and $old_writetime are empty strings, set your variables equal to the Lengh and LastWriteTime properties from your object and then continue the loop
Assign the Length of your object to a new variable called $curr_len
Assign the LastWriteTime of your object to a new variable called $curr_writetime
Compare the old and current variables:
If both sets of variables are equal, then sleep the script for 5 seconds and then continue the loop
If the length variables are different, write a log entry describing your findings, sleep the script for 3 seconds and then continue the loop
If the writetime variables are different, write a log entry describing your findings, sleep the script for 3 seconds and then continue the loop

As you can see this is some real basic stuff. So far all I have is

New-EventLog -logname Activity13_1 -Source test2

write-host

New-Item  -itemType  directory  “c:\temp\""
New-item -itemtype file ""c:\temp\mytarget.txt""

$file= test-path ""c:\temp\mytarget.txt""

$trigger= ""NO""

$old_len= $null

$old_writetime= $null
 
write-host 'Script is starting...'

while ($trigger -ne ""YES"")

{
    
if($file-eq""FALSE"")
    
Write-EventLog Activity13_1 –message “Not Found”  –source test2 -id  0001
    
$trigger= ""YES""
    
{continue}

}    

And to be honest I'm not even sure this is correct. Any help would be greatly appreciated!",,False,,t5_2qo1o,False,,,True,t3_tm4ov,http://www.reddit.com/r/PowerShell/comments/tm4ov/schoolwork_help_scanning_files_for_changes/,
1336488477.0,2,self.PowerShell,tczh3,pager with backward navigation?,2,0,5,http://www.reddit.com/r/PowerShell/comments/tczh3/pager_with_backward_navigation/,"Is there a pager with backward navigation feature that I can use with Powershell? I was reading through

    man get-wmiobject -examples

and wished Shift+Space would be for going one page backward.
",,False,,t5_2qo1o,False,,,True,t3_tczh3,http://www.reddit.com/r/PowerShell/comments/tczh3/pager_with_backward_navigation/,
1336000974.0,2,self.PowerShell,t4544,"Help with Get-AdUser filter, token assignment attribute?",3,1,4,http://www.reddit.com/r/PowerShell/comments/t4544/help_with_getaduser_filter_token_assignment/,"I'm attempting to get a list of users who have Vasco tokens assigned, but I'm not sure how to filter because of the format.

The attribute ""vasco-LinkUserToDPToken"" is formatted like this:
{CN=0012345678,OU=Users,OU=Blah,O=FOO}

Here's the code I am using:

    Get-ADUser -Filter {(samAccountName -like ""*"") -and (vasco-LinkUserToDPToken -like ""{CN*"")} -Properties vasco-LinkUserToDPToken,vasco-CreateTime,vasco-Disabled,vasco-Locked,vasco-ModifyTime | format-table -property Name,vasco-LinkUserToDPToken,vasco-CreateTime,vasco-Disabled,vasco-Locked,vasco-ModifyTime

I've tried accessing ""vasco-LinkUserToDPToken.CN"", assuming maybe this was being read that way, but no luck. Any suggestions? Thanks!",,False,,t5_2qo1o,False,,,True,t3_t4544,http://www.reddit.com/r/PowerShell/comments/t4544/help_with_getaduser_filter_token_assignment/,
1335864997.0,2,adicodes.com,t1blp,Deploying WSP with Powershell,6,4,0,http://www.reddit.com/r/PowerShell/comments/t1blp/deploying_wsp_with_powershell/,,,False,,t5_2qo1o,False,,,False,t3_t1blp,http://adicodes.com/deploying-wsp-with-powershell/,
1335819656.0,2,self.PowerShell,t0coj,Anybody know how to run a MySql Update in powershell?,3,1,3,http://www.reddit.com/r/PowerShell/comments/t0coj/anybody_know_how_to_run_a_mysql_update_in/,"Here's what I have so far:

    #open database connection to MySQL Server
	[system.reflection.assembly]::LoadWithPartialName(""MySql.Data"")
	$cn = New-Object -TypeName MySql.Data.MySqlClient.MySqlConnection
	$cn.ConnectionString = ""SERVER=localhost;DATABASE=test;UID=root;PWD=password"" 
	$cn.Open()
	
	#define query
	$query = ""UPDATE table1 SET Column1='$Variable1' WHERE Column2='$Variable2'""
		
	#create sql command for select
	$cmd = New-Object -TypeName MySql.Data.MySqlClient.MySqlCommand
	$cmd.connection = $cn
	$cmd.commandtext = $query
    $cmd.executereader()

	#close database connection to MySQL Server 
	$cn.close

This will run without any errors but the values in the table don't change. I've also noticed that an Insert or Replace query work perfectly but not an Update query :-/ ",,False,,t5_2qo1o,False,,,True,t3_t0coj,http://www.reddit.com/r/PowerShell/comments/t0coj/anybody_know_how_to_run_a_mysql_update_in/,
1335033477.0,2,self.PowerShell,sljvm,"Very new but need guidance, simple script.",3,1,19,http://www.reddit.com/r/PowerShell/comments/sljvm/very_new_but_need_guidance_simple_script/,"Hey /r/powershell, hope you guys are good.

I'm trying to create something pretty simple here and have very limited knowledge of Windows and scripting in general, hopefully you can help.

What I want is a program a person can click on the desktop and enter in their set of credentials. The input here would go to an environmental variable value.

One input would be for one environmental variables value.
The second input would be for a second environmental variables value.

This is what I saw in PowerShell that I think would work, I just need to know how to make it into a file someone can click and paste in their input when prompted.

[Environment]::SetEnvironmentVariable(""TestVariable"", ""Test value."", ""User"")",,False,,t5_2qo1o,False,,,True,t3_sljvm,http://www.reddit.com/r/PowerShell/comments/sljvm/very_new_but_need_guidance_simple_script/,
1334159611.0,2,self.PowerShell,s4hb5,Pulling multiple values for the same export (1000+ times),5,3,6,http://www.reddit.com/r/PowerShell/comments/s4hb5/pulling_multiple_values_for_the_same_export_1000/,"I'm working on a script to go out and replace windows hosts files on about 1000 machines. It's still a work in progress as I am currently trying to figure out the best way to do this. I am not sure if my current route will work. The line to populate the contents of the hosts file before it distributes it is as follows:

$Names = gc C:\temp\TempHosts\register_name.txt
$Storeno = gc C:\temp\TempHosts\store_no.txt
$Address = gc C:\temp\TempHosts\addresses.txt

[Just en example, I know I'll have to create a new file for each entry going forward]
foreach ($Name in $Names) { 
Add-Content C:\temp\TempHosts\hosts_temp ""127.0.0.1       localhost `r
10.0.$Storeno.1		$Name `r
10.12.13.90		APPSERVER2 `r
# DEV Reserved host name. `r
10.0.$Address.2	devmgr	DEVMGR`r""

}

I am having multiple problems with this on account of not knowing what I am doing, honestly. First off, it is pulling all stores each time I reference $Storeno so that it looks like this:

10.0.1 2 3 4.195		name1 
10.12.13.90		APPSERVER2 `r

10.0.1 2 3 4.195		name2 
10.12.13.90		APPSERVER2 `r

Rather than each line:

10.0.1.195		name1 
10.12.13.90		APPSERVER2 `r

10.0.2.195		name1 
10.12.13.90		APPSERVER2 `r

How do I go about forcing it to do an additional ""foreach"" so that it only pulls the 1 store # rather than the whole list?

Secondly, how is there a way to PS pull a row of information rather than multiple files? I I need to make sure that when it loops through the first set and comes back to the second, it doesn't start at the beginning of the file again. For example, the files would look like this:

Stores.txt
1
2
3

Names.txt
Name1
Name2
Name3

When it performs the loop, how do I make sure it doesn't do this:
1 Name1
2 Name1
3 Name1

Rather than:
1 Name1
2 Name2
3 Name3

Hopefully that all makes sense..... I feel like I wrote a novel. Thanks in advance for any help on this one.

**EDIT:** Sorry, the formatting here is all screwed up... ",,False,,t5_2qo1o,False,,,True,t3_s4hb5,http://www.reddit.com/r/PowerShell/comments/s4hb5/pulling_multiple_values_for_the_same_export_1000/,
1334118927.0,2,csharpening.net,s3ugd,PowerGUI VSX 1.6 Alpha – Visual Studio 2011 Support,2,0,3,http://www.reddit.com/r/PowerShell/comments/s3ugd/powergui_vsx_16_alpha_visual_studio_2011_support/,,,False,,t5_2qo1o,False,,,False,t3_s3ugd,http://csharpening.net/?p=1097,
1333656746.0,2,self.PowerShell,rv5ay,Question about objects,3,1,5,http://www.reddit.com/r/PowerShell/comments/rv5ay/question_about_objects/,"OK, this might turn out to be a long winded post, but here it goes.

OK, so I have an object, actually an object that contains 3 other objects, one to hold errors, one to hold warnings and one to hold information.  I pass this in and out of functions and everything works just fine until I call dsmod.  Now before you get on me for using dsmod, I am fairly sure I have to use it to set home directories in this environment.  I have beat my head against the wall using new-aduser/set-aduser, they will both fill in the information to AD but it does not apply to the user accounts when they login..  

So anyways back to my object,  when I am in the AD account creation part of the script I can step through it all the way to the end of the function and my object is my object, but the minute it is returned from the function my object contains the output of dsmod and then my object is in postion [1].  I am getting around this right now by doing $myobj = $myobj | where {$_ -notmatch ""dsmod""} but it is real hacky and I would like to figure out what I am doing wrong/not understanding.

So can anyone enlighten me or point me to some good resources to figure out wtf I am doing?

General flow

     $myobj = new-object system.object
     $errors = new-object system.object
     $warnings = new-object system.object
     $info = new-object system.object
     $myobj | add-member -type noteproperty -name ""Errors"" -value $errors
     ....
     ....

I create this custom object in a function to keep my main function clean so in my main function I call it like 

       $mainobj = create-customobj

Then I pass it in and out of functions like so 

      $mainobj = create-aduser -object $mainobj


Inside the function I use the information portion and add warnings/errors/information and then 
     
     return $Obj  

Back to the main function.
So everything works as expected in the scope of create-aduser, but once I put it back in $mainobj I now have 2 objects:  

     $mainobj[0] - Dsmod output  

     $mainobj[1] - Expected object..",,False,,t5_2qo1o,True,,,True,t3_rv5ay,http://www.reddit.com/r/PowerShell/comments/rv5ay/question_about_objects/,
1333476768.0,2,self.PowerShell,rri7x,Update ad attributes from erp feed very slow..   looking for alternative ideas,3,1,4,http://www.reddit.com/r/PowerShell/comments/rri7x/update_ad_attributes_from_erp_feed_very_slow/,"So I am writing a process that will update a number of ad attributes with data from our erp system.   I wrote a process that reads the files
in and updates the attributes as expected,   but I have found that it is extremely slow.    The process that I am using is..

-Read provided file {from erp}  
-Load info for each user into a hashtable  
-  -&gt;shoot attribute to a  function {below} that reads current attribute &amp; compares to new erp value.  If different update, if not leave alone   
-&gt; Wash rinse repeat for over 100,000 users...  about 15 attributes per.
-&gt; Logging/error checks /etc

I realize {now :) } how slow and inefficient this process is.   My biggest reason for writing it this way was for load and logging reasons.  Meaning,  each attribute is only written if there is an update.    This and if there is an error,   I would be able to see it was for a specific user/attribute.

So  assuming I scrap this methodology,   does anyone have any thoughts/suggestions on a better way to accomplish this task?   

----------------------
&lt;snip&gt;

Function Write-AdAttribute  
{  
 param ([string]$Username,[string]$attribute,[string]$attributeValue)  
[string]$strDelim= ""`t""  
 If (CheckUser $Username)  
 {  
	try  
	 {  
		 $Write_Attribute_User = Get-qADUser $Username -properties $attribute  
			 If ($Write_Attribute_User.$attribute -ne $attributeValue)   
			  {  
			   Set-QADUser $Username -objectAttribute @{$attribute=$attributeValue}  
			    
			   #Log code for success here  
			  }  
			  Else   
			  {  
			   #Log code for No write here  
			  }  
  
        } #end of try  
    Catch [System.Exception]   
     {  
        #Log code for No write here  
  
     } #end of catch  
 }	    
 Else   
 {  
  #Log code for user does not exist   
 }  #End of CheckUser  
} #End of WriteAdAttribute  

&lt;/snip&gt;",,False,,t5_2qo1o,False,,,True,t3_rri7x,http://www.reddit.com/r/PowerShell/comments/rri7x/update_ad_attributes_from_erp_feed_very_slow/,
1332551956.0,2,self.PowerShell,rau4d,script error handling question,2,0,1,http://www.reddit.com/r/PowerShell/comments/rau4d/script_error_handling_question/,"I am working on a script to update ad attributes and I was wondering how people handle errors above a certain count?   Specifically,  I have the script working and I catch individual errors {catch/try} and log accordingly.     What I am not sure about is if something goes really wrong...  I feel like I should put some sort of limit on the process.    ex..failure greater than 50 |script dies|send email|open trouble ticket?

How do you handle something of this sort?    ",,False,,t5_2qo1o,False,,,True,t3_rau4d,http://www.reddit.com/r/PowerShell/comments/rau4d/script_error_handling_question/,
1332201531.0,2,self.PowerShell,r49dc,Powershell help for a noob,2,0,2,http://www.reddit.com/r/PowerShell/comments/r49dc/powershell_help_for_a_noob/,"Hey everybody,

I'm having trouble beginning a powershell script. Here's my problem I'm trying to solve via the script:

I have an old piece of software with bad file association. If I click on a file, it only opens the software without referencing the file which opened the software. My goal:

* Associate the file extension to the script
* Have the script pull the referenced file location
* Modify the registry with this new file location (for the software to open to)
* Open the original application

Would something like this work? I'm only trying to fix the file association here to actually open the file within the application and not have to manually complete this action.

Thanks for the help!
",,False,,t5_2qo1o,False,,,True,t3_r49dc,http://www.reddit.com/r/PowerShell/comments/r49dc/powershell_help_for_a_noob/,
1331430337.0,2,self.PowerShell,qqzl7,Is there a way to change attributes when using add-computer to join a domain?,2,0,3,http://www.reddit.com/r/PowerShell/comments/qqzl7/is_there_a_way_to_change_attributes_when_using/,"Our domain is foo.bar.com we have added an addition to the suffix to the DNS name to specify site. So pcs are pcname123.site1.foo.bar.com

When joining a machine via GUI the machine joins correctly and is listed in AD as pcname123.site1.foo.bar.com.

When I use
    Add-Computer -domainname foo.bar.com -credentials foo\domainadmin

The machine initially appears correctly but once the machine reboots the DnsHostName record changes to pcname123.foo.bar.com.

This results in users not being able to login until the attribute is changed via gui or set-qadcomputer.

I am trying to understand what is causing the record to change. And why it only happens on a command line join. Any help would be greatly appreciated.",,False,,t5_2qo1o,False,,,True,t3_qqzl7,http://www.reddit.com/r/PowerShell/comments/qqzl7/is_there_a_way_to_change_attributes_when_using/,
1330176562.0,2,self.PowerShell,q5eye,powershell outto-html question,2,0,7,http://www.reddit.com/r/PowerShell/comments/q5eye/powershell_outtohtml_question/,"
I am working on a few scripts and need to output to the screen, file and to a formatted email
I have written several functions that do this and that and then I call each from the main body of 
the script.   

ex:

Function logstuff{  
   #writetohost  
   #writetofile  
}  

Function DoSomeStuff {  
 Try {  
        Do some stuff....     
        Logstuff Success!""  
      }  
 Catch{  
       LogStuff Errors  
         }  

} #end of do some stuff   

     

 What I forgot was the content for the email.   I would like to output general formatted results for the email instead of the detailed results in the logs.   Most likely will end up being pumped through outo-html...but kind of looking for a few ideas on how to handle this.
",,False,,t5_2qo1o,True,,,True,t3_q5eye,http://www.reddit.com/r/PowerShell/comments/q5eye/powershell_outtohtml_question/,
1328546576.0,2,self.PowerShell,pdbh1,Move-Item/Join-Path Question,2,0,4,http://www.reddit.com/r/PowerShell/comments/pdbh1/moveitemjoinpath_question/,"So I am trying to create a simple function that will take a given file,   datestamp the file name and then 
move it to another directory.     I am sure that I am missing something obvious,   but I keep getting an error
on file move and can't place why.  Specifically,  I can see that @{Name is shown.    My understanding was
a Join-path before hand should take care of this,   but obviously not.

&lt;snip&gt;
$TimeStamp = (Get-Date -format  M.d.yyyy-hh.mm.ss-).ToString()    
$currentfile = Get-ChildItem -path $originalFile |select name  
$NewFileName = $TimeStamp + $currentfile.name.Tostring()   
$NewFileName = Join-Path $fileDestination $NewFileName  

$write-host $currentFile	      
$write-host $newFileName  

Move-Item $currentfile $NewFileName  

&lt;/snip&gt;  

Returns: 

test.test  
c:\destdir\2.6.2012-11.37.53-test.test  
Move-Item : Cannot find path 'c:\destdir\@{Name=test.test}' because it does not exist.  
  

Any thoughts for insights would be appreciated.",,False,,t5_2qo1o,False,,,True,t3_pdbh1,http://www.reddit.com/r/PowerShell/comments/pdbh1/moveitemjoinpath_question/,
1328264055.0,2,braintostring.blogspot.com,p93q6,Simplify development with Powershell (part 2) - init local github repo,3,1,0,http://www.reddit.com/r/PowerShell/comments/p93q6/simplify_development_with_powershell_part_2_init/,,,False,,t5_2qo1o,False,,,False,t3_p93q6,http://braintostring.blogspot.com/2012/02/simplify-development-with-powershell.html,
1328259065.0,2,self.PowerShell,p920u,Script to get all user account who have logged onto a server in the last 30 days,3,1,6,http://www.reddit.com/r/PowerShell/comments/p920u/script_to_get_all_user_account_who_have_logged/,"Any ideas where to start on this?

Thanks",,False,,t5_2qo1o,False,,,True,t3_p920u,http://www.reddit.com/r/PowerShell/comments/p920u/script_to_get_all_user_account_who_have_logged/,
1328107958.0,2,psget.net,p65kx,PSGet a tool for installing Modules from the cmd line. ,6,4,0,http://www.reddit.com/r/PowerShell/comments/p65kx/psget_a_tool_for_installing_modules_from_the_cmd/,,,False,,t5_2qo1o,False,,,False,t3_p65kx,http://psget.net/,
1327594537.0,2,self.PowerShell,oxpd0,Fun with Invoke-RestMethod (help!),2,0,2,http://www.reddit.com/r/PowerShell/comments/oxpd0/fun_with_invokerestmethod_help/,"Hey All,

  So I'm still playing with RestMethod and JSON to manipulate and do neat things to RSS feeds.  I've got this .rss (http://www.bodyrock.tv/feed/) which is full of workout videos.  I want to extract from the feed all of the Youtube Links, which I will then dump into a text file to use with my Youtube Downloader app, so I'm trying something like this:

    $rss=Invoke-RestMethod http://www.bodyrock.tv/feed/
    $rss | Get-Member

    PS ...\My Code\Powershell&gt; $rss | Select Title,Link | Format-List -wide

title                                                                          link                                                                          
-----                                                                          ----                                                                          
Day 3 Week 4 of The 30 Day Challenge – What Doesn’t Kill You Workout           http://www.bodyrock.tv/2012/01/25/day-3-week-4-of-the-30-day-challenge-what...
Day 2 Week 4 of the 30 Day Challenge – Strip The  Fear Workout                 http://www.bodyrock.tv/2012/01/24/day-2-week-4-of-the-30-day-challenge-stri...
Week 4 Day 1 of The 30 Challenge – RockStar Booty Workout                      http://www.bodyrock.tv/2012/01/23/weel-4-day-1-of-the-30-challenge-rockstar...
Day 5 Week 3 of The 30 Day Challenge – The Fast &amp; The Furious 800 Rep Workout! http://www.bodyrock.tv/2012/01/20/day-5-week-3-of-the-30-day-challenge-the-...
Day 4 Week 3 of The 30 Day Challenge – We Found Love Workout 2                 http://www.bodyrock.tv/2012/01/19/day-4-week-3-of-the-30-day-challenge-brea...

    $rss | ForEach-Object {
     invoke-restmethod $_.link | Select-String -Context ""http://www.youtube.com/v/*""}

To me, it seems like this should work, grabbing the youtube links from each post but...well, clearly I'm doing something wrong here.

Any ideas?

e: Derp! Changed -Context to -Pattern.  Now it is showing me the entire document!  Maybe I need to convert-fromHTML at some point here.",,False,,t5_2qo1o,True,,,True,t3_oxpd0,http://www.reddit.com/r/PowerShell/comments/oxpd0/fun_with_invokerestmethod_help/,
1324654454.0,2,self.PowerShell,nnzgd,Create and change primary SMTP Reply to Address (Exchange 2010),2,0,3,http://www.reddit.com/r/PowerShell/comments/nnzgd/create_and_change_primary_smtp_reply_to_address/,"So my Exchange guy left a few weeks ago and he was supposed to leave me a script to run against my Exchange 2010 environment. But, the break my dev environment and deletes the original address and adds in a new one that just follows the mail policies. So can anyone lend a hand in helping me out with a script that:

* Reads the current SMTP Reply Address
* Creates a new SMTP record with the original address but with the @domain.com replaced with a @domain2.com
* If the new address already existed it should not throw an error
* Once the new address exists set it to be the default reply to address.

Thanks in advance to anyone that helps. I really appreciate it and read some powershell books myself.",,False,,t5_2qo1o,False,,,True,t3_nnzgd,http://www.reddit.com/r/PowerShell/comments/nnzgd/create_and_change_primary_smtp_reply_to_address/,
1321021510.0,2,pastebin.com,m8oul,Powershell IMDB Search Function,4,2,1,http://www.reddit.com/r/PowerShell/comments/m8oul/powershell_imdb_search_function/,,,False,,t5_2qo1o,False,,,False,t3_m8oul,http://pastebin.com/0MHY27yQ,
1318346567.0,2,self.PowerShell,l8cki,Detect IDE transfer mode?,2,0,3,http://www.reddit.com/r/PowerShell/comments/l8cki/detect_ide_transfer_mode/,"Scripting journeyman; powershell novice here, just looking for the right place to find the local machine's IDE transfer mode.

I'm setting up a one-click fix to reset from PIO to DMA.  But rather than have users run it whenever they think the machine's ""slow"", I want to query the transfer mode and only fix it if it's in PIO.",,False,,t5_2qo1o,False,,,True,t3_l8cki,http://www.reddit.com/r/PowerShell/comments/l8cki/detect_ide_transfer_mode/,
1316136590.0,2,self.PowerShell,kh5n1,Strategy for centralizing maintenance scripts?,2,0,9,http://www.reddit.com/r/PowerShell/comments/kh5n1/strategy_for_centralizing_maintenance_scripts/,"Have a pretty small bunch of around 60 geographically-distributed servers that run SharePoint and Exchange, a mix of 2003, 2008, and 2008 R2. We're consolidating and cleaning up their maintenance scripts. Do you think it's more efficient to place them in one server and just remote everything? These scripts will be running maintenance tasks (log backups) and daily reports that send out an email with data pulled out of WMI. Servers have consistent file structures but the WAN can be a bit spotty.",,False,,t5_2qo1o,False,,,True,t3_kh5n1,http://www.reddit.com/r/PowerShell/comments/kh5n1/strategy_for_centralizing_maintenance_scripts/,
1315367467.0,2,gallery.technet.microsoft.com,k772i,Query time server of multiple computers,3,1,0,http://www.reddit.com/r/PowerShell/comments/k772i/query_time_server_of_multiple_computers/,,,False,,t5_2qo1o,False,,,False,t3_k772i,http://gallery.technet.microsoft.com/scriptcenter/Determine-a-computers-time-4b3063e2,
1315281203.0,2,gallery.technet.microsoft.com,k61uc,Get Windows 7/Server 2008R2 reliability information,2,0,0,http://www.reddit.com/r/PowerShell/comments/k61uc/get_windows_7server_2008r2_reliability_information/,,,False,,t5_2qo1o,False,,,False,t3_k61uc,http://gallery.technet.microsoft.com/scriptcenter/Get-reliability-info-cdf80852,
1314218019.0,2,self.PowerShell,jt8yx,Change Company of all users in an OU,2,0,8,http://www.reddit.com/r/PowerShell/comments/jt8yx/change_company_of_all_users_in_an_ou/,"This seems like it should be really easy, but I've been having a really hard time figuring it out - Say I have an OU called ""Company1"" and I want to change everyone in that OU's company detail in AD to a string (in this case also ""Company1,"" but it doesn't need to be dynamic, I only need to do this twice), how would I do that?

Thanks in advance - I've been fumbling through loop, LDAP queries, etc. for the past two hours without much progress.

Update: I'm not sure if this will matter, but they are actually mail contacts I added via exchange, and are not in the group domain users. That may be what's throwing off the scripts I've tried.",,False,,t5_2qo1o,True,,,True,t3_jt8yx,http://www.reddit.com/r/PowerShell/comments/jt8yx/change_company_of_all_users_in_an_ou/,
1308587002.0,2,self.PowerShell,i4fcy,Memory usage in Powershell?,2,0,3,http://www.reddit.com/r/PowerShell/comments/i4fcy/memory_usage_in_powershell/,"Any wizards know how to get an idea how much memory is being used by a given variable?

I sometimes end up with some pretty large structures, and wanted to get an idea of how useful certain kinds of trimming will actually be.  And as we all know, you never optimize without measuring =)  And if it takes 4 hours to full a structure up, I can only glean so much from the overall process usage delta.",,False,,t5_2qo1o,False,,,True,t3_i4fcy,http://www.reddit.com/r/PowerShell/comments/i4fcy/memory_usage_in_powershell/,
1306460057.0,2,self.PowerShell,hl56z,Multithreaded Logging with background jobs,2,0,11,http://www.reddit.com/r/PowerShell/comments/hl56z/multithreaded_logging_with_background_jobs/,I have 2 scripts. The main script opens a secondary script that has the work i want to do on each computer in the list.The main script runs the external script in 12 asynchronous background jobs and cycles through a list of computers till the secondary script has been run on all of them . I wanted to get a better idea of what was happening in each job so I put in some quick logging to a text file. I found that the jobs could not all write to the same text file. It kept saying the file was locked by the other job. What strategy would you guys use so that I could have one log file for all the jobs?,,False,,t5_2qo1o,False,,,True,t3_hl56z,http://www.reddit.com/r/PowerShell/comments/hl56z/multithreaded_logging_with_background_jobs/,
1284616967.0,2,self.PowerShell,deke1,rm -rf *,3,1,8,http://www.reddit.com/r/PowerShell/comments/deke1/rm_rf/,"What's the easiest way of doing this in powersell? I always get non empty directory problems....

ಠ_ಠ ",,False,,t5_2qo1o,False,,,True,t3_deke1,http://www.reddit.com/r/PowerShell/comments/deke1/rm_rf/,
1263493803.0,2,itexpertvoice.com,apnnz,Using PowerShell on Windows 7 (screencast),2,0,0,http://www.reddit.com/r/PowerShell/comments/apnnz/using_powershell_on_windows_7_screencast/,,,False,,t5_2qo1o,False,,,False,t3_apnnz,http://itexpertvoice.com/home/using-the-windows-7-powershell-scripting-environment/,
1251310222.0,2,simonhartcher.com,9eeg1,HOWTO: Query MSSQL And Send HTML Email Using Powershell,3,1,0,http://www.reddit.com/r/PowerShell/comments/9eeg1/howto_query_mssql_and_send_html_email_using/,,,False,,t5_2qo1o,False,,,False,t3_9eeg1,http://www.simonhartcher.com/?p=146,
1251309598.0,2,edge.technet.com,9eebp,Screencast:  Windows PowerShell introduction,2,0,0,http://www.reddit.com/r/PowerShell/comments/9eebp/screencast_windows_powershell_introduction/,,,False,,t5_2qo1o,False,,,False,t3_9eebp,http://edge.technet.com/Media/Screencast-Windows-PowerShell-introduction/,
1251273643.0,2,devcentral.f5.com,9e8he,Introducing PoshTweet - The PowerShell Twitter Script Library,5,3,0,http://www.reddit.com/r/PowerShell/comments/9e8he/introducing_poshtweet_the_powershell_twitter/,,,False,,t5_2qo1o,False,,,False,t3_9e8he,http://devcentral.f5.com/weblogs/Joe/archive/2008/12/30/introducing-poshtweet---the-powershell-twitter-script-library.aspx,
1229478549.0,2,blogs.msdn.com,7jyy9,Mike Wilbur's Blog : Powershell script that can schedule itself to run later,2,0,0,http://www.reddit.com/r/PowerShell/comments/7jyy9/mike_wilburs_blog_powershell_script_that_can/,,,False,,t5_2qo1o,False,,,False,t3_7jyy9,http://blogs.msdn.com/mwilbur/archive/2007/02/23/powershell-script-that-can-schedule-itself-to-run-later.aspx,
1376678432.0,1,self.PowerShell,1ki5ba,script executed from sql agent job only completing half.,1,0,2,http://www.reddit.com/r/PowerShell/comments/1ki5ba/script_executed_from_sql_agent_job_only/,"Ok. I'm out of ideas.

I have a script that grabs a list of sqlserver instances, then connects to each (foreach), executes a query and loads the results into a table.

Every time I execute the script through a sql agent job(via cmdexec) , it only queries against 2 of the 4 servers it should. 

Its run successfully from powershell, powershell ise, starting powershell through sql server, it even runs successfully if I run it through a standard command prompt.

Any ideas?",,False,,t5_2qo1o,False,,,True,t3_1ki5ba,http://www.reddit.com/r/PowerShell/comments/1ki5ba/script_executed_from_sql_agent_job_only/,
1376500652.0,0,self.PowerShell,1kcy67,"TIL: When creating a module, your functions can only use verbs from MS's 'approved' verb list",6,6,12,http://www.reddit.com/r/PowerShell/comments/1kcy67/til_when_creating_a_module_your_functions_can/,"&lt;Approved Verb&gt;-&lt;AnyNoun&gt; = Works

&lt;Random Verb&gt;-&lt;Any Noun&gt; = BROKE AS FUCK.

http://msdn.microsoft.com/en-us/library/windows/desktop/ms714428(v=vs.85).aspx

Check-UpdateStatus = NOPE

Get-UpdateStatus = Yep

",[Core],False,,t5_2qo1o,False,,,True,t3_1kcy67,http://www.reddit.com/r/PowerShell/comments/1kcy67/til_when_creating_a_module_your_functions_can/,
1376485847.0,1,self.PowerShell,1kcgce,"migrating from 1 terminal server to 2 new load balanced terminal servers. users demanding i move their ""favorites"" any way to script the move at logon?",1,0,12,http://www.reddit.com/r/PowerShell/comments/1kcgce/migrating_from_1_terminal_server_to_2_new_load/,,[Core],False,,t5_2qo1o,False,,,True,t3_1kcgce,http://www.reddit.com/r/PowerShell/comments/1kcgce/migrating_from_1_terminal_server_to_2_new_load/,
1376416410.0,1,self.PowerShell,1kaico,Function with auto-complete parameters help,1,0,3,http://www.reddit.com/r/PowerShell/comments/1kaico/function_with_autocomplete_parameters_help/,"I've been scripting with Powershell for about a year now, and I have no other programming experience so I'm fairly new to this.  Please be gentle.

Here's a snippet of a script I'm writing to restore data from a lagged database copy in Exchange 2010:

$roll = Read-Host ""Enter the number of days the database should be rolled back""
$db = Read-Host ""Type the database name""
$recoverypath = ""e:\rdb""
$date = Get-Date
$time = ($date.adddays(-$roll)).tostring(""dd/mm/yyyy"")
$server = hostname
[string]$prefix = @(Get-ChildItem c:\$db | ? {$_.name -like ""*.log""})[0]

if (!(Test-Path e:)) {
    Write-Host ""A separate drive/partition has not yet been created for the Recovery Database.  Create an E: partition and re-run this script."" -ForegroundColor red
    Exit
    }

if (!(Test-Path e:\RDB)) {
    New-Item -ItemType directory -Path e:\RDB -Force
    }

Suspend-MailboxDatabaseCopy ""$db\$server""
Get-ChildItem c:\$db | ? {$_.name -like ""*.log"" -or $_.name -like ""*.edb""} | % {Copy-Item $_ ""e:\rdb""}
Resume-MailboxDatabaseCopy $db\$server
Get-ChildItem $recoverypath | ? {$_.LastWriteTime -gt $time -and $_.name -like ""*.log""} | Remove-Item -Confirm:$true
eseutil /r $prefix.substring(0,3) /a /d $recoverypath /l $recoverypath

$state = eseutil /mh ""c:\$db\$db.edb""
if ($state[25] -like ""*dirty*"") {
    Write-Host ""The database is dirty"" -ForegroundColor red
    Exit
    }

What I would like to be able to do is get rid of the first two Read-Host variables ($roll and $db) and replace the user prompted input with parameters in a function (with the $db variable being required).  I've tried following the examples from a few Technet and Hey, Scripting Guy! articles with no luck so far.  Basically I want to open up this functionality:

PS C:\&gt; Restore-LaggedCopy.ps1 -Database DB01 -RestoreTimeframeInDays 5

Here are the articles I've referenced so far:

http://technet.microsoft.com/en-us/magazine/jj554301.aspx

http://blogs.technet.com/b/heyscriptingguy/archive/2013/04/11/named-arguments-for-powershell-functions-best-practices.aspx

Any advice for a noob?",,False,,t5_2qo1o,False,,,True,t3_1kaico,http://www.reddit.com/r/PowerShell/comments/1kaico/function_with_autocomplete_parameters_help/,
1376068276.0,1,self.PowerShell,1k1bfy,Issue passing sql database property through conditional statement,1,0,1,http://www.reddit.com/r/PowerShell/comments/1k1bfy/issue_passing_sql_database_property_through/,"A little stumped here. The first write-host writes out fine, but no full recovery databases are passing the conditional statement

    $InstanceObject = New-Object (’Microsoft.SqlServer.Management.Smo.Server’) -argumentlist $InstanceName
    
    # loop through all databases within this instance
    $InstanceObject.Databases | 
    foreach-object {
    
       # get database object into a variable
       $DatabaseObject = $_
       
       $DatabaseName = $DatabaseObject.Name
       $RecoveryModel = $DatabaseObject.RecoveryModel
       
       write-host $DatabaseName $RecoveryModel
       
       if($RecoveryModel -eq ""Full""){write-host ""$DatabaseName is in $RecoveryModel recovery mode""}
       
       }",,False,,t5_2qo1o,False,,,True,t3_1k1bfy,http://www.reddit.com/r/PowerShell/comments/1k1bfy/issue_passing_sql_database_property_through/,
1376053666.0,1,self.PowerShell,1k0ucw,Strangeness with a custom object.,1,0,5,http://www.reddit.com/r/PowerShell/comments/1k0ucw/strangeness_with_a_custom_object/,"This is driving me nuts.  Why does this come back with an array of custom objects that all have the same data (which coincides with the last server processed)?

    $dhcpservers = netsh dhcp show server | select-string ""location""
    $dhcpservers = $dhcpservers | foreach {$_.tostring()}
    $DHCPServerTemplate = """" | Select-Object name,IP,cn
    $DHCPServersFromAD = @()
    
    foreach ($s in $dhcpservers)
        {
        $server=$s.split(' ,[,],=');$name=$server[2];$IP=$server[6];$CN=$server[11]
        
        $DHCPServerTemplate.name = $name
        $DHCPServerTemplate.IP = $IP
        $DHCPServerTemplate.CN = $CN
    
        $DHCPServersFromAD += $DHCPServerTemplate
        }

    $DHCPServersFromAD
",[Core],False,,t5_2qo1o,False,,,True,t3_1k0ucw,http://www.reddit.com/r/PowerShell/comments/1k0ucw/strangeness_with_a_custom_object/,
